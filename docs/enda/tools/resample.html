<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>enda.tools.resample API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../tools.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;enda.tools</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Resample">Resample</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Resample.downsample">downsample</a>
                        </li>
                        <li>
                                <a class="function" href="#Resample.upsample_and_divide_evenly">upsample_and_divide_evenly</a>
                        </li>
                        <li>
                                <a class="function" href="#Resample.upsample_monthly_data_and_divide_evenly">upsample_monthly_data_and_divide_evenly</a>
                        </li>
                        <li>
                                <a class="function" href="#Resample.upsample_and_interpolate">upsample_and_interpolate</a>
                        </li>
                        <li>
                                <a class="function" href="#Resample.equal_sample_fillna">equal_sample_fillna</a>
                        </li>
                        <li>
                                <a class="function" href="#Resample.forward_fill_final_record">forward_fill_final_record</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../enda.html">enda</a><wbr>.<a href="./../tools.html">tools</a><wbr>.resample    </h1>

                        <div class="docstring"><p>This module contains functions for resampling timeseries</p>
</div>

                        <input id="mod-resample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-resample-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;This module contains functions for resampling timeseries&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">enda.tools.timeseries</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">enda.tools.timezone_utils</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">enda.tools.decorators</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="k">class</span> <span class="nc">Resample</span><span class="p">:</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class contains methods to resample (up or down) timeseries DataFrames&quot;&quot;&quot;</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="k">def</span> <span class="nf">downsample</span><span class="p">(</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>        <span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>        <span class="n">agg_functions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>        <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;start_day&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>        <span class="n">is_original_frequency_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">        Downsample a datetime-indexed pd.DataFrame to a provided frequency using one or several aggregation functions.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        The provided frequency must be greater than the original one in the dataframe index.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        :param freq: the aimed frequency. If given as a pd.Timedelta, it must be convertible to freq string</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">        :param groupby: If a list of columns is provided, the DataFrame will be grouped by specified columns</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">                        before resampling</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        :param agg_functions: aggregate functions used for resampling passed to aggregate().</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">                              If a dict is provided, it must indicate an agg function for each column of the dataframe</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">                              If a string is provided, it will be used for all columns of the dataframe.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">                              Default is &#39;mean&#39; for all columns</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        :param origin: the timestamp on which to adjust the grouping.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">                       Default is &#39;start_day&#39;, i.e. origin is the first day at midnight of the timeseries</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">                       Other options are &#39;epoch&#39;, &#39;start&#39;, &#39;end&#39;, &#39;end_day&#39;. For more details, see</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">                       https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.resample.html</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">        :param is_original_frequency_unique: boolean, if True, ensure there&#39;s no missing value, no extra-point,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">                                             and a single well-defined frequency in the original dataframe</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="k">if</span> <span class="n">groupby</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>            <span class="n">groupby</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>            <span class="n">cols_with_missing_function</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">agg_functions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">groupby</span><span class="p">))</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>            <span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols_with_missing_function</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>                    <span class="s2">&quot;Aggregation function to use has not been set for next columns &quot;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>                    <span class="sa">f</span><span class="s2">&quot; of dataframe: </span><span class="si">{</span><span class="n">cols_with_missing_function</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>                <span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>            <span class="n">agg_functions</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>                <span class="n">_</span><span class="p">:</span> <span class="n">agg_functions</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">groupby</span><span class="p">)))</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>            <span class="p">}</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>                <span class="sa">f</span><span class="s2">&quot;agg_functions must be of type str or dict, found </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead&quot;</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>            <span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="c1"># If we need to group by other columns than the index, it means that there might be duplicates in time index.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="c1"># That could lead &#39;find_most_common_frequency&#39; to return null frequency as the most frequent.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="c1"># Note this does NOT imply the duplicates are reset when downsampling !</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="n">skip_duplicates_for_unique_freq_check</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupby</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="c1"># it return None only if the dataframe has a single record, else it returns the most common frequency</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>            <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="n">skip_duplicates_for_unique_freq_check</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>            <span class="n">original_freq</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>            <span class="ow">and</span> <span class="n">is_original_frequency_unique</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>                <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>                    <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>                    <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                    <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="n">skip_duplicates_for_unique_freq_check</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>                <span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>            <span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="p">):</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Frequency is not unique in the dataframe&quot;</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="c1"># make sure we downsample</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="k">if</span> <span class="n">original_freq</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                <span class="o">&lt;</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="p">):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="sa">f</span><span class="s2">&quot; is smaller than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="c1"># resample using the aggregation function</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupby</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>                <span class="n">agg_functions</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="p">)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="n">columns_in_order_list</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>                <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>                <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                <span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>  <span class="c1"># reorder index</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">columns_in_order_list</span><span class="p">)</span>  <span class="c1"># reorder columns</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>            <span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="n">resampled_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="n">resampled_df</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">upsample_and_divide_evenly</span><span class="p">(</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        Upsample a datetime-indexed pd.DataFrame to a provided frequency and divide the values so that the sum</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        of columns remains the same :</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        {2023-01-01 00:00:00 : 50, 2023-01-01 00:30:00: 40} with 15 minutes resampling should give</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">        {2023-01-01 00:00:00 : 25, 2023-01-01 00:15:00 : 25,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">         2023-01-01 00:30:00 : 20, 2023-01-01 00:45:00 : 20}</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        This is intended for columns with numerical values that vary when changing frequency (such as energy and cost,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        but not power)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        Note there is a forward-filling of the last record before dividing, because it&#39;s the only behaviour that makes</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        sense.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        The provided frequency must be lower than the original one in the dataframe index. Does not work if frequency</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        in the original DataFrame isn&#39;t unique (for example : monthly values, as number of days in a month varies)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        :param freq: the aimed frequency. If given as string, it must be convertible to pd.Timedelta, eg &#39;1D&#39; or &#39;1H&#39;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">                        go from a non-localized timestamp (e.g. dates) to a localized one (e.g. date-times)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="c1"># check it&#39;s not a one-row dataframe, because it cannot be upsampled.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="c1"># Consider using forward_fill and give a gap_timedelta to achieve the objective.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>                <span class="s2">&quot;Cannot upsample an empty or single-record time series; because its initial&quot;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                <span class="s2">&quot; frequency cannot be determined. Consider using &#39;forward_fill_last_record prior.&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="c1"># get to copy</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="c1"># if it&#39;s not a regular frequency, this function cannot work</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">is_regular_freq</span><span class="p">(</span><span class="n">original_freq</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">is_regular_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="p">):</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>                <span class="sa">f</span><span class="s2">&quot;Cannot upsample and divide for an input dataframe with an irregular frequency, &quot;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                <span class="sa">f</span><span class="s2">&quot;(in terms of length). Here, we have original_freq=</span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                <span class="sa">f</span><span class="s2">&quot; and target freq = </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="p">):</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequency is not single-defined in the dataframe&quot;</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="c1"># compute the frequency ration to know how to divide. It should be convertible to pd.Timedelta</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="n">freq_ratio</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>            <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="c1"># make sure we upsample</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="n">freq_ratio</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>                <span class="sa">f</span><span class="s2">&quot; is higher than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="c1"># we must artificially add one timestep to the original dataframe to make sure we don&#39;t miss time steps in the</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="c1"># new frequency. With the example of the docstring, if we don&#39;t do this the 2023-01-01 00:45:00 won&#39;t be</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="c1"># added when resampling which will make the sum of values in the numerical columns false</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="c1"># Note this implies the last record of the resulting index is greater than the initial one.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">original_freq</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">freq_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="n">timeseries_df</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">upsample_monthly_data_and_divide_evenly</span><span class="p">(</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        # @ TODO integrate to the previous function ?</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        Upsample a monthly datetime-indexed pd.DataFrame to a provided frequency and averages the values so that the sum</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        of columns remains the same :</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        {2023-01-01 00:00:00 : 50, 2023-01-01 00:30:00: 40} with 15 minutes resampling should give</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        {2023-01-01 00:00:00 : 25, 2023-01-01 00:15:00 : 25,</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">         2023-01-01 00:30:00 : 20, 2023-01-01 00:45:00 : 20}</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        This is intended for columns with numerical values that vary when changing frequency (such as energy and cost,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        but not power)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        The provided frequency must be lower than the original one in the dataframe index.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        :param freq: the aimed frequency. If given as string, it must be convertible to pd.Timedelta, eg &#39;1D&#39; or &#39;1H&#39;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">                        go from a non-localized timestamp (eg. dates) to a localized one (e.g. date-times)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="c1"># check it&#39;s monthly</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="p">(</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">amount_months</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">month_freq</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="k">if</span> <span class="n">month_freq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">amount_months</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frequency should be monthly but found </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>                <span class="n">resampled_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="c1"># resample using the aggregation function</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="c1"># We must artificially add one timestep to the original dataframe to make sure we don&#39;t miss time steps in the</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="c1"># new frequency. With the example of the docstring, if we don&#39;t do this the 2023-01-01 00:45:00 won&#39;t be</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="c1"># added when resampling which will make the sum of values in the numerical columns false</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">resampled_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">resampled_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="n">resampled_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">resampled_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="n">resampled_df</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>    <span class="k">def</span> <span class="nf">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="n">forward_fill</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="n">is_original_frequency_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="p">):</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        Upsample a datetime-indexed dataframe, and interpolate the columns data according to an interpolating method</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        :param timeseries_df: the dataframe to resample</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        :param freq: the target frequency (timedelta) e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc.)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        :param forward_fill: If True, the upsampling is performed for the last element of the datetimeindex</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        :param is_original_frequency_unique: check whether the frequency is unique in the initial dataframe</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">                        go from a non-localized timestamp (e.g. dates) to a localized one (e.g. date-times)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="c1"># check it&#39;s not a one-row dataframe, because it cannot be upsampled.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>                <span class="s2">&quot;Cannot upsample an empty or single-record time series; because it&#39;s initial&quot;</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>                <span class="s2">&quot; frequency cannot be determined. Consider using &#39;forward_fill_last_record&#39; prior.&quot;</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="n">is_original_frequency_unique</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>                <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="p">):</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequency is not unique in the dataframe&quot;</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="c1"># make sure we downsample</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="n">freq</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="p">)</span> <span class="o">&gt;=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">original_freq</span><span class="p">):</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                <span class="sa">f</span><span class="s2">&quot; is higher than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="c1"># resample and interpolate</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="k">if</span> <span class="n">forward_fill</span><span class="p">:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="c1"># this serves to extend the dataframe, and resample using &#39;ffill&#39; the last element</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>            <span class="c1"># of the dataframe (not impacted by the previous resampling operation).</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>            <span class="c1"># note that in that case, the timedelta must correspond to the initial frequency</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">Resample</span><span class="o">.</span><span class="n">forward_fill_final_record</span><span class="p">(</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">gap_timedelta</span><span class="o">=</span><span class="n">original_freq</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">timeseries_df</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>    <span class="k">def</span> <span class="nf">equal_sample_fillna</span><span class="p">(</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="n">fill_value</span><span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="n">method_filling</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="n">safe_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">        Fill missing values in a datetime-indexed pd.DataFrame with a frequency.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        Two options are possible to fill the missing values:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">            - &#39;fill_value&#39; is used to fill with the same value (can be NaN, default behavior if set to None)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">              all missing timestamp, calling Resampler.asfreq()</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">            - &#39;method_filling&#39; fills missing values calling Resampler.fillna() if method_filling</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">              is in {pad, backfill, ffill, bfill, nearest}</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        :param fill_value: value to fill all missing values.</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        :param method_filling: the method used to fill nan values.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        :param safe_run: boolean, if True, check there is no duplicates nor extra_periods</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">                         that the resampling could delete</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="c1"># check both options (fill_with and method_filling) are not active simultaneously</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">method_filling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>                <span class="sa">f</span><span class="s2">&quot;fill_value = </span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2"> which contradicts method_filling = </span><span class="si">{</span><span class="n">method_filling</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>                <span class="s2">&quot;Only one can be not None.&quot;</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="c1"># get frequency from the initial dataframe.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="n">safe_run</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="c1"># check duplicates</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="n">duplicates</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_duplicates</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                    <span class="sa">f</span><span class="s2">&quot;Duplicates found in the index of the dataframe. The function would delete them, &quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>                    <span class="sa">f</span><span class="s2">&quot;so it&#39;s unsafe to run. duplicates = </span><span class="si">{</span><span class="n">duplicates</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                <span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="c1"># check extra-periods</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="n">extra_periods</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_periods</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                    <span class="sa">f</span><span class="s2">&quot;Extra periods found in the index of the dataframe. The function would delete them,&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                    <span class="sa">f</span><span class="s2">&quot; so it&#39;s unsafe to run. extra_periods = </span><span class="si">{</span><span class="n">extra_periods</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="n">method_filling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="c1"># resample using the method of Resampler.fillna() if provided</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="c1"># throw an error if method_filling is not a valid option</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="n">result_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method_filling</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="c1"># if method_filling is None, we use Resampler.asfreq() with fill_value</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="n">result_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="k">return</span> <span class="n">result_df</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>    <span class="k">def</span> <span class="nf">forward_fill_final_record</span><span class="p">(</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="n">gap_timedelta</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="n">cut_off</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="n">excl_end_time</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>    <span class="p">):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        Forward-fill the final record of a regular datetime-indexed dataframe, keeping the frequency of</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        the initial time series. This function not only add a timestamp, but resample with a forward-fill</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        the timeseries until the desired timestamp.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        Naming &#39;final_ts&#39; the max of the index of the initial dataframe timeseries_df, the resulting index of the</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        final dataframe can be determined from two manners:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">        - using the argument &#39;gap_timedelta&#39; so that the new index goes until final_ts + gap_timedelta (excluded)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">        - using the argument &#39;excl_end_final_date&#39; so that the new index goes until excl_end_time (excluded)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        The resampling frequency is determined from the frequency of the initial dataframe.</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">        The extra parameter &#39;cut_off&#39; can be used to set up a limit not to overpass. It means the resulting index is</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">        truncated to take into account the given cut-off.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">        This function is typically used in junction with upsample_*() to forward-fill the last record.</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">        Here are some examples:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        1. Given timeseries_df:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        time_index                value</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">        2021-01-01 12:00:00+01:00 2</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;1D&#39;):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">        2021-01-01 12:00:00+01:00 2</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">        2021-01-02 12:00:00+01:00 3</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">        2. Given df:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">        time_index                value</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;3H&#39;, cut_off=None):</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">        2021-01-01 23:00:00+01:00 4</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        2021-01-02 00:00:00+01:00 4</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        3. Given df:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">        time_index                value</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;3H&#39;, cut_off=&#39;1D&#39;):</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">        2021-01-01 23:00:00+01:00 4</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">        :param timeseries_df: input datetime-indexed dataframe to be forward-filled.</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">        :param gap_timedelta: The forward-filling is performed using this argument if provided.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">                              Basically, the last index is extended until last_index + gap_timedelta</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">                              This option is incompatible with the setting of the excl_end_time argument</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">        :param cut_off: a timedelta that serves as a cut-off beyond which the final record is not extended</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        :param excl_end_time: The forward-filling is performed using this argument if provided.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">                              Basically, the last index is extended until excl_end_time - timeseries_df.index.freq</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">                              This option is incompatible with the setting of the gap_timedelta argument</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        :return: datetime-indexed dataframe similar to the initial one, with the last record being forward filled</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">                 using the initial frequency of the dataframe index.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="c1"># the last record is understood as the max time (not the last record of the index)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="n">incl_end_time</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">gap_timedelta</span> <span class="ow">and</span> <span class="n">excl_end_time</span><span class="p">:</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>                <span class="s2">&quot;Cannot provide both arguments excl_end_time and gap_timedelta at once&quot;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>            <span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="k">if</span> <span class="n">gap_timedelta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="n">extra_excl_end_time</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>                <span class="n">incl_end_time</span><span class="p">,</span> <span class="n">gap_timedelta</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>            <span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="k">elif</span> <span class="n">excl_end_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="n">extra_excl_end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">excl_end_time</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>            <span class="k">if</span> <span class="n">extra_excl_end_time</span> <span class="o">&lt;=</span> <span class="n">incl_end_time</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>                    <span class="sa">f</span><span class="s2">&quot;Provided extra_excl_end_time=</span><span class="si">{</span><span class="n">extra_excl_end_time</span><span class="si">}</span><span class="s2"> &lt;= &quot;</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>                    <span class="sa">f</span><span class="s2">&quot;max(timeseries_df.index) = </span><span class="si">{</span><span class="n">incl_end_time</span><span class="si">}</span><span class="s2">. Cannot forward-fill.&quot;</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>                <span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>                <span class="s2">&quot;One argument among excl_end_final_date and gap_timedelta must be given&quot;</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>            <span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="c1"># the dataframe is extended using the row of index.max()</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="n">end_row</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">incl_end_time</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duplicate last record, cannot find a way to extrapolate&quot;</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="n">extra_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">incl_end_time</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">extra_excl_end_time</span><span class="p">],</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="n">columns</span><span class="o">=</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="n">extra_row</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="c1"># Add the extra row, and extrapolate using resample</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">end_row</span><span class="p">,</span> <span class="n">extra_row</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">incl_end_time</span><span class="p">,</span> <span class="n">extra_excl_end_time</span><span class="p">])</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="k">if</span> <span class="n">cut_off</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>            <span class="n">cut_off_end</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>                <span class="n">incl_end_time</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">cut_off</span><span class="p">),</span> <span class="n">cut_off</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">cut_off_end</span><span class="p">]</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">timeseries_df</span><span class="p">,</span> <span class="n">result</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            </section>
                <section id="Resample">
                            <input id="Resample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Resample</span>:

                <label class="view-source-button" for="Resample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Resample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Resample-14"><a href="#Resample-14"><span class="linenos"> 14</span></a><span class="k">class</span> <span class="nc">Resample</span><span class="p">:</span>
</span><span id="Resample-15"><a href="#Resample-15"><span class="linenos"> 15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class contains methods to resample (up or down) timeseries DataFrames&quot;&quot;&quot;</span>
</span><span id="Resample-16"><a href="#Resample-16"><span class="linenos"> 16</span></a>
</span><span id="Resample-17"><a href="#Resample-17"><span class="linenos"> 17</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample-18"><a href="#Resample-18"><span class="linenos"> 18</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample-19"><a href="#Resample-19"><span class="linenos"> 19</span></a>    <span class="k">def</span> <span class="nf">downsample</span><span class="p">(</span>
</span><span id="Resample-20"><a href="#Resample-20"><span class="linenos"> 20</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample-21"><a href="#Resample-21"><span class="linenos"> 21</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="Resample-22"><a href="#Resample-22"><span class="linenos"> 22</span></a>        <span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-23"><a href="#Resample-23"><span class="linenos"> 23</span></a>        <span class="n">agg_functions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="Resample-24"><a href="#Resample-24"><span class="linenos"> 24</span></a>        <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;start_day&quot;</span><span class="p">,</span>
</span><span id="Resample-25"><a href="#Resample-25"><span class="linenos"> 25</span></a>        <span class="n">is_original_frequency_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Resample-26"><a href="#Resample-26"><span class="linenos"> 26</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-27"><a href="#Resample-27"><span class="linenos"> 27</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Resample-28"><a href="#Resample-28"><span class="linenos"> 28</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample-29"><a href="#Resample-29"><span class="linenos"> 29</span></a><span class="sd">        Downsample a datetime-indexed pd.DataFrame to a provided frequency using one or several aggregation functions.</span>
</span><span id="Resample-30"><a href="#Resample-30"><span class="linenos"> 30</span></a><span class="sd">        The provided frequency must be greater than the original one in the dataframe index.</span>
</span><span id="Resample-31"><a href="#Resample-31"><span class="linenos"> 31</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="Resample-32"><a href="#Resample-32"><span class="linenos"> 32</span></a><span class="sd">        :param freq: the aimed frequency. If given as a pd.Timedelta, it must be convertible to freq string</span>
</span><span id="Resample-33"><a href="#Resample-33"><span class="linenos"> 33</span></a><span class="sd">        :param groupby: If a list of columns is provided, the DataFrame will be grouped by specified columns</span>
</span><span id="Resample-34"><a href="#Resample-34"><span class="linenos"> 34</span></a><span class="sd">                        before resampling</span>
</span><span id="Resample-35"><a href="#Resample-35"><span class="linenos"> 35</span></a><span class="sd">        :param agg_functions: aggregate functions used for resampling passed to aggregate().</span>
</span><span id="Resample-36"><a href="#Resample-36"><span class="linenos"> 36</span></a><span class="sd">                              If a dict is provided, it must indicate an agg function for each column of the dataframe</span>
</span><span id="Resample-37"><a href="#Resample-37"><span class="linenos"> 37</span></a><span class="sd">                              If a string is provided, it will be used for all columns of the dataframe.</span>
</span><span id="Resample-38"><a href="#Resample-38"><span class="linenos"> 38</span></a><span class="sd">                              Default is &#39;mean&#39; for all columns</span>
</span><span id="Resample-39"><a href="#Resample-39"><span class="linenos"> 39</span></a><span class="sd">        :param origin: the timestamp on which to adjust the grouping.</span>
</span><span id="Resample-40"><a href="#Resample-40"><span class="linenos"> 40</span></a><span class="sd">                       Default is &#39;start_day&#39;, i.e. origin is the first day at midnight of the timeseries</span>
</span><span id="Resample-41"><a href="#Resample-41"><span class="linenos"> 41</span></a><span class="sd">                       Other options are &#39;epoch&#39;, &#39;start&#39;, &#39;end&#39;, &#39;end_day&#39;. For more details, see</span>
</span><span id="Resample-42"><a href="#Resample-42"><span class="linenos"> 42</span></a><span class="sd">                       https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.resample.html</span>
</span><span id="Resample-43"><a href="#Resample-43"><span class="linenos"> 43</span></a><span class="sd">        :param is_original_frequency_unique: boolean, if True, ensure there&#39;s no missing value, no extra-point,</span>
</span><span id="Resample-44"><a href="#Resample-44"><span class="linenos"> 44</span></a><span class="sd">                                             and a single well-defined frequency in the original dataframe</span>
</span><span id="Resample-45"><a href="#Resample-45"><span class="linenos"> 45</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="Resample-46"><a href="#Resample-46"><span class="linenos"> 46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample-47"><a href="#Resample-47"><span class="linenos"> 47</span></a>
</span><span id="Resample-48"><a href="#Resample-48"><span class="linenos"> 48</span></a>        <span class="k">if</span> <span class="n">groupby</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-49"><a href="#Resample-49"><span class="linenos"> 49</span></a>            <span class="n">groupby</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Resample-50"><a href="#Resample-50"><span class="linenos"> 50</span></a>
</span><span id="Resample-51"><a href="#Resample-51"><span class="linenos"> 51</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="Resample-52"><a href="#Resample-52"><span class="linenos"> 52</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="Resample-53"><a href="#Resample-53"><span class="linenos"> 53</span></a>
</span><span id="Resample-54"><a href="#Resample-54"><span class="linenos"> 54</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="Resample-55"><a href="#Resample-55"><span class="linenos"> 55</span></a>            <span class="n">cols_with_missing_function</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
</span><span id="Resample-56"><a href="#Resample-56"><span class="linenos"> 56</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">agg_functions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">groupby</span><span class="p">))</span>
</span><span id="Resample-57"><a href="#Resample-57"><span class="linenos"> 57</span></a>            <span class="p">)</span>
</span><span id="Resample-58"><a href="#Resample-58"><span class="linenos"> 58</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols_with_missing_function</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Resample-59"><a href="#Resample-59"><span class="linenos"> 59</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-60"><a href="#Resample-60"><span class="linenos"> 60</span></a>                    <span class="s2">&quot;Aggregation function to use has not been set for next columns &quot;</span>
</span><span id="Resample-61"><a href="#Resample-61"><span class="linenos"> 61</span></a>                    <span class="sa">f</span><span class="s2">&quot; of dataframe: </span><span class="si">{</span><span class="n">cols_with_missing_function</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-62"><a href="#Resample-62"><span class="linenos"> 62</span></a>                <span class="p">)</span>
</span><span id="Resample-63"><a href="#Resample-63"><span class="linenos"> 63</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Resample-64"><a href="#Resample-64"><span class="linenos"> 64</span></a>            <span class="n">agg_functions</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Resample-65"><a href="#Resample-65"><span class="linenos"> 65</span></a>                <span class="n">_</span><span class="p">:</span> <span class="n">agg_functions</span>
</span><span id="Resample-66"><a href="#Resample-66"><span class="linenos"> 66</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">groupby</span><span class="p">)))</span>
</span><span id="Resample-67"><a href="#Resample-67"><span class="linenos"> 67</span></a>            <span class="p">}</span>
</span><span id="Resample-68"><a href="#Resample-68"><span class="linenos"> 68</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Resample-69"><a href="#Resample-69"><span class="linenos"> 69</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="Resample-70"><a href="#Resample-70"><span class="linenos"> 70</span></a>                <span class="sa">f</span><span class="s2">&quot;agg_functions must be of type str or dict, found </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead&quot;</span>
</span><span id="Resample-71"><a href="#Resample-71"><span class="linenos"> 71</span></a>            <span class="p">)</span>
</span><span id="Resample-72"><a href="#Resample-72"><span class="linenos"> 72</span></a>
</span><span id="Resample-73"><a href="#Resample-73"><span class="linenos"> 73</span></a>        <span class="c1"># If we need to group by other columns than the index, it means that there might be duplicates in time index.</span>
</span><span id="Resample-74"><a href="#Resample-74"><span class="linenos"> 74</span></a>        <span class="c1"># That could lead &#39;find_most_common_frequency&#39; to return null frequency as the most frequent.</span>
</span><span id="Resample-75"><a href="#Resample-75"><span class="linenos"> 75</span></a>        <span class="c1"># Note this does NOT imply the duplicates are reset when downsampling !</span>
</span><span id="Resample-76"><a href="#Resample-76"><span class="linenos"> 76</span></a>        <span class="n">skip_duplicates_for_unique_freq_check</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupby</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="Resample-77"><a href="#Resample-77"><span class="linenos"> 77</span></a>
</span><span id="Resample-78"><a href="#Resample-78"><span class="linenos"> 78</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="Resample-79"><a href="#Resample-79"><span class="linenos"> 79</span></a>        <span class="c1"># it return None only if the dataframe has a single record, else it returns the most common frequency</span>
</span><span id="Resample-80"><a href="#Resample-80"><span class="linenos"> 80</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample-81"><a href="#Resample-81"><span class="linenos"> 81</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="Resample-82"><a href="#Resample-82"><span class="linenos"> 82</span></a>            <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="n">skip_duplicates_for_unique_freq_check</span><span class="p">,</span>
</span><span id="Resample-83"><a href="#Resample-83"><span class="linenos"> 83</span></a>        <span class="p">)</span>
</span><span id="Resample-84"><a href="#Resample-84"><span class="linenos"> 84</span></a>
</span><span id="Resample-85"><a href="#Resample-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="Resample-86"><a href="#Resample-86"><span class="linenos"> 86</span></a>            <span class="n">original_freq</span>
</span><span id="Resample-87"><a href="#Resample-87"><span class="linenos"> 87</span></a>            <span class="ow">and</span> <span class="n">is_original_frequency_unique</span>
</span><span id="Resample-88"><a href="#Resample-88"><span class="linenos"> 88</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="Resample-89"><a href="#Resample-89"><span class="linenos"> 89</span></a>                <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="Resample-90"><a href="#Resample-90"><span class="linenos"> 90</span></a>                    <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="Resample-91"><a href="#Resample-91"><span class="linenos"> 91</span></a>                    <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Resample-92"><a href="#Resample-92"><span class="linenos"> 92</span></a>                    <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="n">skip_duplicates_for_unique_freq_check</span><span class="p">,</span>
</span><span id="Resample-93"><a href="#Resample-93"><span class="linenos"> 93</span></a>                <span class="p">)</span>
</span><span id="Resample-94"><a href="#Resample-94"><span class="linenos"> 94</span></a>            <span class="p">)</span>
</span><span id="Resample-95"><a href="#Resample-95"><span class="linenos"> 95</span></a>        <span class="p">):</span>
</span><span id="Resample-96"><a href="#Resample-96"><span class="linenos"> 96</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Frequency is not unique in the dataframe&quot;</span><span class="p">)</span>
</span><span id="Resample-97"><a href="#Resample-97"><span class="linenos"> 97</span></a>
</span><span id="Resample-98"><a href="#Resample-98"><span class="linenos"> 98</span></a>        <span class="c1"># make sure we downsample</span>
</span><span id="Resample-99"><a href="#Resample-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="n">original_freq</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="Resample-100"><a href="#Resample-100"><span class="linenos">100</span></a>                <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="Resample-101"><a href="#Resample-101"><span class="linenos">101</span></a>                <span class="o">&lt;</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span>
</span><span id="Resample-102"><a href="#Resample-102"><span class="linenos">102</span></a>        <span class="p">):</span>
</span><span id="Resample-103"><a href="#Resample-103"><span class="linenos">103</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Resample-104"><a href="#Resample-104"><span class="linenos">104</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-105"><a href="#Resample-105"><span class="linenos">105</span></a>                <span class="sa">f</span><span class="s2">&quot; is smaller than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-106"><a href="#Resample-106"><span class="linenos">106</span></a>            <span class="p">)</span>
</span><span id="Resample-107"><a href="#Resample-107"><span class="linenos">107</span></a>
</span><span id="Resample-108"><a href="#Resample-108"><span class="linenos">108</span></a>        <span class="c1"># resample using the aggregation function</span>
</span><span id="Resample-109"><a href="#Resample-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupby</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Resample-110"><a href="#Resample-110"><span class="linenos">110</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
</span><span id="Resample-111"><a href="#Resample-111"><span class="linenos">111</span></a>                <span class="n">agg_functions</span>
</span><span id="Resample-112"><a href="#Resample-112"><span class="linenos">112</span></a>            <span class="p">)</span>
</span><span id="Resample-113"><a href="#Resample-113"><span class="linenos">113</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Resample-114"><a href="#Resample-114"><span class="linenos">114</span></a>            <span class="n">columns_in_order_list</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="Resample-115"><a href="#Resample-115"><span class="linenos">115</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Resample-116"><a href="#Resample-116"><span class="linenos">116</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
</span><span id="Resample-117"><a href="#Resample-117"><span class="linenos">117</span></a>                <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
</span><span id="Resample-118"><a href="#Resample-118"><span class="linenos">118</span></a>                <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">)</span>
</span><span id="Resample-119"><a href="#Resample-119"><span class="linenos">119</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
</span><span id="Resample-120"><a href="#Resample-120"><span class="linenos">120</span></a>                <span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>  <span class="c1"># reorder index</span>
</span><span id="Resample-121"><a href="#Resample-121"><span class="linenos">121</span></a>                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">columns_in_order_list</span><span class="p">)</span>  <span class="c1"># reorder columns</span>
</span><span id="Resample-122"><a href="#Resample-122"><span class="linenos">122</span></a>            <span class="p">)</span>
</span><span id="Resample-123"><a href="#Resample-123"><span class="linenos">123</span></a>
</span><span id="Resample-124"><a href="#Resample-124"><span class="linenos">124</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="Resample-125"><a href="#Resample-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-126"><a href="#Resample-126"><span class="linenos">126</span></a>            <span class="n">resampled_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="Resample-127"><a href="#Resample-127"><span class="linenos">127</span></a>
</span><span id="Resample-128"><a href="#Resample-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">resampled_df</span>
</span><span id="Resample-129"><a href="#Resample-129"><span class="linenos">129</span></a>
</span><span id="Resample-130"><a href="#Resample-130"><span class="linenos">130</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample-131"><a href="#Resample-131"><span class="linenos">131</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample-132"><a href="#Resample-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">upsample_and_divide_evenly</span><span class="p">(</span>
</span><span id="Resample-133"><a href="#Resample-133"><span class="linenos">133</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample-134"><a href="#Resample-134"><span class="linenos">134</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="Resample-135"><a href="#Resample-135"><span class="linenos">135</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-136"><a href="#Resample-136"><span class="linenos">136</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-137"><a href="#Resample-137"><span class="linenos">137</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Resample-138"><a href="#Resample-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample-139"><a href="#Resample-139"><span class="linenos">139</span></a><span class="sd">        Upsample a datetime-indexed pd.DataFrame to a provided frequency and divide the values so that the sum</span>
</span><span id="Resample-140"><a href="#Resample-140"><span class="linenos">140</span></a><span class="sd">        of columns remains the same :</span>
</span><span id="Resample-141"><a href="#Resample-141"><span class="linenos">141</span></a><span class="sd">        {2023-01-01 00:00:00 : 50, 2023-01-01 00:30:00: 40} with 15 minutes resampling should give</span>
</span><span id="Resample-142"><a href="#Resample-142"><span class="linenos">142</span></a><span class="sd">        {2023-01-01 00:00:00 : 25, 2023-01-01 00:15:00 : 25,</span>
</span><span id="Resample-143"><a href="#Resample-143"><span class="linenos">143</span></a><span class="sd">         2023-01-01 00:30:00 : 20, 2023-01-01 00:45:00 : 20}</span>
</span><span id="Resample-144"><a href="#Resample-144"><span class="linenos">144</span></a><span class="sd">        This is intended for columns with numerical values that vary when changing frequency (such as energy and cost,</span>
</span><span id="Resample-145"><a href="#Resample-145"><span class="linenos">145</span></a><span class="sd">        but not power)</span>
</span><span id="Resample-146"><a href="#Resample-146"><span class="linenos">146</span></a><span class="sd">        Note there is a forward-filling of the last record before dividing, because it&#39;s the only behaviour that makes</span>
</span><span id="Resample-147"><a href="#Resample-147"><span class="linenos">147</span></a><span class="sd">        sense.</span>
</span><span id="Resample-148"><a href="#Resample-148"><span class="linenos">148</span></a><span class="sd">        The provided frequency must be lower than the original one in the dataframe index. Does not work if frequency</span>
</span><span id="Resample-149"><a href="#Resample-149"><span class="linenos">149</span></a><span class="sd">        in the original DataFrame isn&#39;t unique (for example : monthly values, as number of days in a month varies)</span>
</span><span id="Resample-150"><a href="#Resample-150"><span class="linenos">150</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="Resample-151"><a href="#Resample-151"><span class="linenos">151</span></a><span class="sd">        :param freq: the aimed frequency. If given as string, it must be convertible to pd.Timedelta, eg &#39;1D&#39; or &#39;1H&#39;</span>
</span><span id="Resample-152"><a href="#Resample-152"><span class="linenos">152</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="Resample-153"><a href="#Resample-153"><span class="linenos">153</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="Resample-154"><a href="#Resample-154"><span class="linenos">154</span></a><span class="sd">                        go from a non-localized timestamp (e.g. dates) to a localized one (e.g. date-times)</span>
</span><span id="Resample-155"><a href="#Resample-155"><span class="linenos">155</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="Resample-156"><a href="#Resample-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample-157"><a href="#Resample-157"><span class="linenos">157</span></a>
</span><span id="Resample-158"><a href="#Resample-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="Resample-159"><a href="#Resample-159"><span class="linenos">159</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="Resample-160"><a href="#Resample-160"><span class="linenos">160</span></a>
</span><span id="Resample-161"><a href="#Resample-161"><span class="linenos">161</span></a>        <span class="c1"># check it&#39;s not a one-row dataframe, because it cannot be upsampled.</span>
</span><span id="Resample-162"><a href="#Resample-162"><span class="linenos">162</span></a>        <span class="c1"># Consider using forward_fill and give a gap_timedelta to achieve the objective.</span>
</span><span id="Resample-163"><a href="#Resample-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample-164"><a href="#Resample-164"><span class="linenos">164</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-165"><a href="#Resample-165"><span class="linenos">165</span></a>                <span class="s2">&quot;Cannot upsample an empty or single-record time series; because its initial&quot;</span>
</span><span id="Resample-166"><a href="#Resample-166"><span class="linenos">166</span></a>                <span class="s2">&quot; frequency cannot be determined. Consider using &#39;forward_fill_last_record prior.&quot;</span>
</span><span id="Resample-167"><a href="#Resample-167"><span class="linenos">167</span></a>            <span class="p">)</span>
</span><span id="Resample-168"><a href="#Resample-168"><span class="linenos">168</span></a>
</span><span id="Resample-169"><a href="#Resample-169"><span class="linenos">169</span></a>        <span class="c1"># get to copy</span>
</span><span id="Resample-170"><a href="#Resample-170"><span class="linenos">170</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Resample-171"><a href="#Resample-171"><span class="linenos">171</span></a>
</span><span id="Resample-172"><a href="#Resample-172"><span class="linenos">172</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="Resample-173"><a href="#Resample-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-174"><a href="#Resample-174"><span class="linenos">174</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="Resample-175"><a href="#Resample-175"><span class="linenos">175</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="Resample-176"><a href="#Resample-176"><span class="linenos">176</span></a>            <span class="p">)</span>
</span><span id="Resample-177"><a href="#Resample-177"><span class="linenos">177</span></a>
</span><span id="Resample-178"><a href="#Resample-178"><span class="linenos">178</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="Resample-179"><a href="#Resample-179"><span class="linenos">179</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample-180"><a href="#Resample-180"><span class="linenos">180</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample-181"><a href="#Resample-181"><span class="linenos">181</span></a>        <span class="p">)</span>
</span><span id="Resample-182"><a href="#Resample-182"><span class="linenos">182</span></a>
</span><span id="Resample-183"><a href="#Resample-183"><span class="linenos">183</span></a>        <span class="c1"># if it&#39;s not a regular frequency, this function cannot work</span>
</span><span id="Resample-184"><a href="#Resample-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">is_regular_freq</span><span class="p">(</span><span class="n">original_freq</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="Resample-185"><a href="#Resample-185"><span class="linenos">185</span></a>            <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">is_regular_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="Resample-186"><a href="#Resample-186"><span class="linenos">186</span></a>        <span class="p">):</span>
</span><span id="Resample-187"><a href="#Resample-187"><span class="linenos">187</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-188"><a href="#Resample-188"><span class="linenos">188</span></a>                <span class="sa">f</span><span class="s2">&quot;Cannot upsample and divide for an input dataframe with an irregular frequency, &quot;</span>
</span><span id="Resample-189"><a href="#Resample-189"><span class="linenos">189</span></a>                <span class="sa">f</span><span class="s2">&quot;(in terms of length). Here, we have original_freq=</span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Resample-190"><a href="#Resample-190"><span class="linenos">190</span></a>                <span class="sa">f</span><span class="s2">&quot; and target freq = </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-191"><a href="#Resample-191"><span class="linenos">191</span></a>            <span class="p">)</span>
</span><span id="Resample-192"><a href="#Resample-192"><span class="linenos">192</span></a>
</span><span id="Resample-193"><a href="#Resample-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="Resample-194"><a href="#Resample-194"><span class="linenos">194</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="Resample-195"><a href="#Resample-195"><span class="linenos">195</span></a>            <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Resample-196"><a href="#Resample-196"><span class="linenos">196</span></a>            <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Resample-197"><a href="#Resample-197"><span class="linenos">197</span></a>        <span class="p">):</span>
</span><span id="Resample-198"><a href="#Resample-198"><span class="linenos">198</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequency is not single-defined in the dataframe&quot;</span><span class="p">)</span>
</span><span id="Resample-199"><a href="#Resample-199"><span class="linenos">199</span></a>
</span><span id="Resample-200"><a href="#Resample-200"><span class="linenos">200</span></a>        <span class="c1"># compute the frequency ration to know how to divide. It should be convertible to pd.Timedelta</span>
</span><span id="Resample-201"><a href="#Resample-201"><span class="linenos">201</span></a>        <span class="n">freq_ratio</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Resample-202"><a href="#Resample-202"><span class="linenos">202</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="Resample-203"><a href="#Resample-203"><span class="linenos">203</span></a>            <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="Resample-204"><a href="#Resample-204"><span class="linenos">204</span></a>        <span class="p">)</span>
</span><span id="Resample-205"><a href="#Resample-205"><span class="linenos">205</span></a>
</span><span id="Resample-206"><a href="#Resample-206"><span class="linenos">206</span></a>        <span class="c1"># make sure we upsample</span>
</span><span id="Resample-207"><a href="#Resample-207"><span class="linenos">207</span></a>        <span class="k">if</span> <span class="n">freq_ratio</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample-208"><a href="#Resample-208"><span class="linenos">208</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-209"><a href="#Resample-209"><span class="linenos">209</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-210"><a href="#Resample-210"><span class="linenos">210</span></a>                <span class="sa">f</span><span class="s2">&quot; is higher than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-211"><a href="#Resample-211"><span class="linenos">211</span></a>            <span class="p">)</span>
</span><span id="Resample-212"><a href="#Resample-212"><span class="linenos">212</span></a>
</span><span id="Resample-213"><a href="#Resample-213"><span class="linenos">213</span></a>        <span class="c1"># we must artificially add one timestep to the original dataframe to make sure we don&#39;t miss time steps in the</span>
</span><span id="Resample-214"><a href="#Resample-214"><span class="linenos">214</span></a>        <span class="c1"># new frequency. With the example of the docstring, if we don&#39;t do this the 2023-01-01 00:45:00 won&#39;t be</span>
</span><span id="Resample-215"><a href="#Resample-215"><span class="linenos">215</span></a>        <span class="c1"># added when resampling which will make the sum of values in the numerical columns false</span>
</span><span id="Resample-216"><a href="#Resample-216"><span class="linenos">216</span></a>        <span class="c1"># Note this implies the last record of the resulting index is greater than the initial one.</span>
</span><span id="Resample-217"><a href="#Resample-217"><span class="linenos">217</span></a>        <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Resample-218"><a href="#Resample-218"><span class="linenos">218</span></a>            <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="Resample-219"><a href="#Resample-219"><span class="linenos">219</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">original_freq</span>
</span><span id="Resample-220"><a href="#Resample-220"><span class="linenos">220</span></a>            <span class="p">)</span>
</span><span id="Resample-221"><a href="#Resample-221"><span class="linenos">221</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Resample-222"><a href="#Resample-222"><span class="linenos">222</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">freq_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Resample-223"><a href="#Resample-223"><span class="linenos">223</span></a>
</span><span id="Resample-224"><a href="#Resample-224"><span class="linenos">224</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="Resample-225"><a href="#Resample-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-226"><a href="#Resample-226"><span class="linenos">226</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="Resample-227"><a href="#Resample-227"><span class="linenos">227</span></a>
</span><span id="Resample-228"><a href="#Resample-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="n">timeseries_df</span>
</span><span id="Resample-229"><a href="#Resample-229"><span class="linenos">229</span></a>
</span><span id="Resample-230"><a href="#Resample-230"><span class="linenos">230</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample-231"><a href="#Resample-231"><span class="linenos">231</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample-232"><a href="#Resample-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">upsample_monthly_data_and_divide_evenly</span><span class="p">(</span>
</span><span id="Resample-233"><a href="#Resample-233"><span class="linenos">233</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample-234"><a href="#Resample-234"><span class="linenos">234</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="Resample-235"><a href="#Resample-235"><span class="linenos">235</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-236"><a href="#Resample-236"><span class="linenos">236</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Resample-237"><a href="#Resample-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample-238"><a href="#Resample-238"><span class="linenos">238</span></a><span class="sd">        # @ TODO integrate to the previous function ?</span>
</span><span id="Resample-239"><a href="#Resample-239"><span class="linenos">239</span></a><span class="sd">        Upsample a monthly datetime-indexed pd.DataFrame to a provided frequency and averages the values so that the sum</span>
</span><span id="Resample-240"><a href="#Resample-240"><span class="linenos">240</span></a><span class="sd">        of columns remains the same :</span>
</span><span id="Resample-241"><a href="#Resample-241"><span class="linenos">241</span></a><span class="sd">        {2023-01-01 00:00:00 : 50, 2023-01-01 00:30:00: 40} with 15 minutes resampling should give</span>
</span><span id="Resample-242"><a href="#Resample-242"><span class="linenos">242</span></a><span class="sd">        {2023-01-01 00:00:00 : 25, 2023-01-01 00:15:00 : 25,</span>
</span><span id="Resample-243"><a href="#Resample-243"><span class="linenos">243</span></a><span class="sd">         2023-01-01 00:30:00 : 20, 2023-01-01 00:45:00 : 20}</span>
</span><span id="Resample-244"><a href="#Resample-244"><span class="linenos">244</span></a><span class="sd">        This is intended for columns with numerical values that vary when changing frequency (such as energy and cost,</span>
</span><span id="Resample-245"><a href="#Resample-245"><span class="linenos">245</span></a><span class="sd">        but not power)</span>
</span><span id="Resample-246"><a href="#Resample-246"><span class="linenos">246</span></a><span class="sd">        The provided frequency must be lower than the original one in the dataframe index.</span>
</span><span id="Resample-247"><a href="#Resample-247"><span class="linenos">247</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="Resample-248"><a href="#Resample-248"><span class="linenos">248</span></a><span class="sd">        :param freq: the aimed frequency. If given as string, it must be convertible to pd.Timedelta, eg &#39;1D&#39; or &#39;1H&#39;</span>
</span><span id="Resample-249"><a href="#Resample-249"><span class="linenos">249</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="Resample-250"><a href="#Resample-250"><span class="linenos">250</span></a><span class="sd">                        go from a non-localized timestamp (eg. dates) to a localized one (e.g. date-times)</span>
</span><span id="Resample-251"><a href="#Resample-251"><span class="linenos">251</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="Resample-252"><a href="#Resample-252"><span class="linenos">252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample-253"><a href="#Resample-253"><span class="linenos">253</span></a>
</span><span id="Resample-254"><a href="#Resample-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="Resample-255"><a href="#Resample-255"><span class="linenos">255</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="Resample-256"><a href="#Resample-256"><span class="linenos">256</span></a>
</span><span id="Resample-257"><a href="#Resample-257"><span class="linenos">257</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="Resample-258"><a href="#Resample-258"><span class="linenos">258</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample-259"><a href="#Resample-259"><span class="linenos">259</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample-260"><a href="#Resample-260"><span class="linenos">260</span></a>        <span class="p">)</span>
</span><span id="Resample-261"><a href="#Resample-261"><span class="linenos">261</span></a>
</span><span id="Resample-262"><a href="#Resample-262"><span class="linenos">262</span></a>        <span class="c1"># check it&#39;s monthly</span>
</span><span id="Resample-263"><a href="#Resample-263"><span class="linenos">263</span></a>        <span class="p">(</span>
</span><span id="Resample-264"><a href="#Resample-264"><span class="linenos">264</span></a>            <span class="n">amount_months</span><span class="p">,</span>
</span><span id="Resample-265"><a href="#Resample-265"><span class="linenos">265</span></a>            <span class="n">month_freq</span><span class="p">,</span>
</span><span id="Resample-266"><a href="#Resample-266"><span class="linenos">266</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span>
</span><span id="Resample-267"><a href="#Resample-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">month_freq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">amount_months</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample-268"><a href="#Resample-268"><span class="linenos">268</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frequency should be monthly but found </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Resample-269"><a href="#Resample-269"><span class="linenos">269</span></a>
</span><span id="Resample-270"><a href="#Resample-270"><span class="linenos">270</span></a>        <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Resample-271"><a href="#Resample-271"><span class="linenos">271</span></a>
</span><span id="Resample-272"><a href="#Resample-272"><span class="linenos">272</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="Resample-273"><a href="#Resample-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-274"><a href="#Resample-274"><span class="linenos">274</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="Resample-275"><a href="#Resample-275"><span class="linenos">275</span></a>                <span class="n">resampled_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="Resample-276"><a href="#Resample-276"><span class="linenos">276</span></a>            <span class="p">)</span>
</span><span id="Resample-277"><a href="#Resample-277"><span class="linenos">277</span></a>
</span><span id="Resample-278"><a href="#Resample-278"><span class="linenos">278</span></a>        <span class="c1"># resample using the aggregation function</span>
</span><span id="Resample-279"><a href="#Resample-279"><span class="linenos">279</span></a>        <span class="c1"># We must artificially add one timestep to the original dataframe to make sure we don&#39;t miss time steps in the</span>
</span><span id="Resample-280"><a href="#Resample-280"><span class="linenos">280</span></a>        <span class="c1"># new frequency. With the example of the docstring, if we don&#39;t do this the 2023-01-01 00:45:00 won&#39;t be</span>
</span><span id="Resample-281"><a href="#Resample-281"><span class="linenos">281</span></a>        <span class="c1"># added when resampling which will make the sum of values in the numerical columns false</span>
</span><span id="Resample-282"><a href="#Resample-282"><span class="linenos">282</span></a>        <span class="n">resampled_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">resampled_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Resample-283"><a href="#Resample-283"><span class="linenos">283</span></a>        <span class="n">resampled_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Resample-284"><a href="#Resample-284"><span class="linenos">284</span></a>            <span class="n">resampled_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="Resample-285"><a href="#Resample-285"><span class="linenos">285</span></a>            <span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
</span><span id="Resample-286"><a href="#Resample-286"><span class="linenos">286</span></a>            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Resample-287"><a href="#Resample-287"><span class="linenos">287</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Resample-288"><a href="#Resample-288"><span class="linenos">288</span></a>            <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
</span><span id="Resample-289"><a href="#Resample-289"><span class="linenos">289</span></a>        <span class="p">)</span>
</span><span id="Resample-290"><a href="#Resample-290"><span class="linenos">290</span></a>
</span><span id="Resample-291"><a href="#Resample-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">resampled_df</span>
</span><span id="Resample-292"><a href="#Resample-292"><span class="linenos">292</span></a>
</span><span id="Resample-293"><a href="#Resample-293"><span class="linenos">293</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample-294"><a href="#Resample-294"><span class="linenos">294</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample-295"><a href="#Resample-295"><span class="linenos">295</span></a>    <span class="k">def</span> <span class="nf">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="Resample-296"><a href="#Resample-296"><span class="linenos">296</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample-297"><a href="#Resample-297"><span class="linenos">297</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="Resample-298"><a href="#Resample-298"><span class="linenos">298</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="Resample-299"><a href="#Resample-299"><span class="linenos">299</span></a>        <span class="n">forward_fill</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Resample-300"><a href="#Resample-300"><span class="linenos">300</span></a>        <span class="n">is_original_frequency_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Resample-301"><a href="#Resample-301"><span class="linenos">301</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-302"><a href="#Resample-302"><span class="linenos">302</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-303"><a href="#Resample-303"><span class="linenos">303</span></a>    <span class="p">):</span>
</span><span id="Resample-304"><a href="#Resample-304"><span class="linenos">304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample-305"><a href="#Resample-305"><span class="linenos">305</span></a><span class="sd">        Upsample a datetime-indexed dataframe, and interpolate the columns data according to an interpolating method</span>
</span><span id="Resample-306"><a href="#Resample-306"><span class="linenos">306</span></a><span class="sd">        :param timeseries_df: the dataframe to resample</span>
</span><span id="Resample-307"><a href="#Resample-307"><span class="linenos">307</span></a><span class="sd">        :param freq: the target frequency (timedelta) e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc.</span>
</span><span id="Resample-308"><a href="#Resample-308"><span class="linenos">308</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc.)</span>
</span><span id="Resample-309"><a href="#Resample-309"><span class="linenos">309</span></a><span class="sd">        :param forward_fill: If True, the upsampling is performed for the last element of the datetimeindex</span>
</span><span id="Resample-310"><a href="#Resample-310"><span class="linenos">310</span></a><span class="sd">        :param is_original_frequency_unique: check whether the frequency is unique in the initial dataframe</span>
</span><span id="Resample-311"><a href="#Resample-311"><span class="linenos">311</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="Resample-312"><a href="#Resample-312"><span class="linenos">312</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="Resample-313"><a href="#Resample-313"><span class="linenos">313</span></a><span class="sd">                        go from a non-localized timestamp (e.g. dates) to a localized one (e.g. date-times)</span>
</span><span id="Resample-314"><a href="#Resample-314"><span class="linenos">314</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="Resample-315"><a href="#Resample-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample-316"><a href="#Resample-316"><span class="linenos">316</span></a>
</span><span id="Resample-317"><a href="#Resample-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="Resample-318"><a href="#Resample-318"><span class="linenos">318</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="Resample-319"><a href="#Resample-319"><span class="linenos">319</span></a>
</span><span id="Resample-320"><a href="#Resample-320"><span class="linenos">320</span></a>        <span class="c1"># check it&#39;s not a one-row dataframe, because it cannot be upsampled.</span>
</span><span id="Resample-321"><a href="#Resample-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample-322"><a href="#Resample-322"><span class="linenos">322</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-323"><a href="#Resample-323"><span class="linenos">323</span></a>                <span class="s2">&quot;Cannot upsample an empty or single-record time series; because it&#39;s initial&quot;</span>
</span><span id="Resample-324"><a href="#Resample-324"><span class="linenos">324</span></a>                <span class="s2">&quot; frequency cannot be determined. Consider using &#39;forward_fill_last_record&#39; prior.&quot;</span>
</span><span id="Resample-325"><a href="#Resample-325"><span class="linenos">325</span></a>            <span class="p">)</span>
</span><span id="Resample-326"><a href="#Resample-326"><span class="linenos">326</span></a>
</span><span id="Resample-327"><a href="#Resample-327"><span class="linenos">327</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Resample-328"><a href="#Resample-328"><span class="linenos">328</span></a>
</span><span id="Resample-329"><a href="#Resample-329"><span class="linenos">329</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="Resample-330"><a href="#Resample-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-331"><a href="#Resample-331"><span class="linenos">331</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="Resample-332"><a href="#Resample-332"><span class="linenos">332</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="Resample-333"><a href="#Resample-333"><span class="linenos">333</span></a>            <span class="p">)</span>
</span><span id="Resample-334"><a href="#Resample-334"><span class="linenos">334</span></a>
</span><span id="Resample-335"><a href="#Resample-335"><span class="linenos">335</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="Resample-336"><a href="#Resample-336"><span class="linenos">336</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample-337"><a href="#Resample-337"><span class="linenos">337</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample-338"><a href="#Resample-338"><span class="linenos">338</span></a>        <span class="p">)</span>
</span><span id="Resample-339"><a href="#Resample-339"><span class="linenos">339</span></a>
</span><span id="Resample-340"><a href="#Resample-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">is_original_frequency_unique</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="Resample-341"><a href="#Resample-341"><span class="linenos">341</span></a>            <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="Resample-342"><a href="#Resample-342"><span class="linenos">342</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="Resample-343"><a href="#Resample-343"><span class="linenos">343</span></a>                <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Resample-344"><a href="#Resample-344"><span class="linenos">344</span></a>                <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Resample-345"><a href="#Resample-345"><span class="linenos">345</span></a>            <span class="p">)</span>
</span><span id="Resample-346"><a href="#Resample-346"><span class="linenos">346</span></a>        <span class="p">):</span>
</span><span id="Resample-347"><a href="#Resample-347"><span class="linenos">347</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequency is not unique in the dataframe&quot;</span><span class="p">)</span>
</span><span id="Resample-348"><a href="#Resample-348"><span class="linenos">348</span></a>
</span><span id="Resample-349"><a href="#Resample-349"><span class="linenos">349</span></a>        <span class="c1"># make sure we downsample</span>
</span><span id="Resample-350"><a href="#Resample-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span>
</span><span id="Resample-351"><a href="#Resample-351"><span class="linenos">351</span></a>            <span class="n">freq</span>
</span><span id="Resample-352"><a href="#Resample-352"><span class="linenos">352</span></a>        <span class="p">)</span> <span class="o">&gt;=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">original_freq</span><span class="p">):</span>
</span><span id="Resample-353"><a href="#Resample-353"><span class="linenos">353</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-354"><a href="#Resample-354"><span class="linenos">354</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-355"><a href="#Resample-355"><span class="linenos">355</span></a>                <span class="sa">f</span><span class="s2">&quot; is higher than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-356"><a href="#Resample-356"><span class="linenos">356</span></a>            <span class="p">)</span>
</span><span id="Resample-357"><a href="#Resample-357"><span class="linenos">357</span></a>        <span class="c1"># resample and interpolate</span>
</span><span id="Resample-358"><a href="#Resample-358"><span class="linenos">358</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
</span><span id="Resample-359"><a href="#Resample-359"><span class="linenos">359</span></a>
</span><span id="Resample-360"><a href="#Resample-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="n">forward_fill</span><span class="p">:</span>
</span><span id="Resample-361"><a href="#Resample-361"><span class="linenos">361</span></a>            <span class="c1"># this serves to extend the dataframe, and resample using &#39;ffill&#39; the last element</span>
</span><span id="Resample-362"><a href="#Resample-362"><span class="linenos">362</span></a>            <span class="c1"># of the dataframe (not impacted by the previous resampling operation).</span>
</span><span id="Resample-363"><a href="#Resample-363"><span class="linenos">363</span></a>            <span class="c1"># note that in that case, the timedelta must correspond to the initial frequency</span>
</span><span id="Resample-364"><a href="#Resample-364"><span class="linenos">364</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">Resample</span><span class="o">.</span><span class="n">forward_fill_final_record</span><span class="p">(</span>
</span><span id="Resample-365"><a href="#Resample-365"><span class="linenos">365</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">gap_timedelta</span><span class="o">=</span><span class="n">original_freq</span>
</span><span id="Resample-366"><a href="#Resample-366"><span class="linenos">366</span></a>            <span class="p">)</span>
</span><span id="Resample-367"><a href="#Resample-367"><span class="linenos">367</span></a>
</span><span id="Resample-368"><a href="#Resample-368"><span class="linenos">368</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="Resample-369"><a href="#Resample-369"><span class="linenos">369</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-370"><a href="#Resample-370"><span class="linenos">370</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="Resample-371"><a href="#Resample-371"><span class="linenos">371</span></a>
</span><span id="Resample-372"><a href="#Resample-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">timeseries_df</span>
</span><span id="Resample-373"><a href="#Resample-373"><span class="linenos">373</span></a>
</span><span id="Resample-374"><a href="#Resample-374"><span class="linenos">374</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample-375"><a href="#Resample-375"><span class="linenos">375</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample-376"><a href="#Resample-376"><span class="linenos">376</span></a>    <span class="k">def</span> <span class="nf">equal_sample_fillna</span><span class="p">(</span>
</span><span id="Resample-377"><a href="#Resample-377"><span class="linenos">377</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample-378"><a href="#Resample-378"><span class="linenos">378</span></a>        <span class="n">fill_value</span><span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-379"><a href="#Resample-379"><span class="linenos">379</span></a>        <span class="n">method_filling</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-380"><a href="#Resample-380"><span class="linenos">380</span></a>        <span class="n">safe_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Resample-381"><a href="#Resample-381"><span class="linenos">381</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Resample-382"><a href="#Resample-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample-383"><a href="#Resample-383"><span class="linenos">383</span></a><span class="sd">        Fill missing values in a datetime-indexed pd.DataFrame with a frequency.</span>
</span><span id="Resample-384"><a href="#Resample-384"><span class="linenos">384</span></a><span class="sd">        Two options are possible to fill the missing values:</span>
</span><span id="Resample-385"><a href="#Resample-385"><span class="linenos">385</span></a><span class="sd">            - &#39;fill_value&#39; is used to fill with the same value (can be NaN, default behavior if set to None)</span>
</span><span id="Resample-386"><a href="#Resample-386"><span class="linenos">386</span></a><span class="sd">              all missing timestamp, calling Resampler.asfreq()</span>
</span><span id="Resample-387"><a href="#Resample-387"><span class="linenos">387</span></a><span class="sd">            - &#39;method_filling&#39; fills missing values calling Resampler.fillna() if method_filling</span>
</span><span id="Resample-388"><a href="#Resample-388"><span class="linenos">388</span></a><span class="sd">              is in {pad, backfill, ffill, bfill, nearest}</span>
</span><span id="Resample-389"><a href="#Resample-389"><span class="linenos">389</span></a>
</span><span id="Resample-390"><a href="#Resample-390"><span class="linenos">390</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="Resample-391"><a href="#Resample-391"><span class="linenos">391</span></a><span class="sd">        :param fill_value: value to fill all missing values.</span>
</span><span id="Resample-392"><a href="#Resample-392"><span class="linenos">392</span></a><span class="sd">        :param method_filling: the method used to fill nan values.</span>
</span><span id="Resample-393"><a href="#Resample-393"><span class="linenos">393</span></a><span class="sd">        :param safe_run: boolean, if True, check there is no duplicates nor extra_periods</span>
</span><span id="Resample-394"><a href="#Resample-394"><span class="linenos">394</span></a><span class="sd">                         that the resampling could delete</span>
</span><span id="Resample-395"><a href="#Resample-395"><span class="linenos">395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample-396"><a href="#Resample-396"><span class="linenos">396</span></a>
</span><span id="Resample-397"><a href="#Resample-397"><span class="linenos">397</span></a>        <span class="c1"># check both options (fill_with and method_filling) are not active simultaneously</span>
</span><span id="Resample-398"><a href="#Resample-398"><span class="linenos">398</span></a>        <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">method_filling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-399"><a href="#Resample-399"><span class="linenos">399</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-400"><a href="#Resample-400"><span class="linenos">400</span></a>                <span class="sa">f</span><span class="s2">&quot;fill_value = </span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2"> which contradicts method_filling = </span><span class="si">{</span><span class="n">method_filling</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="Resample-401"><a href="#Resample-401"><span class="linenos">401</span></a>                <span class="s2">&quot;Only one can be not None.&quot;</span>
</span><span id="Resample-402"><a href="#Resample-402"><span class="linenos">402</span></a>            <span class="p">)</span>
</span><span id="Resample-403"><a href="#Resample-403"><span class="linenos">403</span></a>
</span><span id="Resample-404"><a href="#Resample-404"><span class="linenos">404</span></a>        <span class="c1"># get frequency from the initial dataframe.</span>
</span><span id="Resample-405"><a href="#Resample-405"><span class="linenos">405</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample-406"><a href="#Resample-406"><span class="linenos">406</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Resample-407"><a href="#Resample-407"><span class="linenos">407</span></a>        <span class="p">)</span>
</span><span id="Resample-408"><a href="#Resample-408"><span class="linenos">408</span></a>
</span><span id="Resample-409"><a href="#Resample-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">safe_run</span><span class="p">:</span>
</span><span id="Resample-410"><a href="#Resample-410"><span class="linenos">410</span></a>            <span class="c1"># check duplicates</span>
</span><span id="Resample-411"><a href="#Resample-411"><span class="linenos">411</span></a>            <span class="n">duplicates</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_duplicates</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="Resample-412"><a href="#Resample-412"><span class="linenos">412</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Resample-413"><a href="#Resample-413"><span class="linenos">413</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Resample-414"><a href="#Resample-414"><span class="linenos">414</span></a>                    <span class="sa">f</span><span class="s2">&quot;Duplicates found in the index of the dataframe. The function would delete them, &quot;</span>
</span><span id="Resample-415"><a href="#Resample-415"><span class="linenos">415</span></a>                    <span class="sa">f</span><span class="s2">&quot;so it&#39;s unsafe to run. duplicates = </span><span class="si">{</span><span class="n">duplicates</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-416"><a href="#Resample-416"><span class="linenos">416</span></a>                <span class="p">)</span>
</span><span id="Resample-417"><a href="#Resample-417"><span class="linenos">417</span></a>
</span><span id="Resample-418"><a href="#Resample-418"><span class="linenos">418</span></a>            <span class="c1"># check extra-periods</span>
</span><span id="Resample-419"><a href="#Resample-419"><span class="linenos">419</span></a>            <span class="n">extra_periods</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span>
</span><span id="Resample-420"><a href="#Resample-420"><span class="linenos">420</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample-421"><a href="#Resample-421"><span class="linenos">421</span></a>            <span class="p">)</span>
</span><span id="Resample-422"><a href="#Resample-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_periods</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Resample-423"><a href="#Resample-423"><span class="linenos">423</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-424"><a href="#Resample-424"><span class="linenos">424</span></a>                    <span class="sa">f</span><span class="s2">&quot;Extra periods found in the index of the dataframe. The function would delete them,&quot;</span>
</span><span id="Resample-425"><a href="#Resample-425"><span class="linenos">425</span></a>                    <span class="sa">f</span><span class="s2">&quot; so it&#39;s unsafe to run. extra_periods = </span><span class="si">{</span><span class="n">extra_periods</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample-426"><a href="#Resample-426"><span class="linenos">426</span></a>                <span class="p">)</span>
</span><span id="Resample-427"><a href="#Resample-427"><span class="linenos">427</span></a>
</span><span id="Resample-428"><a href="#Resample-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">method_filling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-429"><a href="#Resample-429"><span class="linenos">429</span></a>            <span class="c1"># resample using the method of Resampler.fillna() if provided</span>
</span><span id="Resample-430"><a href="#Resample-430"><span class="linenos">430</span></a>            <span class="c1"># throw an error if method_filling is not a valid option</span>
</span><span id="Resample-431"><a href="#Resample-431"><span class="linenos">431</span></a>            <span class="n">result_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method_filling</span><span class="p">)</span>
</span><span id="Resample-432"><a href="#Resample-432"><span class="linenos">432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Resample-433"><a href="#Resample-433"><span class="linenos">433</span></a>            <span class="c1"># if method_filling is None, we use Resampler.asfreq() with fill_value</span>
</span><span id="Resample-434"><a href="#Resample-434"><span class="linenos">434</span></a>            <span class="n">result_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
</span><span id="Resample-435"><a href="#Resample-435"><span class="linenos">435</span></a>
</span><span id="Resample-436"><a href="#Resample-436"><span class="linenos">436</span></a>        <span class="k">return</span> <span class="n">result_df</span>
</span><span id="Resample-437"><a href="#Resample-437"><span class="linenos">437</span></a>
</span><span id="Resample-438"><a href="#Resample-438"><span class="linenos">438</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample-439"><a href="#Resample-439"><span class="linenos">439</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample-440"><a href="#Resample-440"><span class="linenos">440</span></a>    <span class="k">def</span> <span class="nf">forward_fill_final_record</span><span class="p">(</span>
</span><span id="Resample-441"><a href="#Resample-441"><span class="linenos">441</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample-442"><a href="#Resample-442"><span class="linenos">442</span></a>        <span class="n">gap_timedelta</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-443"><a href="#Resample-443"><span class="linenos">443</span></a>        <span class="n">cut_off</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-444"><a href="#Resample-444"><span class="linenos">444</span></a>        <span class="n">excl_end_time</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample-445"><a href="#Resample-445"><span class="linenos">445</span></a>    <span class="p">):</span>
</span><span id="Resample-446"><a href="#Resample-446"><span class="linenos">446</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample-447"><a href="#Resample-447"><span class="linenos">447</span></a><span class="sd">        Forward-fill the final record of a regular datetime-indexed dataframe, keeping the frequency of</span>
</span><span id="Resample-448"><a href="#Resample-448"><span class="linenos">448</span></a><span class="sd">        the initial time series. This function not only add a timestamp, but resample with a forward-fill</span>
</span><span id="Resample-449"><a href="#Resample-449"><span class="linenos">449</span></a><span class="sd">        the timeseries until the desired timestamp.</span>
</span><span id="Resample-450"><a href="#Resample-450"><span class="linenos">450</span></a><span class="sd">        Naming &#39;final_ts&#39; the max of the index of the initial dataframe timeseries_df, the resulting index of the</span>
</span><span id="Resample-451"><a href="#Resample-451"><span class="linenos">451</span></a><span class="sd">        final dataframe can be determined from two manners:</span>
</span><span id="Resample-452"><a href="#Resample-452"><span class="linenos">452</span></a><span class="sd">        - using the argument &#39;gap_timedelta&#39; so that the new index goes until final_ts + gap_timedelta (excluded)</span>
</span><span id="Resample-453"><a href="#Resample-453"><span class="linenos">453</span></a><span class="sd">        - using the argument &#39;excl_end_final_date&#39; so that the new index goes until excl_end_time (excluded)</span>
</span><span id="Resample-454"><a href="#Resample-454"><span class="linenos">454</span></a><span class="sd">        The resampling frequency is determined from the frequency of the initial dataframe.</span>
</span><span id="Resample-455"><a href="#Resample-455"><span class="linenos">455</span></a><span class="sd">        The extra parameter &#39;cut_off&#39; can be used to set up a limit not to overpass. It means the resulting index is</span>
</span><span id="Resample-456"><a href="#Resample-456"><span class="linenos">456</span></a><span class="sd">        truncated to take into account the given cut-off.</span>
</span><span id="Resample-457"><a href="#Resample-457"><span class="linenos">457</span></a><span class="sd">        This function is typically used in junction with upsample_*() to forward-fill the last record.</span>
</span><span id="Resample-458"><a href="#Resample-458"><span class="linenos">458</span></a>
</span><span id="Resample-459"><a href="#Resample-459"><span class="linenos">459</span></a><span class="sd">        Here are some examples:</span>
</span><span id="Resample-460"><a href="#Resample-460"><span class="linenos">460</span></a>
</span><span id="Resample-461"><a href="#Resample-461"><span class="linenos">461</span></a><span class="sd">        1. Given timeseries_df:</span>
</span><span id="Resample-462"><a href="#Resample-462"><span class="linenos">462</span></a><span class="sd">        time_index                value</span>
</span><span id="Resample-463"><a href="#Resample-463"><span class="linenos">463</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="Resample-464"><a href="#Resample-464"><span class="linenos">464</span></a><span class="sd">        2021-01-01 12:00:00+01:00 2</span>
</span><span id="Resample-465"><a href="#Resample-465"><span class="linenos">465</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="Resample-466"><a href="#Resample-466"><span class="linenos">466</span></a>
</span><span id="Resample-467"><a href="#Resample-467"><span class="linenos">467</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;1D&#39;):</span>
</span><span id="Resample-468"><a href="#Resample-468"><span class="linenos">468</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="Resample-469"><a href="#Resample-469"><span class="linenos">469</span></a><span class="sd">        2021-01-01 12:00:00+01:00 2</span>
</span><span id="Resample-470"><a href="#Resample-470"><span class="linenos">470</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="Resample-471"><a href="#Resample-471"><span class="linenos">471</span></a><span class="sd">        2021-01-02 12:00:00+01:00 3</span>
</span><span id="Resample-472"><a href="#Resample-472"><span class="linenos">472</span></a>
</span><span id="Resample-473"><a href="#Resample-473"><span class="linenos">473</span></a><span class="sd">        2. Given df:</span>
</span><span id="Resample-474"><a href="#Resample-474"><span class="linenos">474</span></a><span class="sd">        time_index                value</span>
</span><span id="Resample-475"><a href="#Resample-475"><span class="linenos">475</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="Resample-476"><a href="#Resample-476"><span class="linenos">476</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="Resample-477"><a href="#Resample-477"><span class="linenos">477</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="Resample-478"><a href="#Resample-478"><span class="linenos">478</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="Resample-479"><a href="#Resample-479"><span class="linenos">479</span></a>
</span><span id="Resample-480"><a href="#Resample-480"><span class="linenos">480</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;3H&#39;, cut_off=None):</span>
</span><span id="Resample-481"><a href="#Resample-481"><span class="linenos">481</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="Resample-482"><a href="#Resample-482"><span class="linenos">482</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="Resample-483"><a href="#Resample-483"><span class="linenos">483</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="Resample-484"><a href="#Resample-484"><span class="linenos">484</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="Resample-485"><a href="#Resample-485"><span class="linenos">485</span></a><span class="sd">        2021-01-01 23:00:00+01:00 4</span>
</span><span id="Resample-486"><a href="#Resample-486"><span class="linenos">486</span></a><span class="sd">        2021-01-02 00:00:00+01:00 4</span>
</span><span id="Resample-487"><a href="#Resample-487"><span class="linenos">487</span></a>
</span><span id="Resample-488"><a href="#Resample-488"><span class="linenos">488</span></a><span class="sd">        3. Given df:</span>
</span><span id="Resample-489"><a href="#Resample-489"><span class="linenos">489</span></a><span class="sd">        time_index                value</span>
</span><span id="Resample-490"><a href="#Resample-490"><span class="linenos">490</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="Resample-491"><a href="#Resample-491"><span class="linenos">491</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="Resample-492"><a href="#Resample-492"><span class="linenos">492</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="Resample-493"><a href="#Resample-493"><span class="linenos">493</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="Resample-494"><a href="#Resample-494"><span class="linenos">494</span></a>
</span><span id="Resample-495"><a href="#Resample-495"><span class="linenos">495</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;3H&#39;, cut_off=&#39;1D&#39;):</span>
</span><span id="Resample-496"><a href="#Resample-496"><span class="linenos">496</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="Resample-497"><a href="#Resample-497"><span class="linenos">497</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="Resample-498"><a href="#Resample-498"><span class="linenos">498</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="Resample-499"><a href="#Resample-499"><span class="linenos">499</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="Resample-500"><a href="#Resample-500"><span class="linenos">500</span></a><span class="sd">        2021-01-01 23:00:00+01:00 4</span>
</span><span id="Resample-501"><a href="#Resample-501"><span class="linenos">501</span></a>
</span><span id="Resample-502"><a href="#Resample-502"><span class="linenos">502</span></a><span class="sd">        :param timeseries_df: input datetime-indexed dataframe to be forward-filled.</span>
</span><span id="Resample-503"><a href="#Resample-503"><span class="linenos">503</span></a><span class="sd">        :param gap_timedelta: The forward-filling is performed using this argument if provided.</span>
</span><span id="Resample-504"><a href="#Resample-504"><span class="linenos">504</span></a><span class="sd">                              Basically, the last index is extended until last_index + gap_timedelta</span>
</span><span id="Resample-505"><a href="#Resample-505"><span class="linenos">505</span></a><span class="sd">                              This option is incompatible with the setting of the excl_end_time argument</span>
</span><span id="Resample-506"><a href="#Resample-506"><span class="linenos">506</span></a><span class="sd">        :param cut_off: a timedelta that serves as a cut-off beyond which the final record is not extended</span>
</span><span id="Resample-507"><a href="#Resample-507"><span class="linenos">507</span></a><span class="sd">        :param excl_end_time: The forward-filling is performed using this argument if provided.</span>
</span><span id="Resample-508"><a href="#Resample-508"><span class="linenos">508</span></a><span class="sd">                              Basically, the last index is extended until excl_end_time - timeseries_df.index.freq</span>
</span><span id="Resample-509"><a href="#Resample-509"><span class="linenos">509</span></a><span class="sd">                              This option is incompatible with the setting of the gap_timedelta argument</span>
</span><span id="Resample-510"><a href="#Resample-510"><span class="linenos">510</span></a><span class="sd">        :return: datetime-indexed dataframe similar to the initial one, with the last record being forward filled</span>
</span><span id="Resample-511"><a href="#Resample-511"><span class="linenos">511</span></a><span class="sd">                 using the initial frequency of the dataframe index.</span>
</span><span id="Resample-512"><a href="#Resample-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample-513"><a href="#Resample-513"><span class="linenos">513</span></a>
</span><span id="Resample-514"><a href="#Resample-514"><span class="linenos">514</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample-515"><a href="#Resample-515"><span class="linenos">515</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample-516"><a href="#Resample-516"><span class="linenos">516</span></a>        <span class="p">)</span>
</span><span id="Resample-517"><a href="#Resample-517"><span class="linenos">517</span></a>
</span><span id="Resample-518"><a href="#Resample-518"><span class="linenos">518</span></a>        <span class="c1"># the last record is understood as the max time (not the last record of the index)</span>
</span><span id="Resample-519"><a href="#Resample-519"><span class="linenos">519</span></a>        <span class="n">incl_end_time</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Resample-520"><a href="#Resample-520"><span class="linenos">520</span></a>
</span><span id="Resample-521"><a href="#Resample-521"><span class="linenos">521</span></a>        <span class="k">if</span> <span class="n">gap_timedelta</span> <span class="ow">and</span> <span class="n">excl_end_time</span><span class="p">:</span>
</span><span id="Resample-522"><a href="#Resample-522"><span class="linenos">522</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-523"><a href="#Resample-523"><span class="linenos">523</span></a>                <span class="s2">&quot;Cannot provide both arguments excl_end_time and gap_timedelta at once&quot;</span>
</span><span id="Resample-524"><a href="#Resample-524"><span class="linenos">524</span></a>            <span class="p">)</span>
</span><span id="Resample-525"><a href="#Resample-525"><span class="linenos">525</span></a>        <span class="k">if</span> <span class="n">gap_timedelta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-526"><a href="#Resample-526"><span class="linenos">526</span></a>            <span class="n">extra_excl_end_time</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="Resample-527"><a href="#Resample-527"><span class="linenos">527</span></a>                <span class="n">incl_end_time</span><span class="p">,</span> <span class="n">gap_timedelta</span>
</span><span id="Resample-528"><a href="#Resample-528"><span class="linenos">528</span></a>            <span class="p">)</span>
</span><span id="Resample-529"><a href="#Resample-529"><span class="linenos">529</span></a>        <span class="k">elif</span> <span class="n">excl_end_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-530"><a href="#Resample-530"><span class="linenos">530</span></a>            <span class="n">extra_excl_end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">excl_end_time</span><span class="p">)</span>
</span><span id="Resample-531"><a href="#Resample-531"><span class="linenos">531</span></a>            <span class="k">if</span> <span class="n">extra_excl_end_time</span> <span class="o">&lt;=</span> <span class="n">incl_end_time</span><span class="p">:</span>
</span><span id="Resample-532"><a href="#Resample-532"><span class="linenos">532</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-533"><a href="#Resample-533"><span class="linenos">533</span></a>                    <span class="sa">f</span><span class="s2">&quot;Provided extra_excl_end_time=</span><span class="si">{</span><span class="n">extra_excl_end_time</span><span class="si">}</span><span class="s2"> &lt;= &quot;</span>
</span><span id="Resample-534"><a href="#Resample-534"><span class="linenos">534</span></a>                    <span class="sa">f</span><span class="s2">&quot;max(timeseries_df.index) = </span><span class="si">{</span><span class="n">incl_end_time</span><span class="si">}</span><span class="s2">. Cannot forward-fill.&quot;</span>
</span><span id="Resample-535"><a href="#Resample-535"><span class="linenos">535</span></a>                <span class="p">)</span>
</span><span id="Resample-536"><a href="#Resample-536"><span class="linenos">536</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Resample-537"><a href="#Resample-537"><span class="linenos">537</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample-538"><a href="#Resample-538"><span class="linenos">538</span></a>                <span class="s2">&quot;One argument among excl_end_final_date and gap_timedelta must be given&quot;</span>
</span><span id="Resample-539"><a href="#Resample-539"><span class="linenos">539</span></a>            <span class="p">)</span>
</span><span id="Resample-540"><a href="#Resample-540"><span class="linenos">540</span></a>
</span><span id="Resample-541"><a href="#Resample-541"><span class="linenos">541</span></a>        <span class="c1"># the dataframe is extended using the row of index.max()</span>
</span><span id="Resample-542"><a href="#Resample-542"><span class="linenos">542</span></a>        <span class="n">end_row</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">incl_end_time</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="Resample-543"><a href="#Resample-543"><span class="linenos">543</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample-544"><a href="#Resample-544"><span class="linenos">544</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duplicate last record, cannot find a way to extrapolate&quot;</span><span class="p">)</span>
</span><span id="Resample-545"><a href="#Resample-545"><span class="linenos">545</span></a>        <span class="n">extra_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="Resample-546"><a href="#Resample-546"><span class="linenos">546</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">incl_end_time</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="Resample-547"><a href="#Resample-547"><span class="linenos">547</span></a>            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">extra_excl_end_time</span><span class="p">],</span>
</span><span id="Resample-548"><a href="#Resample-548"><span class="linenos">548</span></a>            <span class="n">columns</span><span class="o">=</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
</span><span id="Resample-549"><a href="#Resample-549"><span class="linenos">549</span></a>        <span class="p">)</span>
</span><span id="Resample-550"><a href="#Resample-550"><span class="linenos">550</span></a>        <span class="n">extra_row</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
</span><span id="Resample-551"><a href="#Resample-551"><span class="linenos">551</span></a>
</span><span id="Resample-552"><a href="#Resample-552"><span class="linenos">552</span></a>        <span class="c1"># Add the extra row, and extrapolate using resample</span>
</span><span id="Resample-553"><a href="#Resample-553"><span class="linenos">553</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">end_row</span><span class="p">,</span> <span class="n">extra_row</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Resample-554"><a href="#Resample-554"><span class="linenos">554</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">)</span>
</span><span id="Resample-555"><a href="#Resample-555"><span class="linenos">555</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">incl_end_time</span><span class="p">,</span> <span class="n">extra_excl_end_time</span><span class="p">])</span>
</span><span id="Resample-556"><a href="#Resample-556"><span class="linenos">556</span></a>
</span><span id="Resample-557"><a href="#Resample-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="n">cut_off</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample-558"><a href="#Resample-558"><span class="linenos">558</span></a>            <span class="n">cut_off_end</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="Resample-559"><a href="#Resample-559"><span class="linenos">559</span></a>                <span class="n">incl_end_time</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">cut_off</span><span class="p">),</span> <span class="n">cut_off</span>
</span><span id="Resample-560"><a href="#Resample-560"><span class="linenos">560</span></a>            <span class="p">)</span>
</span><span id="Resample-561"><a href="#Resample-561"><span class="linenos">561</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">cut_off_end</span><span class="p">]</span>
</span><span id="Resample-562"><a href="#Resample-562"><span class="linenos">562</span></a>
</span><span id="Resample-563"><a href="#Resample-563"><span class="linenos">563</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">timeseries_df</span><span class="p">,</span> <span class="n">result</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Resample-564"><a href="#Resample-564"><span class="linenos">564</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span>
</span><span id="Resample-565"><a href="#Resample-565"><span class="linenos">565</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>This class contains methods to resample (up or down) timeseries DataFrames</p>
</div>


                            <div id="Resample.downsample" class="classattr">
                                        <input id="Resample.downsample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_multiindex(arg_name=&#39;timeseries_df&#39;)</div>

        <span class="def">def</span>
        <span class="name">downsample</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>,</span><span class="param">	<span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">agg_functions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>,</span><span class="param">	<span class="n">origin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;start_day&#39;</span>,</span><span class="param">	<span class="n">is_original_frequency_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="Resample.downsample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Resample.downsample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Resample.downsample-17"><a href="#Resample.downsample-17"><span class="linenos"> 17</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample.downsample-18"><a href="#Resample.downsample-18"><span class="linenos"> 18</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample.downsample-19"><a href="#Resample.downsample-19"><span class="linenos"> 19</span></a>    <span class="k">def</span> <span class="nf">downsample</span><span class="p">(</span>
</span><span id="Resample.downsample-20"><a href="#Resample.downsample-20"><span class="linenos"> 20</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample.downsample-21"><a href="#Resample.downsample-21"><span class="linenos"> 21</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="Resample.downsample-22"><a href="#Resample.downsample-22"><span class="linenos"> 22</span></a>        <span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.downsample-23"><a href="#Resample.downsample-23"><span class="linenos"> 23</span></a>        <span class="n">agg_functions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="Resample.downsample-24"><a href="#Resample.downsample-24"><span class="linenos"> 24</span></a>        <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;start_day&quot;</span><span class="p">,</span>
</span><span id="Resample.downsample-25"><a href="#Resample.downsample-25"><span class="linenos"> 25</span></a>        <span class="n">is_original_frequency_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Resample.downsample-26"><a href="#Resample.downsample-26"><span class="linenos"> 26</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.downsample-27"><a href="#Resample.downsample-27"><span class="linenos"> 27</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Resample.downsample-28"><a href="#Resample.downsample-28"><span class="linenos"> 28</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample.downsample-29"><a href="#Resample.downsample-29"><span class="linenos"> 29</span></a><span class="sd">        Downsample a datetime-indexed pd.DataFrame to a provided frequency using one or several aggregation functions.</span>
</span><span id="Resample.downsample-30"><a href="#Resample.downsample-30"><span class="linenos"> 30</span></a><span class="sd">        The provided frequency must be greater than the original one in the dataframe index.</span>
</span><span id="Resample.downsample-31"><a href="#Resample.downsample-31"><span class="linenos"> 31</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="Resample.downsample-32"><a href="#Resample.downsample-32"><span class="linenos"> 32</span></a><span class="sd">        :param freq: the aimed frequency. If given as a pd.Timedelta, it must be convertible to freq string</span>
</span><span id="Resample.downsample-33"><a href="#Resample.downsample-33"><span class="linenos"> 33</span></a><span class="sd">        :param groupby: If a list of columns is provided, the DataFrame will be grouped by specified columns</span>
</span><span id="Resample.downsample-34"><a href="#Resample.downsample-34"><span class="linenos"> 34</span></a><span class="sd">                        before resampling</span>
</span><span id="Resample.downsample-35"><a href="#Resample.downsample-35"><span class="linenos"> 35</span></a><span class="sd">        :param agg_functions: aggregate functions used for resampling passed to aggregate().</span>
</span><span id="Resample.downsample-36"><a href="#Resample.downsample-36"><span class="linenos"> 36</span></a><span class="sd">                              If a dict is provided, it must indicate an agg function for each column of the dataframe</span>
</span><span id="Resample.downsample-37"><a href="#Resample.downsample-37"><span class="linenos"> 37</span></a><span class="sd">                              If a string is provided, it will be used for all columns of the dataframe.</span>
</span><span id="Resample.downsample-38"><a href="#Resample.downsample-38"><span class="linenos"> 38</span></a><span class="sd">                              Default is &#39;mean&#39; for all columns</span>
</span><span id="Resample.downsample-39"><a href="#Resample.downsample-39"><span class="linenos"> 39</span></a><span class="sd">        :param origin: the timestamp on which to adjust the grouping.</span>
</span><span id="Resample.downsample-40"><a href="#Resample.downsample-40"><span class="linenos"> 40</span></a><span class="sd">                       Default is &#39;start_day&#39;, i.e. origin is the first day at midnight of the timeseries</span>
</span><span id="Resample.downsample-41"><a href="#Resample.downsample-41"><span class="linenos"> 41</span></a><span class="sd">                       Other options are &#39;epoch&#39;, &#39;start&#39;, &#39;end&#39;, &#39;end_day&#39;. For more details, see</span>
</span><span id="Resample.downsample-42"><a href="#Resample.downsample-42"><span class="linenos"> 42</span></a><span class="sd">                       https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.resample.html</span>
</span><span id="Resample.downsample-43"><a href="#Resample.downsample-43"><span class="linenos"> 43</span></a><span class="sd">        :param is_original_frequency_unique: boolean, if True, ensure there&#39;s no missing value, no extra-point,</span>
</span><span id="Resample.downsample-44"><a href="#Resample.downsample-44"><span class="linenos"> 44</span></a><span class="sd">                                             and a single well-defined frequency in the original dataframe</span>
</span><span id="Resample.downsample-45"><a href="#Resample.downsample-45"><span class="linenos"> 45</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="Resample.downsample-46"><a href="#Resample.downsample-46"><span class="linenos"> 46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample.downsample-47"><a href="#Resample.downsample-47"><span class="linenos"> 47</span></a>
</span><span id="Resample.downsample-48"><a href="#Resample.downsample-48"><span class="linenos"> 48</span></a>        <span class="k">if</span> <span class="n">groupby</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.downsample-49"><a href="#Resample.downsample-49"><span class="linenos"> 49</span></a>            <span class="n">groupby</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Resample.downsample-50"><a href="#Resample.downsample-50"><span class="linenos"> 50</span></a>
</span><span id="Resample.downsample-51"><a href="#Resample.downsample-51"><span class="linenos"> 51</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="Resample.downsample-52"><a href="#Resample.downsample-52"><span class="linenos"> 52</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="Resample.downsample-53"><a href="#Resample.downsample-53"><span class="linenos"> 53</span></a>
</span><span id="Resample.downsample-54"><a href="#Resample.downsample-54"><span class="linenos"> 54</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="Resample.downsample-55"><a href="#Resample.downsample-55"><span class="linenos"> 55</span></a>            <span class="n">cols_with_missing_function</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
</span><span id="Resample.downsample-56"><a href="#Resample.downsample-56"><span class="linenos"> 56</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">agg_functions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">groupby</span><span class="p">))</span>
</span><span id="Resample.downsample-57"><a href="#Resample.downsample-57"><span class="linenos"> 57</span></a>            <span class="p">)</span>
</span><span id="Resample.downsample-58"><a href="#Resample.downsample-58"><span class="linenos"> 58</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols_with_missing_function</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Resample.downsample-59"><a href="#Resample.downsample-59"><span class="linenos"> 59</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.downsample-60"><a href="#Resample.downsample-60"><span class="linenos"> 60</span></a>                    <span class="s2">&quot;Aggregation function to use has not been set for next columns &quot;</span>
</span><span id="Resample.downsample-61"><a href="#Resample.downsample-61"><span class="linenos"> 61</span></a>                    <span class="sa">f</span><span class="s2">&quot; of dataframe: </span><span class="si">{</span><span class="n">cols_with_missing_function</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.downsample-62"><a href="#Resample.downsample-62"><span class="linenos"> 62</span></a>                <span class="p">)</span>
</span><span id="Resample.downsample-63"><a href="#Resample.downsample-63"><span class="linenos"> 63</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Resample.downsample-64"><a href="#Resample.downsample-64"><span class="linenos"> 64</span></a>            <span class="n">agg_functions</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Resample.downsample-65"><a href="#Resample.downsample-65"><span class="linenos"> 65</span></a>                <span class="n">_</span><span class="p">:</span> <span class="n">agg_functions</span>
</span><span id="Resample.downsample-66"><a href="#Resample.downsample-66"><span class="linenos"> 66</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">groupby</span><span class="p">)))</span>
</span><span id="Resample.downsample-67"><a href="#Resample.downsample-67"><span class="linenos"> 67</span></a>            <span class="p">}</span>
</span><span id="Resample.downsample-68"><a href="#Resample.downsample-68"><span class="linenos"> 68</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Resample.downsample-69"><a href="#Resample.downsample-69"><span class="linenos"> 69</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="Resample.downsample-70"><a href="#Resample.downsample-70"><span class="linenos"> 70</span></a>                <span class="sa">f</span><span class="s2">&quot;agg_functions must be of type str or dict, found </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead&quot;</span>
</span><span id="Resample.downsample-71"><a href="#Resample.downsample-71"><span class="linenos"> 71</span></a>            <span class="p">)</span>
</span><span id="Resample.downsample-72"><a href="#Resample.downsample-72"><span class="linenos"> 72</span></a>
</span><span id="Resample.downsample-73"><a href="#Resample.downsample-73"><span class="linenos"> 73</span></a>        <span class="c1"># If we need to group by other columns than the index, it means that there might be duplicates in time index.</span>
</span><span id="Resample.downsample-74"><a href="#Resample.downsample-74"><span class="linenos"> 74</span></a>        <span class="c1"># That could lead &#39;find_most_common_frequency&#39; to return null frequency as the most frequent.</span>
</span><span id="Resample.downsample-75"><a href="#Resample.downsample-75"><span class="linenos"> 75</span></a>        <span class="c1"># Note this does NOT imply the duplicates are reset when downsampling !</span>
</span><span id="Resample.downsample-76"><a href="#Resample.downsample-76"><span class="linenos"> 76</span></a>        <span class="n">skip_duplicates_for_unique_freq_check</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupby</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="Resample.downsample-77"><a href="#Resample.downsample-77"><span class="linenos"> 77</span></a>
</span><span id="Resample.downsample-78"><a href="#Resample.downsample-78"><span class="linenos"> 78</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="Resample.downsample-79"><a href="#Resample.downsample-79"><span class="linenos"> 79</span></a>        <span class="c1"># it return None only if the dataframe has a single record, else it returns the most common frequency</span>
</span><span id="Resample.downsample-80"><a href="#Resample.downsample-80"><span class="linenos"> 80</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample.downsample-81"><a href="#Resample.downsample-81"><span class="linenos"> 81</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="Resample.downsample-82"><a href="#Resample.downsample-82"><span class="linenos"> 82</span></a>            <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="n">skip_duplicates_for_unique_freq_check</span><span class="p">,</span>
</span><span id="Resample.downsample-83"><a href="#Resample.downsample-83"><span class="linenos"> 83</span></a>        <span class="p">)</span>
</span><span id="Resample.downsample-84"><a href="#Resample.downsample-84"><span class="linenos"> 84</span></a>
</span><span id="Resample.downsample-85"><a href="#Resample.downsample-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="Resample.downsample-86"><a href="#Resample.downsample-86"><span class="linenos"> 86</span></a>            <span class="n">original_freq</span>
</span><span id="Resample.downsample-87"><a href="#Resample.downsample-87"><span class="linenos"> 87</span></a>            <span class="ow">and</span> <span class="n">is_original_frequency_unique</span>
</span><span id="Resample.downsample-88"><a href="#Resample.downsample-88"><span class="linenos"> 88</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="Resample.downsample-89"><a href="#Resample.downsample-89"><span class="linenos"> 89</span></a>                <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="Resample.downsample-90"><a href="#Resample.downsample-90"><span class="linenos"> 90</span></a>                    <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="Resample.downsample-91"><a href="#Resample.downsample-91"><span class="linenos"> 91</span></a>                    <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Resample.downsample-92"><a href="#Resample.downsample-92"><span class="linenos"> 92</span></a>                    <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="n">skip_duplicates_for_unique_freq_check</span><span class="p">,</span>
</span><span id="Resample.downsample-93"><a href="#Resample.downsample-93"><span class="linenos"> 93</span></a>                <span class="p">)</span>
</span><span id="Resample.downsample-94"><a href="#Resample.downsample-94"><span class="linenos"> 94</span></a>            <span class="p">)</span>
</span><span id="Resample.downsample-95"><a href="#Resample.downsample-95"><span class="linenos"> 95</span></a>        <span class="p">):</span>
</span><span id="Resample.downsample-96"><a href="#Resample.downsample-96"><span class="linenos"> 96</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Frequency is not unique in the dataframe&quot;</span><span class="p">)</span>
</span><span id="Resample.downsample-97"><a href="#Resample.downsample-97"><span class="linenos"> 97</span></a>
</span><span id="Resample.downsample-98"><a href="#Resample.downsample-98"><span class="linenos"> 98</span></a>        <span class="c1"># make sure we downsample</span>
</span><span id="Resample.downsample-99"><a href="#Resample.downsample-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="n">original_freq</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="Resample.downsample-100"><a href="#Resample.downsample-100"><span class="linenos">100</span></a>                <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="Resample.downsample-101"><a href="#Resample.downsample-101"><span class="linenos">101</span></a>                <span class="o">&lt;</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span>
</span><span id="Resample.downsample-102"><a href="#Resample.downsample-102"><span class="linenos">102</span></a>        <span class="p">):</span>
</span><span id="Resample.downsample-103"><a href="#Resample.downsample-103"><span class="linenos">103</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Resample.downsample-104"><a href="#Resample.downsample-104"><span class="linenos">104</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.downsample-105"><a href="#Resample.downsample-105"><span class="linenos">105</span></a>                <span class="sa">f</span><span class="s2">&quot; is smaller than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.downsample-106"><a href="#Resample.downsample-106"><span class="linenos">106</span></a>            <span class="p">)</span>
</span><span id="Resample.downsample-107"><a href="#Resample.downsample-107"><span class="linenos">107</span></a>
</span><span id="Resample.downsample-108"><a href="#Resample.downsample-108"><span class="linenos">108</span></a>        <span class="c1"># resample using the aggregation function</span>
</span><span id="Resample.downsample-109"><a href="#Resample.downsample-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupby</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Resample.downsample-110"><a href="#Resample.downsample-110"><span class="linenos">110</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
</span><span id="Resample.downsample-111"><a href="#Resample.downsample-111"><span class="linenos">111</span></a>                <span class="n">agg_functions</span>
</span><span id="Resample.downsample-112"><a href="#Resample.downsample-112"><span class="linenos">112</span></a>            <span class="p">)</span>
</span><span id="Resample.downsample-113"><a href="#Resample.downsample-113"><span class="linenos">113</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Resample.downsample-114"><a href="#Resample.downsample-114"><span class="linenos">114</span></a>            <span class="n">columns_in_order_list</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="Resample.downsample-115"><a href="#Resample.downsample-115"><span class="linenos">115</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Resample.downsample-116"><a href="#Resample.downsample-116"><span class="linenos">116</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
</span><span id="Resample.downsample-117"><a href="#Resample.downsample-117"><span class="linenos">117</span></a>                <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
</span><span id="Resample.downsample-118"><a href="#Resample.downsample-118"><span class="linenos">118</span></a>                <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">)</span>
</span><span id="Resample.downsample-119"><a href="#Resample.downsample-119"><span class="linenos">119</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
</span><span id="Resample.downsample-120"><a href="#Resample.downsample-120"><span class="linenos">120</span></a>                <span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>  <span class="c1"># reorder index</span>
</span><span id="Resample.downsample-121"><a href="#Resample.downsample-121"><span class="linenos">121</span></a>                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">columns_in_order_list</span><span class="p">)</span>  <span class="c1"># reorder columns</span>
</span><span id="Resample.downsample-122"><a href="#Resample.downsample-122"><span class="linenos">122</span></a>            <span class="p">)</span>
</span><span id="Resample.downsample-123"><a href="#Resample.downsample-123"><span class="linenos">123</span></a>
</span><span id="Resample.downsample-124"><a href="#Resample.downsample-124"><span class="linenos">124</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="Resample.downsample-125"><a href="#Resample.downsample-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.downsample-126"><a href="#Resample.downsample-126"><span class="linenos">126</span></a>            <span class="n">resampled_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="Resample.downsample-127"><a href="#Resample.downsample-127"><span class="linenos">127</span></a>
</span><span id="Resample.downsample-128"><a href="#Resample.downsample-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">resampled_df</span>
</span></pre></div>


            <div class="docstring"><p>Downsample a datetime-indexed pd.DataFrame to a provided frequency using one or several aggregation functions.
The provided frequency must be greater than the original one in the dataframe index.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>timeseries_df</strong>:  the dataframe with a datetime-like index</li>
<li><strong>freq</strong>:  the aimed frequency. If given as a pd.Timedelta, it must be convertible to freq string</li>
<li><strong>groupby</strong>:  If a list of columns is provided, the DataFrame will be grouped by specified columns
before resampling</li>
<li><strong>agg_functions</strong>:  aggregate functions used for resampling passed to aggregate().
If a dict is provided, it must indicate an agg function for each column of the dataframe
If a string is provided, it will be used for all columns of the dataframe.
Default is 'mean' for all columns</li>
<li><strong>origin</strong>:  the timestamp on which to adjust the grouping.
Default is 'start_day', i.e. origin is the first day at midnight of the timeseries
Other options are 'epoch', 'start', 'end', 'end_day'. For more details, see
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.resample.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.resample.html</a></li>
<li><strong>is_original_frequency_unique</strong>:  boolean, if True, ensure there's no missing value, no extra-point,
and a single well-defined frequency in the original dataframe</li>
<li><strong>index_name</strong>:  a name to give to the new index. For instance going from 'date' to 'time'.</li>
</ul>
</div>


                            </div>
                            <div id="Resample.upsample_and_divide_evenly" class="classattr">
                                        <input id="Resample.upsample_and_divide_evenly-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_multiindex(arg_name=&#39;timeseries_df&#39;)</div>

        <span class="def">def</span>
        <span class="name">upsample_and_divide_evenly</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>,</span><span class="param">	<span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="Resample.upsample_and_divide_evenly-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Resample.upsample_and_divide_evenly"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Resample.upsample_and_divide_evenly-130"><a href="#Resample.upsample_and_divide_evenly-130"><span class="linenos">130</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample.upsample_and_divide_evenly-131"><a href="#Resample.upsample_and_divide_evenly-131"><span class="linenos">131</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-132"><a href="#Resample.upsample_and_divide_evenly-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">upsample_and_divide_evenly</span><span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-133"><a href="#Resample.upsample_and_divide_evenly-133"><span class="linenos">133</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample.upsample_and_divide_evenly-134"><a href="#Resample.upsample_and_divide_evenly-134"><span class="linenos">134</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="Resample.upsample_and_divide_evenly-135"><a href="#Resample.upsample_and_divide_evenly-135"><span class="linenos">135</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.upsample_and_divide_evenly-136"><a href="#Resample.upsample_and_divide_evenly-136"><span class="linenos">136</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.upsample_and_divide_evenly-137"><a href="#Resample.upsample_and_divide_evenly-137"><span class="linenos">137</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Resample.upsample_and_divide_evenly-138"><a href="#Resample.upsample_and_divide_evenly-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-139"><a href="#Resample.upsample_and_divide_evenly-139"><span class="linenos">139</span></a><span class="sd">        Upsample a datetime-indexed pd.DataFrame to a provided frequency and divide the values so that the sum</span>
</span><span id="Resample.upsample_and_divide_evenly-140"><a href="#Resample.upsample_and_divide_evenly-140"><span class="linenos">140</span></a><span class="sd">        of columns remains the same :</span>
</span><span id="Resample.upsample_and_divide_evenly-141"><a href="#Resample.upsample_and_divide_evenly-141"><span class="linenos">141</span></a><span class="sd">        {2023-01-01 00:00:00 : 50, 2023-01-01 00:30:00: 40} with 15 minutes resampling should give</span>
</span><span id="Resample.upsample_and_divide_evenly-142"><a href="#Resample.upsample_and_divide_evenly-142"><span class="linenos">142</span></a><span class="sd">        {2023-01-01 00:00:00 : 25, 2023-01-01 00:15:00 : 25,</span>
</span><span id="Resample.upsample_and_divide_evenly-143"><a href="#Resample.upsample_and_divide_evenly-143"><span class="linenos">143</span></a><span class="sd">         2023-01-01 00:30:00 : 20, 2023-01-01 00:45:00 : 20}</span>
</span><span id="Resample.upsample_and_divide_evenly-144"><a href="#Resample.upsample_and_divide_evenly-144"><span class="linenos">144</span></a><span class="sd">        This is intended for columns with numerical values that vary when changing frequency (such as energy and cost,</span>
</span><span id="Resample.upsample_and_divide_evenly-145"><a href="#Resample.upsample_and_divide_evenly-145"><span class="linenos">145</span></a><span class="sd">        but not power)</span>
</span><span id="Resample.upsample_and_divide_evenly-146"><a href="#Resample.upsample_and_divide_evenly-146"><span class="linenos">146</span></a><span class="sd">        Note there is a forward-filling of the last record before dividing, because it&#39;s the only behaviour that makes</span>
</span><span id="Resample.upsample_and_divide_evenly-147"><a href="#Resample.upsample_and_divide_evenly-147"><span class="linenos">147</span></a><span class="sd">        sense.</span>
</span><span id="Resample.upsample_and_divide_evenly-148"><a href="#Resample.upsample_and_divide_evenly-148"><span class="linenos">148</span></a><span class="sd">        The provided frequency must be lower than the original one in the dataframe index. Does not work if frequency</span>
</span><span id="Resample.upsample_and_divide_evenly-149"><a href="#Resample.upsample_and_divide_evenly-149"><span class="linenos">149</span></a><span class="sd">        in the original DataFrame isn&#39;t unique (for example : monthly values, as number of days in a month varies)</span>
</span><span id="Resample.upsample_and_divide_evenly-150"><a href="#Resample.upsample_and_divide_evenly-150"><span class="linenos">150</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="Resample.upsample_and_divide_evenly-151"><a href="#Resample.upsample_and_divide_evenly-151"><span class="linenos">151</span></a><span class="sd">        :param freq: the aimed frequency. If given as string, it must be convertible to pd.Timedelta, eg &#39;1D&#39; or &#39;1H&#39;</span>
</span><span id="Resample.upsample_and_divide_evenly-152"><a href="#Resample.upsample_and_divide_evenly-152"><span class="linenos">152</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="Resample.upsample_and_divide_evenly-153"><a href="#Resample.upsample_and_divide_evenly-153"><span class="linenos">153</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="Resample.upsample_and_divide_evenly-154"><a href="#Resample.upsample_and_divide_evenly-154"><span class="linenos">154</span></a><span class="sd">                        go from a non-localized timestamp (e.g. dates) to a localized one (e.g. date-times)</span>
</span><span id="Resample.upsample_and_divide_evenly-155"><a href="#Resample.upsample_and_divide_evenly-155"><span class="linenos">155</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="Resample.upsample_and_divide_evenly-156"><a href="#Resample.upsample_and_divide_evenly-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-157"><a href="#Resample.upsample_and_divide_evenly-157"><span class="linenos">157</span></a>
</span><span id="Resample.upsample_and_divide_evenly-158"><a href="#Resample.upsample_and_divide_evenly-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="Resample.upsample_and_divide_evenly-159"><a href="#Resample.upsample_and_divide_evenly-159"><span class="linenos">159</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-160"><a href="#Resample.upsample_and_divide_evenly-160"><span class="linenos">160</span></a>
</span><span id="Resample.upsample_and_divide_evenly-161"><a href="#Resample.upsample_and_divide_evenly-161"><span class="linenos">161</span></a>        <span class="c1"># check it&#39;s not a one-row dataframe, because it cannot be upsampled.</span>
</span><span id="Resample.upsample_and_divide_evenly-162"><a href="#Resample.upsample_and_divide_evenly-162"><span class="linenos">162</span></a>        <span class="c1"># Consider using forward_fill and give a gap_timedelta to achieve the objective.</span>
</span><span id="Resample.upsample_and_divide_evenly-163"><a href="#Resample.upsample_and_divide_evenly-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample.upsample_and_divide_evenly-164"><a href="#Resample.upsample_and_divide_evenly-164"><span class="linenos">164</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-165"><a href="#Resample.upsample_and_divide_evenly-165"><span class="linenos">165</span></a>                <span class="s2">&quot;Cannot upsample an empty or single-record time series; because its initial&quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-166"><a href="#Resample.upsample_and_divide_evenly-166"><span class="linenos">166</span></a>                <span class="s2">&quot; frequency cannot be determined. Consider using &#39;forward_fill_last_record prior.&quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-167"><a href="#Resample.upsample_and_divide_evenly-167"><span class="linenos">167</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-168"><a href="#Resample.upsample_and_divide_evenly-168"><span class="linenos">168</span></a>
</span><span id="Resample.upsample_and_divide_evenly-169"><a href="#Resample.upsample_and_divide_evenly-169"><span class="linenos">169</span></a>        <span class="c1"># get to copy</span>
</span><span id="Resample.upsample_and_divide_evenly-170"><a href="#Resample.upsample_and_divide_evenly-170"><span class="linenos">170</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Resample.upsample_and_divide_evenly-171"><a href="#Resample.upsample_and_divide_evenly-171"><span class="linenos">171</span></a>
</span><span id="Resample.upsample_and_divide_evenly-172"><a href="#Resample.upsample_and_divide_evenly-172"><span class="linenos">172</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="Resample.upsample_and_divide_evenly-173"><a href="#Resample.upsample_and_divide_evenly-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.upsample_and_divide_evenly-174"><a href="#Resample.upsample_and_divide_evenly-174"><span class="linenos">174</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-175"><a href="#Resample.upsample_and_divide_evenly-175"><span class="linenos">175</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="Resample.upsample_and_divide_evenly-176"><a href="#Resample.upsample_and_divide_evenly-176"><span class="linenos">176</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-177"><a href="#Resample.upsample_and_divide_evenly-177"><span class="linenos">177</span></a>
</span><span id="Resample.upsample_and_divide_evenly-178"><a href="#Resample.upsample_and_divide_evenly-178"><span class="linenos">178</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="Resample.upsample_and_divide_evenly-179"><a href="#Resample.upsample_and_divide_evenly-179"><span class="linenos">179</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-180"><a href="#Resample.upsample_and_divide_evenly-180"><span class="linenos">180</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample.upsample_and_divide_evenly-181"><a href="#Resample.upsample_and_divide_evenly-181"><span class="linenos">181</span></a>        <span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-182"><a href="#Resample.upsample_and_divide_evenly-182"><span class="linenos">182</span></a>
</span><span id="Resample.upsample_and_divide_evenly-183"><a href="#Resample.upsample_and_divide_evenly-183"><span class="linenos">183</span></a>        <span class="c1"># if it&#39;s not a regular frequency, this function cannot work</span>
</span><span id="Resample.upsample_and_divide_evenly-184"><a href="#Resample.upsample_and_divide_evenly-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">is_regular_freq</span><span class="p">(</span><span class="n">original_freq</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-185"><a href="#Resample.upsample_and_divide_evenly-185"><span class="linenos">185</span></a>            <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">is_regular_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-186"><a href="#Resample.upsample_and_divide_evenly-186"><span class="linenos">186</span></a>        <span class="p">):</span>
</span><span id="Resample.upsample_and_divide_evenly-187"><a href="#Resample.upsample_and_divide_evenly-187"><span class="linenos">187</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-188"><a href="#Resample.upsample_and_divide_evenly-188"><span class="linenos">188</span></a>                <span class="sa">f</span><span class="s2">&quot;Cannot upsample and divide for an input dataframe with an irregular frequency, &quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-189"><a href="#Resample.upsample_and_divide_evenly-189"><span class="linenos">189</span></a>                <span class="sa">f</span><span class="s2">&quot;(in terms of length). Here, we have original_freq=</span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-190"><a href="#Resample.upsample_and_divide_evenly-190"><span class="linenos">190</span></a>                <span class="sa">f</span><span class="s2">&quot; and target freq = </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-191"><a href="#Resample.upsample_and_divide_evenly-191"><span class="linenos">191</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-192"><a href="#Resample.upsample_and_divide_evenly-192"><span class="linenos">192</span></a>
</span><span id="Resample.upsample_and_divide_evenly-193"><a href="#Resample.upsample_and_divide_evenly-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-194"><a href="#Resample.upsample_and_divide_evenly-194"><span class="linenos">194</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="Resample.upsample_and_divide_evenly-195"><a href="#Resample.upsample_and_divide_evenly-195"><span class="linenos">195</span></a>            <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Resample.upsample_and_divide_evenly-196"><a href="#Resample.upsample_and_divide_evenly-196"><span class="linenos">196</span></a>            <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Resample.upsample_and_divide_evenly-197"><a href="#Resample.upsample_and_divide_evenly-197"><span class="linenos">197</span></a>        <span class="p">):</span>
</span><span id="Resample.upsample_and_divide_evenly-198"><a href="#Resample.upsample_and_divide_evenly-198"><span class="linenos">198</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequency is not single-defined in the dataframe&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-199"><a href="#Resample.upsample_and_divide_evenly-199"><span class="linenos">199</span></a>
</span><span id="Resample.upsample_and_divide_evenly-200"><a href="#Resample.upsample_and_divide_evenly-200"><span class="linenos">200</span></a>        <span class="c1"># compute the frequency ration to know how to divide. It should be convertible to pd.Timedelta</span>
</span><span id="Resample.upsample_and_divide_evenly-201"><a href="#Resample.upsample_and_divide_evenly-201"><span class="linenos">201</span></a>        <span class="n">freq_ratio</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-202"><a href="#Resample.upsample_and_divide_evenly-202"><span class="linenos">202</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="Resample.upsample_and_divide_evenly-203"><a href="#Resample.upsample_and_divide_evenly-203"><span class="linenos">203</span></a>            <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="Resample.upsample_and_divide_evenly-204"><a href="#Resample.upsample_and_divide_evenly-204"><span class="linenos">204</span></a>        <span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-205"><a href="#Resample.upsample_and_divide_evenly-205"><span class="linenos">205</span></a>
</span><span id="Resample.upsample_and_divide_evenly-206"><a href="#Resample.upsample_and_divide_evenly-206"><span class="linenos">206</span></a>        <span class="c1"># make sure we upsample</span>
</span><span id="Resample.upsample_and_divide_evenly-207"><a href="#Resample.upsample_and_divide_evenly-207"><span class="linenos">207</span></a>        <span class="k">if</span> <span class="n">freq_ratio</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample.upsample_and_divide_evenly-208"><a href="#Resample.upsample_and_divide_evenly-208"><span class="linenos">208</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-209"><a href="#Resample.upsample_and_divide_evenly-209"><span class="linenos">209</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-210"><a href="#Resample.upsample_and_divide_evenly-210"><span class="linenos">210</span></a>                <span class="sa">f</span><span class="s2">&quot; is higher than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.upsample_and_divide_evenly-211"><a href="#Resample.upsample_and_divide_evenly-211"><span class="linenos">211</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-212"><a href="#Resample.upsample_and_divide_evenly-212"><span class="linenos">212</span></a>
</span><span id="Resample.upsample_and_divide_evenly-213"><a href="#Resample.upsample_and_divide_evenly-213"><span class="linenos">213</span></a>        <span class="c1"># we must artificially add one timestep to the original dataframe to make sure we don&#39;t miss time steps in the</span>
</span><span id="Resample.upsample_and_divide_evenly-214"><a href="#Resample.upsample_and_divide_evenly-214"><span class="linenos">214</span></a>        <span class="c1"># new frequency. With the example of the docstring, if we don&#39;t do this the 2023-01-01 00:45:00 won&#39;t be</span>
</span><span id="Resample.upsample_and_divide_evenly-215"><a href="#Resample.upsample_and_divide_evenly-215"><span class="linenos">215</span></a>        <span class="c1"># added when resampling which will make the sum of values in the numerical columns false</span>
</span><span id="Resample.upsample_and_divide_evenly-216"><a href="#Resample.upsample_and_divide_evenly-216"><span class="linenos">216</span></a>        <span class="c1"># Note this implies the last record of the resulting index is greater than the initial one.</span>
</span><span id="Resample.upsample_and_divide_evenly-217"><a href="#Resample.upsample_and_divide_evenly-217"><span class="linenos">217</span></a>        <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Resample.upsample_and_divide_evenly-218"><a href="#Resample.upsample_and_divide_evenly-218"><span class="linenos">218</span></a>            <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="Resample.upsample_and_divide_evenly-219"><a href="#Resample.upsample_and_divide_evenly-219"><span class="linenos">219</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">original_freq</span>
</span><span id="Resample.upsample_and_divide_evenly-220"><a href="#Resample.upsample_and_divide_evenly-220"><span class="linenos">220</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_divide_evenly-221"><a href="#Resample.upsample_and_divide_evenly-221"><span class="linenos">221</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Resample.upsample_and_divide_evenly-222"><a href="#Resample.upsample_and_divide_evenly-222"><span class="linenos">222</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">freq_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Resample.upsample_and_divide_evenly-223"><a href="#Resample.upsample_and_divide_evenly-223"><span class="linenos">223</span></a>
</span><span id="Resample.upsample_and_divide_evenly-224"><a href="#Resample.upsample_and_divide_evenly-224"><span class="linenos">224</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="Resample.upsample_and_divide_evenly-225"><a href="#Resample.upsample_and_divide_evenly-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.upsample_and_divide_evenly-226"><a href="#Resample.upsample_and_divide_evenly-226"><span class="linenos">226</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="Resample.upsample_and_divide_evenly-227"><a href="#Resample.upsample_and_divide_evenly-227"><span class="linenos">227</span></a>
</span><span id="Resample.upsample_and_divide_evenly-228"><a href="#Resample.upsample_and_divide_evenly-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="n">timeseries_df</span>
</span></pre></div>


            <div class="docstring"><p>Upsample a datetime-indexed pd.DataFrame to a provided frequency and divide the values so that the sum
of columns remains the same :
{2023-01-01 00:00:00 : 50, 2023-01-01 00:30:00: 40} with 15 minutes resampling should give
{2023-01-01 00:00:00 : 25, 2023-01-01 00:15:00 : 25,
 2023-01-01 00:30:00 : 20, 2023-01-01 00:45:00 : 20}
This is intended for columns with numerical values that vary when changing frequency (such as energy and cost,
but not power)
Note there is a forward-filling of the last record before dividing, because it's the only behaviour that makes
sense.
The provided frequency must be lower than the original one in the dataframe index. Does not work if frequency
in the original DataFrame isn't unique (for example : monthly values, as number of days in a month varies)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>timeseries_df</strong>:  the dataframe with a datetime-like index</li>
<li><strong>freq</strong>:  the aimed frequency. If given as string, it must be convertible to pd.Timedelta, eg '1D' or '1H'</li>
<li><strong>index_name</strong>:  a name to give to the new index. For instance going from 'date' to 'time'.</li>
<li><strong>tz_info</strong>:  the target time zone in case the index is resampled in another timezone / or if we want to
go from a non-localized timestamp (e.g. dates) to a localized one (e.g. date-times)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>the upsampled timeseries dataframe</p>
</blockquote>
</div>


                            </div>
                            <div id="Resample.upsample_monthly_data_and_divide_evenly" class="classattr">
                                        <input id="Resample.upsample_monthly_data_and_divide_evenly-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_multiindex(arg_name=&#39;timeseries_df&#39;)</div>

        <span class="def">def</span>
        <span class="name">upsample_monthly_data_and_divide_evenly</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>,</span><span class="param">	<span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="Resample.upsample_monthly_data_and_divide_evenly-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Resample.upsample_monthly_data_and_divide_evenly"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Resample.upsample_monthly_data_and_divide_evenly-230"><a href="#Resample.upsample_monthly_data_and_divide_evenly-230"><span class="linenos">230</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-231"><a href="#Resample.upsample_monthly_data_and_divide_evenly-231"><span class="linenos">231</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-232"><a href="#Resample.upsample_monthly_data_and_divide_evenly-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">upsample_monthly_data_and_divide_evenly</span><span class="p">(</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-233"><a href="#Resample.upsample_monthly_data_and_divide_evenly-233"><span class="linenos">233</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-234"><a href="#Resample.upsample_monthly_data_and_divide_evenly-234"><span class="linenos">234</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-235"><a href="#Resample.upsample_monthly_data_and_divide_evenly-235"><span class="linenos">235</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-236"><a href="#Resample.upsample_monthly_data_and_divide_evenly-236"><span class="linenos">236</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-237"><a href="#Resample.upsample_monthly_data_and_divide_evenly-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-238"><a href="#Resample.upsample_monthly_data_and_divide_evenly-238"><span class="linenos">238</span></a><span class="sd">        # @ TODO integrate to the previous function ?</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-239"><a href="#Resample.upsample_monthly_data_and_divide_evenly-239"><span class="linenos">239</span></a><span class="sd">        Upsample a monthly datetime-indexed pd.DataFrame to a provided frequency and averages the values so that the sum</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-240"><a href="#Resample.upsample_monthly_data_and_divide_evenly-240"><span class="linenos">240</span></a><span class="sd">        of columns remains the same :</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-241"><a href="#Resample.upsample_monthly_data_and_divide_evenly-241"><span class="linenos">241</span></a><span class="sd">        {2023-01-01 00:00:00 : 50, 2023-01-01 00:30:00: 40} with 15 minutes resampling should give</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-242"><a href="#Resample.upsample_monthly_data_and_divide_evenly-242"><span class="linenos">242</span></a><span class="sd">        {2023-01-01 00:00:00 : 25, 2023-01-01 00:15:00 : 25,</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-243"><a href="#Resample.upsample_monthly_data_and_divide_evenly-243"><span class="linenos">243</span></a><span class="sd">         2023-01-01 00:30:00 : 20, 2023-01-01 00:45:00 : 20}</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-244"><a href="#Resample.upsample_monthly_data_and_divide_evenly-244"><span class="linenos">244</span></a><span class="sd">        This is intended for columns with numerical values that vary when changing frequency (such as energy and cost,</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-245"><a href="#Resample.upsample_monthly_data_and_divide_evenly-245"><span class="linenos">245</span></a><span class="sd">        but not power)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-246"><a href="#Resample.upsample_monthly_data_and_divide_evenly-246"><span class="linenos">246</span></a><span class="sd">        The provided frequency must be lower than the original one in the dataframe index.</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-247"><a href="#Resample.upsample_monthly_data_and_divide_evenly-247"><span class="linenos">247</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-248"><a href="#Resample.upsample_monthly_data_and_divide_evenly-248"><span class="linenos">248</span></a><span class="sd">        :param freq: the aimed frequency. If given as string, it must be convertible to pd.Timedelta, eg &#39;1D&#39; or &#39;1H&#39;</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-249"><a href="#Resample.upsample_monthly_data_and_divide_evenly-249"><span class="linenos">249</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-250"><a href="#Resample.upsample_monthly_data_and_divide_evenly-250"><span class="linenos">250</span></a><span class="sd">                        go from a non-localized timestamp (eg. dates) to a localized one (e.g. date-times)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-251"><a href="#Resample.upsample_monthly_data_and_divide_evenly-251"><span class="linenos">251</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-252"><a href="#Resample.upsample_monthly_data_and_divide_evenly-252"><span class="linenos">252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-253"><a href="#Resample.upsample_monthly_data_and_divide_evenly-253"><span class="linenos">253</span></a>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-254"><a href="#Resample.upsample_monthly_data_and_divide_evenly-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-255"><a href="#Resample.upsample_monthly_data_and_divide_evenly-255"><span class="linenos">255</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-256"><a href="#Resample.upsample_monthly_data_and_divide_evenly-256"><span class="linenos">256</span></a>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-257"><a href="#Resample.upsample_monthly_data_and_divide_evenly-257"><span class="linenos">257</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-258"><a href="#Resample.upsample_monthly_data_and_divide_evenly-258"><span class="linenos">258</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-259"><a href="#Resample.upsample_monthly_data_and_divide_evenly-259"><span class="linenos">259</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-260"><a href="#Resample.upsample_monthly_data_and_divide_evenly-260"><span class="linenos">260</span></a>        <span class="p">)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-261"><a href="#Resample.upsample_monthly_data_and_divide_evenly-261"><span class="linenos">261</span></a>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-262"><a href="#Resample.upsample_monthly_data_and_divide_evenly-262"><span class="linenos">262</span></a>        <span class="c1"># check it&#39;s monthly</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-263"><a href="#Resample.upsample_monthly_data_and_divide_evenly-263"><span class="linenos">263</span></a>        <span class="p">(</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-264"><a href="#Resample.upsample_monthly_data_and_divide_evenly-264"><span class="linenos">264</span></a>            <span class="n">amount_months</span><span class="p">,</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-265"><a href="#Resample.upsample_monthly_data_and_divide_evenly-265"><span class="linenos">265</span></a>            <span class="n">month_freq</span><span class="p">,</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-266"><a href="#Resample.upsample_monthly_data_and_divide_evenly-266"><span class="linenos">266</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">original_freq</span><span class="p">)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-267"><a href="#Resample.upsample_monthly_data_and_divide_evenly-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">month_freq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">amount_months</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-268"><a href="#Resample.upsample_monthly_data_and_divide_evenly-268"><span class="linenos">268</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frequency should be monthly but found </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-269"><a href="#Resample.upsample_monthly_data_and_divide_evenly-269"><span class="linenos">269</span></a>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-270"><a href="#Resample.upsample_monthly_data_and_divide_evenly-270"><span class="linenos">270</span></a>        <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-271"><a href="#Resample.upsample_monthly_data_and_divide_evenly-271"><span class="linenos">271</span></a>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-272"><a href="#Resample.upsample_monthly_data_and_divide_evenly-272"><span class="linenos">272</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-273"><a href="#Resample.upsample_monthly_data_and_divide_evenly-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-274"><a href="#Resample.upsample_monthly_data_and_divide_evenly-274"><span class="linenos">274</span></a>            <span class="n">resampled_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-275"><a href="#Resample.upsample_monthly_data_and_divide_evenly-275"><span class="linenos">275</span></a>                <span class="n">resampled_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-276"><a href="#Resample.upsample_monthly_data_and_divide_evenly-276"><span class="linenos">276</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-277"><a href="#Resample.upsample_monthly_data_and_divide_evenly-277"><span class="linenos">277</span></a>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-278"><a href="#Resample.upsample_monthly_data_and_divide_evenly-278"><span class="linenos">278</span></a>        <span class="c1"># resample using the aggregation function</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-279"><a href="#Resample.upsample_monthly_data_and_divide_evenly-279"><span class="linenos">279</span></a>        <span class="c1"># We must artificially add one timestep to the original dataframe to make sure we don&#39;t miss time steps in the</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-280"><a href="#Resample.upsample_monthly_data_and_divide_evenly-280"><span class="linenos">280</span></a>        <span class="c1"># new frequency. With the example of the docstring, if we don&#39;t do this the 2023-01-01 00:45:00 won&#39;t be</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-281"><a href="#Resample.upsample_monthly_data_and_divide_evenly-281"><span class="linenos">281</span></a>        <span class="c1"># added when resampling which will make the sum of values in the numerical columns false</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-282"><a href="#Resample.upsample_monthly_data_and_divide_evenly-282"><span class="linenos">282</span></a>        <span class="n">resampled_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">resampled_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-283"><a href="#Resample.upsample_monthly_data_and_divide_evenly-283"><span class="linenos">283</span></a>        <span class="n">resampled_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-284"><a href="#Resample.upsample_monthly_data_and_divide_evenly-284"><span class="linenos">284</span></a>            <span class="n">resampled_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-285"><a href="#Resample.upsample_monthly_data_and_divide_evenly-285"><span class="linenos">285</span></a>            <span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-286"><a href="#Resample.upsample_monthly_data_and_divide_evenly-286"><span class="linenos">286</span></a>            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-287"><a href="#Resample.upsample_monthly_data_and_divide_evenly-287"><span class="linenos">287</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-288"><a href="#Resample.upsample_monthly_data_and_divide_evenly-288"><span class="linenos">288</span></a>            <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-289"><a href="#Resample.upsample_monthly_data_and_divide_evenly-289"><span class="linenos">289</span></a>        <span class="p">)</span>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-290"><a href="#Resample.upsample_monthly_data_and_divide_evenly-290"><span class="linenos">290</span></a>
</span><span id="Resample.upsample_monthly_data_and_divide_evenly-291"><a href="#Resample.upsample_monthly_data_and_divide_evenly-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">resampled_df</span>
</span></pre></div>


            <div class="docstring"><h1 id="todo-integrate-to-the-previous-function">@ TODO integrate to the previous function ?</h1>

<p>Upsample a monthly datetime-indexed pd.DataFrame to a provided frequency and averages the values so that the sum
of columns remains the same :
{2023-01-01 00:00:00 : 50, 2023-01-01 00:30:00: 40} with 15 minutes resampling should give
{2023-01-01 00:00:00 : 25, 2023-01-01 00:15:00 : 25,
 2023-01-01 00:30:00 : 20, 2023-01-01 00:45:00 : 20}
This is intended for columns with numerical values that vary when changing frequency (such as energy and cost,
but not power)
The provided frequency must be lower than the original one in the dataframe index.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>timeseries_df</strong>:  the dataframe with a datetime-like index</li>
<li><strong>freq</strong>:  the aimed frequency. If given as string, it must be convertible to pd.Timedelta, eg '1D' or '1H'</li>
<li><strong>tz_info</strong>:  the target time zone in case the index is resampled in another timezone / or if we want to
go from a non-localized timestamp (eg. dates) to a localized one (e.g. date-times)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>the upsampled timeseries dataframe</p>
</blockquote>
</div>


                            </div>
                            <div id="Resample.upsample_and_interpolate" class="classattr">
                                        <input id="Resample.upsample_and_interpolate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_multiindex(arg_name=&#39;timeseries_df&#39;)</div>

        <span class="def">def</span>
        <span class="name">upsample_and_interpolate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	freq: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;],</span><span class="param">	<span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>,</span><span class="param">	<span class="n">forward_fill</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">is_original_frequency_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Resample.upsample_and_interpolate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Resample.upsample_and_interpolate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Resample.upsample_and_interpolate-293"><a href="#Resample.upsample_and_interpolate-293"><span class="linenos">293</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample.upsample_and_interpolate-294"><a href="#Resample.upsample_and_interpolate-294"><span class="linenos">294</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-295"><a href="#Resample.upsample_and_interpolate-295"><span class="linenos">295</span></a>    <span class="k">def</span> <span class="nf">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-296"><a href="#Resample.upsample_and_interpolate-296"><span class="linenos">296</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-297"><a href="#Resample.upsample_and_interpolate-297"><span class="linenos">297</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="Resample.upsample_and_interpolate-298"><a href="#Resample.upsample_and_interpolate-298"><span class="linenos">298</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-299"><a href="#Resample.upsample_and_interpolate-299"><span class="linenos">299</span></a>        <span class="n">forward_fill</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-300"><a href="#Resample.upsample_and_interpolate-300"><span class="linenos">300</span></a>        <span class="n">is_original_frequency_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-301"><a href="#Resample.upsample_and_interpolate-301"><span class="linenos">301</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-302"><a href="#Resample.upsample_and_interpolate-302"><span class="linenos">302</span></a>        <span class="n">tz_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-303"><a href="#Resample.upsample_and_interpolate-303"><span class="linenos">303</span></a>    <span class="p">):</span>
</span><span id="Resample.upsample_and_interpolate-304"><a href="#Resample.upsample_and_interpolate-304"><span class="linenos">304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample.upsample_and_interpolate-305"><a href="#Resample.upsample_and_interpolate-305"><span class="linenos">305</span></a><span class="sd">        Upsample a datetime-indexed dataframe, and interpolate the columns data according to an interpolating method</span>
</span><span id="Resample.upsample_and_interpolate-306"><a href="#Resample.upsample_and_interpolate-306"><span class="linenos">306</span></a><span class="sd">        :param timeseries_df: the dataframe to resample</span>
</span><span id="Resample.upsample_and_interpolate-307"><a href="#Resample.upsample_and_interpolate-307"><span class="linenos">307</span></a><span class="sd">        :param freq: the target frequency (timedelta) e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc.</span>
</span><span id="Resample.upsample_and_interpolate-308"><a href="#Resample.upsample_and_interpolate-308"><span class="linenos">308</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc.)</span>
</span><span id="Resample.upsample_and_interpolate-309"><a href="#Resample.upsample_and_interpolate-309"><span class="linenos">309</span></a><span class="sd">        :param forward_fill: If True, the upsampling is performed for the last element of the datetimeindex</span>
</span><span id="Resample.upsample_and_interpolate-310"><a href="#Resample.upsample_and_interpolate-310"><span class="linenos">310</span></a><span class="sd">        :param is_original_frequency_unique: check whether the frequency is unique in the initial dataframe</span>
</span><span id="Resample.upsample_and_interpolate-311"><a href="#Resample.upsample_and_interpolate-311"><span class="linenos">311</span></a><span class="sd">        :param index_name: a name to give to the new index. For instance going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="Resample.upsample_and_interpolate-312"><a href="#Resample.upsample_and_interpolate-312"><span class="linenos">312</span></a><span class="sd">        :param tz_info: the target time zone in case the index is resampled in another timezone / or if we want to</span>
</span><span id="Resample.upsample_and_interpolate-313"><a href="#Resample.upsample_and_interpolate-313"><span class="linenos">313</span></a><span class="sd">                        go from a non-localized timestamp (e.g. dates) to a localized one (e.g. date-times)</span>
</span><span id="Resample.upsample_and_interpolate-314"><a href="#Resample.upsample_and_interpolate-314"><span class="linenos">314</span></a><span class="sd">        :return: the upsampled timeseries dataframe</span>
</span><span id="Resample.upsample_and_interpolate-315"><a href="#Resample.upsample_and_interpolate-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample.upsample_and_interpolate-316"><a href="#Resample.upsample_and_interpolate-316"><span class="linenos">316</span></a>
</span><span id="Resample.upsample_and_interpolate-317"><a href="#Resample.upsample_and_interpolate-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="Resample.upsample_and_interpolate-318"><a href="#Resample.upsample_and_interpolate-318"><span class="linenos">318</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dataframe index must be a DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-319"><a href="#Resample.upsample_and_interpolate-319"><span class="linenos">319</span></a>
</span><span id="Resample.upsample_and_interpolate-320"><a href="#Resample.upsample_and_interpolate-320"><span class="linenos">320</span></a>        <span class="c1"># check it&#39;s not a one-row dataframe, because it cannot be upsampled.</span>
</span><span id="Resample.upsample_and_interpolate-321"><a href="#Resample.upsample_and_interpolate-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample.upsample_and_interpolate-322"><a href="#Resample.upsample_and_interpolate-322"><span class="linenos">322</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-323"><a href="#Resample.upsample_and_interpolate-323"><span class="linenos">323</span></a>                <span class="s2">&quot;Cannot upsample an empty or single-record time series; because it&#39;s initial&quot;</span>
</span><span id="Resample.upsample_and_interpolate-324"><a href="#Resample.upsample_and_interpolate-324"><span class="linenos">324</span></a>                <span class="s2">&quot; frequency cannot be determined. Consider using &#39;forward_fill_last_record&#39; prior.&quot;</span>
</span><span id="Resample.upsample_and_interpolate-325"><a href="#Resample.upsample_and_interpolate-325"><span class="linenos">325</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-326"><a href="#Resample.upsample_and_interpolate-326"><span class="linenos">326</span></a>
</span><span id="Resample.upsample_and_interpolate-327"><a href="#Resample.upsample_and_interpolate-327"><span class="linenos">327</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Resample.upsample_and_interpolate-328"><a href="#Resample.upsample_and_interpolate-328"><span class="linenos">328</span></a>
</span><span id="Resample.upsample_and_interpolate-329"><a href="#Resample.upsample_and_interpolate-329"><span class="linenos">329</span></a>        <span class="c1"># set timezone in case it&#39;s been indicated</span>
</span><span id="Resample.upsample_and_interpolate-330"><a href="#Resample.upsample_and_interpolate-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="n">tz_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.upsample_and_interpolate-331"><a href="#Resample.upsample_and_interpolate-331"><span class="linenos">331</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-332"><a href="#Resample.upsample_and_interpolate-332"><span class="linenos">332</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">tz_info</span>
</span><span id="Resample.upsample_and_interpolate-333"><a href="#Resample.upsample_and_interpolate-333"><span class="linenos">333</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-334"><a href="#Resample.upsample_and_interpolate-334"><span class="linenos">334</span></a>
</span><span id="Resample.upsample_and_interpolate-335"><a href="#Resample.upsample_and_interpolate-335"><span class="linenos">335</span></a>        <span class="c1"># get frequency from the initial dataframe</span>
</span><span id="Resample.upsample_and_interpolate-336"><a href="#Resample.upsample_and_interpolate-336"><span class="linenos">336</span></a>        <span class="n">original_freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-337"><a href="#Resample.upsample_and_interpolate-337"><span class="linenos">337</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample.upsample_and_interpolate-338"><a href="#Resample.upsample_and_interpolate-338"><span class="linenos">338</span></a>        <span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-339"><a href="#Resample.upsample_and_interpolate-339"><span class="linenos">339</span></a>
</span><span id="Resample.upsample_and_interpolate-340"><a href="#Resample.upsample_and_interpolate-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">is_original_frequency_unique</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-341"><a href="#Resample.upsample_and_interpolate-341"><span class="linenos">341</span></a>            <span class="ow">not</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-342"><a href="#Resample.upsample_and_interpolate-342"><span class="linenos">342</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-343"><a href="#Resample.upsample_and_interpolate-343"><span class="linenos">343</span></a>                <span class="n">variable_duration_freq_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-344"><a href="#Resample.upsample_and_interpolate-344"><span class="linenos">344</span></a>                <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Resample.upsample_and_interpolate-345"><a href="#Resample.upsample_and_interpolate-345"><span class="linenos">345</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-346"><a href="#Resample.upsample_and_interpolate-346"><span class="linenos">346</span></a>        <span class="p">):</span>
</span><span id="Resample.upsample_and_interpolate-347"><a href="#Resample.upsample_and_interpolate-347"><span class="linenos">347</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequency is not unique in the dataframe&quot;</span><span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-348"><a href="#Resample.upsample_and_interpolate-348"><span class="linenos">348</span></a>
</span><span id="Resample.upsample_and_interpolate-349"><a href="#Resample.upsample_and_interpolate-349"><span class="linenos">349</span></a>        <span class="c1"># make sure we downsample</span>
</span><span id="Resample.upsample_and_interpolate-350"><a href="#Resample.upsample_and_interpolate-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-351"><a href="#Resample.upsample_and_interpolate-351"><span class="linenos">351</span></a>            <span class="n">freq</span>
</span><span id="Resample.upsample_and_interpolate-352"><a href="#Resample.upsample_and_interpolate-352"><span class="linenos">352</span></a>        <span class="p">)</span> <span class="o">&gt;=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">original_freq</span><span class="p">):</span>
</span><span id="Resample.upsample_and_interpolate-353"><a href="#Resample.upsample_and_interpolate-353"><span class="linenos">353</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-354"><a href="#Resample.upsample_and_interpolate-354"><span class="linenos">354</span></a>                <span class="sa">f</span><span class="s2">&quot;The required frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.upsample_and_interpolate-355"><a href="#Resample.upsample_and_interpolate-355"><span class="linenos">355</span></a>                <span class="sa">f</span><span class="s2">&quot; is higher than the original one </span><span class="si">{</span><span class="n">original_freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.upsample_and_interpolate-356"><a href="#Resample.upsample_and_interpolate-356"><span class="linenos">356</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-357"><a href="#Resample.upsample_and_interpolate-357"><span class="linenos">357</span></a>        <span class="c1"># resample and interpolate</span>
</span><span id="Resample.upsample_and_interpolate-358"><a href="#Resample.upsample_and_interpolate-358"><span class="linenos">358</span></a>        <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-359"><a href="#Resample.upsample_and_interpolate-359"><span class="linenos">359</span></a>
</span><span id="Resample.upsample_and_interpolate-360"><a href="#Resample.upsample_and_interpolate-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="n">forward_fill</span><span class="p">:</span>
</span><span id="Resample.upsample_and_interpolate-361"><a href="#Resample.upsample_and_interpolate-361"><span class="linenos">361</span></a>            <span class="c1"># this serves to extend the dataframe, and resample using &#39;ffill&#39; the last element</span>
</span><span id="Resample.upsample_and_interpolate-362"><a href="#Resample.upsample_and_interpolate-362"><span class="linenos">362</span></a>            <span class="c1"># of the dataframe (not impacted by the previous resampling operation).</span>
</span><span id="Resample.upsample_and_interpolate-363"><a href="#Resample.upsample_and_interpolate-363"><span class="linenos">363</span></a>            <span class="c1"># note that in that case, the timedelta must correspond to the initial frequency</span>
</span><span id="Resample.upsample_and_interpolate-364"><a href="#Resample.upsample_and_interpolate-364"><span class="linenos">364</span></a>            <span class="n">timeseries_df</span> <span class="o">=</span> <span class="n">Resample</span><span class="o">.</span><span class="n">forward_fill_final_record</span><span class="p">(</span>
</span><span id="Resample.upsample_and_interpolate-365"><a href="#Resample.upsample_and_interpolate-365"><span class="linenos">365</span></a>                <span class="n">timeseries_df</span><span class="p">,</span> <span class="n">gap_timedelta</span><span class="o">=</span><span class="n">original_freq</span>
</span><span id="Resample.upsample_and_interpolate-366"><a href="#Resample.upsample_and_interpolate-366"><span class="linenos">366</span></a>            <span class="p">)</span>
</span><span id="Resample.upsample_and_interpolate-367"><a href="#Resample.upsample_and_interpolate-367"><span class="linenos">367</span></a>
</span><span id="Resample.upsample_and_interpolate-368"><a href="#Resample.upsample_and_interpolate-368"><span class="linenos">368</span></a>        <span class="c1"># change the index_name if required</span>
</span><span id="Resample.upsample_and_interpolate-369"><a href="#Resample.upsample_and_interpolate-369"><span class="linenos">369</span></a>        <span class="k">if</span> <span class="n">index_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.upsample_and_interpolate-370"><a href="#Resample.upsample_and_interpolate-370"><span class="linenos">370</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index_name</span>
</span><span id="Resample.upsample_and_interpolate-371"><a href="#Resample.upsample_and_interpolate-371"><span class="linenos">371</span></a>
</span><span id="Resample.upsample_and_interpolate-372"><a href="#Resample.upsample_and_interpolate-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">timeseries_df</span>
</span></pre></div>


            <div class="docstring"><p>Upsample a datetime-indexed dataframe, and interpolate the columns data according to an interpolating method</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>timeseries_df</strong>:  the dataframe to resample</li>
<li><strong>freq</strong>:  the target frequency (timedelta) e.g. 'H', '30min', '15min', etc.</li>
<li><strong>method</strong>:  how are data interpolated between two consecutive dates (e.g. 'ffill', 'linear', etc.)</li>
<li><strong>forward_fill</strong>:  If True, the upsampling is performed for the last element of the datetimeindex</li>
<li><strong>is_original_frequency_unique</strong>:  check whether the frequency is unique in the initial dataframe</li>
<li><strong>index_name</strong>:  a name to give to the new index. For instance going from 'date' to 'time'.</li>
<li><strong>tz_info</strong>:  the target time zone in case the index is resampled in another timezone / or if we want to
go from a non-localized timestamp (e.g. dates) to a localized one (e.g. date-times)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>the upsampled timeseries dataframe</p>
</blockquote>
</div>


                            </div>
                            <div id="Resample.equal_sample_fillna" class="classattr">
                                        <input id="Resample.equal_sample_fillna-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_multiindex(arg_name=&#39;timeseries_df&#39;)</div>

        <span class="def">def</span>
        <span class="name">equal_sample_fillna</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">fill_value</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">method_filling</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">safe_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="Resample.equal_sample_fillna-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Resample.equal_sample_fillna"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Resample.equal_sample_fillna-374"><a href="#Resample.equal_sample_fillna-374"><span class="linenos">374</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample.equal_sample_fillna-375"><a href="#Resample.equal_sample_fillna-375"><span class="linenos">375</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-376"><a href="#Resample.equal_sample_fillna-376"><span class="linenos">376</span></a>    <span class="k">def</span> <span class="nf">equal_sample_fillna</span><span class="p">(</span>
</span><span id="Resample.equal_sample_fillna-377"><a href="#Resample.equal_sample_fillna-377"><span class="linenos">377</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample.equal_sample_fillna-378"><a href="#Resample.equal_sample_fillna-378"><span class="linenos">378</span></a>        <span class="n">fill_value</span><span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.equal_sample_fillna-379"><a href="#Resample.equal_sample_fillna-379"><span class="linenos">379</span></a>        <span class="n">method_filling</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.equal_sample_fillna-380"><a href="#Resample.equal_sample_fillna-380"><span class="linenos">380</span></a>        <span class="n">safe_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Resample.equal_sample_fillna-381"><a href="#Resample.equal_sample_fillna-381"><span class="linenos">381</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Resample.equal_sample_fillna-382"><a href="#Resample.equal_sample_fillna-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample.equal_sample_fillna-383"><a href="#Resample.equal_sample_fillna-383"><span class="linenos">383</span></a><span class="sd">        Fill missing values in a datetime-indexed pd.DataFrame with a frequency.</span>
</span><span id="Resample.equal_sample_fillna-384"><a href="#Resample.equal_sample_fillna-384"><span class="linenos">384</span></a><span class="sd">        Two options are possible to fill the missing values:</span>
</span><span id="Resample.equal_sample_fillna-385"><a href="#Resample.equal_sample_fillna-385"><span class="linenos">385</span></a><span class="sd">            - &#39;fill_value&#39; is used to fill with the same value (can be NaN, default behavior if set to None)</span>
</span><span id="Resample.equal_sample_fillna-386"><a href="#Resample.equal_sample_fillna-386"><span class="linenos">386</span></a><span class="sd">              all missing timestamp, calling Resampler.asfreq()</span>
</span><span id="Resample.equal_sample_fillna-387"><a href="#Resample.equal_sample_fillna-387"><span class="linenos">387</span></a><span class="sd">            - &#39;method_filling&#39; fills missing values calling Resampler.fillna() if method_filling</span>
</span><span id="Resample.equal_sample_fillna-388"><a href="#Resample.equal_sample_fillna-388"><span class="linenos">388</span></a><span class="sd">              is in {pad, backfill, ffill, bfill, nearest}</span>
</span><span id="Resample.equal_sample_fillna-389"><a href="#Resample.equal_sample_fillna-389"><span class="linenos">389</span></a>
</span><span id="Resample.equal_sample_fillna-390"><a href="#Resample.equal_sample_fillna-390"><span class="linenos">390</span></a><span class="sd">        :param timeseries_df: the dataframe with a datetime-like index</span>
</span><span id="Resample.equal_sample_fillna-391"><a href="#Resample.equal_sample_fillna-391"><span class="linenos">391</span></a><span class="sd">        :param fill_value: value to fill all missing values.</span>
</span><span id="Resample.equal_sample_fillna-392"><a href="#Resample.equal_sample_fillna-392"><span class="linenos">392</span></a><span class="sd">        :param method_filling: the method used to fill nan values.</span>
</span><span id="Resample.equal_sample_fillna-393"><a href="#Resample.equal_sample_fillna-393"><span class="linenos">393</span></a><span class="sd">        :param safe_run: boolean, if True, check there is no duplicates nor extra_periods</span>
</span><span id="Resample.equal_sample_fillna-394"><a href="#Resample.equal_sample_fillna-394"><span class="linenos">394</span></a><span class="sd">                         that the resampling could delete</span>
</span><span id="Resample.equal_sample_fillna-395"><a href="#Resample.equal_sample_fillna-395"><span class="linenos">395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample.equal_sample_fillna-396"><a href="#Resample.equal_sample_fillna-396"><span class="linenos">396</span></a>
</span><span id="Resample.equal_sample_fillna-397"><a href="#Resample.equal_sample_fillna-397"><span class="linenos">397</span></a>        <span class="c1"># check both options (fill_with and method_filling) are not active simultaneously</span>
</span><span id="Resample.equal_sample_fillna-398"><a href="#Resample.equal_sample_fillna-398"><span class="linenos">398</span></a>        <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">method_filling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.equal_sample_fillna-399"><a href="#Resample.equal_sample_fillna-399"><span class="linenos">399</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.equal_sample_fillna-400"><a href="#Resample.equal_sample_fillna-400"><span class="linenos">400</span></a>                <span class="sa">f</span><span class="s2">&quot;fill_value = </span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2"> which contradicts method_filling = </span><span class="si">{</span><span class="n">method_filling</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="Resample.equal_sample_fillna-401"><a href="#Resample.equal_sample_fillna-401"><span class="linenos">401</span></a>                <span class="s2">&quot;Only one can be not None.&quot;</span>
</span><span id="Resample.equal_sample_fillna-402"><a href="#Resample.equal_sample_fillna-402"><span class="linenos">402</span></a>            <span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-403"><a href="#Resample.equal_sample_fillna-403"><span class="linenos">403</span></a>
</span><span id="Resample.equal_sample_fillna-404"><a href="#Resample.equal_sample_fillna-404"><span class="linenos">404</span></a>        <span class="c1"># get frequency from the initial dataframe.</span>
</span><span id="Resample.equal_sample_fillna-405"><a href="#Resample.equal_sample_fillna-405"><span class="linenos">405</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample.equal_sample_fillna-406"><a href="#Resample.equal_sample_fillna-406"><span class="linenos">406</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Resample.equal_sample_fillna-407"><a href="#Resample.equal_sample_fillna-407"><span class="linenos">407</span></a>        <span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-408"><a href="#Resample.equal_sample_fillna-408"><span class="linenos">408</span></a>
</span><span id="Resample.equal_sample_fillna-409"><a href="#Resample.equal_sample_fillna-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">safe_run</span><span class="p">:</span>
</span><span id="Resample.equal_sample_fillna-410"><a href="#Resample.equal_sample_fillna-410"><span class="linenos">410</span></a>            <span class="c1"># check duplicates</span>
</span><span id="Resample.equal_sample_fillna-411"><a href="#Resample.equal_sample_fillna-411"><span class="linenos">411</span></a>            <span class="n">duplicates</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_duplicates</span><span class="p">(</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-412"><a href="#Resample.equal_sample_fillna-412"><span class="linenos">412</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Resample.equal_sample_fillna-413"><a href="#Resample.equal_sample_fillna-413"><span class="linenos">413</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Resample.equal_sample_fillna-414"><a href="#Resample.equal_sample_fillna-414"><span class="linenos">414</span></a>                    <span class="sa">f</span><span class="s2">&quot;Duplicates found in the index of the dataframe. The function would delete them, &quot;</span>
</span><span id="Resample.equal_sample_fillna-415"><a href="#Resample.equal_sample_fillna-415"><span class="linenos">415</span></a>                    <span class="sa">f</span><span class="s2">&quot;so it&#39;s unsafe to run. duplicates = </span><span class="si">{</span><span class="n">duplicates</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.equal_sample_fillna-416"><a href="#Resample.equal_sample_fillna-416"><span class="linenos">416</span></a>                <span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-417"><a href="#Resample.equal_sample_fillna-417"><span class="linenos">417</span></a>
</span><span id="Resample.equal_sample_fillna-418"><a href="#Resample.equal_sample_fillna-418"><span class="linenos">418</span></a>            <span class="c1"># check extra-periods</span>
</span><span id="Resample.equal_sample_fillna-419"><a href="#Resample.equal_sample_fillna-419"><span class="linenos">419</span></a>            <span class="n">extra_periods</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span>
</span><span id="Resample.equal_sample_fillna-420"><a href="#Resample.equal_sample_fillna-420"><span class="linenos">420</span></a>                <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample.equal_sample_fillna-421"><a href="#Resample.equal_sample_fillna-421"><span class="linenos">421</span></a>            <span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-422"><a href="#Resample.equal_sample_fillna-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_periods</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Resample.equal_sample_fillna-423"><a href="#Resample.equal_sample_fillna-423"><span class="linenos">423</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.equal_sample_fillna-424"><a href="#Resample.equal_sample_fillna-424"><span class="linenos">424</span></a>                    <span class="sa">f</span><span class="s2">&quot;Extra periods found in the index of the dataframe. The function would delete them,&quot;</span>
</span><span id="Resample.equal_sample_fillna-425"><a href="#Resample.equal_sample_fillna-425"><span class="linenos">425</span></a>                    <span class="sa">f</span><span class="s2">&quot; so it&#39;s unsafe to run. extra_periods = </span><span class="si">{</span><span class="n">extra_periods</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Resample.equal_sample_fillna-426"><a href="#Resample.equal_sample_fillna-426"><span class="linenos">426</span></a>                <span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-427"><a href="#Resample.equal_sample_fillna-427"><span class="linenos">427</span></a>
</span><span id="Resample.equal_sample_fillna-428"><a href="#Resample.equal_sample_fillna-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">method_filling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.equal_sample_fillna-429"><a href="#Resample.equal_sample_fillna-429"><span class="linenos">429</span></a>            <span class="c1"># resample using the method of Resampler.fillna() if provided</span>
</span><span id="Resample.equal_sample_fillna-430"><a href="#Resample.equal_sample_fillna-430"><span class="linenos">430</span></a>            <span class="c1"># throw an error if method_filling is not a valid option</span>
</span><span id="Resample.equal_sample_fillna-431"><a href="#Resample.equal_sample_fillna-431"><span class="linenos">431</span></a>            <span class="n">result_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method_filling</span><span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-432"><a href="#Resample.equal_sample_fillna-432"><span class="linenos">432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Resample.equal_sample_fillna-433"><a href="#Resample.equal_sample_fillna-433"><span class="linenos">433</span></a>            <span class="c1"># if method_filling is None, we use Resampler.asfreq() with fill_value</span>
</span><span id="Resample.equal_sample_fillna-434"><a href="#Resample.equal_sample_fillna-434"><span class="linenos">434</span></a>            <span class="n">result_df</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
</span><span id="Resample.equal_sample_fillna-435"><a href="#Resample.equal_sample_fillna-435"><span class="linenos">435</span></a>
</span><span id="Resample.equal_sample_fillna-436"><a href="#Resample.equal_sample_fillna-436"><span class="linenos">436</span></a>        <span class="k">return</span> <span class="n">result_df</span>
</span></pre></div>


            <div class="docstring"><p>Fill missing values in a datetime-indexed pd.DataFrame with a frequency.
Two options are possible to fill the missing values:
    - 'fill_value' is used to fill with the same value (can be NaN, default behavior if set to None)
      all missing timestamp, calling Resampler.asfreq()
    - 'method_filling' fills missing values calling Resampler.fillna() if method_filling
      is in {pad, backfill, ffill, bfill, nearest}</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>timeseries_df</strong>:  the dataframe with a datetime-like index</li>
<li><strong>fill_value</strong>:  value to fill all missing values.</li>
<li><strong>method_filling</strong>:  the method used to fill nan values.</li>
<li><strong>safe_run</strong>:  boolean, if True, check there is no duplicates nor extra_periods
that the resampling could delete</li>
</ul>
</div>


                            </div>
                            <div id="Resample.forward_fill_final_record" class="classattr">
                                        <input id="Resample.forward_fill_final_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_multiindex(arg_name=&#39;timeseries_df&#39;)</div>

        <span class="def">def</span>
        <span class="name">forward_fill_final_record</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	gap_timedelta: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;] = None,</span><span class="param">	cut_off: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;] = None,</span><span class="param">	excl_end_time: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;datetime.date&#x27;&gt;, &lt;class &#x27;datetime.datetime&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timestamps.Timestamp&#x27;&gt;] = None</span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Resample.forward_fill_final_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Resample.forward_fill_final_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Resample.forward_fill_final_record-438"><a href="#Resample.forward_fill_final_record-438"><span class="linenos">438</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Resample.forward_fill_final_record-439"><a href="#Resample.forward_fill_final_record-439"><span class="linenos">439</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;timeseries_df&quot;</span><span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-440"><a href="#Resample.forward_fill_final_record-440"><span class="linenos">440</span></a>    <span class="k">def</span> <span class="nf">forward_fill_final_record</span><span class="p">(</span>
</span><span id="Resample.forward_fill_final_record-441"><a href="#Resample.forward_fill_final_record-441"><span class="linenos">441</span></a>        <span class="n">timeseries_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="Resample.forward_fill_final_record-442"><a href="#Resample.forward_fill_final_record-442"><span class="linenos">442</span></a>        <span class="n">gap_timedelta</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.forward_fill_final_record-443"><a href="#Resample.forward_fill_final_record-443"><span class="linenos">443</span></a>        <span class="n">cut_off</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.forward_fill_final_record-444"><a href="#Resample.forward_fill_final_record-444"><span class="linenos">444</span></a>        <span class="n">excl_end_time</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Resample.forward_fill_final_record-445"><a href="#Resample.forward_fill_final_record-445"><span class="linenos">445</span></a>    <span class="p">):</span>
</span><span id="Resample.forward_fill_final_record-446"><a href="#Resample.forward_fill_final_record-446"><span class="linenos">446</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Resample.forward_fill_final_record-447"><a href="#Resample.forward_fill_final_record-447"><span class="linenos">447</span></a><span class="sd">        Forward-fill the final record of a regular datetime-indexed dataframe, keeping the frequency of</span>
</span><span id="Resample.forward_fill_final_record-448"><a href="#Resample.forward_fill_final_record-448"><span class="linenos">448</span></a><span class="sd">        the initial time series. This function not only add a timestamp, but resample with a forward-fill</span>
</span><span id="Resample.forward_fill_final_record-449"><a href="#Resample.forward_fill_final_record-449"><span class="linenos">449</span></a><span class="sd">        the timeseries until the desired timestamp.</span>
</span><span id="Resample.forward_fill_final_record-450"><a href="#Resample.forward_fill_final_record-450"><span class="linenos">450</span></a><span class="sd">        Naming &#39;final_ts&#39; the max of the index of the initial dataframe timeseries_df, the resulting index of the</span>
</span><span id="Resample.forward_fill_final_record-451"><a href="#Resample.forward_fill_final_record-451"><span class="linenos">451</span></a><span class="sd">        final dataframe can be determined from two manners:</span>
</span><span id="Resample.forward_fill_final_record-452"><a href="#Resample.forward_fill_final_record-452"><span class="linenos">452</span></a><span class="sd">        - using the argument &#39;gap_timedelta&#39; so that the new index goes until final_ts + gap_timedelta (excluded)</span>
</span><span id="Resample.forward_fill_final_record-453"><a href="#Resample.forward_fill_final_record-453"><span class="linenos">453</span></a><span class="sd">        - using the argument &#39;excl_end_final_date&#39; so that the new index goes until excl_end_time (excluded)</span>
</span><span id="Resample.forward_fill_final_record-454"><a href="#Resample.forward_fill_final_record-454"><span class="linenos">454</span></a><span class="sd">        The resampling frequency is determined from the frequency of the initial dataframe.</span>
</span><span id="Resample.forward_fill_final_record-455"><a href="#Resample.forward_fill_final_record-455"><span class="linenos">455</span></a><span class="sd">        The extra parameter &#39;cut_off&#39; can be used to set up a limit not to overpass. It means the resulting index is</span>
</span><span id="Resample.forward_fill_final_record-456"><a href="#Resample.forward_fill_final_record-456"><span class="linenos">456</span></a><span class="sd">        truncated to take into account the given cut-off.</span>
</span><span id="Resample.forward_fill_final_record-457"><a href="#Resample.forward_fill_final_record-457"><span class="linenos">457</span></a><span class="sd">        This function is typically used in junction with upsample_*() to forward-fill the last record.</span>
</span><span id="Resample.forward_fill_final_record-458"><a href="#Resample.forward_fill_final_record-458"><span class="linenos">458</span></a>
</span><span id="Resample.forward_fill_final_record-459"><a href="#Resample.forward_fill_final_record-459"><span class="linenos">459</span></a><span class="sd">        Here are some examples:</span>
</span><span id="Resample.forward_fill_final_record-460"><a href="#Resample.forward_fill_final_record-460"><span class="linenos">460</span></a>
</span><span id="Resample.forward_fill_final_record-461"><a href="#Resample.forward_fill_final_record-461"><span class="linenos">461</span></a><span class="sd">        1. Given timeseries_df:</span>
</span><span id="Resample.forward_fill_final_record-462"><a href="#Resample.forward_fill_final_record-462"><span class="linenos">462</span></a><span class="sd">        time_index                value</span>
</span><span id="Resample.forward_fill_final_record-463"><a href="#Resample.forward_fill_final_record-463"><span class="linenos">463</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="Resample.forward_fill_final_record-464"><a href="#Resample.forward_fill_final_record-464"><span class="linenos">464</span></a><span class="sd">        2021-01-01 12:00:00+01:00 2</span>
</span><span id="Resample.forward_fill_final_record-465"><a href="#Resample.forward_fill_final_record-465"><span class="linenos">465</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="Resample.forward_fill_final_record-466"><a href="#Resample.forward_fill_final_record-466"><span class="linenos">466</span></a>
</span><span id="Resample.forward_fill_final_record-467"><a href="#Resample.forward_fill_final_record-467"><span class="linenos">467</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;1D&#39;):</span>
</span><span id="Resample.forward_fill_final_record-468"><a href="#Resample.forward_fill_final_record-468"><span class="linenos">468</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="Resample.forward_fill_final_record-469"><a href="#Resample.forward_fill_final_record-469"><span class="linenos">469</span></a><span class="sd">        2021-01-01 12:00:00+01:00 2</span>
</span><span id="Resample.forward_fill_final_record-470"><a href="#Resample.forward_fill_final_record-470"><span class="linenos">470</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="Resample.forward_fill_final_record-471"><a href="#Resample.forward_fill_final_record-471"><span class="linenos">471</span></a><span class="sd">        2021-01-02 12:00:00+01:00 3</span>
</span><span id="Resample.forward_fill_final_record-472"><a href="#Resample.forward_fill_final_record-472"><span class="linenos">472</span></a>
</span><span id="Resample.forward_fill_final_record-473"><a href="#Resample.forward_fill_final_record-473"><span class="linenos">473</span></a><span class="sd">        2. Given df:</span>
</span><span id="Resample.forward_fill_final_record-474"><a href="#Resample.forward_fill_final_record-474"><span class="linenos">474</span></a><span class="sd">        time_index                value</span>
</span><span id="Resample.forward_fill_final_record-475"><a href="#Resample.forward_fill_final_record-475"><span class="linenos">475</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="Resample.forward_fill_final_record-476"><a href="#Resample.forward_fill_final_record-476"><span class="linenos">476</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="Resample.forward_fill_final_record-477"><a href="#Resample.forward_fill_final_record-477"><span class="linenos">477</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="Resample.forward_fill_final_record-478"><a href="#Resample.forward_fill_final_record-478"><span class="linenos">478</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="Resample.forward_fill_final_record-479"><a href="#Resample.forward_fill_final_record-479"><span class="linenos">479</span></a>
</span><span id="Resample.forward_fill_final_record-480"><a href="#Resample.forward_fill_final_record-480"><span class="linenos">480</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;3H&#39;, cut_off=None):</span>
</span><span id="Resample.forward_fill_final_record-481"><a href="#Resample.forward_fill_final_record-481"><span class="linenos">481</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="Resample.forward_fill_final_record-482"><a href="#Resample.forward_fill_final_record-482"><span class="linenos">482</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="Resample.forward_fill_final_record-483"><a href="#Resample.forward_fill_final_record-483"><span class="linenos">483</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="Resample.forward_fill_final_record-484"><a href="#Resample.forward_fill_final_record-484"><span class="linenos">484</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="Resample.forward_fill_final_record-485"><a href="#Resample.forward_fill_final_record-485"><span class="linenos">485</span></a><span class="sd">        2021-01-01 23:00:00+01:00 4</span>
</span><span id="Resample.forward_fill_final_record-486"><a href="#Resample.forward_fill_final_record-486"><span class="linenos">486</span></a><span class="sd">        2021-01-02 00:00:00+01:00 4</span>
</span><span id="Resample.forward_fill_final_record-487"><a href="#Resample.forward_fill_final_record-487"><span class="linenos">487</span></a>
</span><span id="Resample.forward_fill_final_record-488"><a href="#Resample.forward_fill_final_record-488"><span class="linenos">488</span></a><span class="sd">        3. Given df:</span>
</span><span id="Resample.forward_fill_final_record-489"><a href="#Resample.forward_fill_final_record-489"><span class="linenos">489</span></a><span class="sd">        time_index                value</span>
</span><span id="Resample.forward_fill_final_record-490"><a href="#Resample.forward_fill_final_record-490"><span class="linenos">490</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="Resample.forward_fill_final_record-491"><a href="#Resample.forward_fill_final_record-491"><span class="linenos">491</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="Resample.forward_fill_final_record-492"><a href="#Resample.forward_fill_final_record-492"><span class="linenos">492</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="Resample.forward_fill_final_record-493"><a href="#Resample.forward_fill_final_record-493"><span class="linenos">493</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="Resample.forward_fill_final_record-494"><a href="#Resample.forward_fill_final_record-494"><span class="linenos">494</span></a>
</span><span id="Resample.forward_fill_final_record-495"><a href="#Resample.forward_fill_final_record-495"><span class="linenos">495</span></a><span class="sd">        forward_fill_final_record(timeseries_df, gap_timedelta=&#39;3H&#39;, cut_off=&#39;1D&#39;):</span>
</span><span id="Resample.forward_fill_final_record-496"><a href="#Resample.forward_fill_final_record-496"><span class="linenos">496</span></a><span class="sd">        2021-01-01 19:00:00+01:00 1</span>
</span><span id="Resample.forward_fill_final_record-497"><a href="#Resample.forward_fill_final_record-497"><span class="linenos">497</span></a><span class="sd">        2021-01-01 20:00:00+01:00 2</span>
</span><span id="Resample.forward_fill_final_record-498"><a href="#Resample.forward_fill_final_record-498"><span class="linenos">498</span></a><span class="sd">        2021-01-01 21:00:00+01:00 3</span>
</span><span id="Resample.forward_fill_final_record-499"><a href="#Resample.forward_fill_final_record-499"><span class="linenos">499</span></a><span class="sd">        2021-01-01 22:00:00+01:00 4</span>
</span><span id="Resample.forward_fill_final_record-500"><a href="#Resample.forward_fill_final_record-500"><span class="linenos">500</span></a><span class="sd">        2021-01-01 23:00:00+01:00 4</span>
</span><span id="Resample.forward_fill_final_record-501"><a href="#Resample.forward_fill_final_record-501"><span class="linenos">501</span></a>
</span><span id="Resample.forward_fill_final_record-502"><a href="#Resample.forward_fill_final_record-502"><span class="linenos">502</span></a><span class="sd">        :param timeseries_df: input datetime-indexed dataframe to be forward-filled.</span>
</span><span id="Resample.forward_fill_final_record-503"><a href="#Resample.forward_fill_final_record-503"><span class="linenos">503</span></a><span class="sd">        :param gap_timedelta: The forward-filling is performed using this argument if provided.</span>
</span><span id="Resample.forward_fill_final_record-504"><a href="#Resample.forward_fill_final_record-504"><span class="linenos">504</span></a><span class="sd">                              Basically, the last index is extended until last_index + gap_timedelta</span>
</span><span id="Resample.forward_fill_final_record-505"><a href="#Resample.forward_fill_final_record-505"><span class="linenos">505</span></a><span class="sd">                              This option is incompatible with the setting of the excl_end_time argument</span>
</span><span id="Resample.forward_fill_final_record-506"><a href="#Resample.forward_fill_final_record-506"><span class="linenos">506</span></a><span class="sd">        :param cut_off: a timedelta that serves as a cut-off beyond which the final record is not extended</span>
</span><span id="Resample.forward_fill_final_record-507"><a href="#Resample.forward_fill_final_record-507"><span class="linenos">507</span></a><span class="sd">        :param excl_end_time: The forward-filling is performed using this argument if provided.</span>
</span><span id="Resample.forward_fill_final_record-508"><a href="#Resample.forward_fill_final_record-508"><span class="linenos">508</span></a><span class="sd">                              Basically, the last index is extended until excl_end_time - timeseries_df.index.freq</span>
</span><span id="Resample.forward_fill_final_record-509"><a href="#Resample.forward_fill_final_record-509"><span class="linenos">509</span></a><span class="sd">                              This option is incompatible with the setting of the gap_timedelta argument</span>
</span><span id="Resample.forward_fill_final_record-510"><a href="#Resample.forward_fill_final_record-510"><span class="linenos">510</span></a><span class="sd">        :return: datetime-indexed dataframe similar to the initial one, with the last record being forward filled</span>
</span><span id="Resample.forward_fill_final_record-511"><a href="#Resample.forward_fill_final_record-511"><span class="linenos">511</span></a><span class="sd">                 using the initial frequency of the dataframe index.</span>
</span><span id="Resample.forward_fill_final_record-512"><a href="#Resample.forward_fill_final_record-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Resample.forward_fill_final_record-513"><a href="#Resample.forward_fill_final_record-513"><span class="linenos">513</span></a>
</span><span id="Resample.forward_fill_final_record-514"><a href="#Resample.forward_fill_final_record-514"><span class="linenos">514</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="Resample.forward_fill_final_record-515"><a href="#Resample.forward_fill_final_record-515"><span class="linenos">515</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span>
</span><span id="Resample.forward_fill_final_record-516"><a href="#Resample.forward_fill_final_record-516"><span class="linenos">516</span></a>        <span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-517"><a href="#Resample.forward_fill_final_record-517"><span class="linenos">517</span></a>
</span><span id="Resample.forward_fill_final_record-518"><a href="#Resample.forward_fill_final_record-518"><span class="linenos">518</span></a>        <span class="c1"># the last record is understood as the max time (not the last record of the index)</span>
</span><span id="Resample.forward_fill_final_record-519"><a href="#Resample.forward_fill_final_record-519"><span class="linenos">519</span></a>        <span class="n">incl_end_time</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Resample.forward_fill_final_record-520"><a href="#Resample.forward_fill_final_record-520"><span class="linenos">520</span></a>
</span><span id="Resample.forward_fill_final_record-521"><a href="#Resample.forward_fill_final_record-521"><span class="linenos">521</span></a>        <span class="k">if</span> <span class="n">gap_timedelta</span> <span class="ow">and</span> <span class="n">excl_end_time</span><span class="p">:</span>
</span><span id="Resample.forward_fill_final_record-522"><a href="#Resample.forward_fill_final_record-522"><span class="linenos">522</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.forward_fill_final_record-523"><a href="#Resample.forward_fill_final_record-523"><span class="linenos">523</span></a>                <span class="s2">&quot;Cannot provide both arguments excl_end_time and gap_timedelta at once&quot;</span>
</span><span id="Resample.forward_fill_final_record-524"><a href="#Resample.forward_fill_final_record-524"><span class="linenos">524</span></a>            <span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-525"><a href="#Resample.forward_fill_final_record-525"><span class="linenos">525</span></a>        <span class="k">if</span> <span class="n">gap_timedelta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.forward_fill_final_record-526"><a href="#Resample.forward_fill_final_record-526"><span class="linenos">526</span></a>            <span class="n">extra_excl_end_time</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="Resample.forward_fill_final_record-527"><a href="#Resample.forward_fill_final_record-527"><span class="linenos">527</span></a>                <span class="n">incl_end_time</span><span class="p">,</span> <span class="n">gap_timedelta</span>
</span><span id="Resample.forward_fill_final_record-528"><a href="#Resample.forward_fill_final_record-528"><span class="linenos">528</span></a>            <span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-529"><a href="#Resample.forward_fill_final_record-529"><span class="linenos">529</span></a>        <span class="k">elif</span> <span class="n">excl_end_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.forward_fill_final_record-530"><a href="#Resample.forward_fill_final_record-530"><span class="linenos">530</span></a>            <span class="n">extra_excl_end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">excl_end_time</span><span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-531"><a href="#Resample.forward_fill_final_record-531"><span class="linenos">531</span></a>            <span class="k">if</span> <span class="n">extra_excl_end_time</span> <span class="o">&lt;=</span> <span class="n">incl_end_time</span><span class="p">:</span>
</span><span id="Resample.forward_fill_final_record-532"><a href="#Resample.forward_fill_final_record-532"><span class="linenos">532</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.forward_fill_final_record-533"><a href="#Resample.forward_fill_final_record-533"><span class="linenos">533</span></a>                    <span class="sa">f</span><span class="s2">&quot;Provided extra_excl_end_time=</span><span class="si">{</span><span class="n">extra_excl_end_time</span><span class="si">}</span><span class="s2"> &lt;= &quot;</span>
</span><span id="Resample.forward_fill_final_record-534"><a href="#Resample.forward_fill_final_record-534"><span class="linenos">534</span></a>                    <span class="sa">f</span><span class="s2">&quot;max(timeseries_df.index) = </span><span class="si">{</span><span class="n">incl_end_time</span><span class="si">}</span><span class="s2">. Cannot forward-fill.&quot;</span>
</span><span id="Resample.forward_fill_final_record-535"><a href="#Resample.forward_fill_final_record-535"><span class="linenos">535</span></a>                <span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-536"><a href="#Resample.forward_fill_final_record-536"><span class="linenos">536</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Resample.forward_fill_final_record-537"><a href="#Resample.forward_fill_final_record-537"><span class="linenos">537</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Resample.forward_fill_final_record-538"><a href="#Resample.forward_fill_final_record-538"><span class="linenos">538</span></a>                <span class="s2">&quot;One argument among excl_end_final_date and gap_timedelta must be given&quot;</span>
</span><span id="Resample.forward_fill_final_record-539"><a href="#Resample.forward_fill_final_record-539"><span class="linenos">539</span></a>            <span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-540"><a href="#Resample.forward_fill_final_record-540"><span class="linenos">540</span></a>
</span><span id="Resample.forward_fill_final_record-541"><a href="#Resample.forward_fill_final_record-541"><span class="linenos">541</span></a>        <span class="c1"># the dataframe is extended using the row of index.max()</span>
</span><span id="Resample.forward_fill_final_record-542"><a href="#Resample.forward_fill_final_record-542"><span class="linenos">542</span></a>        <span class="n">end_row</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">incl_end_time</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="Resample.forward_fill_final_record-543"><a href="#Resample.forward_fill_final_record-543"><span class="linenos">543</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Resample.forward_fill_final_record-544"><a href="#Resample.forward_fill_final_record-544"><span class="linenos">544</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duplicate last record, cannot find a way to extrapolate&quot;</span><span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-545"><a href="#Resample.forward_fill_final_record-545"><span class="linenos">545</span></a>        <span class="n">extra_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="Resample.forward_fill_final_record-546"><a href="#Resample.forward_fill_final_record-546"><span class="linenos">546</span></a>            <span class="n">timeseries_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">incl_end_time</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="Resample.forward_fill_final_record-547"><a href="#Resample.forward_fill_final_record-547"><span class="linenos">547</span></a>            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">extra_excl_end_time</span><span class="p">],</span>
</span><span id="Resample.forward_fill_final_record-548"><a href="#Resample.forward_fill_final_record-548"><span class="linenos">548</span></a>            <span class="n">columns</span><span class="o">=</span><span class="n">timeseries_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
</span><span id="Resample.forward_fill_final_record-549"><a href="#Resample.forward_fill_final_record-549"><span class="linenos">549</span></a>        <span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-550"><a href="#Resample.forward_fill_final_record-550"><span class="linenos">550</span></a>        <span class="n">extra_row</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
</span><span id="Resample.forward_fill_final_record-551"><a href="#Resample.forward_fill_final_record-551"><span class="linenos">551</span></a>
</span><span id="Resample.forward_fill_final_record-552"><a href="#Resample.forward_fill_final_record-552"><span class="linenos">552</span></a>        <span class="c1"># Add the extra row, and extrapolate using resample</span>
</span><span id="Resample.forward_fill_final_record-553"><a href="#Resample.forward_fill_final_record-553"><span class="linenos">553</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">end_row</span><span class="p">,</span> <span class="n">extra_row</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-554"><a href="#Resample.forward_fill_final_record-554"><span class="linenos">554</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-555"><a href="#Resample.forward_fill_final_record-555"><span class="linenos">555</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">incl_end_time</span><span class="p">,</span> <span class="n">extra_excl_end_time</span><span class="p">])</span>
</span><span id="Resample.forward_fill_final_record-556"><a href="#Resample.forward_fill_final_record-556"><span class="linenos">556</span></a>
</span><span id="Resample.forward_fill_final_record-557"><a href="#Resample.forward_fill_final_record-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="n">cut_off</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Resample.forward_fill_final_record-558"><a href="#Resample.forward_fill_final_record-558"><span class="linenos">558</span></a>            <span class="n">cut_off_end</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span>
</span><span id="Resample.forward_fill_final_record-559"><a href="#Resample.forward_fill_final_record-559"><span class="linenos">559</span></a>                <span class="n">incl_end_time</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">cut_off</span><span class="p">),</span> <span class="n">cut_off</span>
</span><span id="Resample.forward_fill_final_record-560"><a href="#Resample.forward_fill_final_record-560"><span class="linenos">560</span></a>            <span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-561"><a href="#Resample.forward_fill_final_record-561"><span class="linenos">561</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">cut_off_end</span><span class="p">]</span>
</span><span id="Resample.forward_fill_final_record-562"><a href="#Resample.forward_fill_final_record-562"><span class="linenos">562</span></a>
</span><span id="Resample.forward_fill_final_record-563"><a href="#Resample.forward_fill_final_record-563"><span class="linenos">563</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">timeseries_df</span><span class="p">,</span> <span class="n">result</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Resample.forward_fill_final_record-564"><a href="#Resample.forward_fill_final_record-564"><span class="linenos">564</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">timeseries_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span>
</span><span id="Resample.forward_fill_final_record-565"><a href="#Resample.forward_fill_final_record-565"><span class="linenos">565</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Forward-fill the final record of a regular datetime-indexed dataframe, keeping the frequency of
the initial time series. This function not only add a timestamp, but resample with a forward-fill
the timeseries until the desired timestamp.
Naming 'final_ts' the max of the index of the initial dataframe timeseries_df, the resulting index of the
final dataframe can be determined from two manners:</p>

<ul>
<li>using the argument 'gap_timedelta' so that the new index goes until final_ts + gap_timedelta (excluded)</li>
<li>using the argument 'excl_end_final_date' so that the new index goes until excl_end_time (excluded)
The resampling frequency is determined from the frequency of the initial dataframe.
The extra parameter 'cut_off' can be used to set up a limit not to overpass. It means the resulting index is
truncated to take into account the given cut-off.
This function is typically used in junction with upsample_*() to forward-fill the last record.</li>
</ul>

<p>Here are some examples:</p>

<ol>
<li>Given timeseries_df:
time_index                value
2021-01-01 00:00:00+01:00 1
2021-01-01 12:00:00+01:00 2
2021-01-02 00:00:00+01:00 3</li>
</ol>

<p>forward_fill_final_record(timeseries_df, gap_timedelta='1D'):
2021-01-01 00:00:00+01:00 1
2021-01-01 12:00:00+01:00 2
2021-01-02 00:00:00+01:00 3
2021-01-02 12:00:00+01:00 3</p>

<ol start="2">
<li>Given df:
time_index                value
2021-01-01 19:00:00+01:00 1
2021-01-01 20:00:00+01:00 2
2021-01-01 21:00:00+01:00 3
2021-01-01 22:00:00+01:00 4</li>
</ol>

<p>forward_fill_final_record(timeseries_df, gap_timedelta='3H', cut_off=None):
2021-01-01 19:00:00+01:00 1
2021-01-01 20:00:00+01:00 2
2021-01-01 21:00:00+01:00 3
2021-01-01 22:00:00+01:00 4
2021-01-01 23:00:00+01:00 4
2021-01-02 00:00:00+01:00 4</p>

<ol start="3">
<li>Given df:
time_index                value
2021-01-01 19:00:00+01:00 1
2021-01-01 20:00:00+01:00 2
2021-01-01 21:00:00+01:00 3
2021-01-01 22:00:00+01:00 4</li>
</ol>

<p>forward_fill_final_record(timeseries_df, gap_timedelta='3H', cut_off='1D'):
2021-01-01 19:00:00+01:00 1
2021-01-01 20:00:00+01:00 2
2021-01-01 21:00:00+01:00 3
2021-01-01 22:00:00+01:00 4
2021-01-01 23:00:00+01:00 4</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>timeseries_df</strong>:  input datetime-indexed dataframe to be forward-filled.</li>
<li><strong>gap_timedelta</strong>:  The forward-filling is performed using this argument if provided.
Basically, the last index is extended until last_index + gap_timedelta
This option is incompatible with the setting of the excl_end_time argument</li>
<li><strong>cut_off</strong>:  a timedelta that serves as a cut-off beyond which the final record is not extended</li>
<li><strong>excl_end_time</strong>:  The forward-filling is performed using this argument if provided.
Basically, the last index is extended until excl_end_time - timeseries_df.index.freq
This option is incompatible with the setting of the gap_timedelta argument</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>datetime-indexed dataframe similar to the initial one, with the last record being forward filled
           using the initial frequency of the dataframe index.</p>
</blockquote>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>