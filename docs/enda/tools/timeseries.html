<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.5.1"/>
    <title>enda.tools.timeseries API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../tools.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;enda.tools</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#TimeSeries">TimeSeries</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TimeSeries.FREQ_UNIT_TO_DAYS">FREQ_UNIT_TO_DAYS</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeSeries.FREQ_UNIT_TO_SECONDS">FREQ_UNIT_TO_SECONDS</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.split_amount_and_unit_from_freq">split_amount_and_unit_from_freq</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.is_regular_freq">is_regular_freq</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.freq_as_approximate_nb_days">freq_as_approximate_nb_days</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.freq_as_approximate_nb_seconds">freq_as_approximate_nb_seconds</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.add_timedelta">add_timedelta</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.subtract_timedelta">subtract_timedelta</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.has_nan_or_empty">has_nan_or_empty</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_nb_records">find_nb_records</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_gap_distribution">find_gap_distribution</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_most_common_frequency">find_most_common_frequency</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_duplicates">find_duplicates</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_extra_points">find_extra_points</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_duplicates_and_extra_points">find_duplicates_and_extra_points</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_missing_points">find_missing_points</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.collapse_to_periods">collapse_to_periods</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_missing_periods">find_missing_periods</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.has_single_frequency">has_single_frequency</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.align_timezone">align_timezone</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.find_missing_and_extra_periods">find_missing_and_extra_periods</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.collapse_dt_series_into_periods">collapse_dt_series_into_periods</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.get_timeseries_frequency">get_timeseries_frequency</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.interpolate_freq_to_sub_freq_data">interpolate_freq_to_sub_freq_data</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.forward_fill_final_record">forward_fill_final_record</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.interpolate_daily_to_sub_daily_data">interpolate_daily_to_sub_daily_data</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeSeries.average_to_upper_freq">average_to_upper_freq</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../enda.html">enda</a><wbr>.<a href="./../tools.html">tools</a><wbr>.timeseries    </h1>

                        <div class="docstring"><p>This module contains functions to help manipulating timeseries</p>
</div>

                        <input id="mod-timeseries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-timeseries-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;This module contains functions to help manipulating timeseries&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">pytz</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">enda.tools.decorators</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">enda.tools.resample</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">enda.tools.timezone_utils</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="k">class</span> <span class="nc">TimeSeries</span><span class="p">:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    This class contains methods for manipulating timeseries</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>    <span class="c1"># ------------------------</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="c1"># Frequencies / Timedelta</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>    <span class="c1"># ------------------------</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>    <span class="c1"># mapping of common frequencies codes to approximate number of days</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="c1"># checkout https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#dateoffset-objects</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="c1"># to get more information</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="n">FREQ_UNIT_TO_DAYS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>  <span class="c1"># millisecond</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">),</span>  <span class="c1"># second</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">),</span>  <span class="c1"># second</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1440</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="s2">&quot;MIN&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1440</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1440</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>  <span class="c1"># hour</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>  <span class="c1"># hour</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># day</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># day</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># business day</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># business day</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># week</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># week</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="s2">&quot;W-SUN&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># week</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>        <span class="s2">&quot;W-MON&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># week</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mf">30.4</span><span class="p">,</span>  <span class="c1"># average number of days in a month</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="mf">30.4</span><span class="p">,</span>  <span class="c1"># average number of days in a month</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span>  <span class="c1"># quarter (approximation)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span>  <span class="c1"># assuming 365 days in a year (approximation)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span>  <span class="c1"># assuming 365 days in a year (approximation)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="p">}</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="c1"># mapping of common frequencies codes to approximate number of seconds</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="n">FREQ_UNIT_TO_SECONDS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>  <span class="c1"># millisecond</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># second</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># second</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="s2">&quot;MIN&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># hour</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># hour</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>  <span class="c1"># number of seconds in a day (out of DST)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>  <span class="c1"># day (out of DST)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>  <span class="c1"># business day (out of DST)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>  <span class="c1"># business day (out of DST)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>  <span class="c1"># week (out of DST)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>  <span class="c1"># week (out of DST)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="s2">&quot;W-SUN&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>  <span class="c1"># week (out of DST)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="s2">&quot;W-MON&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>  <span class="c1"># week (out of DST)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mi">2626560</span><span class="p">,</span>  <span class="c1"># average number of seconds in a month</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="mi">2626560</span><span class="p">,</span>  <span class="c1"># average number of seconds in a month</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="mi">7862400</span><span class="p">,</span>  <span class="c1"># quarter (approximation)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mi">31536000</span><span class="p">,</span>  <span class="c1"># assuming 365 days in a year (approximation)</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mi">31536000</span><span class="p">,</span>  <span class="c1"># assuming 365 days in a year (approximation)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="p">}</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        Given a frequency as a string, such as &#39;1D&#39;, &#39;10min&#39;, &#39;-3MS&#39;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        extract the amount (e.g. 1, 10, -3) and the unit part (e.g. &#39;D&#39;, &#39;min&#39;, &#39;MS&#39;), capitalized.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        :param freq: the frequency</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        :return: the unit part of that frequency, and the number of units</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="c1"># if freq is a pd.Timedelta, it should be convertible to a string</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="n">freq_string_parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+|\D+)&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="c1"># several cases are possible to take into account the +/- sign</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>            <span class="c1"># in that case, first character must be a + or - sign, eg. &#39;-1D&#39;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>            <span class="k">if</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>            <span class="k">elif</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                <span class="k">pass</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First character is not a plus or minus sign&quot;</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>            <span class="c1"># numeric part - error if type is wrong</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>            <span class="c1"># freq part  - error if type is wrong</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>            <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="c1"># in that case, first group must be a number, second group must be a unit e.g. &#39;2MS&#39;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>            <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>            <span class="c1"># in that case, there is no number but first character might be a sign. e.g.  or &#39;MS&#39; or &#39;-D&#39;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="k">if</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="k">elif</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;freq </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> is not valid&quot;</span><span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="c1"># simple check</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="n">freq_unit_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_SECONDS</span><span class="p">:</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                <span class="sa">f</span><span class="s2">&quot;Unknown frequency unit </span><span class="si">{</span><span class="n">freq_unit_str</span><span class="si">}</span><span class="s2"> obtained from frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="nf">is_regular_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        Return a boolean that indicates the frequency is something regular or not</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        eg &#39;D&#39; &#39;min&#39; are regular, &#39;MS&#39;, &#39;Y&#39;, &#39;Q&#39; are not.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        For instance, irregular frequencies cannot be turned to pd.Timedelta elements.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        Note that if the frequency is a pd.Timedelta, it is always regular</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        :param freq: the frequency given as a string or a pd.Timedelta</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        :return: a boolean that indicates whether the considered frequency is &#39;even&#39;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="n">freq_unit_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        Map pandas freq string to an approximate length of days.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        This serves to compare freq strings, such as &#39;1D&#39;, &#39;3MS&#39;, and so on.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        It replaces the calls to total_seconds() possibly used only with pd.Timedelta().</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        Note that the computation is exact if a pd.Timedelta is given.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        :param freq: the frequency as a string, such as &#39;10min&#39;, &#39;3MS&#39;, or a pd.Timedelta.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        :return: a sometimes approximate length of the provided frequency in days</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="n">freq</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="c1"># error if is not in FREQ_UNIT_TO_DAYS</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_DAYS</span><span class="p">[</span><span class="n">freq_unit_str</span><span class="p">]</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">freq_as_approximate_nb_seconds</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        Map pandas freq string to an approximate number of seconds.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        This serves to compare freq strings, such as &#39;1D&#39;, &#39;3MS&#39;, and so on.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        It replaces the calls to total_seconds() possibly used only with pd.Timedelta().</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        Note that the computation is exact if a pd.Timedelta is given.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        :param freq: the frequency as a string, such as &#39;10min&#39;, &#39;3MS&#39;, or a pd.Timedelta.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        :return: a sometimes approximate length of the provided frequency in days</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="n">freq</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="c1"># error if is not in FREQ_UNIT_TO_SECONDS</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_SECONDS</span><span class="p">[</span><span class="n">freq_unit_str</span><span class="p">]</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">add_timedelta</span><span class="p">(</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">date</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">],</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">timedelta</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        Define how to add a timedelta according to the way it&#39;s provided (string, timedelta), regular or irregular</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        absolute length.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        :param date: a date, provided as a pd.Timestamp (naive or tz-aware), a date, a datetime</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        :param timedelta:  a timedelta, given as a freq string (e.g. &#39;2MS&#39;) or a pd.Timedelta object.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;timedelta must be of type Timedelta or string &quot;</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">timedelta</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="c1"># if it&#39;s a string, it is not necessarily convertible to timedelta, as</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="c1"># it might be an irregular length (month, year, quarter...)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="c1"># in that case, we handle these cases before defaulting to pd.to_timedelta()</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="p">(</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>            <span class="n">numeric_part_int</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="n">unit_freq_str</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">timedelta_str</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                    <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                <span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">]:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                <span class="s2">&quot;Cannot simply add a quarter, it does not mean anything in general&quot;</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="c1"># there, it should be convertible to pd.Timedelta with no ambiguous interpretation</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="c1"># because we&#39;re under the day scale (no DST issue)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="n">timedelta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numeric_part_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit_freq_str</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="k">return</span> <span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="k">def</span> <span class="nf">subtract_timedelta</span><span class="p">(</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">date</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">],</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="n">timedelta</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        Define how to subtract a timedelta according to the way it&#39;s provided (string, timedelta), regular or irregular</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        absolute length.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        :param date: a date, provided as a pd.Timestamp (naive or tz-aware), a date, a datetime</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        :param timedelta: a timedelta, given as a freq string (e.g. &#39;2MS&#39;) or a pd.Timedelta object.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;timedelta must be of type Timedelta or string &quot;</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">timedelta</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="c1"># if it&#39;s a string, it is not necessarily convertible to timedelta, as</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="c1"># it might be an irregular length (month, year, quarter...)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="c1"># in that case, we handle these cases before defaulting to pd.to_timedelta()</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="p">(</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="n">numeric_part_int</span><span class="p">,</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="n">unit_freq_str</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">timedelta_str</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>                    <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>                <span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">]:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="s2">&quot;Cannot simply subtract a quarter, it does not mean anything in general&quot;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>            <span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="c1"># there, it should be convertible to pd.Timedelta with no ambiguous interpretation</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="c1"># because we&#39;re under the day scale (no DST issue)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">timedelta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numeric_part_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit_freq_str</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>    <span class="c1"># ------------</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>    <span class="c1"># Time-series</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>    <span class="c1"># ------------</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        Check whether a datetime index has NaN or is empty</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;parameter &#39;dti&#39; should be a pandas.DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>    <span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="nf">find_nb_records</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        Compute the number of records</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">         :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        :param skip_duplicate_timestamps: bool that indicates if duplicates must be considered</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">               or not when computing the number of records</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        :return: the number of records in the time series</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>    <span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">find_gap_distribution</span><span class="p">(</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">        Find frequencies in a pd.DatetimeIndex. The function computes</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">        all timedelta between successive indexes, and count them. It returns an ordered</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">        pd.Series, with the most commonly found in index 0.</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        :param skip_duplicate_timestamps: bool that indicates if duplicates must be considered</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">               or not when the gap distribution is considered.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">        :return: a pd.Series with all frequencies found, and their cardinality.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">                eg. &gt;&gt;&gt; find_frequencies(dti)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">                #    01:00:00    1181</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">                #    02:00:00     499</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">                #    03:00:00     180</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">                #    ....</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty dti&quot;</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="c1"># compute the gap distribution</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">gap_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dti</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="n">gap_dist</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>    <span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="k">def</span> <span class="nf">find_most_common_frequency</span><span class="p">(</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        Find most common frequency in pd.DatetimeIndex. If several frequencies are found, it returns the most common.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        The function checks the index is not null,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        :param skip_duplicate_timestamps: if True, the function will not consider duplicate timestamps</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">                                          in the calculation.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        :return : the most common frequency found in the datetime index as a string</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty datetime index&quot;</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="n">nb_records</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="k">if</span> <span class="n">nb_records</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="c1"># we cannot get a frequency out of the series, as it&#39;s a single element series !</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="k">if</span> <span class="n">nb_records</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>            <span class="c1"># try getting single frequency from pandas if the series is big enough</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="c1"># it means there is some kind of irregularity in the datetimeindex, as pandas could not find it or</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>            <span class="c1"># e.g. there might be more than one frequency in the dataframe.</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="c1"># note that there must be at least two records in the datetimeindex at that point</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="c1"># get all gap distributions in the dataframe</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="n">gap_distribution</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_gap_distribution</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="c1"># return the more common</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">gap_distribution</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="c1"># turn it to a string</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="c1"># if the freq is &#39;one&#39; of a particular unit, pandas just returns the unit,</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="c1"># This is not practical for other functions, so we add 1 to the string freq.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="c1"># e.g. the freq is one day, pandas may return &#39;D&#39;</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="c1"># we transform it to &#39;1D&#39; in that case</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span> <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdecimal</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;1&quot;</span> <span class="o">+</span> <span class="n">freq</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="k">return</span> <span class="n">freq</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>    <span class="k">def</span> <span class="nf">find_duplicates</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        Check for duplicates in the timeseries</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">        :return: duplicates</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="k">return</span> <span class="n">dti</span><span class="p">[</span><span class="n">dti</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>    <span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>    <span class="k">def</span> <span class="nf">find_extra_points</span><span class="p">(</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        Check for extra data points in the timeseries, i.e. data points that are</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">        outside the expected frequency (or the most common frequency if not known) of data points.</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">        This is based on the min and max of the index, which means no extra point might be found</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">        if min or max are the extra points (in that case, there might be missing periods!)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        :return: extra data points</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="c1"># get freq if None</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_freq</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>            <span class="n">expected_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>                <span class="n">dti</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="c1"># inspect extra periods: we must work on a sorted dti without index</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">data_index</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">expected_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>            <span class="n">data_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="n">expected_freq</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">data_index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">expected_index</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="k">return</span> <span class="n">extra_points</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>    <span class="k">def</span> <span class="nf">find_duplicates_and_extra_points</span><span class="p">(</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">]:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        Check for extra data points in the timeseries, i.e. data points that are duplicated and/or data points that are</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">        outside the expected frequency (or the most common frequency if not known) of data points.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        :param dti: a time_series</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        :return: extra data points</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_duplicates</span><span class="p">(</span><span class="n">dti</span><span class="p">),</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>    <span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>    <span class="k">def</span> <span class="nf">find_missing_points</span><span class="p">(</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">        Check for missing periods in the time series with an expected frequency.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">        :param expected_start_datetime: the expected start time of the datetime index, default None</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        :param expected_excl_end_datetime: the expected exclusive end time of the datetime index, default None</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        :return: missing points as a datetime index</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty datetime index&quot;</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="c1"># process freq</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_freq</span><span class="p">:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>            <span class="n">expected_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="c1"># drop duplicates and sort</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="c1"># start date</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="k">if</span> <span class="n">expected_start_datetime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expected_start_datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;expected_start_datetime must be a pandas.Datetime&quot;</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">expected_start_datetime</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>            <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="c1"># end date</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="k">if</span> <span class="n">expected_excl_end_datetime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expected_excl_end_datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;expected_end_datetime must be a pandas.Datetime&quot;</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">subtract_timedelta</span><span class="p">(</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>                <span class="n">expected_excl_end_datetime</span><span class="p">,</span> <span class="n">expected_freq</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="p">)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="c1"># compute the expected index</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="n">expected_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start_datetime</span><span class="p">,</span> <span class="n">end_datetime</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">expected_freq</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">expected_index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="k">return</span> <span class="n">missing_points</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>    <span class="p">)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>    <span class="k">def</span> <span class="nf">collapse_to_periods</span><span class="p">(</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="nb">tuple</span><span class="p">[</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="p">]</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>    <span class="p">]:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">        Given a datetime index and a frequency, it gives the list of regular periods found in the datetime index, as</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">        a collection of tuples that contain the start time and exclusive time of the periods found. More precisely,</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a><span class="sd">        if a timestamp is missing (ie if t is present but t + freq is missing), a new period is defined (t</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">        becomes the end time of the current period, and the next timestamp found after t defines the beginning of a new</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="sd">        period).</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">        Duplicates are dropped in the operation.</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">        :param freq: the freq of the datetime index used to find missing periods.</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">        :return: a list of tuples that contain the regular periods in the datetime index (defined as the start and</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">        inclusive end times of the period).</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="c1"># drop duplicates and sort the index</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="n">current_period_start</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        <span class="n">periods_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>            <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">freq</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>                <span class="c1"># end the current period and start a new one</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>                <span class="n">periods_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_period_start</span><span class="p">,</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>                <span class="n">current_period_start</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="n">periods_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_period_start</span><span class="p">,</span> <span class="n">dti</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># Don&#39;t forget last period</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="k">return</span> <span class="n">periods_list</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>    <span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>    <span class="k">def</span> <span class="nf">find_missing_periods</span><span class="p">(</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>        <span class="n">expected_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>        <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">        Find missing periods in a datetimeIndex. It finds all missing points, and collapse them</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">        in periods</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">        :param expected_start_datetime: the expected start time of the datetime index, default None</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">        :param expected_excl_end_datetime: the expected exclusive end time of the datetime index, default None</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">        :return: missing periods as a list of tuples of start and end times of the missing periods.</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">expected_freq</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="n">expected_freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_points</span><span class="p">(</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>            <span class="n">dti</span><span class="p">,</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>            <span class="n">expected_freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>            <span class="n">expected_start_datetime</span><span class="o">=</span><span class="n">expected_start_datetime</span><span class="p">,</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="n">expected_excl_end_datetime</span><span class="p">,</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>        <span class="p">)</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">collapse_to_periods</span><span class="p">(</span><span class="n">missing_points</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>    <span class="p">)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>    <span class="k">def</span> <span class="nf">has_single_frequency</span><span class="p">(</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="n">variable_duration_freq_included</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">        Return True if the provided datetime index has a single frequency, i.e.</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a><span class="sd">        does not have missing periods, extra points, nor change of frequency</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">        :param variable_duration_freq_included: &#39;Frequency&#39; may have a double meaning, whether fixed-time frequencies</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">                                           are considered or not. For instance, a frequency of one month leads to</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">                                           intervals with different absolute length (in terms of days, and seconds).</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="sd">                                           Setting True means the datetimeindex is inspected with absolute duration</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">                                           in mind. It is useful when we expect:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">                                           * an x-min difference between timestamps</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">                                           * an x-day difference between dates</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">        :param skip_duplicate_timestamps: If True, the function will not consider duplicate timestamps</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">        :return: True if the data has a clean single frequency defined.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>        <span class="c1"># easy case: check the exact differences in duration between timestamps / dates</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>        <span class="k">if</span> <span class="n">variable_duration_freq_included</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_gap_distribution</span><span class="p">(</span><span class="n">dti</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>        <span class="c1"># else, it might be more tricky, because the frequency may be irregular in terms of total_seconds</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>        <span class="c1"># (e.g. when freq is months, years, or even days because of change of hour). We need to rely on pd.infer_freq().</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>        <span class="c1"># Safer way is to reconstruct a time-series index from scratch using the most common frequency found in the</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>        <span class="c1"># input index, and compare it to the index.</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>        <span class="c1"># most common freq</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>        <span class="n">most_common_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>        <span class="c1"># we rely on find extra points and missing points to detect it.</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span><span class="o">=</span><span class="n">most_common_freq</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_points</span><span class="p">(</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>            <span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span><span class="o">=</span><span class="n">most_common_freq</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>        <span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>    <span class="c1"># ----------------------------------</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>    <span class="c1"># DEPRECATED FUNCTIONS AND CALL</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>    <span class="c1"># ----------------------------------</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;TimezoneUtils&quot;</span><span class="p">,</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;convert_dtype_from_object_to_tz_aware&quot;</span><span class="p">,</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>    <span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>    <span class="k">def</span> <span class="nf">align_timezone</span><span class="p">(</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>        <span class="n">time_series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>        <span class="n">tzinfo</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>            <span class="nb">str</span><span class="p">,</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>            <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="p">],</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>    <span class="p">):</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a><span class="sd">        Sometimes a time series is of pandas type &quot;object&quot; just because the time-zone information</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a><span class="sd">        is not well-read initially. Such a series can&#39;t be translated to a pd.DatetimeIndex.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a><span class="sd">        This function makes sure the time zone information of the input series is set to the input</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="sd">        tz_info for each row and also for the series.</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a><span class="sd">        Example :</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a><span class="sd">        time_series = a time_series with some times at timezone +01:00 (French winter time)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a><span class="sd">                      and others at timezone +02:00 (French summer)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="sd">                      So its pandas dtype is &quot;object&quot;</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a><span class="sd">        tz = pytz.timezone(&quot;Europe/Paris&quot;)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a><span class="sd">        :param time_series: a series with tz-aware date-times. If a datetime-index is passed, the function</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="sd">                            process it</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a><span class="sd">        :param tzinfo: a str or a datetime.tzinfo</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a><span class="sd">        :return: a DatetimeIndex of dtype: datetime[ns, tzinfo]</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>            <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">convert_dtype_from_object_to_tz_aware</span><span class="p">(</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>                <span class="n">time_series</span><span class="o">=</span><span class="n">time_series</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tzinfo</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>            <span class="p">)</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>        <span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;find_missing_periods and find_extra_points&quot;</span><span class="p">,</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>    <span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>    <span class="k">def</span> <span class="nf">find_missing_and_extra_periods</span><span class="p">(</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>        <span class="n">dti</span><span class="p">,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>        <span class="n">expected_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>        <span class="n">expected_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>    <span class="p">):</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a><span class="sd">        Check for missing and extra data points</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a><span class="sd">        :param dti: a series of type DatetimeIndex, in ascending order and without duplicates or NaNs</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a><span class="sd">        :param expected_freq: pandas formatted frequency. If None is given, will infer the frequency, taking the</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a><span class="sd">            most common gap between 2 consecutive points.</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a><span class="sd">        :param expected_start_datetime: a pandas.Datetime, if None is given, will take dti[0]</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a><span class="sd">        :param expected_end_datetime: a pandas.Datetime, if None is given, will take dti[-1]</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a><span class="sd">        :return: Missing and extra data points collapsed in periods</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>        <span class="c1"># for the sake of compatibility</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">dti</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;given dti is not in ascending order&quot;</span><span class="p">)</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;given dti has duplicates.&quot;</span><span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>        <span class="n">missing_periods</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_periods</span><span class="p">(</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>            <span class="n">dti</span><span class="p">,</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>            <span class="n">expected_freq</span><span class="o">=</span><span class="n">expected_freq</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>            <span class="n">expected_start_datetime</span><span class="o">=</span><span class="n">expected_start_datetime</span><span class="p">,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>            <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="n">expected_end_datetime</span><span class="p">,</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>        <span class="p">)</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span> <span class="n">missing_periods</span><span class="p">,</span> <span class="n">extra_points</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;collapse_to_periods&quot;</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>    <span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>    <span class="k">def</span> <span class="nf">collapse_dt_series_into_periods</span><span class="p">(</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>        <span class="nb">tuple</span><span class="p">[</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>        <span class="p">]</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>    <span class="p">]:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a><span class="sd">        Given a datetime index and a frequency, it gives the list of regular periods found in the datetime index, as</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a><span class="sd">        a collection of tuples that contain the start time and exclusive time of the periods found. More precisely,</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a><span class="sd">        if a timestamp is missing (ie if t is present but t + freq is missing), a new period is defined (t</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a><span class="sd">        becomes the end time of the current period, and the next timestamp found after t defines the beginning of a new</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a><span class="sd">        period).</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a><span class="sd">        :param freq: the freq of the datetime index used to find missing periods.</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a><span class="sd">        :return: a list of tuples that contain the regular periods in the datetime index (defined as the start and</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a><span class="sd">        inclusive end times of the period).</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>        <span class="c1"># legacy: check duplicates and multiple of period</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>            <span class="k">if</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dti must be sorted and without duplicates!&quot;</span><span class="p">)</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">%</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>                <span class="n">freq</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>                    <span class="sa">f</span><span class="s2">&quot;Timedelta between </span><span class="si">{</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> is not a multiple of freq (</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>                <span class="p">)</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">collapse_to_periods</span><span class="p">(</span><span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;find_most_common_frequency&quot;</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>    <span class="p">)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>    <span class="k">def</span> <span class="nf">get_timeseries_frequency</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a><span class="sd">        Retrieve the frequency of a pandas dataframe&#39;s index.</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Found several frequencies in the datetimeIndex&quot;</span><span class="p">)</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;upsample_and_interpolate&quot;</span><span class="p">,</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>    <span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>    <span class="k">def</span> <span class="nf">interpolate_freq_to_sub_freq_data</span><span class="p">(</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>        <span class="n">enforce_single_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>    <span class="p">):</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a><span class="sd">        Interpolate dataframe data on a smaller frequency than the one initially defined</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a><span class="sd">        in the dataframe</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a><span class="sd">        The original index of the data must have a well-defined frequency, i.e. it must be</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a><span class="sd">        able to retrieve its frequency with inferred_freq</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a><span class="sd">        :param df: pd.DataFrame</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a><span class="sd">        :param freq: a frequency e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc.</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a><span class="sd">        :param tz: the target time zone.</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a><span class="sd">        :param index_name: name to give to the new index. Usually going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc.)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a><span class="sd">        :param enforce_single_freq: is there a single frequency in the original dataframe</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a><span class="sd">        :return: pd.DataFrame</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>            <span class="n">forward_fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>            <span class="n">is_original_frequency_unique</span><span class="o">=</span><span class="n">enforce_single_freq</span><span class="p">,</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>        <span class="p">)</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>    <span class="p">)</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>    <span class="k">def</span> <span class="nf">forward_fill_final_record</span><span class="p">(</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a>        <span class="n">gap_frequency</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a>        <span class="n">cut_off_frequency</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>    <span class="p">):</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a><span class="sd">        Forward-fill last record</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">get_timeseries_frequency</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a>        <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataframe has no frequency and cannot be extended&quot;</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a>            <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">gap_frequency</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a>        <span class="p">):</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a>                <span class="s2">&quot;Cannot extend the dataframe on a smaller frequency than itself&quot;</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a>            <span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">forward_fill_final_record</span><span class="p">(</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">gap_timedelta</span><span class="o">=</span><span class="n">gap_frequency</span><span class="p">,</span> <span class="n">cut_off</span><span class="o">=</span><span class="n">cut_off_frequency</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a>        <span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a>        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;upsample_and_interpolate&quot;</span><span class="p">,</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a>    <span class="p">)</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a>    <span class="k">def</span> <span class="nf">interpolate_daily_to_sub_daily_data</span><span class="p">(</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos">889</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos">890</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ffill&quot;</span><span class="p">,</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos">891</span></a>    <span class="p">):</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos">892</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos">893</span></a><span class="sd">        Interpolate daily data in a dataframe (with a DatetimeIndex) to sub-daily data using a given method.</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos">894</span></a><span class="sd">        The last daily record is resampled using a forward-fill in any case.</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos">895</span></a><span class="sd">        :param df: pd.DataFrame</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos">896</span></a><span class="sd">        :param freq: a frequency &lt; &#39;D&#39; (e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc)</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos">897</span></a><span class="sd">        :param tz: the time zone (None not accepted because important)</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos">898</span></a><span class="sd">        :param index_name: name to give to the new index. Usually going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos">899</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc)</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos">900</span></a><span class="sd">        :return: pd.DataFrame</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos">901</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos">902</span></a>
</span><span id="L-903"><a href="#L-903"><span class="linenos">903</span></a>        <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos">904</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos">905</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos">906</span></a>            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos">907</span></a>            <span class="n">forward_fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos">908</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos">909</span></a>            <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">,</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos">910</span></a>        <span class="p">)</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos">911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos">912</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos">913</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos">914</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos">915</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos">916</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;downsample&quot;</span><span class="p">,</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos">917</span></a>    <span class="p">)</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos">918</span></a>    <span class="k">def</span> <span class="nf">average_to_upper_freq</span><span class="p">(</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos">919</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos">920</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos">921</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos">922</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos">923</span></a>        <span class="n">enforce_single_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos">924</span></a>    <span class="p">):</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos">925</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos">926</span></a><span class="sd">        Downsample data provided in a given dataframe with a DatetimeIndex, or a two-levels</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos">927</span></a><span class="sd">        compatible Multiindex.</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos">928</span></a><span class="sd">        The provided frequency serves as a basis to group the data and average.</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos">929</span></a><span class="sd">        If the initial dataframe has no frequency, we raise an error.</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos">930</span></a>
</span><span id="L-931"><a href="#L-931"><span class="linenos">931</span></a><span class="sd">        Example:</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos">932</span></a>
</span><span id="L-933"><a href="#L-933"><span class="linenos">933</span></a><span class="sd">        1. Given df:</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos">934</span></a><span class="sd">        time_index                value</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos">935</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos">936</span></a><span class="sd">        2021-01-01 00:12:00+01:00 2</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos">937</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos">938</span></a>
</span><span id="L-939"><a href="#L-939"><span class="linenos">939</span></a><span class="sd">        average_to_upper_freq(df, freq=&#39;1D&#39;):</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos">940</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1.5</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos">941</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos">942</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos">943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos">944</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos">945</span></a>            <span class="n">df</span><span class="p">,</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos">946</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos">947</span></a>            <span class="n">agg_functions</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos">948</span></a>            <span class="n">is_original_frequency_unique</span><span class="o">=</span><span class="n">enforce_single_freq</span><span class="p">,</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos">949</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos">950</span></a>        <span class="p">)</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos">951</span></a>
</span><span id="L-952"><a href="#L-952"><span class="linenos">952</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos">953</span></a>
</span><span id="L-954"><a href="#L-954"><span class="linenos">954</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            </section>
                <section id="TimeSeries">
                            <input id="TimeSeries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimeSeries</span>:

                <label class="view-source-button" for="TimeSeries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries-17"><a href="#TimeSeries-17"><span class="linenos"> 17</span></a><span class="k">class</span> <span class="nc">TimeSeries</span><span class="p">:</span>
</span><span id="TimeSeries-18"><a href="#TimeSeries-18"><span class="linenos"> 18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-19"><a href="#TimeSeries-19"><span class="linenos"> 19</span></a><span class="sd">    This class contains methods for manipulating timeseries</span>
</span><span id="TimeSeries-20"><a href="#TimeSeries-20"><span class="linenos"> 20</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TimeSeries-21"><a href="#TimeSeries-21"><span class="linenos"> 21</span></a>
</span><span id="TimeSeries-22"><a href="#TimeSeries-22"><span class="linenos"> 22</span></a>    <span class="c1"># ------------------------</span>
</span><span id="TimeSeries-23"><a href="#TimeSeries-23"><span class="linenos"> 23</span></a>    <span class="c1"># Frequencies / Timedelta</span>
</span><span id="TimeSeries-24"><a href="#TimeSeries-24"><span class="linenos"> 24</span></a>    <span class="c1"># ------------------------</span>
</span><span id="TimeSeries-25"><a href="#TimeSeries-25"><span class="linenos"> 25</span></a>
</span><span id="TimeSeries-26"><a href="#TimeSeries-26"><span class="linenos"> 26</span></a>    <span class="c1"># mapping of common frequencies codes to approximate number of days</span>
</span><span id="TimeSeries-27"><a href="#TimeSeries-27"><span class="linenos"> 27</span></a>    <span class="c1"># checkout https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#dateoffset-objects</span>
</span><span id="TimeSeries-28"><a href="#TimeSeries-28"><span class="linenos"> 28</span></a>    <span class="c1"># to get more information</span>
</span><span id="TimeSeries-29"><a href="#TimeSeries-29"><span class="linenos"> 29</span></a>    <span class="n">FREQ_UNIT_TO_DAYS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TimeSeries-30"><a href="#TimeSeries-30"><span class="linenos"> 30</span></a>        <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>  <span class="c1"># millisecond</span>
</span><span id="TimeSeries-31"><a href="#TimeSeries-31"><span class="linenos"> 31</span></a>        <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">),</span>  <span class="c1"># second</span>
</span><span id="TimeSeries-32"><a href="#TimeSeries-32"><span class="linenos"> 32</span></a>        <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">),</span>  <span class="c1"># second</span>
</span><span id="TimeSeries-33"><a href="#TimeSeries-33"><span class="linenos"> 33</span></a>        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1440</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="TimeSeries-34"><a href="#TimeSeries-34"><span class="linenos"> 34</span></a>        <span class="s2">&quot;MIN&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1440</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="TimeSeries-35"><a href="#TimeSeries-35"><span class="linenos"> 35</span></a>        <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1440</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="TimeSeries-36"><a href="#TimeSeries-36"><span class="linenos"> 36</span></a>        <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>  <span class="c1"># hour</span>
</span><span id="TimeSeries-37"><a href="#TimeSeries-37"><span class="linenos"> 37</span></a>        <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>  <span class="c1"># hour</span>
</span><span id="TimeSeries-38"><a href="#TimeSeries-38"><span class="linenos"> 38</span></a>        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># day</span>
</span><span id="TimeSeries-39"><a href="#TimeSeries-39"><span class="linenos"> 39</span></a>        <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># day</span>
</span><span id="TimeSeries-40"><a href="#TimeSeries-40"><span class="linenos"> 40</span></a>        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># business day</span>
</span><span id="TimeSeries-41"><a href="#TimeSeries-41"><span class="linenos"> 41</span></a>        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># business day</span>
</span><span id="TimeSeries-42"><a href="#TimeSeries-42"><span class="linenos"> 42</span></a>        <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># week</span>
</span><span id="TimeSeries-43"><a href="#TimeSeries-43"><span class="linenos"> 43</span></a>        <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># week</span>
</span><span id="TimeSeries-44"><a href="#TimeSeries-44"><span class="linenos"> 44</span></a>        <span class="s2">&quot;W-SUN&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># week</span>
</span><span id="TimeSeries-45"><a href="#TimeSeries-45"><span class="linenos"> 45</span></a>        <span class="s2">&quot;W-MON&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># week</span>
</span><span id="TimeSeries-46"><a href="#TimeSeries-46"><span class="linenos"> 46</span></a>        <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mf">30.4</span><span class="p">,</span>  <span class="c1"># average number of days in a month</span>
</span><span id="TimeSeries-47"><a href="#TimeSeries-47"><span class="linenos"> 47</span></a>        <span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="mf">30.4</span><span class="p">,</span>  <span class="c1"># average number of days in a month</span>
</span><span id="TimeSeries-48"><a href="#TimeSeries-48"><span class="linenos"> 48</span></a>        <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span>  <span class="c1"># quarter (approximation)</span>
</span><span id="TimeSeries-49"><a href="#TimeSeries-49"><span class="linenos"> 49</span></a>        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span>  <span class="c1"># assuming 365 days in a year (approximation)</span>
</span><span id="TimeSeries-50"><a href="#TimeSeries-50"><span class="linenos"> 50</span></a>        <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span>  <span class="c1"># assuming 365 days in a year (approximation)</span>
</span><span id="TimeSeries-51"><a href="#TimeSeries-51"><span class="linenos"> 51</span></a>    <span class="p">}</span>
</span><span id="TimeSeries-52"><a href="#TimeSeries-52"><span class="linenos"> 52</span></a>
</span><span id="TimeSeries-53"><a href="#TimeSeries-53"><span class="linenos"> 53</span></a>    <span class="c1"># mapping of common frequencies codes to approximate number of seconds</span>
</span><span id="TimeSeries-54"><a href="#TimeSeries-54"><span class="linenos"> 54</span></a>    <span class="n">FREQ_UNIT_TO_SECONDS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TimeSeries-55"><a href="#TimeSeries-55"><span class="linenos"> 55</span></a>        <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>  <span class="c1"># millisecond</span>
</span><span id="TimeSeries-56"><a href="#TimeSeries-56"><span class="linenos"> 56</span></a>        <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># second</span>
</span><span id="TimeSeries-57"><a href="#TimeSeries-57"><span class="linenos"> 57</span></a>        <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># second</span>
</span><span id="TimeSeries-58"><a href="#TimeSeries-58"><span class="linenos"> 58</span></a>        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="TimeSeries-59"><a href="#TimeSeries-59"><span class="linenos"> 59</span></a>        <span class="s2">&quot;MIN&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="TimeSeries-60"><a href="#TimeSeries-60"><span class="linenos"> 60</span></a>        <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># minute</span>
</span><span id="TimeSeries-61"><a href="#TimeSeries-61"><span class="linenos"> 61</span></a>        <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># hour</span>
</span><span id="TimeSeries-62"><a href="#TimeSeries-62"><span class="linenos"> 62</span></a>        <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># hour</span>
</span><span id="TimeSeries-63"><a href="#TimeSeries-63"><span class="linenos"> 63</span></a>        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>  <span class="c1"># number of seconds in a day (out of DST)</span>
</span><span id="TimeSeries-64"><a href="#TimeSeries-64"><span class="linenos"> 64</span></a>        <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>  <span class="c1"># day (out of DST)</span>
</span><span id="TimeSeries-65"><a href="#TimeSeries-65"><span class="linenos"> 65</span></a>        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>  <span class="c1"># business day (out of DST)</span>
</span><span id="TimeSeries-66"><a href="#TimeSeries-66"><span class="linenos"> 66</span></a>        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>  <span class="c1"># business day (out of DST)</span>
</span><span id="TimeSeries-67"><a href="#TimeSeries-67"><span class="linenos"> 67</span></a>        <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>  <span class="c1"># week (out of DST)</span>
</span><span id="TimeSeries-68"><a href="#TimeSeries-68"><span class="linenos"> 68</span></a>        <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>  <span class="c1"># week (out of DST)</span>
</span><span id="TimeSeries-69"><a href="#TimeSeries-69"><span class="linenos"> 69</span></a>        <span class="s2">&quot;W-SUN&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>  <span class="c1"># week (out of DST)</span>
</span><span id="TimeSeries-70"><a href="#TimeSeries-70"><span class="linenos"> 70</span></a>        <span class="s2">&quot;W-MON&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>  <span class="c1"># week (out of DST)</span>
</span><span id="TimeSeries-71"><a href="#TimeSeries-71"><span class="linenos"> 71</span></a>        <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mi">2626560</span><span class="p">,</span>  <span class="c1"># average number of seconds in a month</span>
</span><span id="TimeSeries-72"><a href="#TimeSeries-72"><span class="linenos"> 72</span></a>        <span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="mi">2626560</span><span class="p">,</span>  <span class="c1"># average number of seconds in a month</span>
</span><span id="TimeSeries-73"><a href="#TimeSeries-73"><span class="linenos"> 73</span></a>        <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="mi">7862400</span><span class="p">,</span>  <span class="c1"># quarter (approximation)</span>
</span><span id="TimeSeries-74"><a href="#TimeSeries-74"><span class="linenos"> 74</span></a>        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mi">31536000</span><span class="p">,</span>  <span class="c1"># assuming 365 days in a year (approximation)</span>
</span><span id="TimeSeries-75"><a href="#TimeSeries-75"><span class="linenos"> 75</span></a>        <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mi">31536000</span><span class="p">,</span>  <span class="c1"># assuming 365 days in a year (approximation)</span>
</span><span id="TimeSeries-76"><a href="#TimeSeries-76"><span class="linenos"> 76</span></a>    <span class="p">}</span>
</span><span id="TimeSeries-77"><a href="#TimeSeries-77"><span class="linenos"> 77</span></a>
</span><span id="TimeSeries-78"><a href="#TimeSeries-78"><span class="linenos"> 78</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-79"><a href="#TimeSeries-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="TimeSeries-80"><a href="#TimeSeries-80"><span class="linenos"> 80</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="TimeSeries-81"><a href="#TimeSeries-81"><span class="linenos"> 81</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="TimeSeries-82"><a href="#TimeSeries-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-83"><a href="#TimeSeries-83"><span class="linenos"> 83</span></a><span class="sd">        Given a frequency as a string, such as &#39;1D&#39;, &#39;10min&#39;, &#39;-3MS&#39;</span>
</span><span id="TimeSeries-84"><a href="#TimeSeries-84"><span class="linenos"> 84</span></a><span class="sd">        extract the amount (e.g. 1, 10, -3) and the unit part (e.g. &#39;D&#39;, &#39;min&#39;, &#39;MS&#39;), capitalized.</span>
</span><span id="TimeSeries-85"><a href="#TimeSeries-85"><span class="linenos"> 85</span></a><span class="sd">        :param freq: the frequency</span>
</span><span id="TimeSeries-86"><a href="#TimeSeries-86"><span class="linenos"> 86</span></a><span class="sd">        :return: the unit part of that frequency, and the number of units</span>
</span><span id="TimeSeries-87"><a href="#TimeSeries-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-88"><a href="#TimeSeries-88"><span class="linenos"> 88</span></a>
</span><span id="TimeSeries-89"><a href="#TimeSeries-89"><span class="linenos"> 89</span></a>        <span class="c1"># if freq is a pd.Timedelta, it should be convertible to a string</span>
</span><span id="TimeSeries-90"><a href="#TimeSeries-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="TimeSeries-91"><a href="#TimeSeries-91"><span class="linenos"> 91</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="TimeSeries-92"><a href="#TimeSeries-92"><span class="linenos"> 92</span></a>
</span><span id="TimeSeries-93"><a href="#TimeSeries-93"><span class="linenos"> 93</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="TimeSeries-94"><a href="#TimeSeries-94"><span class="linenos"> 94</span></a>        <span class="n">freq_string_parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+|\D+)&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>
</span><span id="TimeSeries-95"><a href="#TimeSeries-95"><span class="linenos"> 95</span></a>
</span><span id="TimeSeries-96"><a href="#TimeSeries-96"><span class="linenos"> 96</span></a>        <span class="c1"># several cases are possible to take into account the +/- sign</span>
</span><span id="TimeSeries-97"><a href="#TimeSeries-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="TimeSeries-98"><a href="#TimeSeries-98"><span class="linenos"> 98</span></a>            <span class="c1"># in that case, first character must be a + or - sign, eg. &#39;-1D&#39;</span>
</span><span id="TimeSeries-99"><a href="#TimeSeries-99"><span class="linenos"> 99</span></a>            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="TimeSeries-100"><a href="#TimeSeries-100"><span class="linenos">100</span></a>            <span class="k">if</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
</span><span id="TimeSeries-101"><a href="#TimeSeries-101"><span class="linenos">101</span></a>                <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="TimeSeries-102"><a href="#TimeSeries-102"><span class="linenos">102</span></a>            <span class="k">elif</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
</span><span id="TimeSeries-103"><a href="#TimeSeries-103"><span class="linenos">103</span></a>                <span class="k">pass</span>
</span><span id="TimeSeries-104"><a href="#TimeSeries-104"><span class="linenos">104</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries-105"><a href="#TimeSeries-105"><span class="linenos">105</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First character is not a plus or minus sign&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-106"><a href="#TimeSeries-106"><span class="linenos">106</span></a>
</span><span id="TimeSeries-107"><a href="#TimeSeries-107"><span class="linenos">107</span></a>            <span class="c1"># numeric part - error if type is wrong</span>
</span><span id="TimeSeries-108"><a href="#TimeSeries-108"><span class="linenos">108</span></a>            <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TimeSeries-109"><a href="#TimeSeries-109"><span class="linenos">109</span></a>
</span><span id="TimeSeries-110"><a href="#TimeSeries-110"><span class="linenos">110</span></a>            <span class="c1"># freq part  - error if type is wrong</span>
</span><span id="TimeSeries-111"><a href="#TimeSeries-111"><span class="linenos">111</span></a>            <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TimeSeries-112"><a href="#TimeSeries-112"><span class="linenos">112</span></a>
</span><span id="TimeSeries-113"><a href="#TimeSeries-113"><span class="linenos">113</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="TimeSeries-114"><a href="#TimeSeries-114"><span class="linenos">114</span></a>            <span class="c1"># in that case, first group must be a number, second group must be a unit e.g. &#39;2MS&#39;</span>
</span><span id="TimeSeries-115"><a href="#TimeSeries-115"><span class="linenos">115</span></a>            <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="TimeSeries-116"><a href="#TimeSeries-116"><span class="linenos">116</span></a>            <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TimeSeries-117"><a href="#TimeSeries-117"><span class="linenos">117</span></a>
</span><span id="TimeSeries-118"><a href="#TimeSeries-118"><span class="linenos">118</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TimeSeries-119"><a href="#TimeSeries-119"><span class="linenos">119</span></a>            <span class="c1"># in that case, there is no number but first character might be a sign. e.g.  or &#39;MS&#39; or &#39;-D&#39;</span>
</span><span id="TimeSeries-120"><a href="#TimeSeries-120"><span class="linenos">120</span></a>            <span class="k">if</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
</span><span id="TimeSeries-121"><a href="#TimeSeries-121"><span class="linenos">121</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="TimeSeries-122"><a href="#TimeSeries-122"><span class="linenos">122</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="TimeSeries-123"><a href="#TimeSeries-123"><span class="linenos">123</span></a>            <span class="k">elif</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
</span><span id="TimeSeries-124"><a href="#TimeSeries-124"><span class="linenos">124</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="TimeSeries-125"><a href="#TimeSeries-125"><span class="linenos">125</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="TimeSeries-126"><a href="#TimeSeries-126"><span class="linenos">126</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries-127"><a href="#TimeSeries-127"><span class="linenos">127</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="TimeSeries-128"><a href="#TimeSeries-128"><span class="linenos">128</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeSeries-129"><a href="#TimeSeries-129"><span class="linenos">129</span></a>
</span><span id="TimeSeries-130"><a href="#TimeSeries-130"><span class="linenos">130</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries-131"><a href="#TimeSeries-131"><span class="linenos">131</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;freq </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> is not valid&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-132"><a href="#TimeSeries-132"><span class="linenos">132</span></a>
</span><span id="TimeSeries-133"><a href="#TimeSeries-133"><span class="linenos">133</span></a>        <span class="c1"># simple check</span>
</span><span id="TimeSeries-134"><a href="#TimeSeries-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="n">freq_unit_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_SECONDS</span><span class="p">:</span>
</span><span id="TimeSeries-135"><a href="#TimeSeries-135"><span class="linenos">135</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries-136"><a href="#TimeSeries-136"><span class="linenos">136</span></a>                <span class="sa">f</span><span class="s2">&quot;Unknown frequency unit </span><span class="si">{</span><span class="n">freq_unit_str</span><span class="si">}</span><span class="s2"> obtained from frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TimeSeries-137"><a href="#TimeSeries-137"><span class="linenos">137</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-138"><a href="#TimeSeries-138"><span class="linenos">138</span></a>
</span><span id="TimeSeries-139"><a href="#TimeSeries-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span>
</span><span id="TimeSeries-140"><a href="#TimeSeries-140"><span class="linenos">140</span></a>
</span><span id="TimeSeries-141"><a href="#TimeSeries-141"><span class="linenos">141</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-142"><a href="#TimeSeries-142"><span class="linenos">142</span></a>    <span class="k">def</span> <span class="nf">is_regular_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TimeSeries-143"><a href="#TimeSeries-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-144"><a href="#TimeSeries-144"><span class="linenos">144</span></a><span class="sd">        Return a boolean that indicates the frequency is something regular or not</span>
</span><span id="TimeSeries-145"><a href="#TimeSeries-145"><span class="linenos">145</span></a><span class="sd">        eg &#39;D&#39; &#39;min&#39; are regular, &#39;MS&#39;, &#39;Y&#39;, &#39;Q&#39; are not.</span>
</span><span id="TimeSeries-146"><a href="#TimeSeries-146"><span class="linenos">146</span></a><span class="sd">        For instance, irregular frequencies cannot be turned to pd.Timedelta elements.</span>
</span><span id="TimeSeries-147"><a href="#TimeSeries-147"><span class="linenos">147</span></a><span class="sd">        Note that if the frequency is a pd.Timedelta, it is always regular</span>
</span><span id="TimeSeries-148"><a href="#TimeSeries-148"><span class="linenos">148</span></a><span class="sd">        :param freq: the frequency given as a string or a pd.Timedelta</span>
</span><span id="TimeSeries-149"><a href="#TimeSeries-149"><span class="linenos">149</span></a><span class="sd">        :return: a boolean that indicates whether the considered frequency is &#39;even&#39;</span>
</span><span id="TimeSeries-150"><a href="#TimeSeries-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-151"><a href="#TimeSeries-151"><span class="linenos">151</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="TimeSeries-152"><a href="#TimeSeries-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">freq_unit_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-153"><a href="#TimeSeries-153"><span class="linenos">153</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TimeSeries-154"><a href="#TimeSeries-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TimeSeries-155"><a href="#TimeSeries-155"><span class="linenos">155</span></a>
</span><span id="TimeSeries-156"><a href="#TimeSeries-156"><span class="linenos">156</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-157"><a href="#TimeSeries-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TimeSeries-158"><a href="#TimeSeries-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-159"><a href="#TimeSeries-159"><span class="linenos">159</span></a><span class="sd">        Map pandas freq string to an approximate length of days.</span>
</span><span id="TimeSeries-160"><a href="#TimeSeries-160"><span class="linenos">160</span></a><span class="sd">        This serves to compare freq strings, such as &#39;1D&#39;, &#39;3MS&#39;, and so on.</span>
</span><span id="TimeSeries-161"><a href="#TimeSeries-161"><span class="linenos">161</span></a><span class="sd">        It replaces the calls to total_seconds() possibly used only with pd.Timedelta().</span>
</span><span id="TimeSeries-162"><a href="#TimeSeries-162"><span class="linenos">162</span></a><span class="sd">        Note that the computation is exact if a pd.Timedelta is given.</span>
</span><span id="TimeSeries-163"><a href="#TimeSeries-163"><span class="linenos">163</span></a><span class="sd">        :param freq: the frequency as a string, such as &#39;10min&#39;, &#39;3MS&#39;, or a pd.Timedelta.</span>
</span><span id="TimeSeries-164"><a href="#TimeSeries-164"><span class="linenos">164</span></a><span class="sd">        :return: a sometimes approximate length of the provided frequency in days</span>
</span><span id="TimeSeries-165"><a href="#TimeSeries-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-166"><a href="#TimeSeries-166"><span class="linenos">166</span></a>
</span><span id="TimeSeries-167"><a href="#TimeSeries-167"><span class="linenos">167</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="TimeSeries-168"><a href="#TimeSeries-168"><span class="linenos">168</span></a>        <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="TimeSeries-169"><a href="#TimeSeries-169"><span class="linenos">169</span></a>            <span class="n">freq</span>
</span><span id="TimeSeries-170"><a href="#TimeSeries-170"><span class="linenos">170</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-171"><a href="#TimeSeries-171"><span class="linenos">171</span></a>
</span><span id="TimeSeries-172"><a href="#TimeSeries-172"><span class="linenos">172</span></a>        <span class="c1"># error if is not in FREQ_UNIT_TO_DAYS</span>
</span><span id="TimeSeries-173"><a href="#TimeSeries-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_DAYS</span><span class="p">[</span><span class="n">freq_unit_str</span><span class="p">]</span>
</span><span id="TimeSeries-174"><a href="#TimeSeries-174"><span class="linenos">174</span></a>
</span><span id="TimeSeries-175"><a href="#TimeSeries-175"><span class="linenos">175</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-176"><a href="#TimeSeries-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">freq_as_approximate_nb_seconds</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TimeSeries-177"><a href="#TimeSeries-177"><span class="linenos">177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-178"><a href="#TimeSeries-178"><span class="linenos">178</span></a><span class="sd">        Map pandas freq string to an approximate number of seconds.</span>
</span><span id="TimeSeries-179"><a href="#TimeSeries-179"><span class="linenos">179</span></a><span class="sd">        This serves to compare freq strings, such as &#39;1D&#39;, &#39;3MS&#39;, and so on.</span>
</span><span id="TimeSeries-180"><a href="#TimeSeries-180"><span class="linenos">180</span></a><span class="sd">        It replaces the calls to total_seconds() possibly used only with pd.Timedelta().</span>
</span><span id="TimeSeries-181"><a href="#TimeSeries-181"><span class="linenos">181</span></a><span class="sd">        Note that the computation is exact if a pd.Timedelta is given.</span>
</span><span id="TimeSeries-182"><a href="#TimeSeries-182"><span class="linenos">182</span></a><span class="sd">        :param freq: the frequency as a string, such as &#39;10min&#39;, &#39;3MS&#39;, or a pd.Timedelta.</span>
</span><span id="TimeSeries-183"><a href="#TimeSeries-183"><span class="linenos">183</span></a><span class="sd">        :return: a sometimes approximate length of the provided frequency in days</span>
</span><span id="TimeSeries-184"><a href="#TimeSeries-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-185"><a href="#TimeSeries-185"><span class="linenos">185</span></a>
</span><span id="TimeSeries-186"><a href="#TimeSeries-186"><span class="linenos">186</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="TimeSeries-187"><a href="#TimeSeries-187"><span class="linenos">187</span></a>        <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="TimeSeries-188"><a href="#TimeSeries-188"><span class="linenos">188</span></a>            <span class="n">freq</span>
</span><span id="TimeSeries-189"><a href="#TimeSeries-189"><span class="linenos">189</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-190"><a href="#TimeSeries-190"><span class="linenos">190</span></a>
</span><span id="TimeSeries-191"><a href="#TimeSeries-191"><span class="linenos">191</span></a>        <span class="c1"># error if is not in FREQ_UNIT_TO_SECONDS</span>
</span><span id="TimeSeries-192"><a href="#TimeSeries-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_SECONDS</span><span class="p">[</span><span class="n">freq_unit_str</span><span class="p">]</span>
</span><span id="TimeSeries-193"><a href="#TimeSeries-193"><span class="linenos">193</span></a>
</span><span id="TimeSeries-194"><a href="#TimeSeries-194"><span class="linenos">194</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-195"><a href="#TimeSeries-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">add_timedelta</span><span class="p">(</span>
</span><span id="TimeSeries-196"><a href="#TimeSeries-196"><span class="linenos">196</span></a>        <span class="n">date</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">],</span>
</span><span id="TimeSeries-197"><a href="#TimeSeries-197"><span class="linenos">197</span></a>        <span class="n">timedelta</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries-198"><a href="#TimeSeries-198"><span class="linenos">198</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]:</span>
</span><span id="TimeSeries-199"><a href="#TimeSeries-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-200"><a href="#TimeSeries-200"><span class="linenos">200</span></a><span class="sd">        Define how to add a timedelta according to the way it&#39;s provided (string, timedelta), regular or irregular</span>
</span><span id="TimeSeries-201"><a href="#TimeSeries-201"><span class="linenos">201</span></a><span class="sd">        absolute length.</span>
</span><span id="TimeSeries-202"><a href="#TimeSeries-202"><span class="linenos">202</span></a><span class="sd">        :param date: a date, provided as a pd.Timestamp (naive or tz-aware), a date, a datetime</span>
</span><span id="TimeSeries-203"><a href="#TimeSeries-203"><span class="linenos">203</span></a><span class="sd">        :param timedelta:  a timedelta, given as a freq string (e.g. &#39;2MS&#39;) or a pd.Timedelta object.</span>
</span><span id="TimeSeries-204"><a href="#TimeSeries-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-205"><a href="#TimeSeries-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="TimeSeries-206"><a href="#TimeSeries-206"><span class="linenos">206</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;timedelta must be of type Timedelta or string &quot;</span><span class="p">)</span>
</span><span id="TimeSeries-207"><a href="#TimeSeries-207"><span class="linenos">207</span></a>
</span><span id="TimeSeries-208"><a href="#TimeSeries-208"><span class="linenos">208</span></a>        <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">timedelta</span>
</span><span id="TimeSeries-209"><a href="#TimeSeries-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="TimeSeries-210"><a href="#TimeSeries-210"><span class="linenos">210</span></a>            <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="TimeSeries-211"><a href="#TimeSeries-211"><span class="linenos">211</span></a>
</span><span id="TimeSeries-212"><a href="#TimeSeries-212"><span class="linenos">212</span></a>        <span class="c1"># if it&#39;s a string, it is not necessarily convertible to timedelta, as</span>
</span><span id="TimeSeries-213"><a href="#TimeSeries-213"><span class="linenos">213</span></a>        <span class="c1"># it might be an irregular length (month, year, quarter...)</span>
</span><span id="TimeSeries-214"><a href="#TimeSeries-214"><span class="linenos">214</span></a>        <span class="c1"># in that case, we handle these cases before defaulting to pd.to_timedelta()</span>
</span><span id="TimeSeries-215"><a href="#TimeSeries-215"><span class="linenos">215</span></a>        <span class="p">(</span>
</span><span id="TimeSeries-216"><a href="#TimeSeries-216"><span class="linenos">216</span></a>            <span class="n">numeric_part_int</span><span class="p">,</span>
</span><span id="TimeSeries-217"><a href="#TimeSeries-217"><span class="linenos">217</span></a>            <span class="n">unit_freq_str</span><span class="p">,</span>
</span><span id="TimeSeries-218"><a href="#TimeSeries-218"><span class="linenos">218</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">timedelta_str</span><span class="p">)</span>
</span><span id="TimeSeries-219"><a href="#TimeSeries-219"><span class="linenos">219</span></a>
</span><span id="TimeSeries-220"><a href="#TimeSeries-220"><span class="linenos">220</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-221"><a href="#TimeSeries-221"><span class="linenos">221</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries-222"><a href="#TimeSeries-222"><span class="linenos">222</span></a>                    <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries-223"><a href="#TimeSeries-223"><span class="linenos">223</span></a>                <span class="p">)</span>
</span><span id="TimeSeries-224"><a href="#TimeSeries-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]:</span>
</span><span id="TimeSeries-225"><a href="#TimeSeries-225"><span class="linenos">225</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries-226"><a href="#TimeSeries-226"><span class="linenos">226</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries-227"><a href="#TimeSeries-227"><span class="linenos">227</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-228"><a href="#TimeSeries-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-229"><a href="#TimeSeries-229"><span class="linenos">229</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries-230"><a href="#TimeSeries-230"><span class="linenos">230</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries-231"><a href="#TimeSeries-231"><span class="linenos">231</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-232"><a href="#TimeSeries-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-233"><a href="#TimeSeries-233"><span class="linenos">233</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries-234"><a href="#TimeSeries-234"><span class="linenos">234</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries-235"><a href="#TimeSeries-235"><span class="linenos">235</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-236"><a href="#TimeSeries-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-237"><a href="#TimeSeries-237"><span class="linenos">237</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries-238"><a href="#TimeSeries-238"><span class="linenos">238</span></a>                <span class="s2">&quot;Cannot simply add a quarter, it does not mean anything in general&quot;</span>
</span><span id="TimeSeries-239"><a href="#TimeSeries-239"><span class="linenos">239</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-240"><a href="#TimeSeries-240"><span class="linenos">240</span></a>
</span><span id="TimeSeries-241"><a href="#TimeSeries-241"><span class="linenos">241</span></a>        <span class="c1"># there, it should be convertible to pd.Timedelta with no ambiguous interpretation</span>
</span><span id="TimeSeries-242"><a href="#TimeSeries-242"><span class="linenos">242</span></a>        <span class="c1"># because we&#39;re under the day scale (no DST issue)</span>
</span><span id="TimeSeries-243"><a href="#TimeSeries-243"><span class="linenos">243</span></a>        <span class="n">timedelta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numeric_part_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit_freq_str</span>
</span><span id="TimeSeries-244"><a href="#TimeSeries-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span>
</span><span id="TimeSeries-245"><a href="#TimeSeries-245"><span class="linenos">245</span></a>
</span><span id="TimeSeries-246"><a href="#TimeSeries-246"><span class="linenos">246</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-247"><a href="#TimeSeries-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">subtract_timedelta</span><span class="p">(</span>
</span><span id="TimeSeries-248"><a href="#TimeSeries-248"><span class="linenos">248</span></a>        <span class="n">date</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">],</span>
</span><span id="TimeSeries-249"><a href="#TimeSeries-249"><span class="linenos">249</span></a>        <span class="n">timedelta</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries-250"><a href="#TimeSeries-250"><span class="linenos">250</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]:</span>
</span><span id="TimeSeries-251"><a href="#TimeSeries-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-252"><a href="#TimeSeries-252"><span class="linenos">252</span></a><span class="sd">        Define how to subtract a timedelta according to the way it&#39;s provided (string, timedelta), regular or irregular</span>
</span><span id="TimeSeries-253"><a href="#TimeSeries-253"><span class="linenos">253</span></a><span class="sd">        absolute length.</span>
</span><span id="TimeSeries-254"><a href="#TimeSeries-254"><span class="linenos">254</span></a><span class="sd">        :param date: a date, provided as a pd.Timestamp (naive or tz-aware), a date, a datetime</span>
</span><span id="TimeSeries-255"><a href="#TimeSeries-255"><span class="linenos">255</span></a><span class="sd">        :param timedelta: a timedelta, given as a freq string (e.g. &#39;2MS&#39;) or a pd.Timedelta object.</span>
</span><span id="TimeSeries-256"><a href="#TimeSeries-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-257"><a href="#TimeSeries-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="TimeSeries-258"><a href="#TimeSeries-258"><span class="linenos">258</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;timedelta must be of type Timedelta or string &quot;</span><span class="p">)</span>
</span><span id="TimeSeries-259"><a href="#TimeSeries-259"><span class="linenos">259</span></a>
</span><span id="TimeSeries-260"><a href="#TimeSeries-260"><span class="linenos">260</span></a>        <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">timedelta</span>
</span><span id="TimeSeries-261"><a href="#TimeSeries-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="TimeSeries-262"><a href="#TimeSeries-262"><span class="linenos">262</span></a>            <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="TimeSeries-263"><a href="#TimeSeries-263"><span class="linenos">263</span></a>
</span><span id="TimeSeries-264"><a href="#TimeSeries-264"><span class="linenos">264</span></a>        <span class="c1"># if it&#39;s a string, it is not necessarily convertible to timedelta, as</span>
</span><span id="TimeSeries-265"><a href="#TimeSeries-265"><span class="linenos">265</span></a>        <span class="c1"># it might be an irregular length (month, year, quarter...)</span>
</span><span id="TimeSeries-266"><a href="#TimeSeries-266"><span class="linenos">266</span></a>        <span class="c1"># in that case, we handle these cases before defaulting to pd.to_timedelta()</span>
</span><span id="TimeSeries-267"><a href="#TimeSeries-267"><span class="linenos">267</span></a>        <span class="p">(</span>
</span><span id="TimeSeries-268"><a href="#TimeSeries-268"><span class="linenos">268</span></a>            <span class="n">numeric_part_int</span><span class="p">,</span>
</span><span id="TimeSeries-269"><a href="#TimeSeries-269"><span class="linenos">269</span></a>            <span class="n">unit_freq_str</span><span class="p">,</span>
</span><span id="TimeSeries-270"><a href="#TimeSeries-270"><span class="linenos">270</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">timedelta_str</span><span class="p">)</span>
</span><span id="TimeSeries-271"><a href="#TimeSeries-271"><span class="linenos">271</span></a>
</span><span id="TimeSeries-272"><a href="#TimeSeries-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-273"><a href="#TimeSeries-273"><span class="linenos">273</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries-274"><a href="#TimeSeries-274"><span class="linenos">274</span></a>                    <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries-275"><a href="#TimeSeries-275"><span class="linenos">275</span></a>                <span class="p">)</span>
</span><span id="TimeSeries-276"><a href="#TimeSeries-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]:</span>
</span><span id="TimeSeries-277"><a href="#TimeSeries-277"><span class="linenos">277</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries-278"><a href="#TimeSeries-278"><span class="linenos">278</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries-279"><a href="#TimeSeries-279"><span class="linenos">279</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-280"><a href="#TimeSeries-280"><span class="linenos">280</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-281"><a href="#TimeSeries-281"><span class="linenos">281</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries-282"><a href="#TimeSeries-282"><span class="linenos">282</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries-283"><a href="#TimeSeries-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-284"><a href="#TimeSeries-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-285"><a href="#TimeSeries-285"><span class="linenos">285</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries-286"><a href="#TimeSeries-286"><span class="linenos">286</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries-287"><a href="#TimeSeries-287"><span class="linenos">287</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-288"><a href="#TimeSeries-288"><span class="linenos">288</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries-289"><a href="#TimeSeries-289"><span class="linenos">289</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries-290"><a href="#TimeSeries-290"><span class="linenos">290</span></a>                <span class="s2">&quot;Cannot simply subtract a quarter, it does not mean anything in general&quot;</span>
</span><span id="TimeSeries-291"><a href="#TimeSeries-291"><span class="linenos">291</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-292"><a href="#TimeSeries-292"><span class="linenos">292</span></a>
</span><span id="TimeSeries-293"><a href="#TimeSeries-293"><span class="linenos">293</span></a>        <span class="c1"># there, it should be convertible to pd.Timedelta with no ambiguous interpretation</span>
</span><span id="TimeSeries-294"><a href="#TimeSeries-294"><span class="linenos">294</span></a>        <span class="c1"># because we&#39;re under the day scale (no DST issue)</span>
</span><span id="TimeSeries-295"><a href="#TimeSeries-295"><span class="linenos">295</span></a>        <span class="n">timedelta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numeric_part_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit_freq_str</span>
</span><span id="TimeSeries-296"><a href="#TimeSeries-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="n">date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span>
</span><span id="TimeSeries-297"><a href="#TimeSeries-297"><span class="linenos">297</span></a>
</span><span id="TimeSeries-298"><a href="#TimeSeries-298"><span class="linenos">298</span></a>    <span class="c1"># ------------</span>
</span><span id="TimeSeries-299"><a href="#TimeSeries-299"><span class="linenos">299</span></a>    <span class="c1"># Time-series</span>
</span><span id="TimeSeries-300"><a href="#TimeSeries-300"><span class="linenos">300</span></a>    <span class="c1"># ------------</span>
</span><span id="TimeSeries-301"><a href="#TimeSeries-301"><span class="linenos">301</span></a>
</span><span id="TimeSeries-302"><a href="#TimeSeries-302"><span class="linenos">302</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-303"><a href="#TimeSeries-303"><span class="linenos">303</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-304"><a href="#TimeSeries-304"><span class="linenos">304</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-305"><a href="#TimeSeries-305"><span class="linenos">305</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-306"><a href="#TimeSeries-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TimeSeries-307"><a href="#TimeSeries-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-308"><a href="#TimeSeries-308"><span class="linenos">308</span></a><span class="sd">        Check whether a datetime index has NaN or is empty</span>
</span><span id="TimeSeries-309"><a href="#TimeSeries-309"><span class="linenos">309</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries-310"><a href="#TimeSeries-310"><span class="linenos">310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-311"><a href="#TimeSeries-311"><span class="linenos">311</span></a>
</span><span id="TimeSeries-312"><a href="#TimeSeries-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="TimeSeries-313"><a href="#TimeSeries-313"><span class="linenos">313</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;parameter &#39;dti&#39; should be a pandas.DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-314"><a href="#TimeSeries-314"><span class="linenos">314</span></a>
</span><span id="TimeSeries-315"><a href="#TimeSeries-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries-316"><a href="#TimeSeries-316"><span class="linenos">316</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TimeSeries-317"><a href="#TimeSeries-317"><span class="linenos">317</span></a>
</span><span id="TimeSeries-318"><a href="#TimeSeries-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries-319"><a href="#TimeSeries-319"><span class="linenos">319</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TimeSeries-320"><a href="#TimeSeries-320"><span class="linenos">320</span></a>
</span><span id="TimeSeries-321"><a href="#TimeSeries-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="TimeSeries-322"><a href="#TimeSeries-322"><span class="linenos">322</span></a>
</span><span id="TimeSeries-323"><a href="#TimeSeries-323"><span class="linenos">323</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-324"><a href="#TimeSeries-324"><span class="linenos">324</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-325"><a href="#TimeSeries-325"><span class="linenos">325</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-326"><a href="#TimeSeries-326"><span class="linenos">326</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-327"><a href="#TimeSeries-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">find_nb_records</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TimeSeries-328"><a href="#TimeSeries-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-329"><a href="#TimeSeries-329"><span class="linenos">329</span></a><span class="sd">        Compute the number of records</span>
</span><span id="TimeSeries-330"><a href="#TimeSeries-330"><span class="linenos">330</span></a><span class="sd">         :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries-331"><a href="#TimeSeries-331"><span class="linenos">331</span></a><span class="sd">        :param skip_duplicate_timestamps: bool that indicates if duplicates must be considered</span>
</span><span id="TimeSeries-332"><a href="#TimeSeries-332"><span class="linenos">332</span></a><span class="sd">               or not when computing the number of records</span>
</span><span id="TimeSeries-333"><a href="#TimeSeries-333"><span class="linenos">333</span></a><span class="sd">        :return: the number of records in the time series</span>
</span><span id="TimeSeries-334"><a href="#TimeSeries-334"><span class="linenos">334</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-335"><a href="#TimeSeries-335"><span class="linenos">335</span></a>
</span><span id="TimeSeries-336"><a href="#TimeSeries-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="TimeSeries-337"><a href="#TimeSeries-337"><span class="linenos">337</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="TimeSeries-338"><a href="#TimeSeries-338"><span class="linenos">338</span></a>
</span><span id="TimeSeries-339"><a href="#TimeSeries-339"><span class="linenos">339</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-340"><a href="#TimeSeries-340"><span class="linenos">340</span></a>
</span><span id="TimeSeries-341"><a href="#TimeSeries-341"><span class="linenos">341</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-342"><a href="#TimeSeries-342"><span class="linenos">342</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-343"><a href="#TimeSeries-343"><span class="linenos">343</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-344"><a href="#TimeSeries-344"><span class="linenos">344</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-345"><a href="#TimeSeries-345"><span class="linenos">345</span></a>    <span class="k">def</span> <span class="nf">find_gap_distribution</span><span class="p">(</span>
</span><span id="TimeSeries-346"><a href="#TimeSeries-346"><span class="linenos">346</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-347"><a href="#TimeSeries-347"><span class="linenos">347</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
</span><span id="TimeSeries-348"><a href="#TimeSeries-348"><span class="linenos">348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-349"><a href="#TimeSeries-349"><span class="linenos">349</span></a><span class="sd">        Find frequencies in a pd.DatetimeIndex. The function computes</span>
</span><span id="TimeSeries-350"><a href="#TimeSeries-350"><span class="linenos">350</span></a><span class="sd">        all timedelta between successive indexes, and count them. It returns an ordered</span>
</span><span id="TimeSeries-351"><a href="#TimeSeries-351"><span class="linenos">351</span></a><span class="sd">        pd.Series, with the most commonly found in index 0.</span>
</span><span id="TimeSeries-352"><a href="#TimeSeries-352"><span class="linenos">352</span></a>
</span><span id="TimeSeries-353"><a href="#TimeSeries-353"><span class="linenos">353</span></a>
</span><span id="TimeSeries-354"><a href="#TimeSeries-354"><span class="linenos">354</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries-355"><a href="#TimeSeries-355"><span class="linenos">355</span></a><span class="sd">        :param skip_duplicate_timestamps: bool that indicates if duplicates must be considered</span>
</span><span id="TimeSeries-356"><a href="#TimeSeries-356"><span class="linenos">356</span></a><span class="sd">               or not when the gap distribution is considered.</span>
</span><span id="TimeSeries-357"><a href="#TimeSeries-357"><span class="linenos">357</span></a><span class="sd">        :return: a pd.Series with all frequencies found, and their cardinality.</span>
</span><span id="TimeSeries-358"><a href="#TimeSeries-358"><span class="linenos">358</span></a><span class="sd">                eg. &gt;&gt;&gt; find_frequencies(dti)</span>
</span><span id="TimeSeries-359"><a href="#TimeSeries-359"><span class="linenos">359</span></a><span class="sd">                #    01:00:00    1181</span>
</span><span id="TimeSeries-360"><a href="#TimeSeries-360"><span class="linenos">360</span></a><span class="sd">                #    02:00:00     499</span>
</span><span id="TimeSeries-361"><a href="#TimeSeries-361"><span class="linenos">361</span></a><span class="sd">                #    03:00:00     180</span>
</span><span id="TimeSeries-362"><a href="#TimeSeries-362"><span class="linenos">362</span></a><span class="sd">                #    ....</span>
</span><span id="TimeSeries-363"><a href="#TimeSeries-363"><span class="linenos">363</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-364"><a href="#TimeSeries-364"><span class="linenos">364</span></a>
</span><span id="TimeSeries-365"><a href="#TimeSeries-365"><span class="linenos">365</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="TimeSeries-366"><a href="#TimeSeries-366"><span class="linenos">366</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty dti&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-367"><a href="#TimeSeries-367"><span class="linenos">367</span></a>
</span><span id="TimeSeries-368"><a href="#TimeSeries-368"><span class="linenos">368</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries-369"><a href="#TimeSeries-369"><span class="linenos">369</span></a>
</span><span id="TimeSeries-370"><a href="#TimeSeries-370"><span class="linenos">370</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="TimeSeries-371"><a href="#TimeSeries-371"><span class="linenos">371</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="TimeSeries-372"><a href="#TimeSeries-372"><span class="linenos">372</span></a>
</span><span id="TimeSeries-373"><a href="#TimeSeries-373"><span class="linenos">373</span></a>        <span class="c1"># compute the gap distribution</span>
</span><span id="TimeSeries-374"><a href="#TimeSeries-374"><span class="linenos">374</span></a>        <span class="n">gap_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dti</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</span><span id="TimeSeries-375"><a href="#TimeSeries-375"><span class="linenos">375</span></a>
</span><span id="TimeSeries-376"><a href="#TimeSeries-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="n">gap_dist</span>
</span><span id="TimeSeries-377"><a href="#TimeSeries-377"><span class="linenos">377</span></a>
</span><span id="TimeSeries-378"><a href="#TimeSeries-378"><span class="linenos">378</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-379"><a href="#TimeSeries-379"><span class="linenos">379</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-380"><a href="#TimeSeries-380"><span class="linenos">380</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-381"><a href="#TimeSeries-381"><span class="linenos">381</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-382"><a href="#TimeSeries-382"><span class="linenos">382</span></a>    <span class="k">def</span> <span class="nf">find_most_common_frequency</span><span class="p">(</span>
</span><span id="TimeSeries-383"><a href="#TimeSeries-383"><span class="linenos">383</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-384"><a href="#TimeSeries-384"><span class="linenos">384</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="TimeSeries-385"><a href="#TimeSeries-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-386"><a href="#TimeSeries-386"><span class="linenos">386</span></a><span class="sd">        Find most common frequency in pd.DatetimeIndex. If several frequencies are found, it returns the most common.</span>
</span><span id="TimeSeries-387"><a href="#TimeSeries-387"><span class="linenos">387</span></a><span class="sd">        The function checks the index is not null,</span>
</span><span id="TimeSeries-388"><a href="#TimeSeries-388"><span class="linenos">388</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries-389"><a href="#TimeSeries-389"><span class="linenos">389</span></a><span class="sd">        :param skip_duplicate_timestamps: if True, the function will not consider duplicate timestamps</span>
</span><span id="TimeSeries-390"><a href="#TimeSeries-390"><span class="linenos">390</span></a><span class="sd">                                          in the calculation.</span>
</span><span id="TimeSeries-391"><a href="#TimeSeries-391"><span class="linenos">391</span></a><span class="sd">        :return : the most common frequency found in the datetime index as a string</span>
</span><span id="TimeSeries-392"><a href="#TimeSeries-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-393"><a href="#TimeSeries-393"><span class="linenos">393</span></a>
</span><span id="TimeSeries-394"><a href="#TimeSeries-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="TimeSeries-395"><a href="#TimeSeries-395"><span class="linenos">395</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty datetime index&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-396"><a href="#TimeSeries-396"><span class="linenos">396</span></a>
</span><span id="TimeSeries-397"><a href="#TimeSeries-397"><span class="linenos">397</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries-398"><a href="#TimeSeries-398"><span class="linenos">398</span></a>
</span><span id="TimeSeries-399"><a href="#TimeSeries-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="TimeSeries-400"><a href="#TimeSeries-400"><span class="linenos">400</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="TimeSeries-401"><a href="#TimeSeries-401"><span class="linenos">401</span></a>
</span><span id="TimeSeries-402"><a href="#TimeSeries-402"><span class="linenos">402</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TimeSeries-403"><a href="#TimeSeries-403"><span class="linenos">403</span></a>        <span class="n">nb_records</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-404"><a href="#TimeSeries-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="n">nb_records</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TimeSeries-405"><a href="#TimeSeries-405"><span class="linenos">405</span></a>            <span class="c1"># we cannot get a frequency out of the series, as it&#39;s a single element series !</span>
</span><span id="TimeSeries-406"><a href="#TimeSeries-406"><span class="linenos">406</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="TimeSeries-407"><a href="#TimeSeries-407"><span class="linenos">407</span></a>
</span><span id="TimeSeries-408"><a href="#TimeSeries-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="n">nb_records</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="TimeSeries-409"><a href="#TimeSeries-409"><span class="linenos">409</span></a>            <span class="c1"># try getting single frequency from pandas if the series is big enough</span>
</span><span id="TimeSeries-410"><a href="#TimeSeries-410"><span class="linenos">410</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-411"><a href="#TimeSeries-411"><span class="linenos">411</span></a>
</span><span id="TimeSeries-412"><a href="#TimeSeries-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries-413"><a href="#TimeSeries-413"><span class="linenos">413</span></a>            <span class="c1"># it means there is some kind of irregularity in the datetimeindex, as pandas could not find it or</span>
</span><span id="TimeSeries-414"><a href="#TimeSeries-414"><span class="linenos">414</span></a>            <span class="c1"># e.g. there might be more than one frequency in the dataframe.</span>
</span><span id="TimeSeries-415"><a href="#TimeSeries-415"><span class="linenos">415</span></a>            <span class="c1"># note that there must be at least two records in the datetimeindex at that point</span>
</span><span id="TimeSeries-416"><a href="#TimeSeries-416"><span class="linenos">416</span></a>
</span><span id="TimeSeries-417"><a href="#TimeSeries-417"><span class="linenos">417</span></a>            <span class="c1"># get all gap distributions in the dataframe</span>
</span><span id="TimeSeries-418"><a href="#TimeSeries-418"><span class="linenos">418</span></a>            <span class="n">gap_distribution</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_gap_distribution</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-419"><a href="#TimeSeries-419"><span class="linenos">419</span></a>
</span><span id="TimeSeries-420"><a href="#TimeSeries-420"><span class="linenos">420</span></a>            <span class="c1"># return the more common</span>
</span><span id="TimeSeries-421"><a href="#TimeSeries-421"><span class="linenos">421</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">gap_distribution</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeSeries-422"><a href="#TimeSeries-422"><span class="linenos">422</span></a>
</span><span id="TimeSeries-423"><a href="#TimeSeries-423"><span class="linenos">423</span></a>            <span class="c1"># turn it to a string</span>
</span><span id="TimeSeries-424"><a href="#TimeSeries-424"><span class="linenos">424</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="TimeSeries-425"><a href="#TimeSeries-425"><span class="linenos">425</span></a>
</span><span id="TimeSeries-426"><a href="#TimeSeries-426"><span class="linenos">426</span></a>        <span class="c1"># if the freq is &#39;one&#39; of a particular unit, pandas just returns the unit,</span>
</span><span id="TimeSeries-427"><a href="#TimeSeries-427"><span class="linenos">427</span></a>        <span class="c1"># This is not practical for other functions, so we add 1 to the string freq.</span>
</span><span id="TimeSeries-428"><a href="#TimeSeries-428"><span class="linenos">428</span></a>        <span class="c1"># e.g. the freq is one day, pandas may return &#39;D&#39;</span>
</span><span id="TimeSeries-429"><a href="#TimeSeries-429"><span class="linenos">429</span></a>        <span class="c1"># we transform it to &#39;1D&#39; in that case</span>
</span><span id="TimeSeries-430"><a href="#TimeSeries-430"><span class="linenos">430</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span> <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdecimal</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;1&quot;</span> <span class="o">+</span> <span class="n">freq</span>
</span><span id="TimeSeries-431"><a href="#TimeSeries-431"><span class="linenos">431</span></a>
</span><span id="TimeSeries-432"><a href="#TimeSeries-432"><span class="linenos">432</span></a>        <span class="k">return</span> <span class="n">freq</span>
</span><span id="TimeSeries-433"><a href="#TimeSeries-433"><span class="linenos">433</span></a>
</span><span id="TimeSeries-434"><a href="#TimeSeries-434"><span class="linenos">434</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-435"><a href="#TimeSeries-435"><span class="linenos">435</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-436"><a href="#TimeSeries-436"><span class="linenos">436</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="TimeSeries-437"><a href="#TimeSeries-437"><span class="linenos">437</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-438"><a href="#TimeSeries-438"><span class="linenos">438</span></a>    <span class="k">def</span> <span class="nf">find_duplicates</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="TimeSeries-439"><a href="#TimeSeries-439"><span class="linenos">439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-440"><a href="#TimeSeries-440"><span class="linenos">440</span></a><span class="sd">        Check for duplicates in the timeseries</span>
</span><span id="TimeSeries-441"><a href="#TimeSeries-441"><span class="linenos">441</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries-442"><a href="#TimeSeries-442"><span class="linenos">442</span></a><span class="sd">        :return: duplicates</span>
</span><span id="TimeSeries-443"><a href="#TimeSeries-443"><span class="linenos">443</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-444"><a href="#TimeSeries-444"><span class="linenos">444</span></a>        <span class="k">return</span> <span class="n">dti</span><span class="p">[</span><span class="n">dti</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</span><span id="TimeSeries-445"><a href="#TimeSeries-445"><span class="linenos">445</span></a>
</span><span id="TimeSeries-446"><a href="#TimeSeries-446"><span class="linenos">446</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-447"><a href="#TimeSeries-447"><span class="linenos">447</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-448"><a href="#TimeSeries-448"><span class="linenos">448</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="TimeSeries-449"><a href="#TimeSeries-449"><span class="linenos">449</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-450"><a href="#TimeSeries-450"><span class="linenos">450</span></a>    <span class="k">def</span> <span class="nf">find_extra_points</span><span class="p">(</span>
</span><span id="TimeSeries-451"><a href="#TimeSeries-451"><span class="linenos">451</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TimeSeries-452"><a href="#TimeSeries-452"><span class="linenos">452</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="TimeSeries-453"><a href="#TimeSeries-453"><span class="linenos">453</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-454"><a href="#TimeSeries-454"><span class="linenos">454</span></a><span class="sd">        Check for extra data points in the timeseries, i.e. data points that are</span>
</span><span id="TimeSeries-455"><a href="#TimeSeries-455"><span class="linenos">455</span></a><span class="sd">        outside the expected frequency (or the most common frequency if not known) of data points.</span>
</span><span id="TimeSeries-456"><a href="#TimeSeries-456"><span class="linenos">456</span></a><span class="sd">        This is based on the min and max of the index, which means no extra point might be found</span>
</span><span id="TimeSeries-457"><a href="#TimeSeries-457"><span class="linenos">457</span></a><span class="sd">        if min or max are the extra points (in that case, there might be missing periods!)</span>
</span><span id="TimeSeries-458"><a href="#TimeSeries-458"><span class="linenos">458</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries-459"><a href="#TimeSeries-459"><span class="linenos">459</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="TimeSeries-460"><a href="#TimeSeries-460"><span class="linenos">460</span></a><span class="sd">        :return: extra data points</span>
</span><span id="TimeSeries-461"><a href="#TimeSeries-461"><span class="linenos">461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-462"><a href="#TimeSeries-462"><span class="linenos">462</span></a>
</span><span id="TimeSeries-463"><a href="#TimeSeries-463"><span class="linenos">463</span></a>        <span class="c1"># get freq if None</span>
</span><span id="TimeSeries-464"><a href="#TimeSeries-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_freq</span><span class="p">:</span>
</span><span id="TimeSeries-465"><a href="#TimeSeries-465"><span class="linenos">465</span></a>            <span class="n">expected_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="TimeSeries-466"><a href="#TimeSeries-466"><span class="linenos">466</span></a>                <span class="n">dti</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">True</span>
</span><span id="TimeSeries-467"><a href="#TimeSeries-467"><span class="linenos">467</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-468"><a href="#TimeSeries-468"><span class="linenos">468</span></a>
</span><span id="TimeSeries-469"><a href="#TimeSeries-469"><span class="linenos">469</span></a>        <span class="c1"># inspect extra periods: we must work on a sorted dti without index</span>
</span><span id="TimeSeries-470"><a href="#TimeSeries-470"><span class="linenos">470</span></a>        <span class="n">data_index</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries-471"><a href="#TimeSeries-471"><span class="linenos">471</span></a>        <span class="n">expected_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="TimeSeries-472"><a href="#TimeSeries-472"><span class="linenos">472</span></a>            <span class="n">data_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="n">expected_freq</span>
</span><span id="TimeSeries-473"><a href="#TimeSeries-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-474"><a href="#TimeSeries-474"><span class="linenos">474</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">data_index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">expected_index</span><span class="p">)</span>
</span><span id="TimeSeries-475"><a href="#TimeSeries-475"><span class="linenos">475</span></a>
</span><span id="TimeSeries-476"><a href="#TimeSeries-476"><span class="linenos">476</span></a>        <span class="k">return</span> <span class="n">extra_points</span>
</span><span id="TimeSeries-477"><a href="#TimeSeries-477"><span class="linenos">477</span></a>
</span><span id="TimeSeries-478"><a href="#TimeSeries-478"><span class="linenos">478</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-479"><a href="#TimeSeries-479"><span class="linenos">479</span></a>    <span class="k">def</span> <span class="nf">find_duplicates_and_extra_points</span><span class="p">(</span>
</span><span id="TimeSeries-480"><a href="#TimeSeries-480"><span class="linenos">480</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
</span><span id="TimeSeries-481"><a href="#TimeSeries-481"><span class="linenos">481</span></a>        <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-482"><a href="#TimeSeries-482"><span class="linenos">482</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">]:</span>
</span><span id="TimeSeries-483"><a href="#TimeSeries-483"><span class="linenos">483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-484"><a href="#TimeSeries-484"><span class="linenos">484</span></a><span class="sd">        Check for extra data points in the timeseries, i.e. data points that are duplicated and/or data points that are</span>
</span><span id="TimeSeries-485"><a href="#TimeSeries-485"><span class="linenos">485</span></a><span class="sd">        outside the expected frequency (or the most common frequency if not known) of data points.</span>
</span><span id="TimeSeries-486"><a href="#TimeSeries-486"><span class="linenos">486</span></a><span class="sd">        :param dti: a time_series</span>
</span><span id="TimeSeries-487"><a href="#TimeSeries-487"><span class="linenos">487</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="TimeSeries-488"><a href="#TimeSeries-488"><span class="linenos">488</span></a><span class="sd">        :return: extra data points</span>
</span><span id="TimeSeries-489"><a href="#TimeSeries-489"><span class="linenos">489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-490"><a href="#TimeSeries-490"><span class="linenos">490</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_duplicates</span><span class="p">(</span><span class="n">dti</span><span class="p">),</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span>
</span><span id="TimeSeries-491"><a href="#TimeSeries-491"><span class="linenos">491</span></a>            <span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span>
</span><span id="TimeSeries-492"><a href="#TimeSeries-492"><span class="linenos">492</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-493"><a href="#TimeSeries-493"><span class="linenos">493</span></a>
</span><span id="TimeSeries-494"><a href="#TimeSeries-494"><span class="linenos">494</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-495"><a href="#TimeSeries-495"><span class="linenos">495</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-496"><a href="#TimeSeries-496"><span class="linenos">496</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="TimeSeries-497"><a href="#TimeSeries-497"><span class="linenos">497</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-498"><a href="#TimeSeries-498"><span class="linenos">498</span></a>    <span class="k">def</span> <span class="nf">find_missing_points</span><span class="p">(</span>
</span><span id="TimeSeries-499"><a href="#TimeSeries-499"><span class="linenos">499</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="TimeSeries-500"><a href="#TimeSeries-500"><span class="linenos">500</span></a>        <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-501"><a href="#TimeSeries-501"><span class="linenos">501</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-502"><a href="#TimeSeries-502"><span class="linenos">502</span></a>        <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-503"><a href="#TimeSeries-503"><span class="linenos">503</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="TimeSeries-504"><a href="#TimeSeries-504"><span class="linenos">504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-505"><a href="#TimeSeries-505"><span class="linenos">505</span></a><span class="sd">        Check for missing periods in the time series with an expected frequency.</span>
</span><span id="TimeSeries-506"><a href="#TimeSeries-506"><span class="linenos">506</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries-507"><a href="#TimeSeries-507"><span class="linenos">507</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="TimeSeries-508"><a href="#TimeSeries-508"><span class="linenos">508</span></a><span class="sd">        :param expected_start_datetime: the expected start time of the datetime index, default None</span>
</span><span id="TimeSeries-509"><a href="#TimeSeries-509"><span class="linenos">509</span></a><span class="sd">        :param expected_excl_end_datetime: the expected exclusive end time of the datetime index, default None</span>
</span><span id="TimeSeries-510"><a href="#TimeSeries-510"><span class="linenos">510</span></a><span class="sd">        :return: missing points as a datetime index</span>
</span><span id="TimeSeries-511"><a href="#TimeSeries-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-512"><a href="#TimeSeries-512"><span class="linenos">512</span></a>
</span><span id="TimeSeries-513"><a href="#TimeSeries-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="TimeSeries-514"><a href="#TimeSeries-514"><span class="linenos">514</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty datetime index&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-515"><a href="#TimeSeries-515"><span class="linenos">515</span></a>
</span><span id="TimeSeries-516"><a href="#TimeSeries-516"><span class="linenos">516</span></a>        <span class="c1"># process freq</span>
</span><span id="TimeSeries-517"><a href="#TimeSeries-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_freq</span><span class="p">:</span>
</span><span id="TimeSeries-518"><a href="#TimeSeries-518"><span class="linenos">518</span></a>            <span class="n">expected_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-519"><a href="#TimeSeries-519"><span class="linenos">519</span></a>
</span><span id="TimeSeries-520"><a href="#TimeSeries-520"><span class="linenos">520</span></a>        <span class="c1"># drop duplicates and sort</span>
</span><span id="TimeSeries-521"><a href="#TimeSeries-521"><span class="linenos">521</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries-522"><a href="#TimeSeries-522"><span class="linenos">522</span></a>
</span><span id="TimeSeries-523"><a href="#TimeSeries-523"><span class="linenos">523</span></a>        <span class="c1"># start date</span>
</span><span id="TimeSeries-524"><a href="#TimeSeries-524"><span class="linenos">524</span></a>        <span class="k">if</span> <span class="n">expected_start_datetime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries-525"><a href="#TimeSeries-525"><span class="linenos">525</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expected_start_datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
</span><span id="TimeSeries-526"><a href="#TimeSeries-526"><span class="linenos">526</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;expected_start_datetime must be a pandas.Datetime&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-527"><a href="#TimeSeries-527"><span class="linenos">527</span></a>            <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">expected_start_datetime</span>
</span><span id="TimeSeries-528"><a href="#TimeSeries-528"><span class="linenos">528</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries-529"><a href="#TimeSeries-529"><span class="linenos">529</span></a>            <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeSeries-530"><a href="#TimeSeries-530"><span class="linenos">530</span></a>
</span><span id="TimeSeries-531"><a href="#TimeSeries-531"><span class="linenos">531</span></a>        <span class="c1"># end date</span>
</span><span id="TimeSeries-532"><a href="#TimeSeries-532"><span class="linenos">532</span></a>        <span class="k">if</span> <span class="n">expected_excl_end_datetime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries-533"><a href="#TimeSeries-533"><span class="linenos">533</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expected_excl_end_datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
</span><span id="TimeSeries-534"><a href="#TimeSeries-534"><span class="linenos">534</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;expected_end_datetime must be a pandas.Datetime&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-535"><a href="#TimeSeries-535"><span class="linenos">535</span></a>            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">subtract_timedelta</span><span class="p">(</span>
</span><span id="TimeSeries-536"><a href="#TimeSeries-536"><span class="linenos">536</span></a>                <span class="n">expected_excl_end_datetime</span><span class="p">,</span> <span class="n">expected_freq</span>
</span><span id="TimeSeries-537"><a href="#TimeSeries-537"><span class="linenos">537</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-538"><a href="#TimeSeries-538"><span class="linenos">538</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries-539"><a href="#TimeSeries-539"><span class="linenos">539</span></a>            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TimeSeries-540"><a href="#TimeSeries-540"><span class="linenos">540</span></a>
</span><span id="TimeSeries-541"><a href="#TimeSeries-541"><span class="linenos">541</span></a>        <span class="c1"># compute the expected index</span>
</span><span id="TimeSeries-542"><a href="#TimeSeries-542"><span class="linenos">542</span></a>        <span class="n">expected_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start_datetime</span><span class="p">,</span> <span class="n">end_datetime</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">expected_freq</span><span class="p">)</span>
</span><span id="TimeSeries-543"><a href="#TimeSeries-543"><span class="linenos">543</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">expected_index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-544"><a href="#TimeSeries-544"><span class="linenos">544</span></a>
</span><span id="TimeSeries-545"><a href="#TimeSeries-545"><span class="linenos">545</span></a>        <span class="k">return</span> <span class="n">missing_points</span>
</span><span id="TimeSeries-546"><a href="#TimeSeries-546"><span class="linenos">546</span></a>
</span><span id="TimeSeries-547"><a href="#TimeSeries-547"><span class="linenos">547</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-548"><a href="#TimeSeries-548"><span class="linenos">548</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-549"><a href="#TimeSeries-549"><span class="linenos">549</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-550"><a href="#TimeSeries-550"><span class="linenos">550</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-551"><a href="#TimeSeries-551"><span class="linenos">551</span></a>    <span class="k">def</span> <span class="nf">collapse_to_periods</span><span class="p">(</span>
</span><span id="TimeSeries-552"><a href="#TimeSeries-552"><span class="linenos">552</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="TimeSeries-553"><a href="#TimeSeries-553"><span class="linenos">553</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span>
</span><span id="TimeSeries-554"><a href="#TimeSeries-554"><span class="linenos">554</span></a>        <span class="nb">tuple</span><span class="p">[</span>
</span><span id="TimeSeries-555"><a href="#TimeSeries-555"><span class="linenos">555</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="TimeSeries-556"><a href="#TimeSeries-556"><span class="linenos">556</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="TimeSeries-557"><a href="#TimeSeries-557"><span class="linenos">557</span></a>        <span class="p">]</span>
</span><span id="TimeSeries-558"><a href="#TimeSeries-558"><span class="linenos">558</span></a>    <span class="p">]:</span>
</span><span id="TimeSeries-559"><a href="#TimeSeries-559"><span class="linenos">559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-560"><a href="#TimeSeries-560"><span class="linenos">560</span></a><span class="sd">        Given a datetime index and a frequency, it gives the list of regular periods found in the datetime index, as</span>
</span><span id="TimeSeries-561"><a href="#TimeSeries-561"><span class="linenos">561</span></a><span class="sd">        a collection of tuples that contain the start time and exclusive time of the periods found. More precisely,</span>
</span><span id="TimeSeries-562"><a href="#TimeSeries-562"><span class="linenos">562</span></a><span class="sd">        if a timestamp is missing (ie if t is present but t + freq is missing), a new period is defined (t</span>
</span><span id="TimeSeries-563"><a href="#TimeSeries-563"><span class="linenos">563</span></a><span class="sd">        becomes the end time of the current period, and the next timestamp found after t defines the beginning of a new</span>
</span><span id="TimeSeries-564"><a href="#TimeSeries-564"><span class="linenos">564</span></a><span class="sd">        period).</span>
</span><span id="TimeSeries-565"><a href="#TimeSeries-565"><span class="linenos">565</span></a><span class="sd">        Duplicates are dropped in the operation.</span>
</span><span id="TimeSeries-566"><a href="#TimeSeries-566"><span class="linenos">566</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries-567"><a href="#TimeSeries-567"><span class="linenos">567</span></a><span class="sd">        :param freq: the freq of the datetime index used to find missing periods.</span>
</span><span id="TimeSeries-568"><a href="#TimeSeries-568"><span class="linenos">568</span></a><span class="sd">        :return: a list of tuples that contain the regular periods in the datetime index (defined as the start and</span>
</span><span id="TimeSeries-569"><a href="#TimeSeries-569"><span class="linenos">569</span></a><span class="sd">        inclusive end times of the period).</span>
</span><span id="TimeSeries-570"><a href="#TimeSeries-570"><span class="linenos">570</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-571"><a href="#TimeSeries-571"><span class="linenos">571</span></a>
</span><span id="TimeSeries-572"><a href="#TimeSeries-572"><span class="linenos">572</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries-573"><a href="#TimeSeries-573"><span class="linenos">573</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="TimeSeries-574"><a href="#TimeSeries-574"><span class="linenos">574</span></a>
</span><span id="TimeSeries-575"><a href="#TimeSeries-575"><span class="linenos">575</span></a>        <span class="c1"># drop duplicates and sort the index</span>
</span><span id="TimeSeries-576"><a href="#TimeSeries-576"><span class="linenos">576</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries-577"><a href="#TimeSeries-577"><span class="linenos">577</span></a>
</span><span id="TimeSeries-578"><a href="#TimeSeries-578"><span class="linenos">578</span></a>        <span class="n">current_period_start</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeSeries-579"><a href="#TimeSeries-579"><span class="linenos">579</span></a>        <span class="n">periods_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TimeSeries-580"><a href="#TimeSeries-580"><span class="linenos">580</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="TimeSeries-581"><a href="#TimeSeries-581"><span class="linenos">581</span></a>            <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">freq</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="TimeSeries-582"><a href="#TimeSeries-582"><span class="linenos">582</span></a>                <span class="c1"># end the current period and start a new one</span>
</span><span id="TimeSeries-583"><a href="#TimeSeries-583"><span class="linenos">583</span></a>                <span class="n">periods_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_period_start</span><span class="p">,</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="TimeSeries-584"><a href="#TimeSeries-584"><span class="linenos">584</span></a>                <span class="n">current_period_start</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="TimeSeries-585"><a href="#TimeSeries-585"><span class="linenos">585</span></a>
</span><span id="TimeSeries-586"><a href="#TimeSeries-586"><span class="linenos">586</span></a>        <span class="n">periods_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_period_start</span><span class="p">,</span> <span class="n">dti</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># Don&#39;t forget last period</span>
</span><span id="TimeSeries-587"><a href="#TimeSeries-587"><span class="linenos">587</span></a>
</span><span id="TimeSeries-588"><a href="#TimeSeries-588"><span class="linenos">588</span></a>        <span class="k">return</span> <span class="n">periods_list</span>
</span><span id="TimeSeries-589"><a href="#TimeSeries-589"><span class="linenos">589</span></a>
</span><span id="TimeSeries-590"><a href="#TimeSeries-590"><span class="linenos">590</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-591"><a href="#TimeSeries-591"><span class="linenos">591</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-592"><a href="#TimeSeries-592"><span class="linenos">592</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-593"><a href="#TimeSeries-593"><span class="linenos">593</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-594"><a href="#TimeSeries-594"><span class="linenos">594</span></a>    <span class="k">def</span> <span class="nf">find_missing_periods</span><span class="p">(</span>
</span><span id="TimeSeries-595"><a href="#TimeSeries-595"><span class="linenos">595</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="TimeSeries-596"><a href="#TimeSeries-596"><span class="linenos">596</span></a>        <span class="n">expected_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-597"><a href="#TimeSeries-597"><span class="linenos">597</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-598"><a href="#TimeSeries-598"><span class="linenos">598</span></a>        <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-599"><a href="#TimeSeries-599"><span class="linenos">599</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="TimeSeries-600"><a href="#TimeSeries-600"><span class="linenos">600</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-601"><a href="#TimeSeries-601"><span class="linenos">601</span></a><span class="sd">        Find missing periods in a datetimeIndex. It finds all missing points, and collapse them</span>
</span><span id="TimeSeries-602"><a href="#TimeSeries-602"><span class="linenos">602</span></a><span class="sd">        in periods</span>
</span><span id="TimeSeries-603"><a href="#TimeSeries-603"><span class="linenos">603</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries-604"><a href="#TimeSeries-604"><span class="linenos">604</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="TimeSeries-605"><a href="#TimeSeries-605"><span class="linenos">605</span></a><span class="sd">        :param expected_start_datetime: the expected start time of the datetime index, default None</span>
</span><span id="TimeSeries-606"><a href="#TimeSeries-606"><span class="linenos">606</span></a><span class="sd">        :param expected_excl_end_datetime: the expected exclusive end time of the datetime index, default None</span>
</span><span id="TimeSeries-607"><a href="#TimeSeries-607"><span class="linenos">607</span></a><span class="sd">        :return: missing periods as a list of tuples of start and end times of the missing periods.</span>
</span><span id="TimeSeries-608"><a href="#TimeSeries-608"><span class="linenos">608</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-609"><a href="#TimeSeries-609"><span class="linenos">609</span></a>
</span><span id="TimeSeries-610"><a href="#TimeSeries-610"><span class="linenos">610</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">expected_freq</span>
</span><span id="TimeSeries-611"><a href="#TimeSeries-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">expected_freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries-612"><a href="#TimeSeries-612"><span class="linenos">612</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-613"><a href="#TimeSeries-613"><span class="linenos">613</span></a>
</span><span id="TimeSeries-614"><a href="#TimeSeries-614"><span class="linenos">614</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_points</span><span class="p">(</span>
</span><span id="TimeSeries-615"><a href="#TimeSeries-615"><span class="linenos">615</span></a>            <span class="n">dti</span><span class="p">,</span>
</span><span id="TimeSeries-616"><a href="#TimeSeries-616"><span class="linenos">616</span></a>            <span class="n">expected_freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="TimeSeries-617"><a href="#TimeSeries-617"><span class="linenos">617</span></a>            <span class="n">expected_start_datetime</span><span class="o">=</span><span class="n">expected_start_datetime</span><span class="p">,</span>
</span><span id="TimeSeries-618"><a href="#TimeSeries-618"><span class="linenos">618</span></a>            <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="n">expected_excl_end_datetime</span><span class="p">,</span>
</span><span id="TimeSeries-619"><a href="#TimeSeries-619"><span class="linenos">619</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-620"><a href="#TimeSeries-620"><span class="linenos">620</span></a>
</span><span id="TimeSeries-621"><a href="#TimeSeries-621"><span class="linenos">621</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">collapse_to_periods</span><span class="p">(</span><span class="n">missing_points</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
</span><span id="TimeSeries-622"><a href="#TimeSeries-622"><span class="linenos">622</span></a>
</span><span id="TimeSeries-623"><a href="#TimeSeries-623"><span class="linenos">623</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-624"><a href="#TimeSeries-624"><span class="linenos">624</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries-625"><a href="#TimeSeries-625"><span class="linenos">625</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries-626"><a href="#TimeSeries-626"><span class="linenos">626</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-627"><a href="#TimeSeries-627"><span class="linenos">627</span></a>    <span class="k">def</span> <span class="nf">has_single_frequency</span><span class="p">(</span>
</span><span id="TimeSeries-628"><a href="#TimeSeries-628"><span class="linenos">628</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="TimeSeries-629"><a href="#TimeSeries-629"><span class="linenos">629</span></a>        <span class="n">variable_duration_freq_included</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TimeSeries-630"><a href="#TimeSeries-630"><span class="linenos">630</span></a>        <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TimeSeries-631"><a href="#TimeSeries-631"><span class="linenos">631</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TimeSeries-632"><a href="#TimeSeries-632"><span class="linenos">632</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-633"><a href="#TimeSeries-633"><span class="linenos">633</span></a><span class="sd">        Return True if the provided datetime index has a single frequency, i.e.</span>
</span><span id="TimeSeries-634"><a href="#TimeSeries-634"><span class="linenos">634</span></a><span class="sd">        does not have missing periods, extra points, nor change of frequency</span>
</span><span id="TimeSeries-635"><a href="#TimeSeries-635"><span class="linenos">635</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries-636"><a href="#TimeSeries-636"><span class="linenos">636</span></a><span class="sd">        :param variable_duration_freq_included: &#39;Frequency&#39; may have a double meaning, whether fixed-time frequencies</span>
</span><span id="TimeSeries-637"><a href="#TimeSeries-637"><span class="linenos">637</span></a><span class="sd">                                           are considered or not. For instance, a frequency of one month leads to</span>
</span><span id="TimeSeries-638"><a href="#TimeSeries-638"><span class="linenos">638</span></a><span class="sd">                                           intervals with different absolute length (in terms of days, and seconds).</span>
</span><span id="TimeSeries-639"><a href="#TimeSeries-639"><span class="linenos">639</span></a><span class="sd">                                           Setting True means the datetimeindex is inspected with absolute duration</span>
</span><span id="TimeSeries-640"><a href="#TimeSeries-640"><span class="linenos">640</span></a><span class="sd">                                           in mind. It is useful when we expect:</span>
</span><span id="TimeSeries-641"><a href="#TimeSeries-641"><span class="linenos">641</span></a><span class="sd">                                           * an x-min difference between timestamps</span>
</span><span id="TimeSeries-642"><a href="#TimeSeries-642"><span class="linenos">642</span></a><span class="sd">                                           * an x-day difference between dates</span>
</span><span id="TimeSeries-643"><a href="#TimeSeries-643"><span class="linenos">643</span></a><span class="sd">        :param skip_duplicate_timestamps: If True, the function will not consider duplicate timestamps</span>
</span><span id="TimeSeries-644"><a href="#TimeSeries-644"><span class="linenos">644</span></a><span class="sd">        :return: True if the data has a clean single frequency defined.</span>
</span><span id="TimeSeries-645"><a href="#TimeSeries-645"><span class="linenos">645</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-646"><a href="#TimeSeries-646"><span class="linenos">646</span></a>
</span><span id="TimeSeries-647"><a href="#TimeSeries-647"><span class="linenos">647</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="TimeSeries-648"><a href="#TimeSeries-648"><span class="linenos">648</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="TimeSeries-649"><a href="#TimeSeries-649"><span class="linenos">649</span></a>
</span><span id="TimeSeries-650"><a href="#TimeSeries-650"><span class="linenos">650</span></a>        <span class="c1"># easy case: check the exact differences in duration between timestamps / dates</span>
</span><span id="TimeSeries-651"><a href="#TimeSeries-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="n">variable_duration_freq_included</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="TimeSeries-652"><a href="#TimeSeries-652"><span class="linenos">652</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_gap_distribution</span><span class="p">(</span><span class="n">dti</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="TimeSeries-653"><a href="#TimeSeries-653"><span class="linenos">653</span></a>
</span><span id="TimeSeries-654"><a href="#TimeSeries-654"><span class="linenos">654</span></a>        <span class="c1"># else, it might be more tricky, because the frequency may be irregular in terms of total_seconds</span>
</span><span id="TimeSeries-655"><a href="#TimeSeries-655"><span class="linenos">655</span></a>        <span class="c1"># (e.g. when freq is months, years, or even days because of change of hour). We need to rely on pd.infer_freq().</span>
</span><span id="TimeSeries-656"><a href="#TimeSeries-656"><span class="linenos">656</span></a>        <span class="c1"># Safer way is to reconstruct a time-series index from scratch using the most common frequency found in the</span>
</span><span id="TimeSeries-657"><a href="#TimeSeries-657"><span class="linenos">657</span></a>        <span class="c1"># input index, and compare it to the index.</span>
</span><span id="TimeSeries-658"><a href="#TimeSeries-658"><span class="linenos">658</span></a>
</span><span id="TimeSeries-659"><a href="#TimeSeries-659"><span class="linenos">659</span></a>        <span class="c1"># most common freq</span>
</span><span id="TimeSeries-660"><a href="#TimeSeries-660"><span class="linenos">660</span></a>        <span class="n">most_common_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-661"><a href="#TimeSeries-661"><span class="linenos">661</span></a>
</span><span id="TimeSeries-662"><a href="#TimeSeries-662"><span class="linenos">662</span></a>        <span class="c1"># we rely on find extra points and missing points to detect it.</span>
</span><span id="TimeSeries-663"><a href="#TimeSeries-663"><span class="linenos">663</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span><span class="o">=</span><span class="n">most_common_freq</span><span class="p">)</span>
</span><span id="TimeSeries-664"><a href="#TimeSeries-664"><span class="linenos">664</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries-665"><a href="#TimeSeries-665"><span class="linenos">665</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TimeSeries-666"><a href="#TimeSeries-666"><span class="linenos">666</span></a>
</span><span id="TimeSeries-667"><a href="#TimeSeries-667"><span class="linenos">667</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_points</span><span class="p">(</span>
</span><span id="TimeSeries-668"><a href="#TimeSeries-668"><span class="linenos">668</span></a>            <span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span><span class="o">=</span><span class="n">most_common_freq</span>
</span><span id="TimeSeries-669"><a href="#TimeSeries-669"><span class="linenos">669</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-670"><a href="#TimeSeries-670"><span class="linenos">670</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries-671"><a href="#TimeSeries-671"><span class="linenos">671</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TimeSeries-672"><a href="#TimeSeries-672"><span class="linenos">672</span></a>
</span><span id="TimeSeries-673"><a href="#TimeSeries-673"><span class="linenos">673</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TimeSeries-674"><a href="#TimeSeries-674"><span class="linenos">674</span></a>
</span><span id="TimeSeries-675"><a href="#TimeSeries-675"><span class="linenos">675</span></a>    <span class="c1"># ----------------------------------</span>
</span><span id="TimeSeries-676"><a href="#TimeSeries-676"><span class="linenos">676</span></a>    <span class="c1"># DEPRECATED FUNCTIONS AND CALL</span>
</span><span id="TimeSeries-677"><a href="#TimeSeries-677"><span class="linenos">677</span></a>    <span class="c1"># ----------------------------------</span>
</span><span id="TimeSeries-678"><a href="#TimeSeries-678"><span class="linenos">678</span></a>
</span><span id="TimeSeries-679"><a href="#TimeSeries-679"><span class="linenos">679</span></a>    <span class="nd">@classmethod</span>
</span><span id="TimeSeries-680"><a href="#TimeSeries-680"><span class="linenos">680</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries-681"><a href="#TimeSeries-681"><span class="linenos">681</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-682"><a href="#TimeSeries-682"><span class="linenos">682</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;TimezoneUtils&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-683"><a href="#TimeSeries-683"><span class="linenos">683</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;convert_dtype_from_object_to_tz_aware&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-684"><a href="#TimeSeries-684"><span class="linenos">684</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-685"><a href="#TimeSeries-685"><span class="linenos">685</span></a>    <span class="k">def</span> <span class="nf">align_timezone</span><span class="p">(</span>
</span><span id="TimeSeries-686"><a href="#TimeSeries-686"><span class="linenos">686</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="TimeSeries-687"><a href="#TimeSeries-687"><span class="linenos">687</span></a>        <span class="n">time_series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
</span><span id="TimeSeries-688"><a href="#TimeSeries-688"><span class="linenos">688</span></a>        <span class="n">tzinfo</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="TimeSeries-689"><a href="#TimeSeries-689"><span class="linenos">689</span></a>            <span class="nb">str</span><span class="p">,</span>
</span><span id="TimeSeries-690"><a href="#TimeSeries-690"><span class="linenos">690</span></a>            <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span>
</span><span id="TimeSeries-691"><a href="#TimeSeries-691"><span class="linenos">691</span></a>        <span class="p">],</span>
</span><span id="TimeSeries-692"><a href="#TimeSeries-692"><span class="linenos">692</span></a>    <span class="p">):</span>
</span><span id="TimeSeries-693"><a href="#TimeSeries-693"><span class="linenos">693</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-694"><a href="#TimeSeries-694"><span class="linenos">694</span></a><span class="sd">        Sometimes a time series is of pandas type &quot;object&quot; just because the time-zone information</span>
</span><span id="TimeSeries-695"><a href="#TimeSeries-695"><span class="linenos">695</span></a><span class="sd">        is not well-read initially. Such a series can&#39;t be translated to a pd.DatetimeIndex.</span>
</span><span id="TimeSeries-696"><a href="#TimeSeries-696"><span class="linenos">696</span></a><span class="sd">        This function makes sure the time zone information of the input series is set to the input</span>
</span><span id="TimeSeries-697"><a href="#TimeSeries-697"><span class="linenos">697</span></a><span class="sd">        tz_info for each row and also for the series.</span>
</span><span id="TimeSeries-698"><a href="#TimeSeries-698"><span class="linenos">698</span></a>
</span><span id="TimeSeries-699"><a href="#TimeSeries-699"><span class="linenos">699</span></a><span class="sd">        Example :</span>
</span><span id="TimeSeries-700"><a href="#TimeSeries-700"><span class="linenos">700</span></a><span class="sd">        time_series = a time_series with some times at timezone +01:00 (French winter time)</span>
</span><span id="TimeSeries-701"><a href="#TimeSeries-701"><span class="linenos">701</span></a><span class="sd">                      and others at timezone +02:00 (French summer)</span>
</span><span id="TimeSeries-702"><a href="#TimeSeries-702"><span class="linenos">702</span></a><span class="sd">                      So its pandas dtype is &quot;object&quot;</span>
</span><span id="TimeSeries-703"><a href="#TimeSeries-703"><span class="linenos">703</span></a><span class="sd">        tz = pytz.timezone(&quot;Europe/Paris&quot;)</span>
</span><span id="TimeSeries-704"><a href="#TimeSeries-704"><span class="linenos">704</span></a>
</span><span id="TimeSeries-705"><a href="#TimeSeries-705"><span class="linenos">705</span></a><span class="sd">        :param time_series: a series with tz-aware date-times. If a datetime-index is passed, the function</span>
</span><span id="TimeSeries-706"><a href="#TimeSeries-706"><span class="linenos">706</span></a><span class="sd">                            process it</span>
</span><span id="TimeSeries-707"><a href="#TimeSeries-707"><span class="linenos">707</span></a><span class="sd">        :param tzinfo: a str or a datetime.tzinfo</span>
</span><span id="TimeSeries-708"><a href="#TimeSeries-708"><span class="linenos">708</span></a><span class="sd">        :return: a DatetimeIndex of dtype: datetime[ns, tzinfo]</span>
</span><span id="TimeSeries-709"><a href="#TimeSeries-709"><span class="linenos">709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-710"><a href="#TimeSeries-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span>
</span><span id="TimeSeries-711"><a href="#TimeSeries-711"><span class="linenos">711</span></a>            <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">convert_dtype_from_object_to_tz_aware</span><span class="p">(</span>
</span><span id="TimeSeries-712"><a href="#TimeSeries-712"><span class="linenos">712</span></a>                <span class="n">time_series</span><span class="o">=</span><span class="n">time_series</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tzinfo</span>
</span><span id="TimeSeries-713"><a href="#TimeSeries-713"><span class="linenos">713</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-714"><a href="#TimeSeries-714"><span class="linenos">714</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-715"><a href="#TimeSeries-715"><span class="linenos">715</span></a>
</span><span id="TimeSeries-716"><a href="#TimeSeries-716"><span class="linenos">716</span></a>    <span class="nd">@classmethod</span>
</span><span id="TimeSeries-717"><a href="#TimeSeries-717"><span class="linenos">717</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries-718"><a href="#TimeSeries-718"><span class="linenos">718</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-719"><a href="#TimeSeries-719"><span class="linenos">719</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;find_missing_periods and find_extra_points&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-720"><a href="#TimeSeries-720"><span class="linenos">720</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-721"><a href="#TimeSeries-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="nf">find_missing_and_extra_periods</span><span class="p">(</span>
</span><span id="TimeSeries-722"><a href="#TimeSeries-722"><span class="linenos">722</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="TimeSeries-723"><a href="#TimeSeries-723"><span class="linenos">723</span></a>        <span class="n">dti</span><span class="p">,</span>
</span><span id="TimeSeries-724"><a href="#TimeSeries-724"><span class="linenos">724</span></a>        <span class="n">expected_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-725"><a href="#TimeSeries-725"><span class="linenos">725</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-726"><a href="#TimeSeries-726"><span class="linenos">726</span></a>        <span class="n">expected_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-727"><a href="#TimeSeries-727"><span class="linenos">727</span></a>    <span class="p">):</span>
</span><span id="TimeSeries-728"><a href="#TimeSeries-728"><span class="linenos">728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-729"><a href="#TimeSeries-729"><span class="linenos">729</span></a><span class="sd">        Check for missing and extra data points</span>
</span><span id="TimeSeries-730"><a href="#TimeSeries-730"><span class="linenos">730</span></a><span class="sd">        :param dti: a series of type DatetimeIndex, in ascending order and without duplicates or NaNs</span>
</span><span id="TimeSeries-731"><a href="#TimeSeries-731"><span class="linenos">731</span></a><span class="sd">        :param expected_freq: pandas formatted frequency. If None is given, will infer the frequency, taking the</span>
</span><span id="TimeSeries-732"><a href="#TimeSeries-732"><span class="linenos">732</span></a><span class="sd">            most common gap between 2 consecutive points.</span>
</span><span id="TimeSeries-733"><a href="#TimeSeries-733"><span class="linenos">733</span></a><span class="sd">        :param expected_start_datetime: a pandas.Datetime, if None is given, will take dti[0]</span>
</span><span id="TimeSeries-734"><a href="#TimeSeries-734"><span class="linenos">734</span></a><span class="sd">        :param expected_end_datetime: a pandas.Datetime, if None is given, will take dti[-1]</span>
</span><span id="TimeSeries-735"><a href="#TimeSeries-735"><span class="linenos">735</span></a><span class="sd">        :return: Missing and extra data points collapsed in periods</span>
</span><span id="TimeSeries-736"><a href="#TimeSeries-736"><span class="linenos">736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-737"><a href="#TimeSeries-737"><span class="linenos">737</span></a>
</span><span id="TimeSeries-738"><a href="#TimeSeries-738"><span class="linenos">738</span></a>        <span class="c1"># for the sake of compatibility</span>
</span><span id="TimeSeries-739"><a href="#TimeSeries-739"><span class="linenos">739</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">dti</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
</span><span id="TimeSeries-740"><a href="#TimeSeries-740"><span class="linenos">740</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;given dti is not in ascending order&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-741"><a href="#TimeSeries-741"><span class="linenos">741</span></a>
</span><span id="TimeSeries-742"><a href="#TimeSeries-742"><span class="linenos">742</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries-743"><a href="#TimeSeries-743"><span class="linenos">743</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;given dti has duplicates.&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-744"><a href="#TimeSeries-744"><span class="linenos">744</span></a>
</span><span id="TimeSeries-745"><a href="#TimeSeries-745"><span class="linenos">745</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-746"><a href="#TimeSeries-746"><span class="linenos">746</span></a>        <span class="n">missing_periods</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_periods</span><span class="p">(</span>
</span><span id="TimeSeries-747"><a href="#TimeSeries-747"><span class="linenos">747</span></a>            <span class="n">dti</span><span class="p">,</span>
</span><span id="TimeSeries-748"><a href="#TimeSeries-748"><span class="linenos">748</span></a>            <span class="n">expected_freq</span><span class="o">=</span><span class="n">expected_freq</span><span class="p">,</span>
</span><span id="TimeSeries-749"><a href="#TimeSeries-749"><span class="linenos">749</span></a>            <span class="n">expected_start_datetime</span><span class="o">=</span><span class="n">expected_start_datetime</span><span class="p">,</span>
</span><span id="TimeSeries-750"><a href="#TimeSeries-750"><span class="linenos">750</span></a>            <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="n">expected_end_datetime</span><span class="p">,</span>
</span><span id="TimeSeries-751"><a href="#TimeSeries-751"><span class="linenos">751</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-752"><a href="#TimeSeries-752"><span class="linenos">752</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries-753"><a href="#TimeSeries-753"><span class="linenos">753</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span> <span class="n">missing_periods</span><span class="p">,</span> <span class="n">extra_points</span>
</span><span id="TimeSeries-754"><a href="#TimeSeries-754"><span class="linenos">754</span></a>
</span><span id="TimeSeries-755"><a href="#TimeSeries-755"><span class="linenos">755</span></a>    <span class="nd">@classmethod</span>
</span><span id="TimeSeries-756"><a href="#TimeSeries-756"><span class="linenos">756</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries-757"><a href="#TimeSeries-757"><span class="linenos">757</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;collapse_to_periods&quot;</span>
</span><span id="TimeSeries-758"><a href="#TimeSeries-758"><span class="linenos">758</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-759"><a href="#TimeSeries-759"><span class="linenos">759</span></a>    <span class="k">def</span> <span class="nf">collapse_dt_series_into_periods</span><span class="p">(</span>
</span><span id="TimeSeries-760"><a href="#TimeSeries-760"><span class="linenos">760</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="TimeSeries-761"><a href="#TimeSeries-761"><span class="linenos">761</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span>
</span><span id="TimeSeries-762"><a href="#TimeSeries-762"><span class="linenos">762</span></a>        <span class="nb">tuple</span><span class="p">[</span>
</span><span id="TimeSeries-763"><a href="#TimeSeries-763"><span class="linenos">763</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="TimeSeries-764"><a href="#TimeSeries-764"><span class="linenos">764</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="TimeSeries-765"><a href="#TimeSeries-765"><span class="linenos">765</span></a>        <span class="p">]</span>
</span><span id="TimeSeries-766"><a href="#TimeSeries-766"><span class="linenos">766</span></a>    <span class="p">]:</span>
</span><span id="TimeSeries-767"><a href="#TimeSeries-767"><span class="linenos">767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-768"><a href="#TimeSeries-768"><span class="linenos">768</span></a><span class="sd">        Given a datetime index and a frequency, it gives the list of regular periods found in the datetime index, as</span>
</span><span id="TimeSeries-769"><a href="#TimeSeries-769"><span class="linenos">769</span></a><span class="sd">        a collection of tuples that contain the start time and exclusive time of the periods found. More precisely,</span>
</span><span id="TimeSeries-770"><a href="#TimeSeries-770"><span class="linenos">770</span></a><span class="sd">        if a timestamp is missing (ie if t is present but t + freq is missing), a new period is defined (t</span>
</span><span id="TimeSeries-771"><a href="#TimeSeries-771"><span class="linenos">771</span></a><span class="sd">        becomes the end time of the current period, and the next timestamp found after t defines the beginning of a new</span>
</span><span id="TimeSeries-772"><a href="#TimeSeries-772"><span class="linenos">772</span></a><span class="sd">        period).</span>
</span><span id="TimeSeries-773"><a href="#TimeSeries-773"><span class="linenos">773</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries-774"><a href="#TimeSeries-774"><span class="linenos">774</span></a><span class="sd">        :param freq: the freq of the datetime index used to find missing periods.</span>
</span><span id="TimeSeries-775"><a href="#TimeSeries-775"><span class="linenos">775</span></a><span class="sd">        :return: a list of tuples that contain the regular periods in the datetime index (defined as the start and</span>
</span><span id="TimeSeries-776"><a href="#TimeSeries-776"><span class="linenos">776</span></a><span class="sd">        inclusive end times of the period).</span>
</span><span id="TimeSeries-777"><a href="#TimeSeries-777"><span class="linenos">777</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-778"><a href="#TimeSeries-778"><span class="linenos">778</span></a>
</span><span id="TimeSeries-779"><a href="#TimeSeries-779"><span class="linenos">779</span></a>        <span class="c1"># legacy: check duplicates and multiple of period</span>
</span><span id="TimeSeries-780"><a href="#TimeSeries-780"><span class="linenos">780</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="TimeSeries-781"><a href="#TimeSeries-781"><span class="linenos">781</span></a>            <span class="k">if</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="TimeSeries-782"><a href="#TimeSeries-782"><span class="linenos">782</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dti must be sorted and without duplicates!&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-783"><a href="#TimeSeries-783"><span class="linenos">783</span></a>
</span><span id="TimeSeries-784"><a href="#TimeSeries-784"><span class="linenos">784</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">%</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span>
</span><span id="TimeSeries-785"><a href="#TimeSeries-785"><span class="linenos">785</span></a>                <span class="n">freq</span>
</span><span id="TimeSeries-786"><a href="#TimeSeries-786"><span class="linenos">786</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries-787"><a href="#TimeSeries-787"><span class="linenos">787</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries-788"><a href="#TimeSeries-788"><span class="linenos">788</span></a>                    <span class="sa">f</span><span class="s2">&quot;Timedelta between </span><span class="si">{</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> is not a multiple of freq (</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="TimeSeries-789"><a href="#TimeSeries-789"><span class="linenos">789</span></a>                <span class="p">)</span>
</span><span id="TimeSeries-790"><a href="#TimeSeries-790"><span class="linenos">790</span></a>
</span><span id="TimeSeries-791"><a href="#TimeSeries-791"><span class="linenos">791</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">collapse_to_periods</span><span class="p">(</span><span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
</span><span id="TimeSeries-792"><a href="#TimeSeries-792"><span class="linenos">792</span></a>
</span><span id="TimeSeries-793"><a href="#TimeSeries-793"><span class="linenos">793</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-794"><a href="#TimeSeries-794"><span class="linenos">794</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries-795"><a href="#TimeSeries-795"><span class="linenos">795</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;find_most_common_frequency&quot;</span>
</span><span id="TimeSeries-796"><a href="#TimeSeries-796"><span class="linenos">796</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-797"><a href="#TimeSeries-797"><span class="linenos">797</span></a>    <span class="k">def</span> <span class="nf">get_timeseries_frequency</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="TimeSeries-798"><a href="#TimeSeries-798"><span class="linenos">798</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-799"><a href="#TimeSeries-799"><span class="linenos">799</span></a><span class="sd">        Retrieve the frequency of a pandas dataframe&#39;s index.</span>
</span><span id="TimeSeries-800"><a href="#TimeSeries-800"><span class="linenos">800</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-801"><a href="#TimeSeries-801"><span class="linenos">801</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
</span><span id="TimeSeries-802"><a href="#TimeSeries-802"><span class="linenos">802</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Found several frequencies in the datetimeIndex&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-803"><a href="#TimeSeries-803"><span class="linenos">803</span></a>
</span><span id="TimeSeries-804"><a href="#TimeSeries-804"><span class="linenos">804</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span><span id="TimeSeries-805"><a href="#TimeSeries-805"><span class="linenos">805</span></a>
</span><span id="TimeSeries-806"><a href="#TimeSeries-806"><span class="linenos">806</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-807"><a href="#TimeSeries-807"><span class="linenos">807</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries-808"><a href="#TimeSeries-808"><span class="linenos">808</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-809"><a href="#TimeSeries-809"><span class="linenos">809</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-810"><a href="#TimeSeries-810"><span class="linenos">810</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;upsample_and_interpolate&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-811"><a href="#TimeSeries-811"><span class="linenos">811</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-812"><a href="#TimeSeries-812"><span class="linenos">812</span></a>    <span class="k">def</span> <span class="nf">interpolate_freq_to_sub_freq_data</span><span class="p">(</span>
</span><span id="TimeSeries-813"><a href="#TimeSeries-813"><span class="linenos">813</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="TimeSeries-814"><a href="#TimeSeries-814"><span class="linenos">814</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries-815"><a href="#TimeSeries-815"><span class="linenos">815</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="TimeSeries-816"><a href="#TimeSeries-816"><span class="linenos">816</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-817"><a href="#TimeSeries-817"><span class="linenos">817</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-818"><a href="#TimeSeries-818"><span class="linenos">818</span></a>        <span class="n">enforce_single_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TimeSeries-819"><a href="#TimeSeries-819"><span class="linenos">819</span></a>    <span class="p">):</span>
</span><span id="TimeSeries-820"><a href="#TimeSeries-820"><span class="linenos">820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-821"><a href="#TimeSeries-821"><span class="linenos">821</span></a><span class="sd">        Interpolate dataframe data on a smaller frequency than the one initially defined</span>
</span><span id="TimeSeries-822"><a href="#TimeSeries-822"><span class="linenos">822</span></a><span class="sd">        in the dataframe</span>
</span><span id="TimeSeries-823"><a href="#TimeSeries-823"><span class="linenos">823</span></a><span class="sd">        The original index of the data must have a well-defined frequency, i.e. it must be</span>
</span><span id="TimeSeries-824"><a href="#TimeSeries-824"><span class="linenos">824</span></a><span class="sd">        able to retrieve its frequency with inferred_freq</span>
</span><span id="TimeSeries-825"><a href="#TimeSeries-825"><span class="linenos">825</span></a><span class="sd">        :param df: pd.DataFrame</span>
</span><span id="TimeSeries-826"><a href="#TimeSeries-826"><span class="linenos">826</span></a><span class="sd">        :param freq: a frequency e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc.</span>
</span><span id="TimeSeries-827"><a href="#TimeSeries-827"><span class="linenos">827</span></a><span class="sd">        :param tz: the target time zone.</span>
</span><span id="TimeSeries-828"><a href="#TimeSeries-828"><span class="linenos">828</span></a><span class="sd">        :param index_name: name to give to the new index. Usually going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="TimeSeries-829"><a href="#TimeSeries-829"><span class="linenos">829</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc.)</span>
</span><span id="TimeSeries-830"><a href="#TimeSeries-830"><span class="linenos">830</span></a><span class="sd">        :param enforce_single_freq: is there a single frequency in the original dataframe</span>
</span><span id="TimeSeries-831"><a href="#TimeSeries-831"><span class="linenos">831</span></a><span class="sd">        :return: pd.DataFrame</span>
</span><span id="TimeSeries-832"><a href="#TimeSeries-832"><span class="linenos">832</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-833"><a href="#TimeSeries-833"><span class="linenos">833</span></a>
</span><span id="TimeSeries-834"><a href="#TimeSeries-834"><span class="linenos">834</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="TimeSeries-835"><a href="#TimeSeries-835"><span class="linenos">835</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span id="TimeSeries-836"><a href="#TimeSeries-836"><span class="linenos">836</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="TimeSeries-837"><a href="#TimeSeries-837"><span class="linenos">837</span></a>            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
</span><span id="TimeSeries-838"><a href="#TimeSeries-838"><span class="linenos">838</span></a>            <span class="n">forward_fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TimeSeries-839"><a href="#TimeSeries-839"><span class="linenos">839</span></a>            <span class="n">is_original_frequency_unique</span><span class="o">=</span><span class="n">enforce_single_freq</span><span class="p">,</span>
</span><span id="TimeSeries-840"><a href="#TimeSeries-840"><span class="linenos">840</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="TimeSeries-841"><a href="#TimeSeries-841"><span class="linenos">841</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-842"><a href="#TimeSeries-842"><span class="linenos">842</span></a>
</span><span id="TimeSeries-843"><a href="#TimeSeries-843"><span class="linenos">843</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
</span><span id="TimeSeries-844"><a href="#TimeSeries-844"><span class="linenos">844</span></a>
</span><span id="TimeSeries-845"><a href="#TimeSeries-845"><span class="linenos">845</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="TimeSeries-846"><a href="#TimeSeries-846"><span class="linenos">846</span></a>
</span><span id="TimeSeries-847"><a href="#TimeSeries-847"><span class="linenos">847</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-848"><a href="#TimeSeries-848"><span class="linenos">848</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-849"><a href="#TimeSeries-849"><span class="linenos">849</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries-850"><a href="#TimeSeries-850"><span class="linenos">850</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span>
</span><span id="TimeSeries-851"><a href="#TimeSeries-851"><span class="linenos">851</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-852"><a href="#TimeSeries-852"><span class="linenos">852</span></a>    <span class="k">def</span> <span class="nf">forward_fill_final_record</span><span class="p">(</span>
</span><span id="TimeSeries-853"><a href="#TimeSeries-853"><span class="linenos">853</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="TimeSeries-854"><a href="#TimeSeries-854"><span class="linenos">854</span></a>        <span class="n">gap_frequency</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries-855"><a href="#TimeSeries-855"><span class="linenos">855</span></a>        <span class="n">cut_off_frequency</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-856"><a href="#TimeSeries-856"><span class="linenos">856</span></a>    <span class="p">):</span>
</span><span id="TimeSeries-857"><a href="#TimeSeries-857"><span class="linenos">857</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-858"><a href="#TimeSeries-858"><span class="linenos">858</span></a><span class="sd">        Forward-fill last record</span>
</span><span id="TimeSeries-859"><a href="#TimeSeries-859"><span class="linenos">859</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-860"><a href="#TimeSeries-860"><span class="linenos">860</span></a>
</span><span id="TimeSeries-861"><a href="#TimeSeries-861"><span class="linenos">861</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">get_timeseries_frequency</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="TimeSeries-862"><a href="#TimeSeries-862"><span class="linenos">862</span></a>        <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries-863"><a href="#TimeSeries-863"><span class="linenos">863</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataframe has no frequency and cannot be extended&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-864"><a href="#TimeSeries-864"><span class="linenos">864</span></a>
</span><span id="TimeSeries-865"><a href="#TimeSeries-865"><span class="linenos">865</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="TimeSeries-866"><a href="#TimeSeries-866"><span class="linenos">866</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="TimeSeries-867"><a href="#TimeSeries-867"><span class="linenos">867</span></a>            <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">gap_frequency</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="TimeSeries-868"><a href="#TimeSeries-868"><span class="linenos">868</span></a>        <span class="p">):</span>
</span><span id="TimeSeries-869"><a href="#TimeSeries-869"><span class="linenos">869</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries-870"><a href="#TimeSeries-870"><span class="linenos">870</span></a>                <span class="s2">&quot;Cannot extend the dataframe on a smaller frequency than itself&quot;</span>
</span><span id="TimeSeries-871"><a href="#TimeSeries-871"><span class="linenos">871</span></a>            <span class="p">)</span>
</span><span id="TimeSeries-872"><a href="#TimeSeries-872"><span class="linenos">872</span></a>
</span><span id="TimeSeries-873"><a href="#TimeSeries-873"><span class="linenos">873</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">forward_fill_final_record</span><span class="p">(</span>
</span><span id="TimeSeries-874"><a href="#TimeSeries-874"><span class="linenos">874</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">gap_timedelta</span><span class="o">=</span><span class="n">gap_frequency</span><span class="p">,</span> <span class="n">cut_off</span><span class="o">=</span><span class="n">cut_off_frequency</span>
</span><span id="TimeSeries-875"><a href="#TimeSeries-875"><span class="linenos">875</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-876"><a href="#TimeSeries-876"><span class="linenos">876</span></a>        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="TimeSeries-877"><a href="#TimeSeries-877"><span class="linenos">877</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="TimeSeries-878"><a href="#TimeSeries-878"><span class="linenos">878</span></a>
</span><span id="TimeSeries-879"><a href="#TimeSeries-879"><span class="linenos">879</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-880"><a href="#TimeSeries-880"><span class="linenos">880</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
</span><span id="TimeSeries-881"><a href="#TimeSeries-881"><span class="linenos">881</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries-882"><a href="#TimeSeries-882"><span class="linenos">882</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-883"><a href="#TimeSeries-883"><span class="linenos">883</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-884"><a href="#TimeSeries-884"><span class="linenos">884</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;upsample_and_interpolate&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-885"><a href="#TimeSeries-885"><span class="linenos">885</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-886"><a href="#TimeSeries-886"><span class="linenos">886</span></a>    <span class="k">def</span> <span class="nf">interpolate_daily_to_sub_daily_data</span><span class="p">(</span>
</span><span id="TimeSeries-887"><a href="#TimeSeries-887"><span class="linenos">887</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="TimeSeries-888"><a href="#TimeSeries-888"><span class="linenos">888</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries-889"><a href="#TimeSeries-889"><span class="linenos">889</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="TimeSeries-890"><a href="#TimeSeries-890"><span class="linenos">890</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-891"><a href="#TimeSeries-891"><span class="linenos">891</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ffill&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-892"><a href="#TimeSeries-892"><span class="linenos">892</span></a>    <span class="p">):</span>
</span><span id="TimeSeries-893"><a href="#TimeSeries-893"><span class="linenos">893</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-894"><a href="#TimeSeries-894"><span class="linenos">894</span></a><span class="sd">        Interpolate daily data in a dataframe (with a DatetimeIndex) to sub-daily data using a given method.</span>
</span><span id="TimeSeries-895"><a href="#TimeSeries-895"><span class="linenos">895</span></a><span class="sd">        The last daily record is resampled using a forward-fill in any case.</span>
</span><span id="TimeSeries-896"><a href="#TimeSeries-896"><span class="linenos">896</span></a><span class="sd">        :param df: pd.DataFrame</span>
</span><span id="TimeSeries-897"><a href="#TimeSeries-897"><span class="linenos">897</span></a><span class="sd">        :param freq: a frequency &lt; &#39;D&#39; (e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc)</span>
</span><span id="TimeSeries-898"><a href="#TimeSeries-898"><span class="linenos">898</span></a><span class="sd">        :param tz: the time zone (None not accepted because important)</span>
</span><span id="TimeSeries-899"><a href="#TimeSeries-899"><span class="linenos">899</span></a><span class="sd">        :param index_name: name to give to the new index. Usually going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="TimeSeries-900"><a href="#TimeSeries-900"><span class="linenos">900</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc)</span>
</span><span id="TimeSeries-901"><a href="#TimeSeries-901"><span class="linenos">901</span></a><span class="sd">        :return: pd.DataFrame</span>
</span><span id="TimeSeries-902"><a href="#TimeSeries-902"><span class="linenos">902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-903"><a href="#TimeSeries-903"><span class="linenos">903</span></a>
</span><span id="TimeSeries-904"><a href="#TimeSeries-904"><span class="linenos">904</span></a>        <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="TimeSeries-905"><a href="#TimeSeries-905"><span class="linenos">905</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span id="TimeSeries-906"><a href="#TimeSeries-906"><span class="linenos">906</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="TimeSeries-907"><a href="#TimeSeries-907"><span class="linenos">907</span></a>            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
</span><span id="TimeSeries-908"><a href="#TimeSeries-908"><span class="linenos">908</span></a>            <span class="n">forward_fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TimeSeries-909"><a href="#TimeSeries-909"><span class="linenos">909</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="TimeSeries-910"><a href="#TimeSeries-910"><span class="linenos">910</span></a>            <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">,</span>
</span><span id="TimeSeries-911"><a href="#TimeSeries-911"><span class="linenos">911</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-912"><a href="#TimeSeries-912"><span class="linenos">912</span></a>
</span><span id="TimeSeries-913"><a href="#TimeSeries-913"><span class="linenos">913</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries-914"><a href="#TimeSeries-914"><span class="linenos">914</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries-915"><a href="#TimeSeries-915"><span class="linenos">915</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-916"><a href="#TimeSeries-916"><span class="linenos">916</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-917"><a href="#TimeSeries-917"><span class="linenos">917</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;downsample&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-918"><a href="#TimeSeries-918"><span class="linenos">918</span></a>    <span class="p">)</span>
</span><span id="TimeSeries-919"><a href="#TimeSeries-919"><span class="linenos">919</span></a>    <span class="k">def</span> <span class="nf">average_to_upper_freq</span><span class="p">(</span>
</span><span id="TimeSeries-920"><a href="#TimeSeries-920"><span class="linenos">920</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="TimeSeries-921"><a href="#TimeSeries-921"><span class="linenos">921</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries-922"><a href="#TimeSeries-922"><span class="linenos">922</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="TimeSeries-923"><a href="#TimeSeries-923"><span class="linenos">923</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries-924"><a href="#TimeSeries-924"><span class="linenos">924</span></a>        <span class="n">enforce_single_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TimeSeries-925"><a href="#TimeSeries-925"><span class="linenos">925</span></a>    <span class="p">):</span>
</span><span id="TimeSeries-926"><a href="#TimeSeries-926"><span class="linenos">926</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries-927"><a href="#TimeSeries-927"><span class="linenos">927</span></a><span class="sd">        Downsample data provided in a given dataframe with a DatetimeIndex, or a two-levels</span>
</span><span id="TimeSeries-928"><a href="#TimeSeries-928"><span class="linenos">928</span></a><span class="sd">        compatible Multiindex.</span>
</span><span id="TimeSeries-929"><a href="#TimeSeries-929"><span class="linenos">929</span></a><span class="sd">        The provided frequency serves as a basis to group the data and average.</span>
</span><span id="TimeSeries-930"><a href="#TimeSeries-930"><span class="linenos">930</span></a><span class="sd">        If the initial dataframe has no frequency, we raise an error.</span>
</span><span id="TimeSeries-931"><a href="#TimeSeries-931"><span class="linenos">931</span></a>
</span><span id="TimeSeries-932"><a href="#TimeSeries-932"><span class="linenos">932</span></a><span class="sd">        Example:</span>
</span><span id="TimeSeries-933"><a href="#TimeSeries-933"><span class="linenos">933</span></a>
</span><span id="TimeSeries-934"><a href="#TimeSeries-934"><span class="linenos">934</span></a><span class="sd">        1. Given df:</span>
</span><span id="TimeSeries-935"><a href="#TimeSeries-935"><span class="linenos">935</span></a><span class="sd">        time_index                value</span>
</span><span id="TimeSeries-936"><a href="#TimeSeries-936"><span class="linenos">936</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="TimeSeries-937"><a href="#TimeSeries-937"><span class="linenos">937</span></a><span class="sd">        2021-01-01 00:12:00+01:00 2</span>
</span><span id="TimeSeries-938"><a href="#TimeSeries-938"><span class="linenos">938</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="TimeSeries-939"><a href="#TimeSeries-939"><span class="linenos">939</span></a>
</span><span id="TimeSeries-940"><a href="#TimeSeries-940"><span class="linenos">940</span></a><span class="sd">        average_to_upper_freq(df, freq=&#39;1D&#39;):</span>
</span><span id="TimeSeries-941"><a href="#TimeSeries-941"><span class="linenos">941</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1.5</span>
</span><span id="TimeSeries-942"><a href="#TimeSeries-942"><span class="linenos">942</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="TimeSeries-943"><a href="#TimeSeries-943"><span class="linenos">943</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries-944"><a href="#TimeSeries-944"><span class="linenos">944</span></a>
</span><span id="TimeSeries-945"><a href="#TimeSeries-945"><span class="linenos">945</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span>
</span><span id="TimeSeries-946"><a href="#TimeSeries-946"><span class="linenos">946</span></a>            <span class="n">df</span><span class="p">,</span>
</span><span id="TimeSeries-947"><a href="#TimeSeries-947"><span class="linenos">947</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="TimeSeries-948"><a href="#TimeSeries-948"><span class="linenos">948</span></a>            <span class="n">agg_functions</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="TimeSeries-949"><a href="#TimeSeries-949"><span class="linenos">949</span></a>            <span class="n">is_original_frequency_unique</span><span class="o">=</span><span class="n">enforce_single_freq</span><span class="p">,</span>
</span><span id="TimeSeries-950"><a href="#TimeSeries-950"><span class="linenos">950</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="TimeSeries-951"><a href="#TimeSeries-951"><span class="linenos">951</span></a>        <span class="p">)</span>
</span><span id="TimeSeries-952"><a href="#TimeSeries-952"><span class="linenos">952</span></a>
</span><span id="TimeSeries-953"><a href="#TimeSeries-953"><span class="linenos">953</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
</span><span id="TimeSeries-954"><a href="#TimeSeries-954"><span class="linenos">954</span></a>
</span><span id="TimeSeries-955"><a href="#TimeSeries-955"><span class="linenos">955</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>This class contains methods for manipulating timeseries</p>
</div>


                            <div id="TimeSeries.FREQ_UNIT_TO_DAYS" class="classattr">
                                <div class="attr variable">
            <span class="name">FREQ_UNIT_TO_DAYS</span>        =
<input id="TimeSeries.FREQ_UNIT_TO_DAYS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TimeSeries.FREQ_UNIT_TO_DAYS-view-value"></label><span class="default_value">{&#39;ms&#39;: 1.1574074074074074e-08, &#39;s&#39;: 1.1574074074074073e-05, &#39;S&#39;: 1.1574074074074073e-05, &#39;min&#39;: 0.0006944444444444445, &#39;MIN&#39;: 0.0006944444444444445, &#39;T&#39;: 0.0006944444444444445, &#39;H&#39;: 0.041666666666666664, &#39;h&#39;: 0.041666666666666664, &#39;D&#39;: 1, &#39;d&#39;: 1, &#39;B&#39;: 1, &#39;b&#39;: 1, &#39;W&#39;: 7, &#39;w&#39;: 7, &#39;W-SUN&#39;: 7, &#39;W-MON&#39;: 7, &#39;M&#39;: 30.4, &#39;MS&#39;: 30.4, &#39;Q&#39;: 91, &#39;A&#39;: 365, &#39;Y&#39;: 365}</span>

        
    </div>
    <a class="headerlink" href="#TimeSeries.FREQ_UNIT_TO_DAYS"></a>
    
    

                            </div>
                            <div id="TimeSeries.FREQ_UNIT_TO_SECONDS" class="classattr">
                                <div class="attr variable">
            <span class="name">FREQ_UNIT_TO_SECONDS</span>        =
<input id="TimeSeries.FREQ_UNIT_TO_SECONDS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TimeSeries.FREQ_UNIT_TO_SECONDS-view-value"></label><span class="default_value">{&#39;ms&#39;: 0.001, &#39;s&#39;: 1, &#39;S&#39;: 1, &#39;min&#39;: 60, &#39;MIN&#39;: 60, &#39;T&#39;: 60, &#39;H&#39;: 3600, &#39;h&#39;: 3600, &#39;D&#39;: 86400, &#39;d&#39;: 86400, &#39;B&#39;: 86400, &#39;b&#39;: 86400, &#39;W&#39;: 604800, &#39;w&#39;: 604800, &#39;W-SUN&#39;: 604800, &#39;W-MON&#39;: 604800, &#39;M&#39;: 2626560, &#39;MS&#39;: 2626560, &#39;Q&#39;: 7862400, &#39;A&#39;: 31536000, &#39;Y&#39;: 31536000}</span>

        
    </div>
    <a class="headerlink" href="#TimeSeries.FREQ_UNIT_TO_SECONDS"></a>
    
    

                            </div>
                            <div id="TimeSeries.split_amount_and_unit_from_freq" class="classattr">
                                        <input id="TimeSeries.split_amount_and_unit_from_freq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">split_amount_and_unit_from_freq</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.split_amount_and_unit_from_freq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.split_amount_and_unit_from_freq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.split_amount_and_unit_from_freq-78"><a href="#TimeSeries.split_amount_and_unit_from_freq-78"><span class="linenos"> 78</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-79"><a href="#TimeSeries.split_amount_and_unit_from_freq-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-80"><a href="#TimeSeries.split_amount_and_unit_from_freq-80"><span class="linenos"> 80</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-81"><a href="#TimeSeries.split_amount_and_unit_from_freq-81"><span class="linenos"> 81</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-82"><a href="#TimeSeries.split_amount_and_unit_from_freq-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-83"><a href="#TimeSeries.split_amount_and_unit_from_freq-83"><span class="linenos"> 83</span></a><span class="sd">        Given a frequency as a string, such as &#39;1D&#39;, &#39;10min&#39;, &#39;-3MS&#39;</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-84"><a href="#TimeSeries.split_amount_and_unit_from_freq-84"><span class="linenos"> 84</span></a><span class="sd">        extract the amount (e.g. 1, 10, -3) and the unit part (e.g. &#39;D&#39;, &#39;min&#39;, &#39;MS&#39;), capitalized.</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-85"><a href="#TimeSeries.split_amount_and_unit_from_freq-85"><span class="linenos"> 85</span></a><span class="sd">        :param freq: the frequency</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-86"><a href="#TimeSeries.split_amount_and_unit_from_freq-86"><span class="linenos"> 86</span></a><span class="sd">        :return: the unit part of that frequency, and the number of units</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-87"><a href="#TimeSeries.split_amount_and_unit_from_freq-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-88"><a href="#TimeSeries.split_amount_and_unit_from_freq-88"><span class="linenos"> 88</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-89"><a href="#TimeSeries.split_amount_and_unit_from_freq-89"><span class="linenos"> 89</span></a>        <span class="c1"># if freq is a pd.Timedelta, it should be convertible to a string</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-90"><a href="#TimeSeries.split_amount_and_unit_from_freq-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-91"><a href="#TimeSeries.split_amount_and_unit_from_freq-91"><span class="linenos"> 91</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-92"><a href="#TimeSeries.split_amount_and_unit_from_freq-92"><span class="linenos"> 92</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-93"><a href="#TimeSeries.split_amount_and_unit_from_freq-93"><span class="linenos"> 93</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-94"><a href="#TimeSeries.split_amount_and_unit_from_freq-94"><span class="linenos"> 94</span></a>        <span class="n">freq_string_parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+|\D+)&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-95"><a href="#TimeSeries.split_amount_and_unit_from_freq-95"><span class="linenos"> 95</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-96"><a href="#TimeSeries.split_amount_and_unit_from_freq-96"><span class="linenos"> 96</span></a>        <span class="c1"># several cases are possible to take into account the +/- sign</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-97"><a href="#TimeSeries.split_amount_and_unit_from_freq-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-98"><a href="#TimeSeries.split_amount_and_unit_from_freq-98"><span class="linenos"> 98</span></a>            <span class="c1"># in that case, first character must be a + or - sign, eg. &#39;-1D&#39;</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-99"><a href="#TimeSeries.split_amount_and_unit_from_freq-99"><span class="linenos"> 99</span></a>            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-100"><a href="#TimeSeries.split_amount_and_unit_from_freq-100"><span class="linenos">100</span></a>            <span class="k">if</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-101"><a href="#TimeSeries.split_amount_and_unit_from_freq-101"><span class="linenos">101</span></a>                <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-102"><a href="#TimeSeries.split_amount_and_unit_from_freq-102"><span class="linenos">102</span></a>            <span class="k">elif</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-103"><a href="#TimeSeries.split_amount_and_unit_from_freq-103"><span class="linenos">103</span></a>                <span class="k">pass</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-104"><a href="#TimeSeries.split_amount_and_unit_from_freq-104"><span class="linenos">104</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-105"><a href="#TimeSeries.split_amount_and_unit_from_freq-105"><span class="linenos">105</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First character is not a plus or minus sign&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-106"><a href="#TimeSeries.split_amount_and_unit_from_freq-106"><span class="linenos">106</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-107"><a href="#TimeSeries.split_amount_and_unit_from_freq-107"><span class="linenos">107</span></a>            <span class="c1"># numeric part - error if type is wrong</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-108"><a href="#TimeSeries.split_amount_and_unit_from_freq-108"><span class="linenos">108</span></a>            <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-109"><a href="#TimeSeries.split_amount_and_unit_from_freq-109"><span class="linenos">109</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-110"><a href="#TimeSeries.split_amount_and_unit_from_freq-110"><span class="linenos">110</span></a>            <span class="c1"># freq part  - error if type is wrong</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-111"><a href="#TimeSeries.split_amount_and_unit_from_freq-111"><span class="linenos">111</span></a>            <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-112"><a href="#TimeSeries.split_amount_and_unit_from_freq-112"><span class="linenos">112</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-113"><a href="#TimeSeries.split_amount_and_unit_from_freq-113"><span class="linenos">113</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-114"><a href="#TimeSeries.split_amount_and_unit_from_freq-114"><span class="linenos">114</span></a>            <span class="c1"># in that case, first group must be a number, second group must be a unit e.g. &#39;2MS&#39;</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-115"><a href="#TimeSeries.split_amount_and_unit_from_freq-115"><span class="linenos">115</span></a>            <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-116"><a href="#TimeSeries.split_amount_and_unit_from_freq-116"><span class="linenos">116</span></a>            <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-117"><a href="#TimeSeries.split_amount_and_unit_from_freq-117"><span class="linenos">117</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-118"><a href="#TimeSeries.split_amount_and_unit_from_freq-118"><span class="linenos">118</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_string_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-119"><a href="#TimeSeries.split_amount_and_unit_from_freq-119"><span class="linenos">119</span></a>            <span class="c1"># in that case, there is no number but first character might be a sign. e.g.  or &#39;MS&#39; or &#39;-D&#39;</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-120"><a href="#TimeSeries.split_amount_and_unit_from_freq-120"><span class="linenos">120</span></a>            <span class="k">if</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-121"><a href="#TimeSeries.split_amount_and_unit_from_freq-121"><span class="linenos">121</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-122"><a href="#TimeSeries.split_amount_and_unit_from_freq-122"><span class="linenos">122</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-123"><a href="#TimeSeries.split_amount_and_unit_from_freq-123"><span class="linenos">123</span></a>            <span class="k">elif</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-124"><a href="#TimeSeries.split_amount_and_unit_from_freq-124"><span class="linenos">124</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-125"><a href="#TimeSeries.split_amount_and_unit_from_freq-125"><span class="linenos">125</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-126"><a href="#TimeSeries.split_amount_and_unit_from_freq-126"><span class="linenos">126</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-127"><a href="#TimeSeries.split_amount_and_unit_from_freq-127"><span class="linenos">127</span></a>                <span class="n">numeric_part_int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-128"><a href="#TimeSeries.split_amount_and_unit_from_freq-128"><span class="linenos">128</span></a>                <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">freq_string_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-129"><a href="#TimeSeries.split_amount_and_unit_from_freq-129"><span class="linenos">129</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-130"><a href="#TimeSeries.split_amount_and_unit_from_freq-130"><span class="linenos">130</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-131"><a href="#TimeSeries.split_amount_and_unit_from_freq-131"><span class="linenos">131</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;freq </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> is not valid&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-132"><a href="#TimeSeries.split_amount_and_unit_from_freq-132"><span class="linenos">132</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-133"><a href="#TimeSeries.split_amount_and_unit_from_freq-133"><span class="linenos">133</span></a>        <span class="c1"># simple check</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-134"><a href="#TimeSeries.split_amount_and_unit_from_freq-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="n">freq_unit_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_SECONDS</span><span class="p">:</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-135"><a href="#TimeSeries.split_amount_and_unit_from_freq-135"><span class="linenos">135</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-136"><a href="#TimeSeries.split_amount_and_unit_from_freq-136"><span class="linenos">136</span></a>                <span class="sa">f</span><span class="s2">&quot;Unknown frequency unit </span><span class="si">{</span><span class="n">freq_unit_str</span><span class="si">}</span><span class="s2"> obtained from frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-137"><a href="#TimeSeries.split_amount_and_unit_from_freq-137"><span class="linenos">137</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-138"><a href="#TimeSeries.split_amount_and_unit_from_freq-138"><span class="linenos">138</span></a>
</span><span id="TimeSeries.split_amount_and_unit_from_freq-139"><a href="#TimeSeries.split_amount_and_unit_from_freq-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span>
</span></pre></div>


            <div class="docstring"><p>Given a frequency as a string, such as '1D', '10min', '-3MS'
extract the amount (e.g. 1, 10, -3) and the unit part (e.g. 'D', 'min', 'MS'), capitalized.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>freq</strong>:  the frequency</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>the unit part of that frequency, and the number of units</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.is_regular_freq" class="classattr">
                                        <input id="TimeSeries.is_regular_freq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">is_regular_freq</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">freq</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.is_regular_freq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.is_regular_freq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.is_regular_freq-141"><a href="#TimeSeries.is_regular_freq-141"><span class="linenos">141</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.is_regular_freq-142"><a href="#TimeSeries.is_regular_freq-142"><span class="linenos">142</span></a>    <span class="k">def</span> <span class="nf">is_regular_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TimeSeries.is_regular_freq-143"><a href="#TimeSeries.is_regular_freq-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.is_regular_freq-144"><a href="#TimeSeries.is_regular_freq-144"><span class="linenos">144</span></a><span class="sd">        Return a boolean that indicates the frequency is something regular or not</span>
</span><span id="TimeSeries.is_regular_freq-145"><a href="#TimeSeries.is_regular_freq-145"><span class="linenos">145</span></a><span class="sd">        eg &#39;D&#39; &#39;min&#39; are regular, &#39;MS&#39;, &#39;Y&#39;, &#39;Q&#39; are not.</span>
</span><span id="TimeSeries.is_regular_freq-146"><a href="#TimeSeries.is_regular_freq-146"><span class="linenos">146</span></a><span class="sd">        For instance, irregular frequencies cannot be turned to pd.Timedelta elements.</span>
</span><span id="TimeSeries.is_regular_freq-147"><a href="#TimeSeries.is_regular_freq-147"><span class="linenos">147</span></a><span class="sd">        Note that if the frequency is a pd.Timedelta, it is always regular</span>
</span><span id="TimeSeries.is_regular_freq-148"><a href="#TimeSeries.is_regular_freq-148"><span class="linenos">148</span></a><span class="sd">        :param freq: the frequency given as a string or a pd.Timedelta</span>
</span><span id="TimeSeries.is_regular_freq-149"><a href="#TimeSeries.is_regular_freq-149"><span class="linenos">149</span></a><span class="sd">        :return: a boolean that indicates whether the considered frequency is &#39;even&#39;</span>
</span><span id="TimeSeries.is_regular_freq-150"><a href="#TimeSeries.is_regular_freq-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.is_regular_freq-151"><a href="#TimeSeries.is_regular_freq-151"><span class="linenos">151</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</span><span id="TimeSeries.is_regular_freq-152"><a href="#TimeSeries.is_regular_freq-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">freq_unit_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.is_regular_freq-153"><a href="#TimeSeries.is_regular_freq-153"><span class="linenos">153</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TimeSeries.is_regular_freq-154"><a href="#TimeSeries.is_regular_freq-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Return a boolean that indicates the frequency is something regular or not
eg 'D' 'min' are regular, 'MS', 'Y', 'Q' are not.
For instance, irregular frequencies cannot be turned to pd.Timedelta elements.
Note that if the frequency is a pd.Timedelta, it is always regular</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>freq</strong>:  the frequency given as a string or a pd.Timedelta</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a boolean that indicates whether the considered frequency is 'even'</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.freq_as_approximate_nb_days" class="classattr">
                                        <input id="TimeSeries.freq_as_approximate_nb_days-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">freq_as_approximate_nb_days</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.freq_as_approximate_nb_days-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.freq_as_approximate_nb_days"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.freq_as_approximate_nb_days-156"><a href="#TimeSeries.freq_as_approximate_nb_days-156"><span class="linenos">156</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-157"><a href="#TimeSeries.freq_as_approximate_nb_days-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">freq_as_approximate_nb_days</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-158"><a href="#TimeSeries.freq_as_approximate_nb_days-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-159"><a href="#TimeSeries.freq_as_approximate_nb_days-159"><span class="linenos">159</span></a><span class="sd">        Map pandas freq string to an approximate length of days.</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-160"><a href="#TimeSeries.freq_as_approximate_nb_days-160"><span class="linenos">160</span></a><span class="sd">        This serves to compare freq strings, such as &#39;1D&#39;, &#39;3MS&#39;, and so on.</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-161"><a href="#TimeSeries.freq_as_approximate_nb_days-161"><span class="linenos">161</span></a><span class="sd">        It replaces the calls to total_seconds() possibly used only with pd.Timedelta().</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-162"><a href="#TimeSeries.freq_as_approximate_nb_days-162"><span class="linenos">162</span></a><span class="sd">        Note that the computation is exact if a pd.Timedelta is given.</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-163"><a href="#TimeSeries.freq_as_approximate_nb_days-163"><span class="linenos">163</span></a><span class="sd">        :param freq: the frequency as a string, such as &#39;10min&#39;, &#39;3MS&#39;, or a pd.Timedelta.</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-164"><a href="#TimeSeries.freq_as_approximate_nb_days-164"><span class="linenos">164</span></a><span class="sd">        :return: a sometimes approximate length of the provided frequency in days</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-165"><a href="#TimeSeries.freq_as_approximate_nb_days-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-166"><a href="#TimeSeries.freq_as_approximate_nb_days-166"><span class="linenos">166</span></a>
</span><span id="TimeSeries.freq_as_approximate_nb_days-167"><a href="#TimeSeries.freq_as_approximate_nb_days-167"><span class="linenos">167</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-168"><a href="#TimeSeries.freq_as_approximate_nb_days-168"><span class="linenos">168</span></a>        <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-169"><a href="#TimeSeries.freq_as_approximate_nb_days-169"><span class="linenos">169</span></a>            <span class="n">freq</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-170"><a href="#TimeSeries.freq_as_approximate_nb_days-170"><span class="linenos">170</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-171"><a href="#TimeSeries.freq_as_approximate_nb_days-171"><span class="linenos">171</span></a>
</span><span id="TimeSeries.freq_as_approximate_nb_days-172"><a href="#TimeSeries.freq_as_approximate_nb_days-172"><span class="linenos">172</span></a>        <span class="c1"># error if is not in FREQ_UNIT_TO_DAYS</span>
</span><span id="TimeSeries.freq_as_approximate_nb_days-173"><a href="#TimeSeries.freq_as_approximate_nb_days-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_DAYS</span><span class="p">[</span><span class="n">freq_unit_str</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Map pandas freq string to an approximate length of days.
This serves to compare freq strings, such as '1D', '3MS', and so on.
It replaces the calls to total_seconds() possibly used only with pd.Timedelta().
Note that the computation is exact if a pd.Timedelta is given.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>freq</strong>:  the frequency as a string, such as '10min', '3MS', or a pd.Timedelta.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a sometimes approximate length of the provided frequency in days</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.freq_as_approximate_nb_seconds" class="classattr">
                                        <input id="TimeSeries.freq_as_approximate_nb_seconds-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">freq_as_approximate_nb_seconds</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.freq_as_approximate_nb_seconds-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.freq_as_approximate_nb_seconds"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.freq_as_approximate_nb_seconds-175"><a href="#TimeSeries.freq_as_approximate_nb_seconds-175"><span class="linenos">175</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-176"><a href="#TimeSeries.freq_as_approximate_nb_seconds-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">freq_as_approximate_nb_seconds</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-177"><a href="#TimeSeries.freq_as_approximate_nb_seconds-177"><span class="linenos">177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-178"><a href="#TimeSeries.freq_as_approximate_nb_seconds-178"><span class="linenos">178</span></a><span class="sd">        Map pandas freq string to an approximate number of seconds.</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-179"><a href="#TimeSeries.freq_as_approximate_nb_seconds-179"><span class="linenos">179</span></a><span class="sd">        This serves to compare freq strings, such as &#39;1D&#39;, &#39;3MS&#39;, and so on.</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-180"><a href="#TimeSeries.freq_as_approximate_nb_seconds-180"><span class="linenos">180</span></a><span class="sd">        It replaces the calls to total_seconds() possibly used only with pd.Timedelta().</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-181"><a href="#TimeSeries.freq_as_approximate_nb_seconds-181"><span class="linenos">181</span></a><span class="sd">        Note that the computation is exact if a pd.Timedelta is given.</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-182"><a href="#TimeSeries.freq_as_approximate_nb_seconds-182"><span class="linenos">182</span></a><span class="sd">        :param freq: the frequency as a string, such as &#39;10min&#39;, &#39;3MS&#39;, or a pd.Timedelta.</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-183"><a href="#TimeSeries.freq_as_approximate_nb_seconds-183"><span class="linenos">183</span></a><span class="sd">        :return: a sometimes approximate length of the provided frequency in days</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-184"><a href="#TimeSeries.freq_as_approximate_nb_seconds-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-185"><a href="#TimeSeries.freq_as_approximate_nb_seconds-185"><span class="linenos">185</span></a>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-186"><a href="#TimeSeries.freq_as_approximate_nb_seconds-186"><span class="linenos">186</span></a>        <span class="c1"># separate the freq string in numeric and alphabetic parts</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-187"><a href="#TimeSeries.freq_as_approximate_nb_seconds-187"><span class="linenos">187</span></a>        <span class="n">numeric_part_int</span><span class="p">,</span> <span class="n">freq_unit_str</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-188"><a href="#TimeSeries.freq_as_approximate_nb_seconds-188"><span class="linenos">188</span></a>            <span class="n">freq</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-189"><a href="#TimeSeries.freq_as_approximate_nb_seconds-189"><span class="linenos">189</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-190"><a href="#TimeSeries.freq_as_approximate_nb_seconds-190"><span class="linenos">190</span></a>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-191"><a href="#TimeSeries.freq_as_approximate_nb_seconds-191"><span class="linenos">191</span></a>        <span class="c1"># error if is not in FREQ_UNIT_TO_SECONDS</span>
</span><span id="TimeSeries.freq_as_approximate_nb_seconds-192"><a href="#TimeSeries.freq_as_approximate_nb_seconds-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">numeric_part_int</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">FREQ_UNIT_TO_SECONDS</span><span class="p">[</span><span class="n">freq_unit_str</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Map pandas freq string to an approximate number of seconds.
This serves to compare freq strings, such as '1D', '3MS', and so on.
It replaces the calls to total_seconds() possibly used only with pd.Timedelta().
Note that the computation is exact if a pd.Timedelta is given.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>freq</strong>:  the frequency as a string, such as '10min', '3MS', or a pd.Timedelta.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a sometimes approximate length of the provided frequency in days</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.add_timedelta" class="classattr">
                                        <input id="TimeSeries.add_timedelta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">add_timedelta</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">date</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]</span>,</span><span class="param">	<span class="n">timedelta</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.add_timedelta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.add_timedelta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.add_timedelta-194"><a href="#TimeSeries.add_timedelta-194"><span class="linenos">194</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.add_timedelta-195"><a href="#TimeSeries.add_timedelta-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">add_timedelta</span><span class="p">(</span>
</span><span id="TimeSeries.add_timedelta-196"><a href="#TimeSeries.add_timedelta-196"><span class="linenos">196</span></a>        <span class="n">date</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">],</span>
</span><span id="TimeSeries.add_timedelta-197"><a href="#TimeSeries.add_timedelta-197"><span class="linenos">197</span></a>        <span class="n">timedelta</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries.add_timedelta-198"><a href="#TimeSeries.add_timedelta-198"><span class="linenos">198</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]:</span>
</span><span id="TimeSeries.add_timedelta-199"><a href="#TimeSeries.add_timedelta-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.add_timedelta-200"><a href="#TimeSeries.add_timedelta-200"><span class="linenos">200</span></a><span class="sd">        Define how to add a timedelta according to the way it&#39;s provided (string, timedelta), regular or irregular</span>
</span><span id="TimeSeries.add_timedelta-201"><a href="#TimeSeries.add_timedelta-201"><span class="linenos">201</span></a><span class="sd">        absolute length.</span>
</span><span id="TimeSeries.add_timedelta-202"><a href="#TimeSeries.add_timedelta-202"><span class="linenos">202</span></a><span class="sd">        :param date: a date, provided as a pd.Timestamp (naive or tz-aware), a date, a datetime</span>
</span><span id="TimeSeries.add_timedelta-203"><a href="#TimeSeries.add_timedelta-203"><span class="linenos">203</span></a><span class="sd">        :param timedelta:  a timedelta, given as a freq string (e.g. &#39;2MS&#39;) or a pd.Timedelta object.</span>
</span><span id="TimeSeries.add_timedelta-204"><a href="#TimeSeries.add_timedelta-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.add_timedelta-205"><a href="#TimeSeries.add_timedelta-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="TimeSeries.add_timedelta-206"><a href="#TimeSeries.add_timedelta-206"><span class="linenos">206</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;timedelta must be of type Timedelta or string &quot;</span><span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-207"><a href="#TimeSeries.add_timedelta-207"><span class="linenos">207</span></a>
</span><span id="TimeSeries.add_timedelta-208"><a href="#TimeSeries.add_timedelta-208"><span class="linenos">208</span></a>        <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">timedelta</span>
</span><span id="TimeSeries.add_timedelta-209"><a href="#TimeSeries.add_timedelta-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="TimeSeries.add_timedelta-210"><a href="#TimeSeries.add_timedelta-210"><span class="linenos">210</span></a>            <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="TimeSeries.add_timedelta-211"><a href="#TimeSeries.add_timedelta-211"><span class="linenos">211</span></a>
</span><span id="TimeSeries.add_timedelta-212"><a href="#TimeSeries.add_timedelta-212"><span class="linenos">212</span></a>        <span class="c1"># if it&#39;s a string, it is not necessarily convertible to timedelta, as</span>
</span><span id="TimeSeries.add_timedelta-213"><a href="#TimeSeries.add_timedelta-213"><span class="linenos">213</span></a>        <span class="c1"># it might be an irregular length (month, year, quarter...)</span>
</span><span id="TimeSeries.add_timedelta-214"><a href="#TimeSeries.add_timedelta-214"><span class="linenos">214</span></a>        <span class="c1"># in that case, we handle these cases before defaulting to pd.to_timedelta()</span>
</span><span id="TimeSeries.add_timedelta-215"><a href="#TimeSeries.add_timedelta-215"><span class="linenos">215</span></a>        <span class="p">(</span>
</span><span id="TimeSeries.add_timedelta-216"><a href="#TimeSeries.add_timedelta-216"><span class="linenos">216</span></a>            <span class="n">numeric_part_int</span><span class="p">,</span>
</span><span id="TimeSeries.add_timedelta-217"><a href="#TimeSeries.add_timedelta-217"><span class="linenos">217</span></a>            <span class="n">unit_freq_str</span><span class="p">,</span>
</span><span id="TimeSeries.add_timedelta-218"><a href="#TimeSeries.add_timedelta-218"><span class="linenos">218</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">timedelta_str</span><span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-219"><a href="#TimeSeries.add_timedelta-219"><span class="linenos">219</span></a>
</span><span id="TimeSeries.add_timedelta-220"><a href="#TimeSeries.add_timedelta-220"><span class="linenos">220</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.add_timedelta-221"><a href="#TimeSeries.add_timedelta-221"><span class="linenos">221</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries.add_timedelta-222"><a href="#TimeSeries.add_timedelta-222"><span class="linenos">222</span></a>                    <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-223"><a href="#TimeSeries.add_timedelta-223"><span class="linenos">223</span></a>                <span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-224"><a href="#TimeSeries.add_timedelta-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]:</span>
</span><span id="TimeSeries.add_timedelta-225"><a href="#TimeSeries.add_timedelta-225"><span class="linenos">225</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries.add_timedelta-226"><a href="#TimeSeries.add_timedelta-226"><span class="linenos">226</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-227"><a href="#TimeSeries.add_timedelta-227"><span class="linenos">227</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-228"><a href="#TimeSeries.add_timedelta-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.add_timedelta-229"><a href="#TimeSeries.add_timedelta-229"><span class="linenos">229</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries.add_timedelta-230"><a href="#TimeSeries.add_timedelta-230"><span class="linenos">230</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-231"><a href="#TimeSeries.add_timedelta-231"><span class="linenos">231</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-232"><a href="#TimeSeries.add_timedelta-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.add_timedelta-233"><a href="#TimeSeries.add_timedelta-233"><span class="linenos">233</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries.add_timedelta-234"><a href="#TimeSeries.add_timedelta-234"><span class="linenos">234</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-235"><a href="#TimeSeries.add_timedelta-235"><span class="linenos">235</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-236"><a href="#TimeSeries.add_timedelta-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.add_timedelta-237"><a href="#TimeSeries.add_timedelta-237"><span class="linenos">237</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries.add_timedelta-238"><a href="#TimeSeries.add_timedelta-238"><span class="linenos">238</span></a>                <span class="s2">&quot;Cannot simply add a quarter, it does not mean anything in general&quot;</span>
</span><span id="TimeSeries.add_timedelta-239"><a href="#TimeSeries.add_timedelta-239"><span class="linenos">239</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.add_timedelta-240"><a href="#TimeSeries.add_timedelta-240"><span class="linenos">240</span></a>
</span><span id="TimeSeries.add_timedelta-241"><a href="#TimeSeries.add_timedelta-241"><span class="linenos">241</span></a>        <span class="c1"># there, it should be convertible to pd.Timedelta with no ambiguous interpretation</span>
</span><span id="TimeSeries.add_timedelta-242"><a href="#TimeSeries.add_timedelta-242"><span class="linenos">242</span></a>        <span class="c1"># because we&#39;re under the day scale (no DST issue)</span>
</span><span id="TimeSeries.add_timedelta-243"><a href="#TimeSeries.add_timedelta-243"><span class="linenos">243</span></a>        <span class="n">timedelta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numeric_part_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit_freq_str</span>
</span><span id="TimeSeries.add_timedelta-244"><a href="#TimeSeries.add_timedelta-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Define how to add a timedelta according to the way it's provided (string, timedelta), regular or irregular
absolute length.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>date</strong>:  a date, provided as a pd.Timestamp (naive or tz-aware), a date, a datetime</li>
<li><strong>timedelta</strong>:   a timedelta, given as a freq string (e.g. '2MS') or a pd.Timedelta object.</li>
</ul>
</div>


                            </div>
                            <div id="TimeSeries.subtract_timedelta" class="classattr">
                                        <input id="TimeSeries.subtract_timedelta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">subtract_timedelta</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">date</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]</span>,</span><span class="param">	<span class="n">timedelta</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.subtract_timedelta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.subtract_timedelta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.subtract_timedelta-246"><a href="#TimeSeries.subtract_timedelta-246"><span class="linenos">246</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.subtract_timedelta-247"><a href="#TimeSeries.subtract_timedelta-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">subtract_timedelta</span><span class="p">(</span>
</span><span id="TimeSeries.subtract_timedelta-248"><a href="#TimeSeries.subtract_timedelta-248"><span class="linenos">248</span></a>        <span class="n">date</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">],</span>
</span><span id="TimeSeries.subtract_timedelta-249"><a href="#TimeSeries.subtract_timedelta-249"><span class="linenos">249</span></a>        <span class="n">timedelta</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries.subtract_timedelta-250"><a href="#TimeSeries.subtract_timedelta-250"><span class="linenos">250</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">]:</span>
</span><span id="TimeSeries.subtract_timedelta-251"><a href="#TimeSeries.subtract_timedelta-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.subtract_timedelta-252"><a href="#TimeSeries.subtract_timedelta-252"><span class="linenos">252</span></a><span class="sd">        Define how to subtract a timedelta according to the way it&#39;s provided (string, timedelta), regular or irregular</span>
</span><span id="TimeSeries.subtract_timedelta-253"><a href="#TimeSeries.subtract_timedelta-253"><span class="linenos">253</span></a><span class="sd">        absolute length.</span>
</span><span id="TimeSeries.subtract_timedelta-254"><a href="#TimeSeries.subtract_timedelta-254"><span class="linenos">254</span></a><span class="sd">        :param date: a date, provided as a pd.Timestamp (naive or tz-aware), a date, a datetime</span>
</span><span id="TimeSeries.subtract_timedelta-255"><a href="#TimeSeries.subtract_timedelta-255"><span class="linenos">255</span></a><span class="sd">        :param timedelta: a timedelta, given as a freq string (e.g. &#39;2MS&#39;) or a pd.Timedelta object.</span>
</span><span id="TimeSeries.subtract_timedelta-256"><a href="#TimeSeries.subtract_timedelta-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.subtract_timedelta-257"><a href="#TimeSeries.subtract_timedelta-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="TimeSeries.subtract_timedelta-258"><a href="#TimeSeries.subtract_timedelta-258"><span class="linenos">258</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;timedelta must be of type Timedelta or string &quot;</span><span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-259"><a href="#TimeSeries.subtract_timedelta-259"><span class="linenos">259</span></a>
</span><span id="TimeSeries.subtract_timedelta-260"><a href="#TimeSeries.subtract_timedelta-260"><span class="linenos">260</span></a>        <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">timedelta</span>
</span><span id="TimeSeries.subtract_timedelta-261"><a href="#TimeSeries.subtract_timedelta-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">):</span>
</span><span id="TimeSeries.subtract_timedelta-262"><a href="#TimeSeries.subtract_timedelta-262"><span class="linenos">262</span></a>            <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="TimeSeries.subtract_timedelta-263"><a href="#TimeSeries.subtract_timedelta-263"><span class="linenos">263</span></a>
</span><span id="TimeSeries.subtract_timedelta-264"><a href="#TimeSeries.subtract_timedelta-264"><span class="linenos">264</span></a>        <span class="c1"># if it&#39;s a string, it is not necessarily convertible to timedelta, as</span>
</span><span id="TimeSeries.subtract_timedelta-265"><a href="#TimeSeries.subtract_timedelta-265"><span class="linenos">265</span></a>        <span class="c1"># it might be an irregular length (month, year, quarter...)</span>
</span><span id="TimeSeries.subtract_timedelta-266"><a href="#TimeSeries.subtract_timedelta-266"><span class="linenos">266</span></a>        <span class="c1"># in that case, we handle these cases before defaulting to pd.to_timedelta()</span>
</span><span id="TimeSeries.subtract_timedelta-267"><a href="#TimeSeries.subtract_timedelta-267"><span class="linenos">267</span></a>        <span class="p">(</span>
</span><span id="TimeSeries.subtract_timedelta-268"><a href="#TimeSeries.subtract_timedelta-268"><span class="linenos">268</span></a>            <span class="n">numeric_part_int</span><span class="p">,</span>
</span><span id="TimeSeries.subtract_timedelta-269"><a href="#TimeSeries.subtract_timedelta-269"><span class="linenos">269</span></a>            <span class="n">unit_freq_str</span><span class="p">,</span>
</span><span id="TimeSeries.subtract_timedelta-270"><a href="#TimeSeries.subtract_timedelta-270"><span class="linenos">270</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">split_amount_and_unit_from_freq</span><span class="p">(</span><span class="n">timedelta_str</span><span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-271"><a href="#TimeSeries.subtract_timedelta-271"><span class="linenos">271</span></a>
</span><span id="TimeSeries.subtract_timedelta-272"><a href="#TimeSeries.subtract_timedelta-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.subtract_timedelta-273"><a href="#TimeSeries.subtract_timedelta-273"><span class="linenos">273</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries.subtract_timedelta-274"><a href="#TimeSeries.subtract_timedelta-274"><span class="linenos">274</span></a>                    <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-275"><a href="#TimeSeries.subtract_timedelta-275"><span class="linenos">275</span></a>                <span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-276"><a href="#TimeSeries.subtract_timedelta-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]:</span>
</span><span id="TimeSeries.subtract_timedelta-277"><a href="#TimeSeries.subtract_timedelta-277"><span class="linenos">277</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries.subtract_timedelta-278"><a href="#TimeSeries.subtract_timedelta-278"><span class="linenos">278</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-279"><a href="#TimeSeries.subtract_timedelta-279"><span class="linenos">279</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-280"><a href="#TimeSeries.subtract_timedelta-280"><span class="linenos">280</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.subtract_timedelta-281"><a href="#TimeSeries.subtract_timedelta-281"><span class="linenos">281</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries.subtract_timedelta-282"><a href="#TimeSeries.subtract_timedelta-282"><span class="linenos">282</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-283"><a href="#TimeSeries.subtract_timedelta-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-284"><a href="#TimeSeries.subtract_timedelta-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.subtract_timedelta-285"><a href="#TimeSeries.subtract_timedelta-285"><span class="linenos">285</span></a>            <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">add_interval_to_date_object</span><span class="p">(</span>
</span><span id="TimeSeries.subtract_timedelta-286"><a href="#TimeSeries.subtract_timedelta-286"><span class="linenos">286</span></a>                <span class="n">date</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=-</span><span class="n">numeric_part_int</span><span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-287"><a href="#TimeSeries.subtract_timedelta-287"><span class="linenos">287</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-288"><a href="#TimeSeries.subtract_timedelta-288"><span class="linenos">288</span></a>        <span class="k">if</span> <span class="n">unit_freq_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]:</span>
</span><span id="TimeSeries.subtract_timedelta-289"><a href="#TimeSeries.subtract_timedelta-289"><span class="linenos">289</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries.subtract_timedelta-290"><a href="#TimeSeries.subtract_timedelta-290"><span class="linenos">290</span></a>                <span class="s2">&quot;Cannot simply subtract a quarter, it does not mean anything in general&quot;</span>
</span><span id="TimeSeries.subtract_timedelta-291"><a href="#TimeSeries.subtract_timedelta-291"><span class="linenos">291</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.subtract_timedelta-292"><a href="#TimeSeries.subtract_timedelta-292"><span class="linenos">292</span></a>
</span><span id="TimeSeries.subtract_timedelta-293"><a href="#TimeSeries.subtract_timedelta-293"><span class="linenos">293</span></a>        <span class="c1"># there, it should be convertible to pd.Timedelta with no ambiguous interpretation</span>
</span><span id="TimeSeries.subtract_timedelta-294"><a href="#TimeSeries.subtract_timedelta-294"><span class="linenos">294</span></a>        <span class="c1"># because we&#39;re under the day scale (no DST issue)</span>
</span><span id="TimeSeries.subtract_timedelta-295"><a href="#TimeSeries.subtract_timedelta-295"><span class="linenos">295</span></a>        <span class="n">timedelta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numeric_part_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit_freq_str</span>
</span><span id="TimeSeries.subtract_timedelta-296"><a href="#TimeSeries.subtract_timedelta-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="n">date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Define how to subtract a timedelta according to the way it's provided (string, timedelta), regular or irregular
absolute length.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>date</strong>:  a date, provided as a pd.Timestamp (naive or tz-aware), a date, a datetime</li>
<li><strong>timedelta</strong>:  a timedelta, given as a freq string (e.g. '2MS') or a pd.Timedelta object.</li>
</ul>
</div>


                            </div>
                            <div id="TimeSeries.has_nan_or_empty" class="classattr">
                                        <input id="TimeSeries.has_nan_or_empty-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=False)</div>

        <span class="def">def</span>
        <span class="name">has_nan_or_empty</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.has_nan_or_empty-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.has_nan_or_empty"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.has_nan_or_empty-302"><a href="#TimeSeries.has_nan_or_empty-302"><span class="linenos">302</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.has_nan_or_empty-303"><a href="#TimeSeries.has_nan_or_empty-303"><span class="linenos">303</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.has_nan_or_empty-304"><a href="#TimeSeries.has_nan_or_empty-304"><span class="linenos">304</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.has_nan_or_empty-305"><a href="#TimeSeries.has_nan_or_empty-305"><span class="linenos">305</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.has_nan_or_empty-306"><a href="#TimeSeries.has_nan_or_empty-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TimeSeries.has_nan_or_empty-307"><a href="#TimeSeries.has_nan_or_empty-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.has_nan_or_empty-308"><a href="#TimeSeries.has_nan_or_empty-308"><span class="linenos">308</span></a><span class="sd">        Check whether a datetime index has NaN or is empty</span>
</span><span id="TimeSeries.has_nan_or_empty-309"><a href="#TimeSeries.has_nan_or_empty-309"><span class="linenos">309</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries.has_nan_or_empty-310"><a href="#TimeSeries.has_nan_or_empty-310"><span class="linenos">310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.has_nan_or_empty-311"><a href="#TimeSeries.has_nan_or_empty-311"><span class="linenos">311</span></a>
</span><span id="TimeSeries.has_nan_or_empty-312"><a href="#TimeSeries.has_nan_or_empty-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="TimeSeries.has_nan_or_empty-313"><a href="#TimeSeries.has_nan_or_empty-313"><span class="linenos">313</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;parameter &#39;dti&#39; should be a pandas.DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.has_nan_or_empty-314"><a href="#TimeSeries.has_nan_or_empty-314"><span class="linenos">314</span></a>
</span><span id="TimeSeries.has_nan_or_empty-315"><a href="#TimeSeries.has_nan_or_empty-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries.has_nan_or_empty-316"><a href="#TimeSeries.has_nan_or_empty-316"><span class="linenos">316</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TimeSeries.has_nan_or_empty-317"><a href="#TimeSeries.has_nan_or_empty-317"><span class="linenos">317</span></a>
</span><span id="TimeSeries.has_nan_or_empty-318"><a href="#TimeSeries.has_nan_or_empty-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries.has_nan_or_empty-319"><a href="#TimeSeries.has_nan_or_empty-319"><span class="linenos">319</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TimeSeries.has_nan_or_empty-320"><a href="#TimeSeries.has_nan_or_empty-320"><span class="linenos">320</span></a>
</span><span id="TimeSeries.has_nan_or_empty-321"><a href="#TimeSeries.has_nan_or_empty-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check whether a datetime index has NaN or is empty</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  pd.DatetimeIndex to investigate</li>
</ul>
</div>


                            </div>
                            <div id="TimeSeries.find_nb_records" class="classattr">
                                        <input id="TimeSeries.find_nb_records-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=False)</div>

        <span class="def">def</span>
        <span class="name">find_nb_records</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	<span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.find_nb_records-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_nb_records"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_nb_records-323"><a href="#TimeSeries.find_nb_records-323"><span class="linenos">323</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.find_nb_records-324"><a href="#TimeSeries.find_nb_records-324"><span class="linenos">324</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.find_nb_records-325"><a href="#TimeSeries.find_nb_records-325"><span class="linenos">325</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.find_nb_records-326"><a href="#TimeSeries.find_nb_records-326"><span class="linenos">326</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.find_nb_records-327"><a href="#TimeSeries.find_nb_records-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">find_nb_records</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TimeSeries.find_nb_records-328"><a href="#TimeSeries.find_nb_records-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_nb_records-329"><a href="#TimeSeries.find_nb_records-329"><span class="linenos">329</span></a><span class="sd">        Compute the number of records</span>
</span><span id="TimeSeries.find_nb_records-330"><a href="#TimeSeries.find_nb_records-330"><span class="linenos">330</span></a><span class="sd">         :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries.find_nb_records-331"><a href="#TimeSeries.find_nb_records-331"><span class="linenos">331</span></a><span class="sd">        :param skip_duplicate_timestamps: bool that indicates if duplicates must be considered</span>
</span><span id="TimeSeries.find_nb_records-332"><a href="#TimeSeries.find_nb_records-332"><span class="linenos">332</span></a><span class="sd">               or not when computing the number of records</span>
</span><span id="TimeSeries.find_nb_records-333"><a href="#TimeSeries.find_nb_records-333"><span class="linenos">333</span></a><span class="sd">        :return: the number of records in the time series</span>
</span><span id="TimeSeries.find_nb_records-334"><a href="#TimeSeries.find_nb_records-334"><span class="linenos">334</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_nb_records-335"><a href="#TimeSeries.find_nb_records-335"><span class="linenos">335</span></a>
</span><span id="TimeSeries.find_nb_records-336"><a href="#TimeSeries.find_nb_records-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="TimeSeries.find_nb_records-337"><a href="#TimeSeries.find_nb_records-337"><span class="linenos">337</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="TimeSeries.find_nb_records-338"><a href="#TimeSeries.find_nb_records-338"><span class="linenos">338</span></a>
</span><span id="TimeSeries.find_nb_records-339"><a href="#TimeSeries.find_nb_records-339"><span class="linenos">339</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the number of records
 :param dti: pd.DatetimeIndex to investigate</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>skip_duplicate_timestamps</strong>:  bool that indicates if duplicates must be considered
or not when computing the number of records</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>the number of records in the time series</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.find_gap_distribution" class="classattr">
                                        <input id="TimeSeries.find_gap_distribution-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=False)</div>

        <span class="def">def</span>
        <span class="name">find_gap_distribution</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	<span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.find_gap_distribution-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_gap_distribution"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_gap_distribution-341"><a href="#TimeSeries.find_gap_distribution-341"><span class="linenos">341</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.find_gap_distribution-342"><a href="#TimeSeries.find_gap_distribution-342"><span class="linenos">342</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.find_gap_distribution-343"><a href="#TimeSeries.find_gap_distribution-343"><span class="linenos">343</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.find_gap_distribution-344"><a href="#TimeSeries.find_gap_distribution-344"><span class="linenos">344</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.find_gap_distribution-345"><a href="#TimeSeries.find_gap_distribution-345"><span class="linenos">345</span></a>    <span class="k">def</span> <span class="nf">find_gap_distribution</span><span class="p">(</span>
</span><span id="TimeSeries.find_gap_distribution-346"><a href="#TimeSeries.find_gap_distribution-346"><span class="linenos">346</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.find_gap_distribution-347"><a href="#TimeSeries.find_gap_distribution-347"><span class="linenos">347</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
</span><span id="TimeSeries.find_gap_distribution-348"><a href="#TimeSeries.find_gap_distribution-348"><span class="linenos">348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_gap_distribution-349"><a href="#TimeSeries.find_gap_distribution-349"><span class="linenos">349</span></a><span class="sd">        Find frequencies in a pd.DatetimeIndex. The function computes</span>
</span><span id="TimeSeries.find_gap_distribution-350"><a href="#TimeSeries.find_gap_distribution-350"><span class="linenos">350</span></a><span class="sd">        all timedelta between successive indexes, and count them. It returns an ordered</span>
</span><span id="TimeSeries.find_gap_distribution-351"><a href="#TimeSeries.find_gap_distribution-351"><span class="linenos">351</span></a><span class="sd">        pd.Series, with the most commonly found in index 0.</span>
</span><span id="TimeSeries.find_gap_distribution-352"><a href="#TimeSeries.find_gap_distribution-352"><span class="linenos">352</span></a>
</span><span id="TimeSeries.find_gap_distribution-353"><a href="#TimeSeries.find_gap_distribution-353"><span class="linenos">353</span></a>
</span><span id="TimeSeries.find_gap_distribution-354"><a href="#TimeSeries.find_gap_distribution-354"><span class="linenos">354</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries.find_gap_distribution-355"><a href="#TimeSeries.find_gap_distribution-355"><span class="linenos">355</span></a><span class="sd">        :param skip_duplicate_timestamps: bool that indicates if duplicates must be considered</span>
</span><span id="TimeSeries.find_gap_distribution-356"><a href="#TimeSeries.find_gap_distribution-356"><span class="linenos">356</span></a><span class="sd">               or not when the gap distribution is considered.</span>
</span><span id="TimeSeries.find_gap_distribution-357"><a href="#TimeSeries.find_gap_distribution-357"><span class="linenos">357</span></a><span class="sd">        :return: a pd.Series with all frequencies found, and their cardinality.</span>
</span><span id="TimeSeries.find_gap_distribution-358"><a href="#TimeSeries.find_gap_distribution-358"><span class="linenos">358</span></a><span class="sd">                eg. &gt;&gt;&gt; find_frequencies(dti)</span>
</span><span id="TimeSeries.find_gap_distribution-359"><a href="#TimeSeries.find_gap_distribution-359"><span class="linenos">359</span></a><span class="sd">                #    01:00:00    1181</span>
</span><span id="TimeSeries.find_gap_distribution-360"><a href="#TimeSeries.find_gap_distribution-360"><span class="linenos">360</span></a><span class="sd">                #    02:00:00     499</span>
</span><span id="TimeSeries.find_gap_distribution-361"><a href="#TimeSeries.find_gap_distribution-361"><span class="linenos">361</span></a><span class="sd">                #    03:00:00     180</span>
</span><span id="TimeSeries.find_gap_distribution-362"><a href="#TimeSeries.find_gap_distribution-362"><span class="linenos">362</span></a><span class="sd">                #    ....</span>
</span><span id="TimeSeries.find_gap_distribution-363"><a href="#TimeSeries.find_gap_distribution-363"><span class="linenos">363</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_gap_distribution-364"><a href="#TimeSeries.find_gap_distribution-364"><span class="linenos">364</span></a>
</span><span id="TimeSeries.find_gap_distribution-365"><a href="#TimeSeries.find_gap_distribution-365"><span class="linenos">365</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="TimeSeries.find_gap_distribution-366"><a href="#TimeSeries.find_gap_distribution-366"><span class="linenos">366</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty dti&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.find_gap_distribution-367"><a href="#TimeSeries.find_gap_distribution-367"><span class="linenos">367</span></a>
</span><span id="TimeSeries.find_gap_distribution-368"><a href="#TimeSeries.find_gap_distribution-368"><span class="linenos">368</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries.find_gap_distribution-369"><a href="#TimeSeries.find_gap_distribution-369"><span class="linenos">369</span></a>
</span><span id="TimeSeries.find_gap_distribution-370"><a href="#TimeSeries.find_gap_distribution-370"><span class="linenos">370</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="TimeSeries.find_gap_distribution-371"><a href="#TimeSeries.find_gap_distribution-371"><span class="linenos">371</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="TimeSeries.find_gap_distribution-372"><a href="#TimeSeries.find_gap_distribution-372"><span class="linenos">372</span></a>
</span><span id="TimeSeries.find_gap_distribution-373"><a href="#TimeSeries.find_gap_distribution-373"><span class="linenos">373</span></a>        <span class="c1"># compute the gap distribution</span>
</span><span id="TimeSeries.find_gap_distribution-374"><a href="#TimeSeries.find_gap_distribution-374"><span class="linenos">374</span></a>        <span class="n">gap_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dti</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</span><span id="TimeSeries.find_gap_distribution-375"><a href="#TimeSeries.find_gap_distribution-375"><span class="linenos">375</span></a>
</span><span id="TimeSeries.find_gap_distribution-376"><a href="#TimeSeries.find_gap_distribution-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="n">gap_dist</span>
</span></pre></div>


            <div class="docstring"><p>Find frequencies in a pd.DatetimeIndex. The function computes
all timedelta between successive indexes, and count them. It returns an ordered
pd.Series, with the most commonly found in index 0.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  pd.DatetimeIndex to investigate</li>
<li><strong>skip_duplicate_timestamps</strong>:  bool that indicates if duplicates must be considered
or not when the gap distribution is considered.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a pd.Series with all frequencies found, and their cardinality.
          eg. &gt;&gt;&gt; find_frequencies(dti)
          #    01:00:00    1181
          #    02:00:00     499
          #    03:00:00     180
          #    ....</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.find_most_common_frequency" class="classattr">
                                        <input id="TimeSeries.find_most_common_frequency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=False)</div>

        <span class="def">def</span>
        <span class="name">find_most_common_frequency</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	<span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.find_most_common_frequency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_most_common_frequency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_most_common_frequency-378"><a href="#TimeSeries.find_most_common_frequency-378"><span class="linenos">378</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.find_most_common_frequency-379"><a href="#TimeSeries.find_most_common_frequency-379"><span class="linenos">379</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.find_most_common_frequency-380"><a href="#TimeSeries.find_most_common_frequency-380"><span class="linenos">380</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.find_most_common_frequency-381"><a href="#TimeSeries.find_most_common_frequency-381"><span class="linenos">381</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.find_most_common_frequency-382"><a href="#TimeSeries.find_most_common_frequency-382"><span class="linenos">382</span></a>    <span class="k">def</span> <span class="nf">find_most_common_frequency</span><span class="p">(</span>
</span><span id="TimeSeries.find_most_common_frequency-383"><a href="#TimeSeries.find_most_common_frequency-383"><span class="linenos">383</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.find_most_common_frequency-384"><a href="#TimeSeries.find_most_common_frequency-384"><span class="linenos">384</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="TimeSeries.find_most_common_frequency-385"><a href="#TimeSeries.find_most_common_frequency-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_most_common_frequency-386"><a href="#TimeSeries.find_most_common_frequency-386"><span class="linenos">386</span></a><span class="sd">        Find most common frequency in pd.DatetimeIndex. If several frequencies are found, it returns the most common.</span>
</span><span id="TimeSeries.find_most_common_frequency-387"><a href="#TimeSeries.find_most_common_frequency-387"><span class="linenos">387</span></a><span class="sd">        The function checks the index is not null,</span>
</span><span id="TimeSeries.find_most_common_frequency-388"><a href="#TimeSeries.find_most_common_frequency-388"><span class="linenos">388</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries.find_most_common_frequency-389"><a href="#TimeSeries.find_most_common_frequency-389"><span class="linenos">389</span></a><span class="sd">        :param skip_duplicate_timestamps: if True, the function will not consider duplicate timestamps</span>
</span><span id="TimeSeries.find_most_common_frequency-390"><a href="#TimeSeries.find_most_common_frequency-390"><span class="linenos">390</span></a><span class="sd">                                          in the calculation.</span>
</span><span id="TimeSeries.find_most_common_frequency-391"><a href="#TimeSeries.find_most_common_frequency-391"><span class="linenos">391</span></a><span class="sd">        :return : the most common frequency found in the datetime index as a string</span>
</span><span id="TimeSeries.find_most_common_frequency-392"><a href="#TimeSeries.find_most_common_frequency-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_most_common_frequency-393"><a href="#TimeSeries.find_most_common_frequency-393"><span class="linenos">393</span></a>
</span><span id="TimeSeries.find_most_common_frequency-394"><a href="#TimeSeries.find_most_common_frequency-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="TimeSeries.find_most_common_frequency-395"><a href="#TimeSeries.find_most_common_frequency-395"><span class="linenos">395</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty datetime index&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.find_most_common_frequency-396"><a href="#TimeSeries.find_most_common_frequency-396"><span class="linenos">396</span></a>
</span><span id="TimeSeries.find_most_common_frequency-397"><a href="#TimeSeries.find_most_common_frequency-397"><span class="linenos">397</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries.find_most_common_frequency-398"><a href="#TimeSeries.find_most_common_frequency-398"><span class="linenos">398</span></a>
</span><span id="TimeSeries.find_most_common_frequency-399"><a href="#TimeSeries.find_most_common_frequency-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="TimeSeries.find_most_common_frequency-400"><a href="#TimeSeries.find_most_common_frequency-400"><span class="linenos">400</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="TimeSeries.find_most_common_frequency-401"><a href="#TimeSeries.find_most_common_frequency-401"><span class="linenos">401</span></a>
</span><span id="TimeSeries.find_most_common_frequency-402"><a href="#TimeSeries.find_most_common_frequency-402"><span class="linenos">402</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TimeSeries.find_most_common_frequency-403"><a href="#TimeSeries.find_most_common_frequency-403"><span class="linenos">403</span></a>        <span class="n">nb_records</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_nb_records</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.find_most_common_frequency-404"><a href="#TimeSeries.find_most_common_frequency-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="n">nb_records</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TimeSeries.find_most_common_frequency-405"><a href="#TimeSeries.find_most_common_frequency-405"><span class="linenos">405</span></a>            <span class="c1"># we cannot get a frequency out of the series, as it&#39;s a single element series !</span>
</span><span id="TimeSeries.find_most_common_frequency-406"><a href="#TimeSeries.find_most_common_frequency-406"><span class="linenos">406</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="TimeSeries.find_most_common_frequency-407"><a href="#TimeSeries.find_most_common_frequency-407"><span class="linenos">407</span></a>
</span><span id="TimeSeries.find_most_common_frequency-408"><a href="#TimeSeries.find_most_common_frequency-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="n">nb_records</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="TimeSeries.find_most_common_frequency-409"><a href="#TimeSeries.find_most_common_frequency-409"><span class="linenos">409</span></a>            <span class="c1"># try getting single frequency from pandas if the series is big enough</span>
</span><span id="TimeSeries.find_most_common_frequency-410"><a href="#TimeSeries.find_most_common_frequency-410"><span class="linenos">410</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.find_most_common_frequency-411"><a href="#TimeSeries.find_most_common_frequency-411"><span class="linenos">411</span></a>
</span><span id="TimeSeries.find_most_common_frequency-412"><a href="#TimeSeries.find_most_common_frequency-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries.find_most_common_frequency-413"><a href="#TimeSeries.find_most_common_frequency-413"><span class="linenos">413</span></a>            <span class="c1"># it means there is some kind of irregularity in the datetimeindex, as pandas could not find it or</span>
</span><span id="TimeSeries.find_most_common_frequency-414"><a href="#TimeSeries.find_most_common_frequency-414"><span class="linenos">414</span></a>            <span class="c1"># e.g. there might be more than one frequency in the dataframe.</span>
</span><span id="TimeSeries.find_most_common_frequency-415"><a href="#TimeSeries.find_most_common_frequency-415"><span class="linenos">415</span></a>            <span class="c1"># note that there must be at least two records in the datetimeindex at that point</span>
</span><span id="TimeSeries.find_most_common_frequency-416"><a href="#TimeSeries.find_most_common_frequency-416"><span class="linenos">416</span></a>
</span><span id="TimeSeries.find_most_common_frequency-417"><a href="#TimeSeries.find_most_common_frequency-417"><span class="linenos">417</span></a>            <span class="c1"># get all gap distributions in the dataframe</span>
</span><span id="TimeSeries.find_most_common_frequency-418"><a href="#TimeSeries.find_most_common_frequency-418"><span class="linenos">418</span></a>            <span class="n">gap_distribution</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_gap_distribution</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.find_most_common_frequency-419"><a href="#TimeSeries.find_most_common_frequency-419"><span class="linenos">419</span></a>
</span><span id="TimeSeries.find_most_common_frequency-420"><a href="#TimeSeries.find_most_common_frequency-420"><span class="linenos">420</span></a>            <span class="c1"># return the more common</span>
</span><span id="TimeSeries.find_most_common_frequency-421"><a href="#TimeSeries.find_most_common_frequency-421"><span class="linenos">421</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">gap_distribution</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeSeries.find_most_common_frequency-422"><a href="#TimeSeries.find_most_common_frequency-422"><span class="linenos">422</span></a>
</span><span id="TimeSeries.find_most_common_frequency-423"><a href="#TimeSeries.find_most_common_frequency-423"><span class="linenos">423</span></a>            <span class="c1"># turn it to a string</span>
</span><span id="TimeSeries.find_most_common_frequency-424"><a href="#TimeSeries.find_most_common_frequency-424"><span class="linenos">424</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">to_offset</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">freqstr</span>
</span><span id="TimeSeries.find_most_common_frequency-425"><a href="#TimeSeries.find_most_common_frequency-425"><span class="linenos">425</span></a>
</span><span id="TimeSeries.find_most_common_frequency-426"><a href="#TimeSeries.find_most_common_frequency-426"><span class="linenos">426</span></a>        <span class="c1"># if the freq is &#39;one&#39; of a particular unit, pandas just returns the unit,</span>
</span><span id="TimeSeries.find_most_common_frequency-427"><a href="#TimeSeries.find_most_common_frequency-427"><span class="linenos">427</span></a>        <span class="c1"># This is not practical for other functions, so we add 1 to the string freq.</span>
</span><span id="TimeSeries.find_most_common_frequency-428"><a href="#TimeSeries.find_most_common_frequency-428"><span class="linenos">428</span></a>        <span class="c1"># e.g. the freq is one day, pandas may return &#39;D&#39;</span>
</span><span id="TimeSeries.find_most_common_frequency-429"><a href="#TimeSeries.find_most_common_frequency-429"><span class="linenos">429</span></a>        <span class="c1"># we transform it to &#39;1D&#39; in that case</span>
</span><span id="TimeSeries.find_most_common_frequency-430"><a href="#TimeSeries.find_most_common_frequency-430"><span class="linenos">430</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span> <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdecimal</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;1&quot;</span> <span class="o">+</span> <span class="n">freq</span>
</span><span id="TimeSeries.find_most_common_frequency-431"><a href="#TimeSeries.find_most_common_frequency-431"><span class="linenos">431</span></a>
</span><span id="TimeSeries.find_most_common_frequency-432"><a href="#TimeSeries.find_most_common_frequency-432"><span class="linenos">432</span></a>        <span class="k">return</span> <span class="n">freq</span>
</span></pre></div>


            <div class="docstring"><p>Find most common frequency in pd.DatetimeIndex. If several frequencies are found, it returns the most common.
The function checks the index is not null,</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  pd.DatetimeIndex to investigate</li>
<li><strong>skip_duplicate_timestamps</strong>:  if True, the function will not consider duplicate timestamps
in the calculation.
:return : the most common frequency found in the datetime index as a string</li>
</ul>
</div>


                            </div>
                            <div id="TimeSeries.find_duplicates" class="classattr">
                                        <input id="TimeSeries.find_duplicates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=True)</div>

        <span class="def">def</span>
        <span class="name">find_duplicates</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.find_duplicates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_duplicates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_duplicates-434"><a href="#TimeSeries.find_duplicates-434"><span class="linenos">434</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.find_duplicates-435"><a href="#TimeSeries.find_duplicates-435"><span class="linenos">435</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.find_duplicates-436"><a href="#TimeSeries.find_duplicates-436"><span class="linenos">436</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="TimeSeries.find_duplicates-437"><a href="#TimeSeries.find_duplicates-437"><span class="linenos">437</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.find_duplicates-438"><a href="#TimeSeries.find_duplicates-438"><span class="linenos">438</span></a>    <span class="k">def</span> <span class="nf">find_duplicates</span><span class="p">(</span><span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="TimeSeries.find_duplicates-439"><a href="#TimeSeries.find_duplicates-439"><span class="linenos">439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_duplicates-440"><a href="#TimeSeries.find_duplicates-440"><span class="linenos">440</span></a><span class="sd">        Check for duplicates in the timeseries</span>
</span><span id="TimeSeries.find_duplicates-441"><a href="#TimeSeries.find_duplicates-441"><span class="linenos">441</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries.find_duplicates-442"><a href="#TimeSeries.find_duplicates-442"><span class="linenos">442</span></a><span class="sd">        :return: duplicates</span>
</span><span id="TimeSeries.find_duplicates-443"><a href="#TimeSeries.find_duplicates-443"><span class="linenos">443</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_duplicates-444"><a href="#TimeSeries.find_duplicates-444"><span class="linenos">444</span></a>        <span class="k">return</span> <span class="n">dti</span><span class="p">[</span><span class="n">dti</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</span></pre></div>


            <div class="docstring"><p>Check for duplicates in the timeseries</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  a datetime index, without NaN</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>duplicates</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.find_extra_points" class="classattr">
                                        <input id="TimeSeries.find_extra_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=True)</div>

        <span class="def">def</span>
        <span class="name">find_extra_points</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	<span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.find_extra_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_extra_points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_extra_points-446"><a href="#TimeSeries.find_extra_points-446"><span class="linenos">446</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.find_extra_points-447"><a href="#TimeSeries.find_extra_points-447"><span class="linenos">447</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.find_extra_points-448"><a href="#TimeSeries.find_extra_points-448"><span class="linenos">448</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="TimeSeries.find_extra_points-449"><a href="#TimeSeries.find_extra_points-449"><span class="linenos">449</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.find_extra_points-450"><a href="#TimeSeries.find_extra_points-450"><span class="linenos">450</span></a>    <span class="k">def</span> <span class="nf">find_extra_points</span><span class="p">(</span>
</span><span id="TimeSeries.find_extra_points-451"><a href="#TimeSeries.find_extra_points-451"><span class="linenos">451</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TimeSeries.find_extra_points-452"><a href="#TimeSeries.find_extra_points-452"><span class="linenos">452</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="TimeSeries.find_extra_points-453"><a href="#TimeSeries.find_extra_points-453"><span class="linenos">453</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_extra_points-454"><a href="#TimeSeries.find_extra_points-454"><span class="linenos">454</span></a><span class="sd">        Check for extra data points in the timeseries, i.e. data points that are</span>
</span><span id="TimeSeries.find_extra_points-455"><a href="#TimeSeries.find_extra_points-455"><span class="linenos">455</span></a><span class="sd">        outside the expected frequency (or the most common frequency if not known) of data points.</span>
</span><span id="TimeSeries.find_extra_points-456"><a href="#TimeSeries.find_extra_points-456"><span class="linenos">456</span></a><span class="sd">        This is based on the min and max of the index, which means no extra point might be found</span>
</span><span id="TimeSeries.find_extra_points-457"><a href="#TimeSeries.find_extra_points-457"><span class="linenos">457</span></a><span class="sd">        if min or max are the extra points (in that case, there might be missing periods!)</span>
</span><span id="TimeSeries.find_extra_points-458"><a href="#TimeSeries.find_extra_points-458"><span class="linenos">458</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries.find_extra_points-459"><a href="#TimeSeries.find_extra_points-459"><span class="linenos">459</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="TimeSeries.find_extra_points-460"><a href="#TimeSeries.find_extra_points-460"><span class="linenos">460</span></a><span class="sd">        :return: extra data points</span>
</span><span id="TimeSeries.find_extra_points-461"><a href="#TimeSeries.find_extra_points-461"><span class="linenos">461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_extra_points-462"><a href="#TimeSeries.find_extra_points-462"><span class="linenos">462</span></a>
</span><span id="TimeSeries.find_extra_points-463"><a href="#TimeSeries.find_extra_points-463"><span class="linenos">463</span></a>        <span class="c1"># get freq if None</span>
</span><span id="TimeSeries.find_extra_points-464"><a href="#TimeSeries.find_extra_points-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_freq</span><span class="p">:</span>
</span><span id="TimeSeries.find_extra_points-465"><a href="#TimeSeries.find_extra_points-465"><span class="linenos">465</span></a>            <span class="n">expected_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span>
</span><span id="TimeSeries.find_extra_points-466"><a href="#TimeSeries.find_extra_points-466"><span class="linenos">466</span></a>                <span class="n">dti</span><span class="p">,</span> <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">True</span>
</span><span id="TimeSeries.find_extra_points-467"><a href="#TimeSeries.find_extra_points-467"><span class="linenos">467</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.find_extra_points-468"><a href="#TimeSeries.find_extra_points-468"><span class="linenos">468</span></a>
</span><span id="TimeSeries.find_extra_points-469"><a href="#TimeSeries.find_extra_points-469"><span class="linenos">469</span></a>        <span class="c1"># inspect extra periods: we must work on a sorted dti without index</span>
</span><span id="TimeSeries.find_extra_points-470"><a href="#TimeSeries.find_extra_points-470"><span class="linenos">470</span></a>        <span class="n">data_index</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries.find_extra_points-471"><a href="#TimeSeries.find_extra_points-471"><span class="linenos">471</span></a>        <span class="n">expected_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="TimeSeries.find_extra_points-472"><a href="#TimeSeries.find_extra_points-472"><span class="linenos">472</span></a>            <span class="n">data_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="n">expected_freq</span>
</span><span id="TimeSeries.find_extra_points-473"><a href="#TimeSeries.find_extra_points-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.find_extra_points-474"><a href="#TimeSeries.find_extra_points-474"><span class="linenos">474</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">data_index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">expected_index</span><span class="p">)</span>
</span><span id="TimeSeries.find_extra_points-475"><a href="#TimeSeries.find_extra_points-475"><span class="linenos">475</span></a>
</span><span id="TimeSeries.find_extra_points-476"><a href="#TimeSeries.find_extra_points-476"><span class="linenos">476</span></a>        <span class="k">return</span> <span class="n">extra_points</span>
</span></pre></div>


            <div class="docstring"><p>Check for extra data points in the timeseries, i.e. data points that are
outside the expected frequency (or the most common frequency if not known) of data points.
This is based on the min and max of the index, which means no extra point might be found
if min or max are the extra points (in that case, there might be missing periods!)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  a datetime index, without NaN</li>
<li><strong>expected_freq</strong>:  the expected freq of the datetime index if known, default None.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>extra data points</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.find_duplicates_and_extra_points" class="classattr">
                                        <input id="TimeSeries.find_duplicates_and_extra_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">find_duplicates_and_extra_points</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>,</span><span class="param">	<span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.find_duplicates_and_extra_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_duplicates_and_extra_points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_duplicates_and_extra_points-478"><a href="#TimeSeries.find_duplicates_and_extra_points-478"><span class="linenos">478</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-479"><a href="#TimeSeries.find_duplicates_and_extra_points-479"><span class="linenos">479</span></a>    <span class="k">def</span> <span class="nf">find_duplicates_and_extra_points</span><span class="p">(</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-480"><a href="#TimeSeries.find_duplicates_and_extra_points-480"><span class="linenos">480</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-481"><a href="#TimeSeries.find_duplicates_and_extra_points-481"><span class="linenos">481</span></a>        <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-482"><a href="#TimeSeries.find_duplicates_and_extra_points-482"><span class="linenos">482</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">]:</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-483"><a href="#TimeSeries.find_duplicates_and_extra_points-483"><span class="linenos">483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-484"><a href="#TimeSeries.find_duplicates_and_extra_points-484"><span class="linenos">484</span></a><span class="sd">        Check for extra data points in the timeseries, i.e. data points that are duplicated and/or data points that are</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-485"><a href="#TimeSeries.find_duplicates_and_extra_points-485"><span class="linenos">485</span></a><span class="sd">        outside the expected frequency (or the most common frequency if not known) of data points.</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-486"><a href="#TimeSeries.find_duplicates_and_extra_points-486"><span class="linenos">486</span></a><span class="sd">        :param dti: a time_series</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-487"><a href="#TimeSeries.find_duplicates_and_extra_points-487"><span class="linenos">487</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-488"><a href="#TimeSeries.find_duplicates_and_extra_points-488"><span class="linenos">488</span></a><span class="sd">        :return: extra data points</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-489"><a href="#TimeSeries.find_duplicates_and_extra_points-489"><span class="linenos">489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-490"><a href="#TimeSeries.find_duplicates_and_extra_points-490"><span class="linenos">490</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_duplicates</span><span class="p">(</span><span class="n">dti</span><span class="p">),</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-491"><a href="#TimeSeries.find_duplicates_and_extra_points-491"><span class="linenos">491</span></a>            <span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span>
</span><span id="TimeSeries.find_duplicates_and_extra_points-492"><a href="#TimeSeries.find_duplicates_and_extra_points-492"><span class="linenos">492</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check for extra data points in the timeseries, i.e. data points that are duplicated and/or data points that are
outside the expected frequency (or the most common frequency if not known) of data points.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  a time_series</li>
<li><strong>expected_freq</strong>:  the expected freq of the datetime index if known, default None.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>extra data points</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.find_missing_points" class="classattr">
                                        <input id="TimeSeries.find_missing_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=True)</div>

        <span class="def">def</span>
        <span class="name">find_missing_points</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	<span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.find_missing_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_missing_points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_missing_points-494"><a href="#TimeSeries.find_missing_points-494"><span class="linenos">494</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.find_missing_points-495"><a href="#TimeSeries.find_missing_points-495"><span class="linenos">495</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_points-496"><a href="#TimeSeries.find_missing_points-496"><span class="linenos">496</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">True</span>
</span><span id="TimeSeries.find_missing_points-497"><a href="#TimeSeries.find_missing_points-497"><span class="linenos">497</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.find_missing_points-498"><a href="#TimeSeries.find_missing_points-498"><span class="linenos">498</span></a>    <span class="k">def</span> <span class="nf">find_missing_points</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_points-499"><a href="#TimeSeries.find_missing_points-499"><span class="linenos">499</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_points-500"><a href="#TimeSeries.find_missing_points-500"><span class="linenos">500</span></a>        <span class="n">expected_freq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_points-501"><a href="#TimeSeries.find_missing_points-501"><span class="linenos">501</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_points-502"><a href="#TimeSeries.find_missing_points-502"><span class="linenos">502</span></a>        <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_points-503"><a href="#TimeSeries.find_missing_points-503"><span class="linenos">503</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_points-504"><a href="#TimeSeries.find_missing_points-504"><span class="linenos">504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_missing_points-505"><a href="#TimeSeries.find_missing_points-505"><span class="linenos">505</span></a><span class="sd">        Check for missing periods in the time series with an expected frequency.</span>
</span><span id="TimeSeries.find_missing_points-506"><a href="#TimeSeries.find_missing_points-506"><span class="linenos">506</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries.find_missing_points-507"><a href="#TimeSeries.find_missing_points-507"><span class="linenos">507</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="TimeSeries.find_missing_points-508"><a href="#TimeSeries.find_missing_points-508"><span class="linenos">508</span></a><span class="sd">        :param expected_start_datetime: the expected start time of the datetime index, default None</span>
</span><span id="TimeSeries.find_missing_points-509"><a href="#TimeSeries.find_missing_points-509"><span class="linenos">509</span></a><span class="sd">        :param expected_excl_end_datetime: the expected exclusive end time of the datetime index, default None</span>
</span><span id="TimeSeries.find_missing_points-510"><a href="#TimeSeries.find_missing_points-510"><span class="linenos">510</span></a><span class="sd">        :return: missing points as a datetime index</span>
</span><span id="TimeSeries.find_missing_points-511"><a href="#TimeSeries.find_missing_points-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_missing_points-512"><a href="#TimeSeries.find_missing_points-512"><span class="linenos">512</span></a>
</span><span id="TimeSeries.find_missing_points-513"><a href="#TimeSeries.find_missing_points-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_nan_or_empty</span><span class="p">(</span><span class="n">dti</span><span class="p">):</span>
</span><span id="TimeSeries.find_missing_points-514"><a href="#TimeSeries.find_missing_points-514"><span class="linenos">514</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nan or empty datetime index&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_points-515"><a href="#TimeSeries.find_missing_points-515"><span class="linenos">515</span></a>
</span><span id="TimeSeries.find_missing_points-516"><a href="#TimeSeries.find_missing_points-516"><span class="linenos">516</span></a>        <span class="c1"># process freq</span>
</span><span id="TimeSeries.find_missing_points-517"><a href="#TimeSeries.find_missing_points-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_freq</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_points-518"><a href="#TimeSeries.find_missing_points-518"><span class="linenos">518</span></a>            <span class="n">expected_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_points-519"><a href="#TimeSeries.find_missing_points-519"><span class="linenos">519</span></a>
</span><span id="TimeSeries.find_missing_points-520"><a href="#TimeSeries.find_missing_points-520"><span class="linenos">520</span></a>        <span class="c1"># drop duplicates and sort</span>
</span><span id="TimeSeries.find_missing_points-521"><a href="#TimeSeries.find_missing_points-521"><span class="linenos">521</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries.find_missing_points-522"><a href="#TimeSeries.find_missing_points-522"><span class="linenos">522</span></a>
</span><span id="TimeSeries.find_missing_points-523"><a href="#TimeSeries.find_missing_points-523"><span class="linenos">523</span></a>        <span class="c1"># start date</span>
</span><span id="TimeSeries.find_missing_points-524"><a href="#TimeSeries.find_missing_points-524"><span class="linenos">524</span></a>        <span class="k">if</span> <span class="n">expected_start_datetime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_points-525"><a href="#TimeSeries.find_missing_points-525"><span class="linenos">525</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expected_start_datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
</span><span id="TimeSeries.find_missing_points-526"><a href="#TimeSeries.find_missing_points-526"><span class="linenos">526</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;expected_start_datetime must be a pandas.Datetime&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_points-527"><a href="#TimeSeries.find_missing_points-527"><span class="linenos">527</span></a>            <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">expected_start_datetime</span>
</span><span id="TimeSeries.find_missing_points-528"><a href="#TimeSeries.find_missing_points-528"><span class="linenos">528</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_points-529"><a href="#TimeSeries.find_missing_points-529"><span class="linenos">529</span></a>            <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeSeries.find_missing_points-530"><a href="#TimeSeries.find_missing_points-530"><span class="linenos">530</span></a>
</span><span id="TimeSeries.find_missing_points-531"><a href="#TimeSeries.find_missing_points-531"><span class="linenos">531</span></a>        <span class="c1"># end date</span>
</span><span id="TimeSeries.find_missing_points-532"><a href="#TimeSeries.find_missing_points-532"><span class="linenos">532</span></a>        <span class="k">if</span> <span class="n">expected_excl_end_datetime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_points-533"><a href="#TimeSeries.find_missing_points-533"><span class="linenos">533</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expected_excl_end_datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
</span><span id="TimeSeries.find_missing_points-534"><a href="#TimeSeries.find_missing_points-534"><span class="linenos">534</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;expected_end_datetime must be a pandas.Datetime&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_points-535"><a href="#TimeSeries.find_missing_points-535"><span class="linenos">535</span></a>            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">subtract_timedelta</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_points-536"><a href="#TimeSeries.find_missing_points-536"><span class="linenos">536</span></a>                <span class="n">expected_excl_end_datetime</span><span class="p">,</span> <span class="n">expected_freq</span>
</span><span id="TimeSeries.find_missing_points-537"><a href="#TimeSeries.find_missing_points-537"><span class="linenos">537</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.find_missing_points-538"><a href="#TimeSeries.find_missing_points-538"><span class="linenos">538</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_points-539"><a href="#TimeSeries.find_missing_points-539"><span class="linenos">539</span></a>            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TimeSeries.find_missing_points-540"><a href="#TimeSeries.find_missing_points-540"><span class="linenos">540</span></a>
</span><span id="TimeSeries.find_missing_points-541"><a href="#TimeSeries.find_missing_points-541"><span class="linenos">541</span></a>        <span class="c1"># compute the expected index</span>
</span><span id="TimeSeries.find_missing_points-542"><a href="#TimeSeries.find_missing_points-542"><span class="linenos">542</span></a>        <span class="n">expected_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start_datetime</span><span class="p">,</span> <span class="n">end_datetime</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">expected_freq</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_points-543"><a href="#TimeSeries.find_missing_points-543"><span class="linenos">543</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">expected_index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_points-544"><a href="#TimeSeries.find_missing_points-544"><span class="linenos">544</span></a>
</span><span id="TimeSeries.find_missing_points-545"><a href="#TimeSeries.find_missing_points-545"><span class="linenos">545</span></a>        <span class="k">return</span> <span class="n">missing_points</span>
</span></pre></div>


            <div class="docstring"><p>Check for missing periods in the time series with an expected frequency.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  a datetime index, without NaN</li>
<li><strong>expected_freq</strong>:  the expected freq of the datetime index if known, default None.</li>
<li><strong>expected_start_datetime</strong>:  the expected start time of the datetime index, default None</li>
<li><strong>expected_excl_end_datetime</strong>:  the expected exclusive end time of the datetime index, default None</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>missing points as a datetime index</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.collapse_to_periods" class="classattr">
                                        <input id="TimeSeries.collapse_to_periods-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=False)</div>

        <span class="def">def</span>
        <span class="name">collapse_to_periods</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	freq: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;]</span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.collapse_to_periods-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.collapse_to_periods"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.collapse_to_periods-547"><a href="#TimeSeries.collapse_to_periods-547"><span class="linenos">547</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.collapse_to_periods-548"><a href="#TimeSeries.collapse_to_periods-548"><span class="linenos">548</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.collapse_to_periods-549"><a href="#TimeSeries.collapse_to_periods-549"><span class="linenos">549</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.collapse_to_periods-550"><a href="#TimeSeries.collapse_to_periods-550"><span class="linenos">550</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.collapse_to_periods-551"><a href="#TimeSeries.collapse_to_periods-551"><span class="linenos">551</span></a>    <span class="k">def</span> <span class="nf">collapse_to_periods</span><span class="p">(</span>
</span><span id="TimeSeries.collapse_to_periods-552"><a href="#TimeSeries.collapse_to_periods-552"><span class="linenos">552</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="TimeSeries.collapse_to_periods-553"><a href="#TimeSeries.collapse_to_periods-553"><span class="linenos">553</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span>
</span><span id="TimeSeries.collapse_to_periods-554"><a href="#TimeSeries.collapse_to_periods-554"><span class="linenos">554</span></a>        <span class="nb">tuple</span><span class="p">[</span>
</span><span id="TimeSeries.collapse_to_periods-555"><a href="#TimeSeries.collapse_to_periods-555"><span class="linenos">555</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="TimeSeries.collapse_to_periods-556"><a href="#TimeSeries.collapse_to_periods-556"><span class="linenos">556</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="TimeSeries.collapse_to_periods-557"><a href="#TimeSeries.collapse_to_periods-557"><span class="linenos">557</span></a>        <span class="p">]</span>
</span><span id="TimeSeries.collapse_to_periods-558"><a href="#TimeSeries.collapse_to_periods-558"><span class="linenos">558</span></a>    <span class="p">]:</span>
</span><span id="TimeSeries.collapse_to_periods-559"><a href="#TimeSeries.collapse_to_periods-559"><span class="linenos">559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.collapse_to_periods-560"><a href="#TimeSeries.collapse_to_periods-560"><span class="linenos">560</span></a><span class="sd">        Given a datetime index and a frequency, it gives the list of regular periods found in the datetime index, as</span>
</span><span id="TimeSeries.collapse_to_periods-561"><a href="#TimeSeries.collapse_to_periods-561"><span class="linenos">561</span></a><span class="sd">        a collection of tuples that contain the start time and exclusive time of the periods found. More precisely,</span>
</span><span id="TimeSeries.collapse_to_periods-562"><a href="#TimeSeries.collapse_to_periods-562"><span class="linenos">562</span></a><span class="sd">        if a timestamp is missing (ie if t is present but t + freq is missing), a new period is defined (t</span>
</span><span id="TimeSeries.collapse_to_periods-563"><a href="#TimeSeries.collapse_to_periods-563"><span class="linenos">563</span></a><span class="sd">        becomes the end time of the current period, and the next timestamp found after t defines the beginning of a new</span>
</span><span id="TimeSeries.collapse_to_periods-564"><a href="#TimeSeries.collapse_to_periods-564"><span class="linenos">564</span></a><span class="sd">        period).</span>
</span><span id="TimeSeries.collapse_to_periods-565"><a href="#TimeSeries.collapse_to_periods-565"><span class="linenos">565</span></a><span class="sd">        Duplicates are dropped in the operation.</span>
</span><span id="TimeSeries.collapse_to_periods-566"><a href="#TimeSeries.collapse_to_periods-566"><span class="linenos">566</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries.collapse_to_periods-567"><a href="#TimeSeries.collapse_to_periods-567"><span class="linenos">567</span></a><span class="sd">        :param freq: the freq of the datetime index used to find missing periods.</span>
</span><span id="TimeSeries.collapse_to_periods-568"><a href="#TimeSeries.collapse_to_periods-568"><span class="linenos">568</span></a><span class="sd">        :return: a list of tuples that contain the regular periods in the datetime index (defined as the start and</span>
</span><span id="TimeSeries.collapse_to_periods-569"><a href="#TimeSeries.collapse_to_periods-569"><span class="linenos">569</span></a><span class="sd">        inclusive end times of the period).</span>
</span><span id="TimeSeries.collapse_to_periods-570"><a href="#TimeSeries.collapse_to_periods-570"><span class="linenos">570</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.collapse_to_periods-571"><a href="#TimeSeries.collapse_to_periods-571"><span class="linenos">571</span></a>
</span><span id="TimeSeries.collapse_to_periods-572"><a href="#TimeSeries.collapse_to_periods-572"><span class="linenos">572</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries.collapse_to_periods-573"><a href="#TimeSeries.collapse_to_periods-573"><span class="linenos">573</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="TimeSeries.collapse_to_periods-574"><a href="#TimeSeries.collapse_to_periods-574"><span class="linenos">574</span></a>
</span><span id="TimeSeries.collapse_to_periods-575"><a href="#TimeSeries.collapse_to_periods-575"><span class="linenos">575</span></a>        <span class="c1"># drop duplicates and sort the index</span>
</span><span id="TimeSeries.collapse_to_periods-576"><a href="#TimeSeries.collapse_to_periods-576"><span class="linenos">576</span></a>        <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="TimeSeries.collapse_to_periods-577"><a href="#TimeSeries.collapse_to_periods-577"><span class="linenos">577</span></a>
</span><span id="TimeSeries.collapse_to_periods-578"><a href="#TimeSeries.collapse_to_periods-578"><span class="linenos">578</span></a>        <span class="n">current_period_start</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeSeries.collapse_to_periods-579"><a href="#TimeSeries.collapse_to_periods-579"><span class="linenos">579</span></a>        <span class="n">periods_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TimeSeries.collapse_to_periods-580"><a href="#TimeSeries.collapse_to_periods-580"><span class="linenos">580</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="TimeSeries.collapse_to_periods-581"><a href="#TimeSeries.collapse_to_periods-581"><span class="linenos">581</span></a>            <span class="k">if</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">add_timedelta</span><span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">freq</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="TimeSeries.collapse_to_periods-582"><a href="#TimeSeries.collapse_to_periods-582"><span class="linenos">582</span></a>                <span class="c1"># end the current period and start a new one</span>
</span><span id="TimeSeries.collapse_to_periods-583"><a href="#TimeSeries.collapse_to_periods-583"><span class="linenos">583</span></a>                <span class="n">periods_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_period_start</span><span class="p">,</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="TimeSeries.collapse_to_periods-584"><a href="#TimeSeries.collapse_to_periods-584"><span class="linenos">584</span></a>                <span class="n">current_period_start</span> <span class="o">=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="TimeSeries.collapse_to_periods-585"><a href="#TimeSeries.collapse_to_periods-585"><span class="linenos">585</span></a>
</span><span id="TimeSeries.collapse_to_periods-586"><a href="#TimeSeries.collapse_to_periods-586"><span class="linenos">586</span></a>        <span class="n">periods_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_period_start</span><span class="p">,</span> <span class="n">dti</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># Don&#39;t forget last period</span>
</span><span id="TimeSeries.collapse_to_periods-587"><a href="#TimeSeries.collapse_to_periods-587"><span class="linenos">587</span></a>
</span><span id="TimeSeries.collapse_to_periods-588"><a href="#TimeSeries.collapse_to_periods-588"><span class="linenos">588</span></a>        <span class="k">return</span> <span class="n">periods_list</span>
</span></pre></div>


            <div class="docstring"><p>Given a datetime index and a frequency, it gives the list of regular periods found in the datetime index, as
a collection of tuples that contain the start time and exclusive time of the periods found. More precisely,
if a timestamp is missing (ie if t is present but t + freq is missing), a new period is defined (t
becomes the end time of the current period, and the next timestamp found after t defines the beginning of a new
period).
Duplicates are dropped in the operation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  a datetime index, without NaN</li>
<li><strong>freq</strong>:  the freq of the datetime index used to find missing periods.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a list of tuples that contain the regular periods in the datetime index (defined as the start and
  inclusive end times of the period).</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.find_missing_periods" class="classattr">
                                        <input id="TimeSeries.find_missing_periods-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=False)</div>

        <span class="def">def</span>
        <span class="name">find_missing_periods</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	<span class="n">expected_freq</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">list</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.find_missing_periods-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_missing_periods"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_missing_periods-590"><a href="#TimeSeries.find_missing_periods-590"><span class="linenos">590</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.find_missing_periods-591"><a href="#TimeSeries.find_missing_periods-591"><span class="linenos">591</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_periods-592"><a href="#TimeSeries.find_missing_periods-592"><span class="linenos">592</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.find_missing_periods-593"><a href="#TimeSeries.find_missing_periods-593"><span class="linenos">593</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.find_missing_periods-594"><a href="#TimeSeries.find_missing_periods-594"><span class="linenos">594</span></a>    <span class="k">def</span> <span class="nf">find_missing_periods</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_periods-595"><a href="#TimeSeries.find_missing_periods-595"><span class="linenos">595</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_periods-596"><a href="#TimeSeries.find_missing_periods-596"><span class="linenos">596</span></a>        <span class="n">expected_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_periods-597"><a href="#TimeSeries.find_missing_periods-597"><span class="linenos">597</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_periods-598"><a href="#TimeSeries.find_missing_periods-598"><span class="linenos">598</span></a>        <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_periods-599"><a href="#TimeSeries.find_missing_periods-599"><span class="linenos">599</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_periods-600"><a href="#TimeSeries.find_missing_periods-600"><span class="linenos">600</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_missing_periods-601"><a href="#TimeSeries.find_missing_periods-601"><span class="linenos">601</span></a><span class="sd">        Find missing periods in a datetimeIndex. It finds all missing points, and collapse them</span>
</span><span id="TimeSeries.find_missing_periods-602"><a href="#TimeSeries.find_missing_periods-602"><span class="linenos">602</span></a><span class="sd">        in periods</span>
</span><span id="TimeSeries.find_missing_periods-603"><a href="#TimeSeries.find_missing_periods-603"><span class="linenos">603</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries.find_missing_periods-604"><a href="#TimeSeries.find_missing_periods-604"><span class="linenos">604</span></a><span class="sd">        :param expected_freq: the expected freq of the datetime index if known, default None.</span>
</span><span id="TimeSeries.find_missing_periods-605"><a href="#TimeSeries.find_missing_periods-605"><span class="linenos">605</span></a><span class="sd">        :param expected_start_datetime: the expected start time of the datetime index, default None</span>
</span><span id="TimeSeries.find_missing_periods-606"><a href="#TimeSeries.find_missing_periods-606"><span class="linenos">606</span></a><span class="sd">        :param expected_excl_end_datetime: the expected exclusive end time of the datetime index, default None</span>
</span><span id="TimeSeries.find_missing_periods-607"><a href="#TimeSeries.find_missing_periods-607"><span class="linenos">607</span></a><span class="sd">        :return: missing periods as a list of tuples of start and end times of the missing periods.</span>
</span><span id="TimeSeries.find_missing_periods-608"><a href="#TimeSeries.find_missing_periods-608"><span class="linenos">608</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_missing_periods-609"><a href="#TimeSeries.find_missing_periods-609"><span class="linenos">609</span></a>
</span><span id="TimeSeries.find_missing_periods-610"><a href="#TimeSeries.find_missing_periods-610"><span class="linenos">610</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">expected_freq</span>
</span><span id="TimeSeries.find_missing_periods-611"><a href="#TimeSeries.find_missing_periods-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">expected_freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_periods-612"><a href="#TimeSeries.find_missing_periods-612"><span class="linenos">612</span></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_periods-613"><a href="#TimeSeries.find_missing_periods-613"><span class="linenos">613</span></a>
</span><span id="TimeSeries.find_missing_periods-614"><a href="#TimeSeries.find_missing_periods-614"><span class="linenos">614</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_points</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_periods-615"><a href="#TimeSeries.find_missing_periods-615"><span class="linenos">615</span></a>            <span class="n">dti</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_periods-616"><a href="#TimeSeries.find_missing_periods-616"><span class="linenos">616</span></a>            <span class="n">expected_freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_periods-617"><a href="#TimeSeries.find_missing_periods-617"><span class="linenos">617</span></a>            <span class="n">expected_start_datetime</span><span class="o">=</span><span class="n">expected_start_datetime</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_periods-618"><a href="#TimeSeries.find_missing_periods-618"><span class="linenos">618</span></a>            <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="n">expected_excl_end_datetime</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_periods-619"><a href="#TimeSeries.find_missing_periods-619"><span class="linenos">619</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.find_missing_periods-620"><a href="#TimeSeries.find_missing_periods-620"><span class="linenos">620</span></a>
</span><span id="TimeSeries.find_missing_periods-621"><a href="#TimeSeries.find_missing_periods-621"><span class="linenos">621</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">collapse_to_periods</span><span class="p">(</span><span class="n">missing_points</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Find missing periods in a datetimeIndex. It finds all missing points, and collapse them
in periods</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  a datetime index, without NaN</li>
<li><strong>expected_freq</strong>:  the expected freq of the datetime index if known, default None.</li>
<li><strong>expected_start_datetime</strong>:  the expected start time of the datetime index, default None</li>
<li><strong>expected_excl_end_datetime</strong>:  the expected exclusive end time of the datetime index, default None</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>missing periods as a list of tuples of start and end times of the missing periods.</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.has_single_frequency" class="classattr">
                                        <input id="TimeSeries.has_single_frequency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_series_as_datetimeindex(arg_name=&#39;dti&#39;, return_input_type=False)</div>

        <span class="def">def</span>
        <span class="name">has_single_frequency</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	<span class="n">variable_duration_freq_included</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.has_single_frequency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.has_single_frequency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.has_single_frequency-623"><a href="#TimeSeries.has_single_frequency-623"><span class="linenos">623</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.has_single_frequency-624"><a href="#TimeSeries.has_single_frequency-624"><span class="linenos">624</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_series_as_datetimeindex</span><span class="p">(</span>
</span><span id="TimeSeries.has_single_frequency-625"><a href="#TimeSeries.has_single_frequency-625"><span class="linenos">625</span></a>        <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;dti&quot;</span><span class="p">,</span> <span class="n">return_input_type</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TimeSeries.has_single_frequency-626"><a href="#TimeSeries.has_single_frequency-626"><span class="linenos">626</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.has_single_frequency-627"><a href="#TimeSeries.has_single_frequency-627"><span class="linenos">627</span></a>    <span class="k">def</span> <span class="nf">has_single_frequency</span><span class="p">(</span>
</span><span id="TimeSeries.has_single_frequency-628"><a href="#TimeSeries.has_single_frequency-628"><span class="linenos">628</span></a>        <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
</span><span id="TimeSeries.has_single_frequency-629"><a href="#TimeSeries.has_single_frequency-629"><span class="linenos">629</span></a>        <span class="n">variable_duration_freq_included</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TimeSeries.has_single_frequency-630"><a href="#TimeSeries.has_single_frequency-630"><span class="linenos">630</span></a>        <span class="n">skip_duplicate_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TimeSeries.has_single_frequency-631"><a href="#TimeSeries.has_single_frequency-631"><span class="linenos">631</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TimeSeries.has_single_frequency-632"><a href="#TimeSeries.has_single_frequency-632"><span class="linenos">632</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.has_single_frequency-633"><a href="#TimeSeries.has_single_frequency-633"><span class="linenos">633</span></a><span class="sd">        Return True if the provided datetime index has a single frequency, i.e.</span>
</span><span id="TimeSeries.has_single_frequency-634"><a href="#TimeSeries.has_single_frequency-634"><span class="linenos">634</span></a><span class="sd">        does not have missing periods, extra points, nor change of frequency</span>
</span><span id="TimeSeries.has_single_frequency-635"><a href="#TimeSeries.has_single_frequency-635"><span class="linenos">635</span></a><span class="sd">        :param dti: pd.DatetimeIndex to investigate</span>
</span><span id="TimeSeries.has_single_frequency-636"><a href="#TimeSeries.has_single_frequency-636"><span class="linenos">636</span></a><span class="sd">        :param variable_duration_freq_included: &#39;Frequency&#39; may have a double meaning, whether fixed-time frequencies</span>
</span><span id="TimeSeries.has_single_frequency-637"><a href="#TimeSeries.has_single_frequency-637"><span class="linenos">637</span></a><span class="sd">                                           are considered or not. For instance, a frequency of one month leads to</span>
</span><span id="TimeSeries.has_single_frequency-638"><a href="#TimeSeries.has_single_frequency-638"><span class="linenos">638</span></a><span class="sd">                                           intervals with different absolute length (in terms of days, and seconds).</span>
</span><span id="TimeSeries.has_single_frequency-639"><a href="#TimeSeries.has_single_frequency-639"><span class="linenos">639</span></a><span class="sd">                                           Setting True means the datetimeindex is inspected with absolute duration</span>
</span><span id="TimeSeries.has_single_frequency-640"><a href="#TimeSeries.has_single_frequency-640"><span class="linenos">640</span></a><span class="sd">                                           in mind. It is useful when we expect:</span>
</span><span id="TimeSeries.has_single_frequency-641"><a href="#TimeSeries.has_single_frequency-641"><span class="linenos">641</span></a><span class="sd">                                           * an x-min difference between timestamps</span>
</span><span id="TimeSeries.has_single_frequency-642"><a href="#TimeSeries.has_single_frequency-642"><span class="linenos">642</span></a><span class="sd">                                           * an x-day difference between dates</span>
</span><span id="TimeSeries.has_single_frequency-643"><a href="#TimeSeries.has_single_frequency-643"><span class="linenos">643</span></a><span class="sd">        :param skip_duplicate_timestamps: If True, the function will not consider duplicate timestamps</span>
</span><span id="TimeSeries.has_single_frequency-644"><a href="#TimeSeries.has_single_frequency-644"><span class="linenos">644</span></a><span class="sd">        :return: True if the data has a clean single frequency defined.</span>
</span><span id="TimeSeries.has_single_frequency-645"><a href="#TimeSeries.has_single_frequency-645"><span class="linenos">645</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.has_single_frequency-646"><a href="#TimeSeries.has_single_frequency-646"><span class="linenos">646</span></a>
</span><span id="TimeSeries.has_single_frequency-647"><a href="#TimeSeries.has_single_frequency-647"><span class="linenos">647</span></a>        <span class="k">if</span> <span class="n">skip_duplicate_timestamps</span><span class="p">:</span>
</span><span id="TimeSeries.has_single_frequency-648"><a href="#TimeSeries.has_single_frequency-648"><span class="linenos">648</span></a>            <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="TimeSeries.has_single_frequency-649"><a href="#TimeSeries.has_single_frequency-649"><span class="linenos">649</span></a>
</span><span id="TimeSeries.has_single_frequency-650"><a href="#TimeSeries.has_single_frequency-650"><span class="linenos">650</span></a>        <span class="c1"># easy case: check the exact differences in duration between timestamps / dates</span>
</span><span id="TimeSeries.has_single_frequency-651"><a href="#TimeSeries.has_single_frequency-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="n">variable_duration_freq_included</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="TimeSeries.has_single_frequency-652"><a href="#TimeSeries.has_single_frequency-652"><span class="linenos">652</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_gap_distribution</span><span class="p">(</span><span class="n">dti</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="TimeSeries.has_single_frequency-653"><a href="#TimeSeries.has_single_frequency-653"><span class="linenos">653</span></a>
</span><span id="TimeSeries.has_single_frequency-654"><a href="#TimeSeries.has_single_frequency-654"><span class="linenos">654</span></a>        <span class="c1"># else, it might be more tricky, because the frequency may be irregular in terms of total_seconds</span>
</span><span id="TimeSeries.has_single_frequency-655"><a href="#TimeSeries.has_single_frequency-655"><span class="linenos">655</span></a>        <span class="c1"># (e.g. when freq is months, years, or even days because of change of hour). We need to rely on pd.infer_freq().</span>
</span><span id="TimeSeries.has_single_frequency-656"><a href="#TimeSeries.has_single_frequency-656"><span class="linenos">656</span></a>        <span class="c1"># Safer way is to reconstruct a time-series index from scratch using the most common frequency found in the</span>
</span><span id="TimeSeries.has_single_frequency-657"><a href="#TimeSeries.has_single_frequency-657"><span class="linenos">657</span></a>        <span class="c1"># input index, and compare it to the index.</span>
</span><span id="TimeSeries.has_single_frequency-658"><a href="#TimeSeries.has_single_frequency-658"><span class="linenos">658</span></a>
</span><span id="TimeSeries.has_single_frequency-659"><a href="#TimeSeries.has_single_frequency-659"><span class="linenos">659</span></a>        <span class="c1"># most common freq</span>
</span><span id="TimeSeries.has_single_frequency-660"><a href="#TimeSeries.has_single_frequency-660"><span class="linenos">660</span></a>        <span class="n">most_common_freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.has_single_frequency-661"><a href="#TimeSeries.has_single_frequency-661"><span class="linenos">661</span></a>
</span><span id="TimeSeries.has_single_frequency-662"><a href="#TimeSeries.has_single_frequency-662"><span class="linenos">662</span></a>        <span class="c1"># we rely on find extra points and missing points to detect it.</span>
</span><span id="TimeSeries.has_single_frequency-663"><a href="#TimeSeries.has_single_frequency-663"><span class="linenos">663</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span><span class="o">=</span><span class="n">most_common_freq</span><span class="p">)</span>
</span><span id="TimeSeries.has_single_frequency-664"><a href="#TimeSeries.has_single_frequency-664"><span class="linenos">664</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries.has_single_frequency-665"><a href="#TimeSeries.has_single_frequency-665"><span class="linenos">665</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TimeSeries.has_single_frequency-666"><a href="#TimeSeries.has_single_frequency-666"><span class="linenos">666</span></a>
</span><span id="TimeSeries.has_single_frequency-667"><a href="#TimeSeries.has_single_frequency-667"><span class="linenos">667</span></a>        <span class="n">missing_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_points</span><span class="p">(</span>
</span><span id="TimeSeries.has_single_frequency-668"><a href="#TimeSeries.has_single_frequency-668"><span class="linenos">668</span></a>            <span class="n">dti</span><span class="p">,</span> <span class="n">expected_freq</span><span class="o">=</span><span class="n">most_common_freq</span>
</span><span id="TimeSeries.has_single_frequency-669"><a href="#TimeSeries.has_single_frequency-669"><span class="linenos">669</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.has_single_frequency-670"><a href="#TimeSeries.has_single_frequency-670"><span class="linenos">670</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries.has_single_frequency-671"><a href="#TimeSeries.has_single_frequency-671"><span class="linenos">671</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TimeSeries.has_single_frequency-672"><a href="#TimeSeries.has_single_frequency-672"><span class="linenos">672</span></a>
</span><span id="TimeSeries.has_single_frequency-673"><a href="#TimeSeries.has_single_frequency-673"><span class="linenos">673</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Return True if the provided datetime index has a single frequency, i.e.
does not have missing periods, extra points, nor change of frequency</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  pd.DatetimeIndex to investigate</li>
<li><strong>variable_duration_freq_included</strong>:  'Frequency' may have a double meaning, whether fixed-time frequencies
are considered or not. For instance, a frequency of one month leads to
intervals with different absolute length (in terms of days, and seconds).
Setting True means the datetimeindex is inspected with absolute duration
in mind. It is useful when we expect:
<ul>
<li>an x-min difference between timestamps</li>
<li>an x-day difference between dates</li>
</ul></li>
<li><strong>skip_duplicate_timestamps</strong>:  If True, the function will not consider duplicate timestamps</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>True if the data has a clean single frequency defined.</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.align_timezone" class="classattr">
                                        <input id="TimeSeries.align_timezone-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>
        <div class="decorator">@enda.tools.decorators.warning_deprecated_name(namespace_name=&#39;TimeSeries&#39;, new_namespace_name=&#39;TimezoneUtils&#39;, new_function_name=&#39;convert_dtype_from_object_to_tz_aware&#39;)</div>

        <span class="def">def</span>
        <span class="name">align_timezone</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">time_series</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span>,</span><span class="param">	<span class="n">tzinfo</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">timezone</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TimeSeries.align_timezone-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.align_timezone"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.align_timezone-679"><a href="#TimeSeries.align_timezone-679"><span class="linenos">679</span></a>    <span class="nd">@classmethod</span>
</span><span id="TimeSeries.align_timezone-680"><a href="#TimeSeries.align_timezone-680"><span class="linenos">680</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries.align_timezone-681"><a href="#TimeSeries.align_timezone-681"><span class="linenos">681</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.align_timezone-682"><a href="#TimeSeries.align_timezone-682"><span class="linenos">682</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;TimezoneUtils&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.align_timezone-683"><a href="#TimeSeries.align_timezone-683"><span class="linenos">683</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;convert_dtype_from_object_to_tz_aware&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.align_timezone-684"><a href="#TimeSeries.align_timezone-684"><span class="linenos">684</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.align_timezone-685"><a href="#TimeSeries.align_timezone-685"><span class="linenos">685</span></a>    <span class="k">def</span> <span class="nf">align_timezone</span><span class="p">(</span>
</span><span id="TimeSeries.align_timezone-686"><a href="#TimeSeries.align_timezone-686"><span class="linenos">686</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="TimeSeries.align_timezone-687"><a href="#TimeSeries.align_timezone-687"><span class="linenos">687</span></a>        <span class="n">time_series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
</span><span id="TimeSeries.align_timezone-688"><a href="#TimeSeries.align_timezone-688"><span class="linenos">688</span></a>        <span class="n">tzinfo</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="TimeSeries.align_timezone-689"><a href="#TimeSeries.align_timezone-689"><span class="linenos">689</span></a>            <span class="nb">str</span><span class="p">,</span>
</span><span id="TimeSeries.align_timezone-690"><a href="#TimeSeries.align_timezone-690"><span class="linenos">690</span></a>            <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span>
</span><span id="TimeSeries.align_timezone-691"><a href="#TimeSeries.align_timezone-691"><span class="linenos">691</span></a>        <span class="p">],</span>
</span><span id="TimeSeries.align_timezone-692"><a href="#TimeSeries.align_timezone-692"><span class="linenos">692</span></a>    <span class="p">):</span>
</span><span id="TimeSeries.align_timezone-693"><a href="#TimeSeries.align_timezone-693"><span class="linenos">693</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.align_timezone-694"><a href="#TimeSeries.align_timezone-694"><span class="linenos">694</span></a><span class="sd">        Sometimes a time series is of pandas type &quot;object&quot; just because the time-zone information</span>
</span><span id="TimeSeries.align_timezone-695"><a href="#TimeSeries.align_timezone-695"><span class="linenos">695</span></a><span class="sd">        is not well-read initially. Such a series can&#39;t be translated to a pd.DatetimeIndex.</span>
</span><span id="TimeSeries.align_timezone-696"><a href="#TimeSeries.align_timezone-696"><span class="linenos">696</span></a><span class="sd">        This function makes sure the time zone information of the input series is set to the input</span>
</span><span id="TimeSeries.align_timezone-697"><a href="#TimeSeries.align_timezone-697"><span class="linenos">697</span></a><span class="sd">        tz_info for each row and also for the series.</span>
</span><span id="TimeSeries.align_timezone-698"><a href="#TimeSeries.align_timezone-698"><span class="linenos">698</span></a>
</span><span id="TimeSeries.align_timezone-699"><a href="#TimeSeries.align_timezone-699"><span class="linenos">699</span></a><span class="sd">        Example :</span>
</span><span id="TimeSeries.align_timezone-700"><a href="#TimeSeries.align_timezone-700"><span class="linenos">700</span></a><span class="sd">        time_series = a time_series with some times at timezone +01:00 (French winter time)</span>
</span><span id="TimeSeries.align_timezone-701"><a href="#TimeSeries.align_timezone-701"><span class="linenos">701</span></a><span class="sd">                      and others at timezone +02:00 (French summer)</span>
</span><span id="TimeSeries.align_timezone-702"><a href="#TimeSeries.align_timezone-702"><span class="linenos">702</span></a><span class="sd">                      So its pandas dtype is &quot;object&quot;</span>
</span><span id="TimeSeries.align_timezone-703"><a href="#TimeSeries.align_timezone-703"><span class="linenos">703</span></a><span class="sd">        tz = pytz.timezone(&quot;Europe/Paris&quot;)</span>
</span><span id="TimeSeries.align_timezone-704"><a href="#TimeSeries.align_timezone-704"><span class="linenos">704</span></a>
</span><span id="TimeSeries.align_timezone-705"><a href="#TimeSeries.align_timezone-705"><span class="linenos">705</span></a><span class="sd">        :param time_series: a series with tz-aware date-times. If a datetime-index is passed, the function</span>
</span><span id="TimeSeries.align_timezone-706"><a href="#TimeSeries.align_timezone-706"><span class="linenos">706</span></a><span class="sd">                            process it</span>
</span><span id="TimeSeries.align_timezone-707"><a href="#TimeSeries.align_timezone-707"><span class="linenos">707</span></a><span class="sd">        :param tzinfo: a str or a datetime.tzinfo</span>
</span><span id="TimeSeries.align_timezone-708"><a href="#TimeSeries.align_timezone-708"><span class="linenos">708</span></a><span class="sd">        :return: a DatetimeIndex of dtype: datetime[ns, tzinfo]</span>
</span><span id="TimeSeries.align_timezone-709"><a href="#TimeSeries.align_timezone-709"><span class="linenos">709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.align_timezone-710"><a href="#TimeSeries.align_timezone-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span>
</span><span id="TimeSeries.align_timezone-711"><a href="#TimeSeries.align_timezone-711"><span class="linenos">711</span></a>            <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">convert_dtype_from_object_to_tz_aware</span><span class="p">(</span>
</span><span id="TimeSeries.align_timezone-712"><a href="#TimeSeries.align_timezone-712"><span class="linenos">712</span></a>                <span class="n">time_series</span><span class="o">=</span><span class="n">time_series</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tzinfo</span>
</span><span id="TimeSeries.align_timezone-713"><a href="#TimeSeries.align_timezone-713"><span class="linenos">713</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.align_timezone-714"><a href="#TimeSeries.align_timezone-714"><span class="linenos">714</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sometimes a time series is of pandas type "object" just because the time-zone information
is not well-read initially. Such a series can't be translated to a pd.DatetimeIndex.
This function makes sure the time zone information of the input series is set to the input
tz_info for each row and also for the series.</p>

<p>Example :
time_series = a time_series with some times at timezone +01:00 (French winter time)
              and others at timezone +02:00 (French summer)
              So its pandas dtype is "object"
tz = pytz.timezone("Europe/Paris")</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>time_series</strong>:  a series with tz-aware date-times. If a datetime-index is passed, the function
process it</li>
<li><strong>tzinfo</strong>:  a str or a datetime.tzinfo</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a DatetimeIndex of dtype: datetime[ns, tzinfo]</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.find_missing_and_extra_periods" class="classattr">
                                        <input id="TimeSeries.find_missing_and_extra_periods-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>
        <div class="decorator">@enda.tools.decorators.warning_deprecated_name(namespace_name=&#39;TimeSeries&#39;, new_function_name=&#39;find_missing_periods and find_extra_points&#39;)</div>

        <span class="def">def</span>
        <span class="name">find_missing_and_extra_periods</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">dti</span>,</span><span class="param">	<span class="n">expected_freq</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">expected_end_datetime</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TimeSeries.find_missing_and_extra_periods-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.find_missing_and_extra_periods"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.find_missing_and_extra_periods-716"><a href="#TimeSeries.find_missing_and_extra_periods-716"><span class="linenos">716</span></a>    <span class="nd">@classmethod</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-717"><a href="#TimeSeries.find_missing_and_extra_periods-717"><span class="linenos">717</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-718"><a href="#TimeSeries.find_missing_and_extra_periods-718"><span class="linenos">718</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-719"><a href="#TimeSeries.find_missing_and_extra_periods-719"><span class="linenos">719</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;find_missing_periods and find_extra_points&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-720"><a href="#TimeSeries.find_missing_and_extra_periods-720"><span class="linenos">720</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-721"><a href="#TimeSeries.find_missing_and_extra_periods-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="nf">find_missing_and_extra_periods</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-722"><a href="#TimeSeries.find_missing_and_extra_periods-722"><span class="linenos">722</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-723"><a href="#TimeSeries.find_missing_and_extra_periods-723"><span class="linenos">723</span></a>        <span class="n">dti</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-724"><a href="#TimeSeries.find_missing_and_extra_periods-724"><span class="linenos">724</span></a>        <span class="n">expected_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-725"><a href="#TimeSeries.find_missing_and_extra_periods-725"><span class="linenos">725</span></a>        <span class="n">expected_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-726"><a href="#TimeSeries.find_missing_and_extra_periods-726"><span class="linenos">726</span></a>        <span class="n">expected_end_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-727"><a href="#TimeSeries.find_missing_and_extra_periods-727"><span class="linenos">727</span></a>    <span class="p">):</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-728"><a href="#TimeSeries.find_missing_and_extra_periods-728"><span class="linenos">728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-729"><a href="#TimeSeries.find_missing_and_extra_periods-729"><span class="linenos">729</span></a><span class="sd">        Check for missing and extra data points</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-730"><a href="#TimeSeries.find_missing_and_extra_periods-730"><span class="linenos">730</span></a><span class="sd">        :param dti: a series of type DatetimeIndex, in ascending order and without duplicates or NaNs</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-731"><a href="#TimeSeries.find_missing_and_extra_periods-731"><span class="linenos">731</span></a><span class="sd">        :param expected_freq: pandas formatted frequency. If None is given, will infer the frequency, taking the</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-732"><a href="#TimeSeries.find_missing_and_extra_periods-732"><span class="linenos">732</span></a><span class="sd">            most common gap between 2 consecutive points.</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-733"><a href="#TimeSeries.find_missing_and_extra_periods-733"><span class="linenos">733</span></a><span class="sd">        :param expected_start_datetime: a pandas.Datetime, if None is given, will take dti[0]</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-734"><a href="#TimeSeries.find_missing_and_extra_periods-734"><span class="linenos">734</span></a><span class="sd">        :param expected_end_datetime: a pandas.Datetime, if None is given, will take dti[-1]</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-735"><a href="#TimeSeries.find_missing_and_extra_periods-735"><span class="linenos">735</span></a><span class="sd">        :return: Missing and extra data points collapsed in periods</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-736"><a href="#TimeSeries.find_missing_and_extra_periods-736"><span class="linenos">736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-737"><a href="#TimeSeries.find_missing_and_extra_periods-737"><span class="linenos">737</span></a>
</span><span id="TimeSeries.find_missing_and_extra_periods-738"><a href="#TimeSeries.find_missing_and_extra_periods-738"><span class="linenos">738</span></a>        <span class="c1"># for the sake of compatibility</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-739"><a href="#TimeSeries.find_missing_and_extra_periods-739"><span class="linenos">739</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">dti</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">dti</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-740"><a href="#TimeSeries.find_missing_and_extra_periods-740"><span class="linenos">740</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;given dti is not in ascending order&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-741"><a href="#TimeSeries.find_missing_and_extra_periods-741"><span class="linenos">741</span></a>
</span><span id="TimeSeries.find_missing_and_extra_periods-742"><a href="#TimeSeries.find_missing_and_extra_periods-742"><span class="linenos">742</span></a>        <span class="k">if</span> <span class="n">dti</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-743"><a href="#TimeSeries.find_missing_and_extra_periods-743"><span class="linenos">743</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;given dti has duplicates.&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-744"><a href="#TimeSeries.find_missing_and_extra_periods-744"><span class="linenos">744</span></a>
</span><span id="TimeSeries.find_missing_and_extra_periods-745"><a href="#TimeSeries.find_missing_and_extra_periods-745"><span class="linenos">745</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-746"><a href="#TimeSeries.find_missing_and_extra_periods-746"><span class="linenos">746</span></a>        <span class="n">missing_periods</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_missing_periods</span><span class="p">(</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-747"><a href="#TimeSeries.find_missing_and_extra_periods-747"><span class="linenos">747</span></a>            <span class="n">dti</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-748"><a href="#TimeSeries.find_missing_and_extra_periods-748"><span class="linenos">748</span></a>            <span class="n">expected_freq</span><span class="o">=</span><span class="n">expected_freq</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-749"><a href="#TimeSeries.find_missing_and_extra_periods-749"><span class="linenos">749</span></a>            <span class="n">expected_start_datetime</span><span class="o">=</span><span class="n">expected_start_datetime</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-750"><a href="#TimeSeries.find_missing_and_extra_periods-750"><span class="linenos">750</span></a>            <span class="n">expected_excl_end_datetime</span><span class="o">=</span><span class="n">expected_end_datetime</span><span class="p">,</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-751"><a href="#TimeSeries.find_missing_and_extra_periods-751"><span class="linenos">751</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-752"><a href="#TimeSeries.find_missing_and_extra_periods-752"><span class="linenos">752</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_extra_points</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
</span><span id="TimeSeries.find_missing_and_extra_periods-753"><a href="#TimeSeries.find_missing_and_extra_periods-753"><span class="linenos">753</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span> <span class="n">missing_periods</span><span class="p">,</span> <span class="n">extra_points</span>
</span></pre></div>


            <div class="docstring"><p>Check for missing and extra data points</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  a series of type DatetimeIndex, in ascending order and without duplicates or NaNs</li>
<li><strong>expected_freq</strong>:  pandas formatted frequency. If None is given, will infer the frequency, taking the
most common gap between 2 consecutive points.</li>
<li><strong>expected_start_datetime</strong>:  a pandas.Datetime, if None is given, will take dti[0]</li>
<li><strong>expected_end_datetime</strong>:  a pandas.Datetime, if None is given, will take dti[-1]</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Missing and extra data points collapsed in periods</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.collapse_dt_series_into_periods" class="classattr">
                                        <input id="TimeSeries.collapse_dt_series_into_periods-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>
        <div class="decorator">@enda.tools.decorators.warning_deprecated_name(namespace_name=&#39;TimeSeries&#39;, new_function_name=&#39;collapse_to_periods&#39;)</div>

        <span class="def">def</span>
        <span class="name">collapse_dt_series_into_periods</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">dti</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>,</span><span class="param">	freq: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;]</span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="TimeSeries.collapse_dt_series_into_periods-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.collapse_dt_series_into_periods"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.collapse_dt_series_into_periods-755"><a href="#TimeSeries.collapse_dt_series_into_periods-755"><span class="linenos">755</span></a>    <span class="nd">@classmethod</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-756"><a href="#TimeSeries.collapse_dt_series_into_periods-756"><span class="linenos">756</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-757"><a href="#TimeSeries.collapse_dt_series_into_periods-757"><span class="linenos">757</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;collapse_to_periods&quot;</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-758"><a href="#TimeSeries.collapse_dt_series_into_periods-758"><span class="linenos">758</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-759"><a href="#TimeSeries.collapse_dt_series_into_periods-759"><span class="linenos">759</span></a>    <span class="k">def</span> <span class="nf">collapse_dt_series_into_periods</span><span class="p">(</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-760"><a href="#TimeSeries.collapse_dt_series_into_periods-760"><span class="linenos">760</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">dti</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-761"><a href="#TimeSeries.collapse_dt_series_into_periods-761"><span class="linenos">761</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-762"><a href="#TimeSeries.collapse_dt_series_into_periods-762"><span class="linenos">762</span></a>        <span class="nb">tuple</span><span class="p">[</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-763"><a href="#TimeSeries.collapse_dt_series_into_periods-763"><span class="linenos">763</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-764"><a href="#TimeSeries.collapse_dt_series_into_periods-764"><span class="linenos">764</span></a>            <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-765"><a href="#TimeSeries.collapse_dt_series_into_periods-765"><span class="linenos">765</span></a>        <span class="p">]</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-766"><a href="#TimeSeries.collapse_dt_series_into_periods-766"><span class="linenos">766</span></a>    <span class="p">]:</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-767"><a href="#TimeSeries.collapse_dt_series_into_periods-767"><span class="linenos">767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-768"><a href="#TimeSeries.collapse_dt_series_into_periods-768"><span class="linenos">768</span></a><span class="sd">        Given a datetime index and a frequency, it gives the list of regular periods found in the datetime index, as</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-769"><a href="#TimeSeries.collapse_dt_series_into_periods-769"><span class="linenos">769</span></a><span class="sd">        a collection of tuples that contain the start time and exclusive time of the periods found. More precisely,</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-770"><a href="#TimeSeries.collapse_dt_series_into_periods-770"><span class="linenos">770</span></a><span class="sd">        if a timestamp is missing (ie if t is present but t + freq is missing), a new period is defined (t</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-771"><a href="#TimeSeries.collapse_dt_series_into_periods-771"><span class="linenos">771</span></a><span class="sd">        becomes the end time of the current period, and the next timestamp found after t defines the beginning of a new</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-772"><a href="#TimeSeries.collapse_dt_series_into_periods-772"><span class="linenos">772</span></a><span class="sd">        period).</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-773"><a href="#TimeSeries.collapse_dt_series_into_periods-773"><span class="linenos">773</span></a><span class="sd">        :param dti: a datetime index, without NaN</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-774"><a href="#TimeSeries.collapse_dt_series_into_periods-774"><span class="linenos">774</span></a><span class="sd">        :param freq: the freq of the datetime index used to find missing periods.</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-775"><a href="#TimeSeries.collapse_dt_series_into_periods-775"><span class="linenos">775</span></a><span class="sd">        :return: a list of tuples that contain the regular periods in the datetime index (defined as the start and</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-776"><a href="#TimeSeries.collapse_dt_series_into_periods-776"><span class="linenos">776</span></a><span class="sd">        inclusive end times of the period).</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-777"><a href="#TimeSeries.collapse_dt_series_into_periods-777"><span class="linenos">777</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-778"><a href="#TimeSeries.collapse_dt_series_into_periods-778"><span class="linenos">778</span></a>
</span><span id="TimeSeries.collapse_dt_series_into_periods-779"><a href="#TimeSeries.collapse_dt_series_into_periods-779"><span class="linenos">779</span></a>        <span class="c1"># legacy: check duplicates and multiple of period</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-780"><a href="#TimeSeries.collapse_dt_series_into_periods-780"><span class="linenos">780</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dti</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-781"><a href="#TimeSeries.collapse_dt_series_into_periods-781"><span class="linenos">781</span></a>            <span class="k">if</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-782"><a href="#TimeSeries.collapse_dt_series_into_periods-782"><span class="linenos">782</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dti must be sorted and without duplicates!&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-783"><a href="#TimeSeries.collapse_dt_series_into_periods-783"><span class="linenos">783</span></a>
</span><span id="TimeSeries.collapse_dt_series_into_periods-784"><a href="#TimeSeries.collapse_dt_series_into_periods-784"><span class="linenos">784</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dti</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">%</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-785"><a href="#TimeSeries.collapse_dt_series_into_periods-785"><span class="linenos">785</span></a>                <span class="n">freq</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-786"><a href="#TimeSeries.collapse_dt_series_into_periods-786"><span class="linenos">786</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-787"><a href="#TimeSeries.collapse_dt_series_into_periods-787"><span class="linenos">787</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-788"><a href="#TimeSeries.collapse_dt_series_into_periods-788"><span class="linenos">788</span></a>                    <span class="sa">f</span><span class="s2">&quot;Timedelta between </span><span class="si">{</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">dti</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> is not a multiple of freq (</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-789"><a href="#TimeSeries.collapse_dt_series_into_periods-789"><span class="linenos">789</span></a>                <span class="p">)</span>
</span><span id="TimeSeries.collapse_dt_series_into_periods-790"><a href="#TimeSeries.collapse_dt_series_into_periods-790"><span class="linenos">790</span></a>
</span><span id="TimeSeries.collapse_dt_series_into_periods-791"><a href="#TimeSeries.collapse_dt_series_into_periods-791"><span class="linenos">791</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">collapse_to_periods</span><span class="p">(</span><span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Given a datetime index and a frequency, it gives the list of regular periods found in the datetime index, as
a collection of tuples that contain the start time and exclusive time of the periods found. More precisely,
if a timestamp is missing (ie if t is present but t + freq is missing), a new period is defined (t
becomes the end time of the current period, and the next timestamp found after t defines the beginning of a new
period).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dti</strong>:  a datetime index, without NaN</li>
<li><strong>freq</strong>:  the freq of the datetime index used to find missing periods.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a list of tuples that contain the regular periods in the datetime index (defined as the start and
  inclusive end times of the period).</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.get_timeseries_frequency" class="classattr">
                                        <input id="TimeSeries.get_timeseries_frequency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.warning_deprecated_name(namespace_name=&#39;TimeSeries&#39;, new_function_name=&#39;find_most_common_frequency&#39;)</div>

        <span class="def">def</span>
        <span class="name">get_timeseries_frequency</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">index</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TimeSeries.get_timeseries_frequency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.get_timeseries_frequency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.get_timeseries_frequency-793"><a href="#TimeSeries.get_timeseries_frequency-793"><span class="linenos">793</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.get_timeseries_frequency-794"><a href="#TimeSeries.get_timeseries_frequency-794"><span class="linenos">794</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries.get_timeseries_frequency-795"><a href="#TimeSeries.get_timeseries_frequency-795"><span class="linenos">795</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;find_most_common_frequency&quot;</span>
</span><span id="TimeSeries.get_timeseries_frequency-796"><a href="#TimeSeries.get_timeseries_frequency-796"><span class="linenos">796</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.get_timeseries_frequency-797"><a href="#TimeSeries.get_timeseries_frequency-797"><span class="linenos">797</span></a>    <span class="k">def</span> <span class="nf">get_timeseries_frequency</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="TimeSeries.get_timeseries_frequency-798"><a href="#TimeSeries.get_timeseries_frequency-798"><span class="linenos">798</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.get_timeseries_frequency-799"><a href="#TimeSeries.get_timeseries_frequency-799"><span class="linenos">799</span></a><span class="sd">        Retrieve the frequency of a pandas dataframe&#39;s index.</span>
</span><span id="TimeSeries.get_timeseries_frequency-800"><a href="#TimeSeries.get_timeseries_frequency-800"><span class="linenos">800</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.get_timeseries_frequency-801"><a href="#TimeSeries.get_timeseries_frequency-801"><span class="linenos">801</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">has_single_frequency</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
</span><span id="TimeSeries.get_timeseries_frequency-802"><a href="#TimeSeries.get_timeseries_frequency-802"><span class="linenos">802</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Found several frequencies in the datetimeIndex&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.get_timeseries_frequency-803"><a href="#TimeSeries.get_timeseries_frequency-803"><span class="linenos">803</span></a>
</span><span id="TimeSeries.get_timeseries_frequency-804"><a href="#TimeSeries.get_timeseries_frequency-804"><span class="linenos">804</span></a>        <span class="k">return</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">find_most_common_frequency</span><span class="p">(</span><span class="n">dti</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the frequency of a pandas dataframe's index.</p>
</div>


                            </div>
                            <div id="TimeSeries.interpolate_freq_to_sub_freq_data" class="classattr">
                                        <input id="TimeSeries.interpolate_freq_to_sub_freq_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.warning_deprecated_name(namespace_name=&#39;TimeSeries&#39;, new_namespace_name=&#39;Resample&#39;, new_function_name=&#39;upsample_and_interpolate&#39;)</div>

        <span class="def">def</span>
        <span class="name">interpolate_freq_to_sub_freq_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	freq: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;],</span><span class="param">	tz: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;datetime.tzinfo&#x27;&gt;],</span><span class="param">	<span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>,</span><span class="param">	<span class="n">enforce_single_freq</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TimeSeries.interpolate_freq_to_sub_freq_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.interpolate_freq_to_sub_freq_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-806"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-806"><span class="linenos">806</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-807"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-807"><span class="linenos">807</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-808"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-808"><span class="linenos">808</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-809"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-809"><span class="linenos">809</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-810"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-810"><span class="linenos">810</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;upsample_and_interpolate&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-811"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-811"><span class="linenos">811</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-812"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-812"><span class="linenos">812</span></a>    <span class="k">def</span> <span class="nf">interpolate_freq_to_sub_freq_data</span><span class="p">(</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-813"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-813"><span class="linenos">813</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-814"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-814"><span class="linenos">814</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-815"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-815"><span class="linenos">815</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-816"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-816"><span class="linenos">816</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-817"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-817"><span class="linenos">817</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-818"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-818"><span class="linenos">818</span></a>        <span class="n">enforce_single_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-819"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-819"><span class="linenos">819</span></a>    <span class="p">):</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-820"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-820"><span class="linenos">820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-821"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-821"><span class="linenos">821</span></a><span class="sd">        Interpolate dataframe data on a smaller frequency than the one initially defined</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-822"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-822"><span class="linenos">822</span></a><span class="sd">        in the dataframe</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-823"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-823"><span class="linenos">823</span></a><span class="sd">        The original index of the data must have a well-defined frequency, i.e. it must be</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-824"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-824"><span class="linenos">824</span></a><span class="sd">        able to retrieve its frequency with inferred_freq</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-825"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-825"><span class="linenos">825</span></a><span class="sd">        :param df: pd.DataFrame</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-826"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-826"><span class="linenos">826</span></a><span class="sd">        :param freq: a frequency e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc.</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-827"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-827"><span class="linenos">827</span></a><span class="sd">        :param tz: the target time zone.</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-828"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-828"><span class="linenos">828</span></a><span class="sd">        :param index_name: name to give to the new index. Usually going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-829"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-829"><span class="linenos">829</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc.)</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-830"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-830"><span class="linenos">830</span></a><span class="sd">        :param enforce_single_freq: is there a single frequency in the original dataframe</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-831"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-831"><span class="linenos">831</span></a><span class="sd">        :return: pd.DataFrame</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-832"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-832"><span class="linenos">832</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-833"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-833"><span class="linenos">833</span></a>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-834"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-834"><span class="linenos">834</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-835"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-835"><span class="linenos">835</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-836"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-836"><span class="linenos">836</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-837"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-837"><span class="linenos">837</span></a>            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-838"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-838"><span class="linenos">838</span></a>            <span class="n">forward_fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-839"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-839"><span class="linenos">839</span></a>            <span class="n">is_original_frequency_unique</span><span class="o">=</span><span class="n">enforce_single_freq</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-840"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-840"><span class="linenos">840</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-841"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-841"><span class="linenos">841</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-842"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-842"><span class="linenos">842</span></a>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-843"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-843"><span class="linenos">843</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-844"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-844"><span class="linenos">844</span></a>
</span><span id="TimeSeries.interpolate_freq_to_sub_freq_data-845"><a href="#TimeSeries.interpolate_freq_to_sub_freq_data-845"><span class="linenos">845</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Interpolate dataframe data on a smaller frequency than the one initially defined
in the dataframe
The original index of the data must have a well-defined frequency, i.e. it must be
able to retrieve its frequency with inferred_freq</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  pd.DataFrame</li>
<li><strong>freq</strong>:  a frequency e.g. 'H', '30min', '15min', etc.</li>
<li><strong>tz</strong>:  the target time zone.</li>
<li><strong>index_name</strong>:  name to give to the new index. Usually going from 'date' to 'time'.</li>
<li><strong>method</strong>:  how are data interpolated between two consecutive dates (e.g. 'ffill', 'linear', etc.)</li>
<li><strong>enforce_single_freq</strong>:  is there a single frequency in the original dataframe</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>pd.DataFrame</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.forward_fill_final_record" class="classattr">
                                        <input id="TimeSeries.forward_fill_final_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_multiindex(arg_name=&#39;df&#39;)</div>
        <div class="decorator">@enda.tools.decorators.warning_deprecated_name(namespace_name=&#39;TimeSeries&#39;, new_namespace_name=&#39;Resample&#39;)</div>

        <span class="def">def</span>
        <span class="name">forward_fill_final_record</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	gap_frequency: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;],</span><span class="param">	cut_off_frequency: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;] = None</span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TimeSeries.forward_fill_final_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.forward_fill_final_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.forward_fill_final_record-847"><a href="#TimeSeries.forward_fill_final_record-847"><span class="linenos">847</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.forward_fill_final_record-848"><a href="#TimeSeries.forward_fill_final_record-848"><span class="linenos">848</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.forward_fill_final_record-849"><a href="#TimeSeries.forward_fill_final_record-849"><span class="linenos">849</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries.forward_fill_final_record-850"><a href="#TimeSeries.forward_fill_final_record-850"><span class="linenos">850</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span> <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span>
</span><span id="TimeSeries.forward_fill_final_record-851"><a href="#TimeSeries.forward_fill_final_record-851"><span class="linenos">851</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.forward_fill_final_record-852"><a href="#TimeSeries.forward_fill_final_record-852"><span class="linenos">852</span></a>    <span class="k">def</span> <span class="nf">forward_fill_final_record</span><span class="p">(</span>
</span><span id="TimeSeries.forward_fill_final_record-853"><a href="#TimeSeries.forward_fill_final_record-853"><span class="linenos">853</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="TimeSeries.forward_fill_final_record-854"><a href="#TimeSeries.forward_fill_final_record-854"><span class="linenos">854</span></a>        <span class="n">gap_frequency</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries.forward_fill_final_record-855"><a href="#TimeSeries.forward_fill_final_record-855"><span class="linenos">855</span></a>        <span class="n">cut_off_frequency</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.forward_fill_final_record-856"><a href="#TimeSeries.forward_fill_final_record-856"><span class="linenos">856</span></a>    <span class="p">):</span>
</span><span id="TimeSeries.forward_fill_final_record-857"><a href="#TimeSeries.forward_fill_final_record-857"><span class="linenos">857</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.forward_fill_final_record-858"><a href="#TimeSeries.forward_fill_final_record-858"><span class="linenos">858</span></a><span class="sd">        Forward-fill last record</span>
</span><span id="TimeSeries.forward_fill_final_record-859"><a href="#TimeSeries.forward_fill_final_record-859"><span class="linenos">859</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.forward_fill_final_record-860"><a href="#TimeSeries.forward_fill_final_record-860"><span class="linenos">860</span></a>
</span><span id="TimeSeries.forward_fill_final_record-861"><a href="#TimeSeries.forward_fill_final_record-861"><span class="linenos">861</span></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">get_timeseries_frequency</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="TimeSeries.forward_fill_final_record-862"><a href="#TimeSeries.forward_fill_final_record-862"><span class="linenos">862</span></a>        <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeSeries.forward_fill_final_record-863"><a href="#TimeSeries.forward_fill_final_record-863"><span class="linenos">863</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataframe has no frequency and cannot be extended&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.forward_fill_final_record-864"><a href="#TimeSeries.forward_fill_final_record-864"><span class="linenos">864</span></a>
</span><span id="TimeSeries.forward_fill_final_record-865"><a href="#TimeSeries.forward_fill_final_record-865"><span class="linenos">865</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="TimeSeries.forward_fill_final_record-866"><a href="#TimeSeries.forward_fill_final_record-866"><span class="linenos">866</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="TimeSeries.forward_fill_final_record-867"><a href="#TimeSeries.forward_fill_final_record-867"><span class="linenos">867</span></a>            <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">gap_frequency</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="TimeSeries.forward_fill_final_record-868"><a href="#TimeSeries.forward_fill_final_record-868"><span class="linenos">868</span></a>        <span class="p">):</span>
</span><span id="TimeSeries.forward_fill_final_record-869"><a href="#TimeSeries.forward_fill_final_record-869"><span class="linenos">869</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimeSeries.forward_fill_final_record-870"><a href="#TimeSeries.forward_fill_final_record-870"><span class="linenos">870</span></a>                <span class="s2">&quot;Cannot extend the dataframe on a smaller frequency than itself&quot;</span>
</span><span id="TimeSeries.forward_fill_final_record-871"><a href="#TimeSeries.forward_fill_final_record-871"><span class="linenos">871</span></a>            <span class="p">)</span>
</span><span id="TimeSeries.forward_fill_final_record-872"><a href="#TimeSeries.forward_fill_final_record-872"><span class="linenos">872</span></a>
</span><span id="TimeSeries.forward_fill_final_record-873"><a href="#TimeSeries.forward_fill_final_record-873"><span class="linenos">873</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">forward_fill_final_record</span><span class="p">(</span>
</span><span id="TimeSeries.forward_fill_final_record-874"><a href="#TimeSeries.forward_fill_final_record-874"><span class="linenos">874</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">gap_timedelta</span><span class="o">=</span><span class="n">gap_frequency</span><span class="p">,</span> <span class="n">cut_off</span><span class="o">=</span><span class="n">cut_off_frequency</span>
</span><span id="TimeSeries.forward_fill_final_record-875"><a href="#TimeSeries.forward_fill_final_record-875"><span class="linenos">875</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.forward_fill_final_record-876"><a href="#TimeSeries.forward_fill_final_record-876"><span class="linenos">876</span></a>        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
</span><span id="TimeSeries.forward_fill_final_record-877"><a href="#TimeSeries.forward_fill_final_record-877"><span class="linenos">877</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Forward-fill last record</p>
</div>


                            </div>
                            <div id="TimeSeries.interpolate_daily_to_sub_daily_data" class="classattr">
                                        <input id="TimeSeries.interpolate_daily_to_sub_daily_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.handle_multiindex(arg_name=&#39;df&#39;)</div>
        <div class="decorator">@enda.tools.decorators.warning_deprecated_name(namespace_name=&#39;TimeSeries&#39;, new_namespace_name=&#39;Resample&#39;, new_function_name=&#39;upsample_and_interpolate&#39;)</div>

        <span class="def">def</span>
        <span class="name">interpolate_daily_to_sub_daily_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	freq: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;],</span><span class="param">	tz: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;datetime.tzinfo&#x27;&gt;],</span><span class="param">	<span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>,</span><span class="param">	<span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ffill&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TimeSeries.interpolate_daily_to_sub_daily_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.interpolate_daily_to_sub_daily_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-879"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-879"><span class="linenos">879</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-880"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-880"><span class="linenos">880</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">handle_multiindex</span><span class="p">(</span><span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-881"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-881"><span class="linenos">881</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-882"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-882"><span class="linenos">882</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-883"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-883"><span class="linenos">883</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-884"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-884"><span class="linenos">884</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;upsample_and_interpolate&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-885"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-885"><span class="linenos">885</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-886"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-886"><span class="linenos">886</span></a>    <span class="k">def</span> <span class="nf">interpolate_daily_to_sub_daily_data</span><span class="p">(</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-887"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-887"><span class="linenos">887</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-888"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-888"><span class="linenos">888</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-889"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-889"><span class="linenos">889</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-890"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-890"><span class="linenos">890</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-891"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-891"><span class="linenos">891</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ffill&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-892"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-892"><span class="linenos">892</span></a>    <span class="p">):</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-893"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-893"><span class="linenos">893</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-894"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-894"><span class="linenos">894</span></a><span class="sd">        Interpolate daily data in a dataframe (with a DatetimeIndex) to sub-daily data using a given method.</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-895"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-895"><span class="linenos">895</span></a><span class="sd">        The last daily record is resampled using a forward-fill in any case.</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-896"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-896"><span class="linenos">896</span></a><span class="sd">        :param df: pd.DataFrame</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-897"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-897"><span class="linenos">897</span></a><span class="sd">        :param freq: a frequency &lt; &#39;D&#39; (e.g. &#39;H&#39;, &#39;30min&#39;, &#39;15min&#39;, etc)</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-898"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-898"><span class="linenos">898</span></a><span class="sd">        :param tz: the time zone (None not accepted because important)</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-899"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-899"><span class="linenos">899</span></a><span class="sd">        :param index_name: name to give to the new index. Usually going from &#39;date&#39; to &#39;time&#39;.</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-900"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-900"><span class="linenos">900</span></a><span class="sd">        :param method: how are data interpolated between two consecutive dates (e.g. &#39;ffill&#39;, &#39;linear&#39;, etc)</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-901"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-901"><span class="linenos">901</span></a><span class="sd">        :return: pd.DataFrame</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-902"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-902"><span class="linenos">902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-903"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-903"><span class="linenos">903</span></a>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-904"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-904"><span class="linenos">904</span></a>        <span class="k">return</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">upsample_and_interpolate</span><span class="p">(</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-905"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-905"><span class="linenos">905</span></a>            <span class="n">timeseries_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-906"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-906"><span class="linenos">906</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-907"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-907"><span class="linenos">907</span></a>            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-908"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-908"><span class="linenos">908</span></a>            <span class="n">forward_fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-909"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-909"><span class="linenos">909</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-910"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-910"><span class="linenos">910</span></a>            <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">,</span>
</span><span id="TimeSeries.interpolate_daily_to_sub_daily_data-911"><a href="#TimeSeries.interpolate_daily_to_sub_daily_data-911"><span class="linenos">911</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Interpolate daily data in a dataframe (with a DatetimeIndex) to sub-daily data using a given method.
The last daily record is resampled using a forward-fill in any case.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  pd.DataFrame</li>
<li><strong>freq</strong>:  a frequency &lt; 'D' (e.g. 'H', '30min', '15min', etc)</li>
<li><strong>tz</strong>:  the time zone (None not accepted because important)</li>
<li><strong>index_name</strong>:  name to give to the new index. Usually going from 'date' to 'time'.</li>
<li><strong>method</strong>:  how are data interpolated between two consecutive dates (e.g. 'ffill', 'linear', etc)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>pd.DataFrame</p>
</blockquote>
</div>


                            </div>
                            <div id="TimeSeries.average_to_upper_freq" class="classattr">
                                        <input id="TimeSeries.average_to_upper_freq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@enda.tools.decorators.warning_deprecated_name(namespace_name=&#39;TimeSeries&#39;, new_namespace_name=&#39;Resample&#39;, new_function_name=&#39;downsample&#39;)</div>

        <span class="def">def</span>
        <span class="name">average_to_upper_freq</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	freq: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;],</span><span class="param">	tz: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;datetime.tzinfo&#x27;&gt;],</span><span class="param">	<span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">enforce_single_freq</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TimeSeries.average_to_upper_freq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeSeries.average_to_upper_freq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeSeries.average_to_upper_freq-913"><a href="#TimeSeries.average_to_upper_freq-913"><span class="linenos">913</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimeSeries.average_to_upper_freq-914"><a href="#TimeSeries.average_to_upper_freq-914"><span class="linenos">914</span></a>    <span class="nd">@enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">warning_deprecated_name</span><span class="p">(</span>
</span><span id="TimeSeries.average_to_upper_freq-915"><a href="#TimeSeries.average_to_upper_freq-915"><span class="linenos">915</span></a>        <span class="n">namespace_name</span><span class="o">=</span><span class="s2">&quot;TimeSeries&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-916"><a href="#TimeSeries.average_to_upper_freq-916"><span class="linenos">916</span></a>        <span class="n">new_namespace_name</span><span class="o">=</span><span class="s2">&quot;Resample&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-917"><a href="#TimeSeries.average_to_upper_freq-917"><span class="linenos">917</span></a>        <span class="n">new_function_name</span><span class="o">=</span><span class="s2">&quot;downsample&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-918"><a href="#TimeSeries.average_to_upper_freq-918"><span class="linenos">918</span></a>    <span class="p">)</span>
</span><span id="TimeSeries.average_to_upper_freq-919"><a href="#TimeSeries.average_to_upper_freq-919"><span class="linenos">919</span></a>    <span class="k">def</span> <span class="nf">average_to_upper_freq</span><span class="p">(</span>
</span><span id="TimeSeries.average_to_upper_freq-920"><a href="#TimeSeries.average_to_upper_freq-920"><span class="linenos">920</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-921"><a href="#TimeSeries.average_to_upper_freq-921"><span class="linenos">921</span></a>        <span class="n">freq</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">],</span>
</span><span id="TimeSeries.average_to_upper_freq-922"><a href="#TimeSeries.average_to_upper_freq-922"><span class="linenos">922</span></a>        <span class="n">tz</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">],</span>
</span><span id="TimeSeries.average_to_upper_freq-923"><a href="#TimeSeries.average_to_upper_freq-923"><span class="linenos">923</span></a>        <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-924"><a href="#TimeSeries.average_to_upper_freq-924"><span class="linenos">924</span></a>        <span class="n">enforce_single_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-925"><a href="#TimeSeries.average_to_upper_freq-925"><span class="linenos">925</span></a>    <span class="p">):</span>
</span><span id="TimeSeries.average_to_upper_freq-926"><a href="#TimeSeries.average_to_upper_freq-926"><span class="linenos">926</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeSeries.average_to_upper_freq-927"><a href="#TimeSeries.average_to_upper_freq-927"><span class="linenos">927</span></a><span class="sd">        Downsample data provided in a given dataframe with a DatetimeIndex, or a two-levels</span>
</span><span id="TimeSeries.average_to_upper_freq-928"><a href="#TimeSeries.average_to_upper_freq-928"><span class="linenos">928</span></a><span class="sd">        compatible Multiindex.</span>
</span><span id="TimeSeries.average_to_upper_freq-929"><a href="#TimeSeries.average_to_upper_freq-929"><span class="linenos">929</span></a><span class="sd">        The provided frequency serves as a basis to group the data and average.</span>
</span><span id="TimeSeries.average_to_upper_freq-930"><a href="#TimeSeries.average_to_upper_freq-930"><span class="linenos">930</span></a><span class="sd">        If the initial dataframe has no frequency, we raise an error.</span>
</span><span id="TimeSeries.average_to_upper_freq-931"><a href="#TimeSeries.average_to_upper_freq-931"><span class="linenos">931</span></a>
</span><span id="TimeSeries.average_to_upper_freq-932"><a href="#TimeSeries.average_to_upper_freq-932"><span class="linenos">932</span></a><span class="sd">        Example:</span>
</span><span id="TimeSeries.average_to_upper_freq-933"><a href="#TimeSeries.average_to_upper_freq-933"><span class="linenos">933</span></a>
</span><span id="TimeSeries.average_to_upper_freq-934"><a href="#TimeSeries.average_to_upper_freq-934"><span class="linenos">934</span></a><span class="sd">        1. Given df:</span>
</span><span id="TimeSeries.average_to_upper_freq-935"><a href="#TimeSeries.average_to_upper_freq-935"><span class="linenos">935</span></a><span class="sd">        time_index                value</span>
</span><span id="TimeSeries.average_to_upper_freq-936"><a href="#TimeSeries.average_to_upper_freq-936"><span class="linenos">936</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1</span>
</span><span id="TimeSeries.average_to_upper_freq-937"><a href="#TimeSeries.average_to_upper_freq-937"><span class="linenos">937</span></a><span class="sd">        2021-01-01 00:12:00+01:00 2</span>
</span><span id="TimeSeries.average_to_upper_freq-938"><a href="#TimeSeries.average_to_upper_freq-938"><span class="linenos">938</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="TimeSeries.average_to_upper_freq-939"><a href="#TimeSeries.average_to_upper_freq-939"><span class="linenos">939</span></a>
</span><span id="TimeSeries.average_to_upper_freq-940"><a href="#TimeSeries.average_to_upper_freq-940"><span class="linenos">940</span></a><span class="sd">        average_to_upper_freq(df, freq=&#39;1D&#39;):</span>
</span><span id="TimeSeries.average_to_upper_freq-941"><a href="#TimeSeries.average_to_upper_freq-941"><span class="linenos">941</span></a><span class="sd">        2021-01-01 00:00:00+01:00 1.5</span>
</span><span id="TimeSeries.average_to_upper_freq-942"><a href="#TimeSeries.average_to_upper_freq-942"><span class="linenos">942</span></a><span class="sd">        2021-01-02 00:00:00+01:00 3</span>
</span><span id="TimeSeries.average_to_upper_freq-943"><a href="#TimeSeries.average_to_upper_freq-943"><span class="linenos">943</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeSeries.average_to_upper_freq-944"><a href="#TimeSeries.average_to_upper_freq-944"><span class="linenos">944</span></a>
</span><span id="TimeSeries.average_to_upper_freq-945"><a href="#TimeSeries.average_to_upper_freq-945"><span class="linenos">945</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">Resample</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span>
</span><span id="TimeSeries.average_to_upper_freq-946"><a href="#TimeSeries.average_to_upper_freq-946"><span class="linenos">946</span></a>            <span class="n">df</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-947"><a href="#TimeSeries.average_to_upper_freq-947"><span class="linenos">947</span></a>            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-948"><a href="#TimeSeries.average_to_upper_freq-948"><span class="linenos">948</span></a>            <span class="n">agg_functions</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-949"><a href="#TimeSeries.average_to_upper_freq-949"><span class="linenos">949</span></a>            <span class="n">is_original_frequency_unique</span><span class="o">=</span><span class="n">enforce_single_freq</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-950"><a href="#TimeSeries.average_to_upper_freq-950"><span class="linenos">950</span></a>            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
</span><span id="TimeSeries.average_to_upper_freq-951"><a href="#TimeSeries.average_to_upper_freq-951"><span class="linenos">951</span></a>        <span class="p">)</span>
</span><span id="TimeSeries.average_to_upper_freq-952"><a href="#TimeSeries.average_to_upper_freq-952"><span class="linenos">952</span></a>
</span><span id="TimeSeries.average_to_upper_freq-953"><a href="#TimeSeries.average_to_upper_freq-953"><span class="linenos">953</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">enda</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">timezone_utils</span><span class="o">.</span><span class="n">TimezoneUtils</span><span class="o">.</span><span class="n">set_timezone</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tz_info</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
</span><span id="TimeSeries.average_to_upper_freq-954"><a href="#TimeSeries.average_to_upper_freq-954"><span class="linenos">954</span></a>
</span><span id="TimeSeries.average_to_upper_freq-955"><a href="#TimeSeries.average_to_upper_freq-955"><span class="linenos">955</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Downsample data provided in a given dataframe with a DatetimeIndex, or a two-levels
compatible Multiindex.
The provided frequency serves as a basis to group the data and average.
If the initial dataframe has no frequency, we raise an error.</p>

<p>Example:</p>

<ol>
<li>Given df:
time_index                value
2021-01-01 00:00:00+01:00 1
2021-01-01 00:12:00+01:00 2
2021-01-02 00:00:00+01:00 3</li>
</ol>

<p>average_to_upper_freq(df, freq='1D'):
2021-01-01 00:00:00+01:00 1.5
2021-01-02 00:00:00+01:00 3</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>