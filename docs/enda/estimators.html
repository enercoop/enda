<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>enda.estimators API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../enda.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;enda</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#EndaEstimator">EndaEstimator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EndaEstimator.train">train</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaEstimator.predict">predict</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EndaNormalizedEstimator">EndaNormalizedEstimator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EndaNormalizedEstimator.__init__">EndaNormalizedEstimator</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaNormalizedEstimator.inner_estimator">inner_estimator</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaNormalizedEstimator.target_col">target_col</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaNormalizedEstimator.normalisation_col">normalisation_col</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaNormalizedEstimator.columns_to_normalize">columns_to_normalize</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaNormalizedEstimator.check_normalization_col">check_normalization_col</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaNormalizedEstimator.normalize">normalize</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaNormalizedEstimator.train">train</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaNormalizedEstimator.predict">predict</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EndaStackingEstimator">EndaStackingEstimator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EndaStackingEstimator.__init__">EndaStackingEstimator</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaStackingEstimator.base_estimators">base_estimators</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaStackingEstimator.final_estimator">final_estimator</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaStackingEstimator.base_stack_split_pct">base_stack_split_pct</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaStackingEstimator.train">train</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaStackingEstimator.train_final_estimator">train_final_estimator</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaStackingEstimator.predict_base_estimators">predict_base_estimators</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaStackingEstimator.train_base_estimators">train_base_estimators</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaStackingEstimator.predict">predict</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EndaEstimatorWithFallback">EndaEstimatorWithFallback</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EndaEstimatorWithFallback.__init__">EndaEstimatorWithFallback</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaEstimatorWithFallback.resilient_column">resilient_column</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaEstimatorWithFallback.estimator_with">estimator_with</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaEstimatorWithFallback.estimator_without">estimator_without</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaEstimatorWithFallback.train">train</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaEstimatorWithFallback.predict_both">predict_both</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaEstimatorWithFallback.predict">predict</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaEstimatorWithFallback.get_model_params">get_model_params</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EndaEstimatorRecopy">EndaEstimatorRecopy</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EndaEstimatorRecopy.__init__">EndaEstimatorRecopy</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaEstimatorRecopy.period">period</a>
                        </li>
                        <li>
                                <a class="variable" href="#EndaEstimatorRecopy.training_data">training_data</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaEstimatorRecopy.train">train</a>
                        </li>
                        <li>
                                <a class="function" href="#EndaEstimatorRecopy.predict">predict</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../enda.html">enda</a><wbr>.estimators    </h1>

                        <div class="docstring"><p>This module contains several basic machine learning estimators</p>
</div>

                        <input id="mod-estimators-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-estimators-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;This module contains several basic machine learning estimators&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">abc</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">typing</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="k">class</span> <span class="nc">EndaEstimator</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    This interface represents a simple machine learning estimator with some universal functions.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    We require these functions :</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">        train : train the estimator</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">        predict : predict using the estimator</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    To save and load instances of a class, use tools like pickle or joblib</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    (see information for instance here: https://scikit-learn.org/stable/modules/model_persistence.html).</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    This interface is useful to create more advanced estimators based on these building blocks :</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">        EndaNormalizedEstimator : uses one of the inputs as a &#39;normalization variable&#39; instead of a &#39;training feature&#39;.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">        EndaStackingEstimator : combines several estimators to create a more robust estimator</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">                                (cross-algorithm &#39;ensemble&#39; method).</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">        EndaEstimatorWithFallback : an estimator that can cope with missing input in a robust way.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    See tutorials about Python interfaces for instance here https://realpython.com/python-interface/ .</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="k">def</span> <span class="nf">__subclasshook__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>            <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>            <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="o">.</span><span class="n">train</span><span class="p">)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s2">&quot;predict&quot;</span><span class="p">)</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>            <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="p">)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trains the estimator using the given data.&quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predicts and returns a dataframe with just 1 column: target_col_name&quot;&quot;&quot;</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="k">class</span> <span class="nc">EndaNormalizedEstimator</span><span class="p">(</span><span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    An estimator that uses one of the inputs as a linear &#39;normalization variable&#39; instead of a &#39;training feature&#39;.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    The prediction is:</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    predict(X) = X[normalization_col] * predict(X without normalization_col)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    predict(X without normalization_col) is made by another underlying estimator: inner_estimator.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="n">inner_estimator</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">normalization_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">columns_to_normalize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="p">):</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        Initialize the normalized estimator</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        :param inner_estimator: the estimator that will perform predict(X without normalization_col)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        :param normalization_col: name of the column used as a multiplier and not as a feature.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        :param columns_to_normalize: (optional) columns in &#39;X without normalization_col&#39; that must be divided</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        by normalization_col for the underlying estimator to train/predict correctly.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">inner_estimator</span><span class="p">),</span> <span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>                <span class="sa">f</span><span class="s2">&quot;inner_estimator&#39;s type is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">inner_estimator</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; : it must implement EndaEstimator.&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>            <span class="p">)</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="k">if</span> <span class="n">columns_to_normalize</span> <span class="ow">and</span> <span class="n">normalization_col</span> <span class="ow">in</span> <span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>                <span class="sa">f</span><span class="s2">&quot;normalisation_col &#39;</span><span class="si">{</span><span class="n">normalization_col</span><span class="si">}</span><span class="s2">&#39;should not be in columns_to_normalize </span><span class="si">{</span><span class="n">columns_to_normalize</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>            <span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span> <span class="o">=</span> <span class="n">inner_estimator</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">=</span> <span class="n">target_col</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span> <span class="o">=</span> <span class="n">normalization_col</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span> <span class="o">=</span> <span class="n">columns_to_normalize</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">check_normalization_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        Checks that the values of the normalization col in the input DataFrame are strictly positive, otherwise</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        raise an error</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        :param df: The DataFrame to check</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                <span class="sa">f</span><span class="s2">&quot;Normalisation_col &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="si">}</span><span class="s2">&#39; not present in the Dataframe to normalize&quot;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>            <span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="n">zeros_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">zeros_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                <span class="sa">f</span><span class="s2">&quot;Normalisation_col &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="si">}</span><span class="s2">&#39; : zeros found</span><span class="se">\n</span><span class="si">{</span><span class="n">zeros_df</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        Checks that the normalization column has only strictly positive values, then normalizes the columns of the</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        DataFrame that are in the columns_to_normalize attribute by dividing them by the normalization column. Also</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        normalizes the target_col if it is in the DataFrame columns. Then, drops normalization_col</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        :param df: The DataFrame to normalize</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        :return: The DataFrame with columns part of columns_to_normalize or the target_col column normalized, and</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">            without the normalization_col</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_normalization_col</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>                    <span class="n">df_norm</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_norm</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="c1"># always normalize the target if it is in the df (present in train mode, not in predict mode)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="n">df_norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                <span class="n">df_norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>            <span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="n">df_norm</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="n">df_norm</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="n">drop_where_normalization_under_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="p">):</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        Normalizes the DataFrame and trains the inner estimator</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        :param df: The training DataFrame</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">        :param target_col: The variable to predict</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        :param drop_where_normalization_under_zero: Whether to drop rows where normalization_col is not strictly</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">            positive. Note that the normalize function will raise an error if there is still negative values in</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">            normalization_col</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">!=</span> <span class="n">target_col</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                <span class="sa">f</span><span class="s2">&quot;target should be None or </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2">, but given: </span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="n">drop_where_normalization_under_zero</span><span class="p">:</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        Normalizes the input DataFrame, then uses the inner estimator to make a prediction on target_col. Then,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        multiplies the result by the normalization_col to get the final prediction</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        :param df: The forecast input DataFrame</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        :param target_col: The variable to predict</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        :return: The final prediction of the estimator</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">!=</span> <span class="n">target_col</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                <span class="sa">f</span><span class="s2">&quot;target should be None or &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39;, but given: &#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>            <span class="n">df</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="p">)</span>  <span class="c1"># error out if any value of normalization_col is &lt;= 0</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="n">predict_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">predict_norm</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>                <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>                <span class="s2">&quot;Check that for self.inner_estimator, the method &#39;predict&#39; conserves index.&quot;</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>            <span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="n">predict</span> <span class="o">=</span> <span class="n">predict_norm</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="n">predict</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="k">class</span> <span class="nc">EndaStackingEstimator</span><span class="p">(</span><span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">    This class serves the same purpose as the Scikit-Learn &quot;Stacking Regressor&quot;. However since we work on</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">    time-series, we need fine control on which data is passed to train the base_estimators before training</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">    the final_estimator (to keep it all chronologically consistent).</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">    Training is made this way :</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        temporarily train base_estimators on train_set[:x]</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        use base_estimators to predict on train_set[x:] -&gt; base_predictions</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">        train final_estimator on the base_predictions</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        re-train base_estimators on the full train-set</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">    We have to train base_estimators twice, because if we trained them on the full set and then predict on</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">    train_set[x:] for training final_estimator, we would be making a prediction on part of the data that was used to</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">    train them, which would be a huge risk of over-fitting</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="n">base_estimators</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EndaEstimator</span><span class="p">],</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">final_estimator</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="n">base_stack_split_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.20</span><span class="p">,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="p">):</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        Initialize the stacking estimator</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        :param base_estimators: a dict of {estimator_id -&gt; estimator}, each estimator (there must be at least 2) must</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">            be an EndaEstimator.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        :param final_estimator: the estimator used for stacking, must also implement be an EndaEstimator.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        :param base_stack_split_pct: the % of data used to train the base_estimators before training final_estimator</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">            (this can be overwritten in the train function).</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_estimators</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                <span class="sa">f</span><span class="s2">&quot;At least 2 base_estimators are required, but given: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">base_estimators</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="c1"># We store estimators in an ordered dict to make sure we always iterate over them in the same order</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="k">for</span> <span class="n">estimator_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="p">[</span><span class="n">estimator_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_estimators</span><span class="p">[</span><span class="n">estimator_id</span><span class="p">]</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span> <span class="o">=</span> <span class="n">final_estimator</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_stack_split_pct</span> <span class="o">=</span> <span class="n">base_stack_split_pct</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="n">base_stack_split_pct</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="p">):</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        Train base and final estimators.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        :param df: The training dataset</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        :param base_stack_split_pct: If specified, will overwrite the EndaStackingEstimator attribute.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="n">split_pct</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="n">base_stack_split_pct</span> <span class="k">if</span> <span class="n">base_stack_split_pct</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_stack_split_pct</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="p">)</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="c1"># training final_estimator will temporarily train single estimators on part of the data,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="c1"># so it must be done before training the actual single estimators</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_final_estimator</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">split_pct</span><span class="p">)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="c1"># re-train base estimators with the full dataset</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_base_estimators</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>    <span class="k">def</span> <span class="nf">train_final_estimator</span><span class="p">(</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">split_pct</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="p">):</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        Trains the final estimator used for stacking.</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        (Temporarily) train the single estimators with a subset of the data,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        then apply them on the rest of the data. Use this to train the stacking estimator.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">        :param df: The DataFrame with training data</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">        :param split_pct: The percentage of training data to use to train the base estimators. The rest of the data</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">            will be used to train the final estimator based on the predictions of the base estimators</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="c1"># split the training frame : ,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="n">split_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">split_pct</span><span class="p">))</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="n">split_idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">split_int</span><span class="p">]</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="n">df_base_estimators</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">split_idx</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="p">]</span>  <span class="c1"># one part to train the base estimators</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="n">df_stacking</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">split_idx</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="p">]</span>  <span class="c1"># the other to train the stacking estimator</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="n">df_base_estimators</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">df_stacking</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>                <span class="s2">&quot;The split gave an empty train set for the base estimators or the final estimator. &quot;</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="sa">f</span><span class="s2">&quot;Change parameter &#39;split_pct&#39; (given </span><span class="si">{</span><span class="n">split_pct</span><span class="si">}</span><span class="s2">) or provide a larger training set.&quot;</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_base_estimators</span><span class="p">(</span><span class="n">df_base_estimators</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="c1"># make predictions with these temporary base_estimators, without the target column</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="n">base_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_base_estimators</span><span class="p">(</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">df_stacking</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_col</span><span class="p">]),</span> <span class="n">target_col</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="c1"># add the target back, to train the final estimator</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">base_predictions</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_stacking</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">base_predictions</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">predict_base_estimators</span><span class="p">(</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        Make a prediction using base estimators</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">        :param df: The input DataFrame for prediction</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">        :param target_col: The name of the column to predict</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        :return: a Dataframe with the prediction of each base estimator in each column (on several rows).</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">            Each column&#39;s name is the estimator_id given on initialisation.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="n">estimator_dfs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="k">for</span> <span class="n">estimator_id</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>            <span class="n">estimator_predict</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">estimator_predict</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>                    <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                    <span class="sa">f</span><span class="s2">&quot;Check that for estimator with id &#39;</span><span class="si">{</span><span class="n">estimator_id</span><span class="si">}</span><span class="s2">&#39;, the method &#39;predict&#39; conserves index.&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                <span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="n">estimator_predict</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">target_col</span><span class="p">:</span> <span class="n">estimator_id</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="n">estimator_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator_predict</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="n">predict_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">estimator_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="k">if</span> <span class="n">predict_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                <span class="sa">f</span><span class="s2">&quot;Given </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> values to predict, but predicted </span><span class="si">{</span><span class="n">predict_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>            <span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="k">return</span> <span class="n">predict_df</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="nf">train_base_estimators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        Train the base estimators</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        :param df: The training data</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>            <span class="n">estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        Make predictions with base estimators, then uses them to make a prediction with the final estimator</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        :return: A DataFrame with the predicted column</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="n">base_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_base_estimators</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">base_predictions</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                <span class="s2">&quot;Check that self.final_estimator.predict conserves index.&quot;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="n">prediction</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="k">class</span> <span class="nc">EndaEstimatorWithFallback</span><span class="p">(</span><span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">    This estimator allows to make a prediction even when some important input is missing.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">    In order to deal with missing values, it is common practice to replace None/NA with some meaningful value like</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">    the mean or the median of the values found in the train set for this feature.</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">    However, this is problematic when the missing variable has a significant impact on the prediction.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">    Instead, this estimator trains 2 underlying estimators:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">    an &#39;estimator_with&#39; and an &#39;estimator_without&#39; the column that can be missing.</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    When predicting, it will use the &#39;estimator_with&#39; for inputs with the column present</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">    and the &#39;estimator_without&#39; for the others.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="n">resilient_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="n">estimator_with</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">estimator_without</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="p">):</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        Initialize the estimator</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        :param resilient_column: The column that can be missing, which will be taken into account by estimator_with but</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">            not by estimator_without</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        :param estimator_with: An EndaEstimator that will train/predict using resilient_column</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        :param estimator_without: An EndaEstimator that will train/predict without using resilient_column</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="k">if</span> <span class="n">estimator_with</span> <span class="ow">is</span> <span class="n">estimator_without</span><span class="p">:</span>  <span class="c1"># check identity</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                <span class="s2">&quot;estimator_with and estimator_without must be different objects. &quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>                <span class="s2">&quot;If you want the same base estimator, you can use copying tools &quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>                <span class="s2">&quot; (like copy.deepcopy()) to duplicate the raw estimator.&quot;</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>            <span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span> <span class="o">=</span> <span class="n">resilient_column</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span> <span class="o">=</span> <span class="n">estimator_with</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span> <span class="o">=</span> <span class="n">estimator_without</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        Trains the two estimators : estimator_with and estimator_without the resilient_column</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        :param df: The input data for training</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="c1"># only train the &quot;estimator_with&quot; where resilient_column is present (not NA)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]),</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="c1"># train the &quot;estimator_without&quot; without resilient_column</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]),</span> <span class="n">target_col</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>    <span class="k">def</span> <span class="nf">predict_both</span><span class="p">(</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        Makes predictions with both estimators: estimator_with and estimator_without the resilient_column</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        :return: A tuple with two DataFrames, the first one being the prediction with the resilient_column and the</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">            second one without</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="n">df_with</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="p">]</span>  <span class="c1"># only keeps rows where resilient_column is not NaN</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="n">prediction_with</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_with</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="k">if</span> <span class="n">prediction_with</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="c1"># make estimator_with predict NaN where resilient_column is Nan :</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="n">prediction_with</span> <span class="o">=</span> <span class="n">prediction_with</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="p">)</span>  <span class="c1"># adds rows with NaN values</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction_with</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                <span class="s2">&quot;prediction_with must have the same index as given df. &quot;</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                <span class="s2">&quot;Check that self.estimator_with.predict conserves index.&quot;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>            <span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="n">df_without</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">])</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">prediction_without</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_without</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction_without</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>                <span class="s2">&quot;prediction_without must have the same index as given df. &quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>                <span class="s2">&quot;Check that self.estimator_without.predict conserves index.&quot;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="k">return</span> <span class="n">prediction_with</span><span class="p">,</span> <span class="n">prediction_without</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        Makes a prediction with both estimators, takes prediction by estimator_with by default and fallbacks to</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        estimator_without when it is not available</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        :return: The final prediction combining both estimators</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">predict_with</span><span class="p">,</span> <span class="n">predict_without</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_both</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="c1"># keep prediction with column_name when available, else take the prediction of the estimator without it</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">predict_with</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="n">predict_without</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="p">)</span>  <span class="c1"># pandas series</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>    <span class="k">def</span> <span class="nf">_get_model_name_and_params</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">params</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="k">def</span> <span class="nf">get_model_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        Get model parameters of estimator_with and estimator_without</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">        :return: A dictionary with one entry per model and associated parameters</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="c1"># TODO : ne fonctionne que pour des estimateurs stacks ?</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="s2">&quot;estimator_with&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;final_estimators&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>            <span class="s2">&quot;estimator_without&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;final_estimators&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="p">}</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>            <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_with&quot;</span><span class="p">][</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_without&quot;</span><span class="p">][</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">final_estimator</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_with&quot;</span><span class="p">][</span><span class="s2">&quot;final_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">final_estimator</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_without&quot;</span><span class="p">][</span><span class="s2">&quot;final_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="k">return</span> <span class="n">d</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="k">class</span> <span class="nc">EndaEstimatorRecopy</span><span class="p">(</span><span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">    This estimator is used to recopy the information</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">    It is notably used to predict the production of river power plants, for which no</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">    artificial intelligence is relevant.</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">    It simply recopies the most recent data on a daily basis.</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        Set up the attribute data that will store the dataframe</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">        :param period: The period on which past data should be averaged to be used as future value.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">                       It must be convertible to a pd.Timedelta object, eg &#39;1D&#39;, &#39;2H&#39;, etc...</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">                       If nothing is provided, the last past value is used in the future</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="k">if</span> <span class="n">period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">        This function keeps the more recent data of the input dataframe,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">        and stores it in the attribute training_data. If a period has been</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">        given to the estimator constructor, it is used to define a period on</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">        which to average the data.</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        :param df: The input dataframe, with a single DatetimeIndex</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        :param target_col: the target column</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Index should be of type DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>                <span class="sa">f</span><span class="s2">&quot;Target column </span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> not found in the training dataframe&quot;</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>            <span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>                <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">target_col</span><span class="p">])</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="p">]</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>            <span class="c1"># the training dataframe must have a well-defined frequency</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">target_col</span><span class="p">]),</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">        Make a prediction just copying the retained information.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">        :param df: The input forecast dataframe, with a single DatetimeIndex</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        :param target_col: the target column</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>                <span class="s2">&quot;There is no training dataset defined. Must call &#39;train&#39; before &#39;predict&#39;&quot;</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>            <span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_data</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>                <span class="s2">&quot;Forecast dataset index should be of same type of input dataset&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="n">df_predict</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="n">df_predict</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="k">return</span> <span class="n">df_predict</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">target_col</span><span class="p">]]</span>
</span></pre></div>


            </section>
                <section id="EndaEstimator">
                            <input id="EndaEstimator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EndaEstimator</span>:

                <label class="view-source-button" for="EndaEstimator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimator-12"><a href="#EndaEstimator-12"><span class="linenos">12</span></a><span class="k">class</span> <span class="nc">EndaEstimator</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
</span><span id="EndaEstimator-13"><a href="#EndaEstimator-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimator-14"><a href="#EndaEstimator-14"><span class="linenos">14</span></a><span class="sd">    This interface represents a simple machine learning estimator with some universal functions.</span>
</span><span id="EndaEstimator-15"><a href="#EndaEstimator-15"><span class="linenos">15</span></a><span class="sd">    We require these functions :</span>
</span><span id="EndaEstimator-16"><a href="#EndaEstimator-16"><span class="linenos">16</span></a><span class="sd">        train : train the estimator</span>
</span><span id="EndaEstimator-17"><a href="#EndaEstimator-17"><span class="linenos">17</span></a><span class="sd">        predict : predict using the estimator</span>
</span><span id="EndaEstimator-18"><a href="#EndaEstimator-18"><span class="linenos">18</span></a>
</span><span id="EndaEstimator-19"><a href="#EndaEstimator-19"><span class="linenos">19</span></a><span class="sd">    To save and load instances of a class, use tools like pickle or joblib</span>
</span><span id="EndaEstimator-20"><a href="#EndaEstimator-20"><span class="linenos">20</span></a><span class="sd">    (see information for instance here: https://scikit-learn.org/stable/modules/model_persistence.html).</span>
</span><span id="EndaEstimator-21"><a href="#EndaEstimator-21"><span class="linenos">21</span></a>
</span><span id="EndaEstimator-22"><a href="#EndaEstimator-22"><span class="linenos">22</span></a><span class="sd">    This interface is useful to create more advanced estimators based on these building blocks :</span>
</span><span id="EndaEstimator-23"><a href="#EndaEstimator-23"><span class="linenos">23</span></a><span class="sd">        EndaNormalizedEstimator : uses one of the inputs as a &#39;normalization variable&#39; instead of a &#39;training feature&#39;.</span>
</span><span id="EndaEstimator-24"><a href="#EndaEstimator-24"><span class="linenos">24</span></a><span class="sd">        EndaStackingEstimator : combines several estimators to create a more robust estimator</span>
</span><span id="EndaEstimator-25"><a href="#EndaEstimator-25"><span class="linenos">25</span></a><span class="sd">                                (cross-algorithm &#39;ensemble&#39; method).</span>
</span><span id="EndaEstimator-26"><a href="#EndaEstimator-26"><span class="linenos">26</span></a><span class="sd">        EndaEstimatorWithFallback : an estimator that can cope with missing input in a robust way.</span>
</span><span id="EndaEstimator-27"><a href="#EndaEstimator-27"><span class="linenos">27</span></a>
</span><span id="EndaEstimator-28"><a href="#EndaEstimator-28"><span class="linenos">28</span></a><span class="sd">    See tutorials about Python interfaces for instance here https://realpython.com/python-interface/ .</span>
</span><span id="EndaEstimator-29"><a href="#EndaEstimator-29"><span class="linenos">29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EndaEstimator-30"><a href="#EndaEstimator-30"><span class="linenos">30</span></a>
</span><span id="EndaEstimator-31"><a href="#EndaEstimator-31"><span class="linenos">31</span></a>    <span class="nd">@classmethod</span>
</span><span id="EndaEstimator-32"><a href="#EndaEstimator-32"><span class="linenos">32</span></a>    <span class="k">def</span> <span class="nf">__subclasshook__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
</span><span id="EndaEstimator-33"><a href="#EndaEstimator-33"><span class="linenos">33</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="EndaEstimator-34"><a href="#EndaEstimator-34"><span class="linenos">34</span></a>            <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span>
</span><span id="EndaEstimator-35"><a href="#EndaEstimator-35"><span class="linenos">35</span></a>            <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="o">.</span><span class="n">train</span><span class="p">)</span>
</span><span id="EndaEstimator-36"><a href="#EndaEstimator-36"><span class="linenos">36</span></a>            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s2">&quot;predict&quot;</span><span class="p">)</span>
</span><span id="EndaEstimator-37"><a href="#EndaEstimator-37"><span class="linenos">37</span></a>            <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
</span><span id="EndaEstimator-38"><a href="#EndaEstimator-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span><span id="EndaEstimator-39"><a href="#EndaEstimator-39"><span class="linenos">39</span></a>
</span><span id="EndaEstimator-40"><a href="#EndaEstimator-40"><span class="linenos">40</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="EndaEstimator-41"><a href="#EndaEstimator-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EndaEstimator-42"><a href="#EndaEstimator-42"><span class="linenos">42</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trains the estimator using the given data.&quot;&quot;&quot;</span>
</span><span id="EndaEstimator-43"><a href="#EndaEstimator-43"><span class="linenos">43</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="EndaEstimator-44"><a href="#EndaEstimator-44"><span class="linenos">44</span></a>
</span><span id="EndaEstimator-45"><a href="#EndaEstimator-45"><span class="linenos">45</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="EndaEstimator-46"><a href="#EndaEstimator-46"><span class="linenos">46</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaEstimator-47"><a href="#EndaEstimator-47"><span class="linenos">47</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predicts and returns a dataframe with just 1 column: target_col_name&quot;&quot;&quot;</span>
</span><span id="EndaEstimator-48"><a href="#EndaEstimator-48"><span class="linenos">48</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>This interface represents a simple machine learning estimator with some universal functions.
We require these functions :
    train : train the estimator
    predict : predict using the estimator</p>

<p>To save and load instances of a class, use tools like pickle or joblib
(see information for instance here: https://scikit-learn.org/stable/modules/model_persistence.html).</p>

<p>This interface is useful to create more advanced estimators based on these building blocks :
    EndaNormalizedEstimator : uses one of the inputs as a 'normalization variable' instead of a 'training feature'.
    EndaStackingEstimator : combines several estimators to create a more robust estimator
                            (cross-algorithm 'ensemble' method).
    EndaEstimatorWithFallback : an estimator that can cope with missing input in a robust way.</p>

<p>See tutorials about Python interfaces for instance here <a href="https://realpython.com/python-interface/">https://realpython.com/python-interface/</a> .</p>
</div>


                            <div id="EndaEstimator.train" class="classattr">
                                        <input id="EndaEstimator.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>, </span><span class="param"><span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaEstimator.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimator.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimator.train-40"><a href="#EndaEstimator.train-40"><span class="linenos">40</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="EndaEstimator.train-41"><a href="#EndaEstimator.train-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EndaEstimator.train-42"><a href="#EndaEstimator.train-42"><span class="linenos">42</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trains the estimator using the given data.&quot;&quot;&quot;</span>
</span><span id="EndaEstimator.train-43"><a href="#EndaEstimator.train-43"><span class="linenos">43</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Trains the estimator using the given data.</p>
</div>


                            </div>
                            <div id="EndaEstimator.predict" class="classattr">
                                        <input id="EndaEstimator.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="EndaEstimator.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimator.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimator.predict-45"><a href="#EndaEstimator.predict-45"><span class="linenos">45</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="EndaEstimator.predict-46"><a href="#EndaEstimator.predict-46"><span class="linenos">46</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaEstimator.predict-47"><a href="#EndaEstimator.predict-47"><span class="linenos">47</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predicts and returns a dataframe with just 1 column: target_col_name&quot;&quot;&quot;</span>
</span><span id="EndaEstimator.predict-48"><a href="#EndaEstimator.predict-48"><span class="linenos">48</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Predicts and returns a dataframe with just 1 column: target_col_name</p>
</div>


                            </div>
                </section>
                <section id="EndaNormalizedEstimator">
                            <input id="EndaNormalizedEstimator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EndaNormalizedEstimator</span><wbr>(<span class="base"><a href="#EndaEstimator">EndaEstimator</a></span>):

                <label class="view-source-button" for="EndaNormalizedEstimator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaNormalizedEstimator-51"><a href="#EndaNormalizedEstimator-51"><span class="linenos"> 51</span></a><span class="k">class</span> <span class="nc">EndaNormalizedEstimator</span><span class="p">(</span><span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="EndaNormalizedEstimator-52"><a href="#EndaNormalizedEstimator-52"><span class="linenos"> 52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-53"><a href="#EndaNormalizedEstimator-53"><span class="linenos"> 53</span></a><span class="sd">    An estimator that uses one of the inputs as a linear &#39;normalization variable&#39; instead of a &#39;training feature&#39;.</span>
</span><span id="EndaNormalizedEstimator-54"><a href="#EndaNormalizedEstimator-54"><span class="linenos"> 54</span></a><span class="sd">    The prediction is:</span>
</span><span id="EndaNormalizedEstimator-55"><a href="#EndaNormalizedEstimator-55"><span class="linenos"> 55</span></a><span class="sd">    predict(X) = X[normalization_col] * predict(X without normalization_col)</span>
</span><span id="EndaNormalizedEstimator-56"><a href="#EndaNormalizedEstimator-56"><span class="linenos"> 56</span></a>
</span><span id="EndaNormalizedEstimator-57"><a href="#EndaNormalizedEstimator-57"><span class="linenos"> 57</span></a><span class="sd">    predict(X without normalization_col) is made by another underlying estimator: inner_estimator.</span>
</span><span id="EndaNormalizedEstimator-58"><a href="#EndaNormalizedEstimator-58"><span class="linenos"> 58</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-59"><a href="#EndaNormalizedEstimator-59"><span class="linenos"> 59</span></a>
</span><span id="EndaNormalizedEstimator-60"><a href="#EndaNormalizedEstimator-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-61"><a href="#EndaNormalizedEstimator-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-62"><a href="#EndaNormalizedEstimator-62"><span class="linenos"> 62</span></a>        <span class="n">inner_estimator</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-63"><a href="#EndaNormalizedEstimator-63"><span class="linenos"> 63</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-64"><a href="#EndaNormalizedEstimator-64"><span class="linenos"> 64</span></a>        <span class="n">normalization_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-65"><a href="#EndaNormalizedEstimator-65"><span class="linenos"> 65</span></a>        <span class="n">columns_to_normalize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-66"><a href="#EndaNormalizedEstimator-66"><span class="linenos"> 66</span></a>    <span class="p">):</span>
</span><span id="EndaNormalizedEstimator-67"><a href="#EndaNormalizedEstimator-67"><span class="linenos"> 67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-68"><a href="#EndaNormalizedEstimator-68"><span class="linenos"> 68</span></a><span class="sd">        Initialize the normalized estimator</span>
</span><span id="EndaNormalizedEstimator-69"><a href="#EndaNormalizedEstimator-69"><span class="linenos"> 69</span></a><span class="sd">        :param inner_estimator: the estimator that will perform predict(X without normalization_col)</span>
</span><span id="EndaNormalizedEstimator-70"><a href="#EndaNormalizedEstimator-70"><span class="linenos"> 70</span></a><span class="sd">        :param normalization_col: name of the column used as a multiplier and not as a feature.</span>
</span><span id="EndaNormalizedEstimator-71"><a href="#EndaNormalizedEstimator-71"><span class="linenos"> 71</span></a><span class="sd">        :param columns_to_normalize: (optional) columns in &#39;X without normalization_col&#39; that must be divided</span>
</span><span id="EndaNormalizedEstimator-72"><a href="#EndaNormalizedEstimator-72"><span class="linenos"> 72</span></a><span class="sd">        by normalization_col for the underlying estimator to train/predict correctly.</span>
</span><span id="EndaNormalizedEstimator-73"><a href="#EndaNormalizedEstimator-73"><span class="linenos"> 73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-74"><a href="#EndaNormalizedEstimator-74"><span class="linenos"> 74</span></a>
</span><span id="EndaNormalizedEstimator-75"><a href="#EndaNormalizedEstimator-75"><span class="linenos"> 75</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">inner_estimator</span><span class="p">),</span> <span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="EndaNormalizedEstimator-76"><a href="#EndaNormalizedEstimator-76"><span class="linenos"> 76</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-77"><a href="#EndaNormalizedEstimator-77"><span class="linenos"> 77</span></a>                <span class="sa">f</span><span class="s2">&quot;inner_estimator&#39;s type is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">inner_estimator</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; : it must implement EndaEstimator.&quot;</span>
</span><span id="EndaNormalizedEstimator-78"><a href="#EndaNormalizedEstimator-78"><span class="linenos"> 78</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator-79"><a href="#EndaNormalizedEstimator-79"><span class="linenos"> 79</span></a>
</span><span id="EndaNormalizedEstimator-80"><a href="#EndaNormalizedEstimator-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="n">columns_to_normalize</span> <span class="ow">and</span> <span class="n">normalization_col</span> <span class="ow">in</span> <span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-81"><a href="#EndaNormalizedEstimator-81"><span class="linenos"> 81</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-82"><a href="#EndaNormalizedEstimator-82"><span class="linenos"> 82</span></a>                <span class="sa">f</span><span class="s2">&quot;normalisation_col &#39;</span><span class="si">{</span><span class="n">normalization_col</span><span class="si">}</span><span class="s2">&#39;should not be in columns_to_normalize </span><span class="si">{</span><span class="n">columns_to_normalize</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaNormalizedEstimator-83"><a href="#EndaNormalizedEstimator-83"><span class="linenos"> 83</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator-84"><a href="#EndaNormalizedEstimator-84"><span class="linenos"> 84</span></a>
</span><span id="EndaNormalizedEstimator-85"><a href="#EndaNormalizedEstimator-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span> <span class="o">=</span> <span class="n">inner_estimator</span>
</span><span id="EndaNormalizedEstimator-86"><a href="#EndaNormalizedEstimator-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">=</span> <span class="n">target_col</span>
</span><span id="EndaNormalizedEstimator-87"><a href="#EndaNormalizedEstimator-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span> <span class="o">=</span> <span class="n">normalization_col</span>
</span><span id="EndaNormalizedEstimator-88"><a href="#EndaNormalizedEstimator-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span> <span class="o">=</span> <span class="n">columns_to_normalize</span>
</span><span id="EndaNormalizedEstimator-89"><a href="#EndaNormalizedEstimator-89"><span class="linenos"> 89</span></a>
</span><span id="EndaNormalizedEstimator-90"><a href="#EndaNormalizedEstimator-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">check_normalization_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="EndaNormalizedEstimator-91"><a href="#EndaNormalizedEstimator-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-92"><a href="#EndaNormalizedEstimator-92"><span class="linenos"> 92</span></a><span class="sd">        Checks that the values of the normalization col in the input DataFrame are strictly positive, otherwise</span>
</span><span id="EndaNormalizedEstimator-93"><a href="#EndaNormalizedEstimator-93"><span class="linenos"> 93</span></a><span class="sd">        raise an error</span>
</span><span id="EndaNormalizedEstimator-94"><a href="#EndaNormalizedEstimator-94"><span class="linenos"> 94</span></a><span class="sd">        :param df: The DataFrame to check</span>
</span><span id="EndaNormalizedEstimator-95"><a href="#EndaNormalizedEstimator-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-96"><a href="#EndaNormalizedEstimator-96"><span class="linenos"> 96</span></a>
</span><span id="EndaNormalizedEstimator-97"><a href="#EndaNormalizedEstimator-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-98"><a href="#EndaNormalizedEstimator-98"><span class="linenos"> 98</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-99"><a href="#EndaNormalizedEstimator-99"><span class="linenos"> 99</span></a>                <span class="sa">f</span><span class="s2">&quot;Normalisation_col &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="si">}</span><span class="s2">&#39; not present in the Dataframe to normalize&quot;</span>
</span><span id="EndaNormalizedEstimator-100"><a href="#EndaNormalizedEstimator-100"><span class="linenos">100</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator-101"><a href="#EndaNormalizedEstimator-101"><span class="linenos">101</span></a>        <span class="n">zeros_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="EndaNormalizedEstimator-102"><a href="#EndaNormalizedEstimator-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">zeros_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-103"><a href="#EndaNormalizedEstimator-103"><span class="linenos">103</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-104"><a href="#EndaNormalizedEstimator-104"><span class="linenos">104</span></a>                <span class="sa">f</span><span class="s2">&quot;Normalisation_col &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="si">}</span><span class="s2">&#39; : zeros found</span><span class="se">\n</span><span class="si">{</span><span class="n">zeros_df</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaNormalizedEstimator-105"><a href="#EndaNormalizedEstimator-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator-106"><a href="#EndaNormalizedEstimator-106"><span class="linenos">106</span></a>
</span><span id="EndaNormalizedEstimator-107"><a href="#EndaNormalizedEstimator-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-108"><a href="#EndaNormalizedEstimator-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-109"><a href="#EndaNormalizedEstimator-109"><span class="linenos">109</span></a><span class="sd">        Checks that the normalization column has only strictly positive values, then normalizes the columns of the</span>
</span><span id="EndaNormalizedEstimator-110"><a href="#EndaNormalizedEstimator-110"><span class="linenos">110</span></a><span class="sd">        DataFrame that are in the columns_to_normalize attribute by dividing them by the normalization column. Also</span>
</span><span id="EndaNormalizedEstimator-111"><a href="#EndaNormalizedEstimator-111"><span class="linenos">111</span></a><span class="sd">        normalizes the target_col if it is in the DataFrame columns. Then, drops normalization_col</span>
</span><span id="EndaNormalizedEstimator-112"><a href="#EndaNormalizedEstimator-112"><span class="linenos">112</span></a><span class="sd">        :param df: The DataFrame to normalize</span>
</span><span id="EndaNormalizedEstimator-113"><a href="#EndaNormalizedEstimator-113"><span class="linenos">113</span></a><span class="sd">        :return: The DataFrame with columns part of columns_to_normalize or the target_col column normalized, and</span>
</span><span id="EndaNormalizedEstimator-114"><a href="#EndaNormalizedEstimator-114"><span class="linenos">114</span></a><span class="sd">            without the normalization_col</span>
</span><span id="EndaNormalizedEstimator-115"><a href="#EndaNormalizedEstimator-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-116"><a href="#EndaNormalizedEstimator-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_normalization_col</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator-117"><a href="#EndaNormalizedEstimator-117"><span class="linenos">117</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator-118"><a href="#EndaNormalizedEstimator-118"><span class="linenos">118</span></a>
</span><span id="EndaNormalizedEstimator-119"><a href="#EndaNormalizedEstimator-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-120"><a href="#EndaNormalizedEstimator-120"><span class="linenos">120</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-121"><a href="#EndaNormalizedEstimator-121"><span class="linenos">121</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-122"><a href="#EndaNormalizedEstimator-122"><span class="linenos">122</span></a>                    <span class="n">df_norm</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_norm</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span>
</span><span id="EndaNormalizedEstimator-123"><a href="#EndaNormalizedEstimator-123"><span class="linenos">123</span></a>
</span><span id="EndaNormalizedEstimator-124"><a href="#EndaNormalizedEstimator-124"><span class="linenos">124</span></a>        <span class="c1"># always normalize the target if it is in the df (present in train mode, not in predict mode)</span>
</span><span id="EndaNormalizedEstimator-125"><a href="#EndaNormalizedEstimator-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-126"><a href="#EndaNormalizedEstimator-126"><span class="linenos">126</span></a>            <span class="n">df_norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EndaNormalizedEstimator-127"><a href="#EndaNormalizedEstimator-127"><span class="linenos">127</span></a>                <span class="n">df_norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span>
</span><span id="EndaNormalizedEstimator-128"><a href="#EndaNormalizedEstimator-128"><span class="linenos">128</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator-129"><a href="#EndaNormalizedEstimator-129"><span class="linenos">129</span></a>
</span><span id="EndaNormalizedEstimator-130"><a href="#EndaNormalizedEstimator-130"><span class="linenos">130</span></a>        <span class="n">df_norm</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator-131"><a href="#EndaNormalizedEstimator-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="n">df_norm</span>
</span><span id="EndaNormalizedEstimator-132"><a href="#EndaNormalizedEstimator-132"><span class="linenos">132</span></a>
</span><span id="EndaNormalizedEstimator-133"><a href="#EndaNormalizedEstimator-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-134"><a href="#EndaNormalizedEstimator-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-135"><a href="#EndaNormalizedEstimator-135"><span class="linenos">135</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-136"><a href="#EndaNormalizedEstimator-136"><span class="linenos">136</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-137"><a href="#EndaNormalizedEstimator-137"><span class="linenos">137</span></a>        <span class="n">drop_where_normalization_under_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator-138"><a href="#EndaNormalizedEstimator-138"><span class="linenos">138</span></a>    <span class="p">):</span>
</span><span id="EndaNormalizedEstimator-139"><a href="#EndaNormalizedEstimator-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-140"><a href="#EndaNormalizedEstimator-140"><span class="linenos">140</span></a><span class="sd">        Normalizes the DataFrame and trains the inner estimator</span>
</span><span id="EndaNormalizedEstimator-141"><a href="#EndaNormalizedEstimator-141"><span class="linenos">141</span></a><span class="sd">        :param df: The training DataFrame</span>
</span><span id="EndaNormalizedEstimator-142"><a href="#EndaNormalizedEstimator-142"><span class="linenos">142</span></a><span class="sd">        :param target_col: The variable to predict</span>
</span><span id="EndaNormalizedEstimator-143"><a href="#EndaNormalizedEstimator-143"><span class="linenos">143</span></a><span class="sd">        :param drop_where_normalization_under_zero: Whether to drop rows where normalization_col is not strictly</span>
</span><span id="EndaNormalizedEstimator-144"><a href="#EndaNormalizedEstimator-144"><span class="linenos">144</span></a><span class="sd">            positive. Note that the normalize function will raise an error if there is still negative values in</span>
</span><span id="EndaNormalizedEstimator-145"><a href="#EndaNormalizedEstimator-145"><span class="linenos">145</span></a><span class="sd">            normalization_col</span>
</span><span id="EndaNormalizedEstimator-146"><a href="#EndaNormalizedEstimator-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-147"><a href="#EndaNormalizedEstimator-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">!=</span> <span class="n">target_col</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-148"><a href="#EndaNormalizedEstimator-148"><span class="linenos">148</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-149"><a href="#EndaNormalizedEstimator-149"><span class="linenos">149</span></a>                <span class="sa">f</span><span class="s2">&quot;target should be None or </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2">, but given: </span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaNormalizedEstimator-150"><a href="#EndaNormalizedEstimator-150"><span class="linenos">150</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator-151"><a href="#EndaNormalizedEstimator-151"><span class="linenos">151</span></a>
</span><span id="EndaNormalizedEstimator-152"><a href="#EndaNormalizedEstimator-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">drop_where_normalization_under_zero</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-153"><a href="#EndaNormalizedEstimator-153"><span class="linenos">153</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="EndaNormalizedEstimator-154"><a href="#EndaNormalizedEstimator-154"><span class="linenos">154</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator-155"><a href="#EndaNormalizedEstimator-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator-156"><a href="#EndaNormalizedEstimator-156"><span class="linenos">156</span></a>
</span><span id="EndaNormalizedEstimator-157"><a href="#EndaNormalizedEstimator-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-158"><a href="#EndaNormalizedEstimator-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-159"><a href="#EndaNormalizedEstimator-159"><span class="linenos">159</span></a><span class="sd">        Normalizes the input DataFrame, then uses the inner estimator to make a prediction on target_col. Then,</span>
</span><span id="EndaNormalizedEstimator-160"><a href="#EndaNormalizedEstimator-160"><span class="linenos">160</span></a><span class="sd">        multiplies the result by the normalization_col to get the final prediction</span>
</span><span id="EndaNormalizedEstimator-161"><a href="#EndaNormalizedEstimator-161"><span class="linenos">161</span></a><span class="sd">        :param df: The forecast input DataFrame</span>
</span><span id="EndaNormalizedEstimator-162"><a href="#EndaNormalizedEstimator-162"><span class="linenos">162</span></a><span class="sd">        :param target_col: The variable to predict</span>
</span><span id="EndaNormalizedEstimator-163"><a href="#EndaNormalizedEstimator-163"><span class="linenos">163</span></a><span class="sd">        :return: The final prediction of the estimator</span>
</span><span id="EndaNormalizedEstimator-164"><a href="#EndaNormalizedEstimator-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator-165"><a href="#EndaNormalizedEstimator-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">!=</span> <span class="n">target_col</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator-166"><a href="#EndaNormalizedEstimator-166"><span class="linenos">166</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-167"><a href="#EndaNormalizedEstimator-167"><span class="linenos">167</span></a>                <span class="sa">f</span><span class="s2">&quot;target should be None or &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39;, but given: &#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="EndaNormalizedEstimator-168"><a href="#EndaNormalizedEstimator-168"><span class="linenos">168</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator-169"><a href="#EndaNormalizedEstimator-169"><span class="linenos">169</span></a>
</span><span id="EndaNormalizedEstimator-170"><a href="#EndaNormalizedEstimator-170"><span class="linenos">170</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-171"><a href="#EndaNormalizedEstimator-171"><span class="linenos">171</span></a>            <span class="n">df</span>
</span><span id="EndaNormalizedEstimator-172"><a href="#EndaNormalizedEstimator-172"><span class="linenos">172</span></a>        <span class="p">)</span>  <span class="c1"># error out if any value of normalization_col is &lt;= 0</span>
</span><span id="EndaNormalizedEstimator-173"><a href="#EndaNormalizedEstimator-173"><span class="linenos">173</span></a>        <span class="n">predict_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator-174"><a href="#EndaNormalizedEstimator-174"><span class="linenos">174</span></a>
</span><span id="EndaNormalizedEstimator-175"><a href="#EndaNormalizedEstimator-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">predict_norm</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaNormalizedEstimator-176"><a href="#EndaNormalizedEstimator-176"><span class="linenos">176</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator-177"><a href="#EndaNormalizedEstimator-177"><span class="linenos">177</span></a>                <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="EndaNormalizedEstimator-178"><a href="#EndaNormalizedEstimator-178"><span class="linenos">178</span></a>                <span class="s2">&quot;Check that for self.inner_estimator, the method &#39;predict&#39; conserves index.&quot;</span>
</span><span id="EndaNormalizedEstimator-179"><a href="#EndaNormalizedEstimator-179"><span class="linenos">179</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator-180"><a href="#EndaNormalizedEstimator-180"><span class="linenos">180</span></a>
</span><span id="EndaNormalizedEstimator-181"><a href="#EndaNormalizedEstimator-181"><span class="linenos">181</span></a>        <span class="n">predict</span> <span class="o">=</span> <span class="n">predict_norm</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator-182"><a href="#EndaNormalizedEstimator-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="n">predict</span>
</span></pre></div>


            <div class="docstring"><p>An estimator that uses one of the inputs as a linear 'normalization variable' instead of a 'training feature'.
The prediction is:
predict(X) = X[normalization_col] * predict(X without normalization_col)</p>

<p>predict(X without normalization_col) is made by another underlying estimator: inner_estimator.</p>
</div>


                            <div id="EndaNormalizedEstimator.__init__" class="classattr">
                                        <input id="EndaNormalizedEstimator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EndaNormalizedEstimator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">inner_estimator</span><span class="p">:</span> <span class="n"><a href="#EndaEstimator">EndaEstimator</a></span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">normalization_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">columns_to_normalize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="EndaNormalizedEstimator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaNormalizedEstimator.__init__-60"><a href="#EndaNormalizedEstimator.__init__-60"><span class="linenos">60</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.__init__-61"><a href="#EndaNormalizedEstimator.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.__init__-62"><a href="#EndaNormalizedEstimator.__init__-62"><span class="linenos">62</span></a>        <span class="n">inner_estimator</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.__init__-63"><a href="#EndaNormalizedEstimator.__init__-63"><span class="linenos">63</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.__init__-64"><a href="#EndaNormalizedEstimator.__init__-64"><span class="linenos">64</span></a>        <span class="n">normalization_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.__init__-65"><a href="#EndaNormalizedEstimator.__init__-65"><span class="linenos">65</span></a>        <span class="n">columns_to_normalize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.__init__-66"><a href="#EndaNormalizedEstimator.__init__-66"><span class="linenos">66</span></a>    <span class="p">):</span>
</span><span id="EndaNormalizedEstimator.__init__-67"><a href="#EndaNormalizedEstimator.__init__-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.__init__-68"><a href="#EndaNormalizedEstimator.__init__-68"><span class="linenos">68</span></a><span class="sd">        Initialize the normalized estimator</span>
</span><span id="EndaNormalizedEstimator.__init__-69"><a href="#EndaNormalizedEstimator.__init__-69"><span class="linenos">69</span></a><span class="sd">        :param inner_estimator: the estimator that will perform predict(X without normalization_col)</span>
</span><span id="EndaNormalizedEstimator.__init__-70"><a href="#EndaNormalizedEstimator.__init__-70"><span class="linenos">70</span></a><span class="sd">        :param normalization_col: name of the column used as a multiplier and not as a feature.</span>
</span><span id="EndaNormalizedEstimator.__init__-71"><a href="#EndaNormalizedEstimator.__init__-71"><span class="linenos">71</span></a><span class="sd">        :param columns_to_normalize: (optional) columns in &#39;X without normalization_col&#39; that must be divided</span>
</span><span id="EndaNormalizedEstimator.__init__-72"><a href="#EndaNormalizedEstimator.__init__-72"><span class="linenos">72</span></a><span class="sd">        by normalization_col for the underlying estimator to train/predict correctly.</span>
</span><span id="EndaNormalizedEstimator.__init__-73"><a href="#EndaNormalizedEstimator.__init__-73"><span class="linenos">73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.__init__-74"><a href="#EndaNormalizedEstimator.__init__-74"><span class="linenos">74</span></a>
</span><span id="EndaNormalizedEstimator.__init__-75"><a href="#EndaNormalizedEstimator.__init__-75"><span class="linenos">75</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">inner_estimator</span><span class="p">),</span> <span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="EndaNormalizedEstimator.__init__-76"><a href="#EndaNormalizedEstimator.__init__-76"><span class="linenos">76</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.__init__-77"><a href="#EndaNormalizedEstimator.__init__-77"><span class="linenos">77</span></a>                <span class="sa">f</span><span class="s2">&quot;inner_estimator&#39;s type is &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">inner_estimator</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; : it must implement EndaEstimator.&quot;</span>
</span><span id="EndaNormalizedEstimator.__init__-78"><a href="#EndaNormalizedEstimator.__init__-78"><span class="linenos">78</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator.__init__-79"><a href="#EndaNormalizedEstimator.__init__-79"><span class="linenos">79</span></a>
</span><span id="EndaNormalizedEstimator.__init__-80"><a href="#EndaNormalizedEstimator.__init__-80"><span class="linenos">80</span></a>        <span class="k">if</span> <span class="n">columns_to_normalize</span> <span class="ow">and</span> <span class="n">normalization_col</span> <span class="ow">in</span> <span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.__init__-81"><a href="#EndaNormalizedEstimator.__init__-81"><span class="linenos">81</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.__init__-82"><a href="#EndaNormalizedEstimator.__init__-82"><span class="linenos">82</span></a>                <span class="sa">f</span><span class="s2">&quot;normalisation_col &#39;</span><span class="si">{</span><span class="n">normalization_col</span><span class="si">}</span><span class="s2">&#39;should not be in columns_to_normalize </span><span class="si">{</span><span class="n">columns_to_normalize</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaNormalizedEstimator.__init__-83"><a href="#EndaNormalizedEstimator.__init__-83"><span class="linenos">83</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator.__init__-84"><a href="#EndaNormalizedEstimator.__init__-84"><span class="linenos">84</span></a>
</span><span id="EndaNormalizedEstimator.__init__-85"><a href="#EndaNormalizedEstimator.__init__-85"><span class="linenos">85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span> <span class="o">=</span> <span class="n">inner_estimator</span>
</span><span id="EndaNormalizedEstimator.__init__-86"><a href="#EndaNormalizedEstimator.__init__-86"><span class="linenos">86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">=</span> <span class="n">target_col</span>
</span><span id="EndaNormalizedEstimator.__init__-87"><a href="#EndaNormalizedEstimator.__init__-87"><span class="linenos">87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span> <span class="o">=</span> <span class="n">normalization_col</span>
</span><span id="EndaNormalizedEstimator.__init__-88"><a href="#EndaNormalizedEstimator.__init__-88"><span class="linenos">88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span> <span class="o">=</span> <span class="n">columns_to_normalize</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the normalized estimator</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>inner_estimator</strong>:  the estimator that will perform predict(X without normalization_col)</li>
<li><strong>normalization_col</strong>:  name of the column used as a multiplier and not as a feature.</li>
<li><strong>columns_to_normalize</strong>:  (optional) columns in 'X without normalization_col' that must be divided
by normalization_col for the underlying estimator to train/predict correctly.</li>
</ul>
</div>


                            </div>
                            <div id="EndaNormalizedEstimator.inner_estimator" class="classattr">
                                <div class="attr variable">
            <span class="name">inner_estimator</span>

        
    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.inner_estimator"></a>
    
    

                            </div>
                            <div id="EndaNormalizedEstimator.target_col" class="classattr">
                                <div class="attr variable">
            <span class="name">target_col</span>

        
    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.target_col"></a>
    
    

                            </div>
                            <div id="EndaNormalizedEstimator.normalisation_col" class="classattr">
                                <div class="attr variable">
            <span class="name">normalisation_col</span>

        
    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.normalisation_col"></a>
    
    

                            </div>
                            <div id="EndaNormalizedEstimator.columns_to_normalize" class="classattr">
                                <div class="attr variable">
            <span class="name">columns_to_normalize</span>

        
    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.columns_to_normalize"></a>
    
    

                            </div>
                            <div id="EndaNormalizedEstimator.check_normalization_col" class="classattr">
                                        <input id="EndaNormalizedEstimator.check_normalization_col-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_normalization_col</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaNormalizedEstimator.check_normalization_col-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.check_normalization_col"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaNormalizedEstimator.check_normalization_col-90"><a href="#EndaNormalizedEstimator.check_normalization_col-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">check_normalization_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-91"><a href="#EndaNormalizedEstimator.check_normalization_col-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-92"><a href="#EndaNormalizedEstimator.check_normalization_col-92"><span class="linenos"> 92</span></a><span class="sd">        Checks that the values of the normalization col in the input DataFrame are strictly positive, otherwise</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-93"><a href="#EndaNormalizedEstimator.check_normalization_col-93"><span class="linenos"> 93</span></a><span class="sd">        raise an error</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-94"><a href="#EndaNormalizedEstimator.check_normalization_col-94"><span class="linenos"> 94</span></a><span class="sd">        :param df: The DataFrame to check</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-95"><a href="#EndaNormalizedEstimator.check_normalization_col-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-96"><a href="#EndaNormalizedEstimator.check_normalization_col-96"><span class="linenos"> 96</span></a>
</span><span id="EndaNormalizedEstimator.check_normalization_col-97"><a href="#EndaNormalizedEstimator.check_normalization_col-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-98"><a href="#EndaNormalizedEstimator.check_normalization_col-98"><span class="linenos"> 98</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-99"><a href="#EndaNormalizedEstimator.check_normalization_col-99"><span class="linenos"> 99</span></a>                <span class="sa">f</span><span class="s2">&quot;Normalisation_col &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="si">}</span><span class="s2">&#39; not present in the Dataframe to normalize&quot;</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-100"><a href="#EndaNormalizedEstimator.check_normalization_col-100"><span class="linenos">100</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-101"><a href="#EndaNormalizedEstimator.check_normalization_col-101"><span class="linenos">101</span></a>        <span class="n">zeros_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-102"><a href="#EndaNormalizedEstimator.check_normalization_col-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">zeros_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-103"><a href="#EndaNormalizedEstimator.check_normalization_col-103"><span class="linenos">103</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-104"><a href="#EndaNormalizedEstimator.check_normalization_col-104"><span class="linenos">104</span></a>                <span class="sa">f</span><span class="s2">&quot;Normalisation_col &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="si">}</span><span class="s2">&#39; : zeros found</span><span class="se">\n</span><span class="si">{</span><span class="n">zeros_df</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaNormalizedEstimator.check_normalization_col-105"><a href="#EndaNormalizedEstimator.check_normalization_col-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Checks that the values of the normalization col in the input DataFrame are strictly positive, otherwise
raise an error</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The DataFrame to check</li>
</ul>
</div>


                            </div>
                            <div id="EndaNormalizedEstimator.normalize" class="classattr">
                                        <input id="EndaNormalizedEstimator.normalize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="EndaNormalizedEstimator.normalize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.normalize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaNormalizedEstimator.normalize-107"><a href="#EndaNormalizedEstimator.normalize-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.normalize-108"><a href="#EndaNormalizedEstimator.normalize-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.normalize-109"><a href="#EndaNormalizedEstimator.normalize-109"><span class="linenos">109</span></a><span class="sd">        Checks that the normalization column has only strictly positive values, then normalizes the columns of the</span>
</span><span id="EndaNormalizedEstimator.normalize-110"><a href="#EndaNormalizedEstimator.normalize-110"><span class="linenos">110</span></a><span class="sd">        DataFrame that are in the columns_to_normalize attribute by dividing them by the normalization column. Also</span>
</span><span id="EndaNormalizedEstimator.normalize-111"><a href="#EndaNormalizedEstimator.normalize-111"><span class="linenos">111</span></a><span class="sd">        normalizes the target_col if it is in the DataFrame columns. Then, drops normalization_col</span>
</span><span id="EndaNormalizedEstimator.normalize-112"><a href="#EndaNormalizedEstimator.normalize-112"><span class="linenos">112</span></a><span class="sd">        :param df: The DataFrame to normalize</span>
</span><span id="EndaNormalizedEstimator.normalize-113"><a href="#EndaNormalizedEstimator.normalize-113"><span class="linenos">113</span></a><span class="sd">        :return: The DataFrame with columns part of columns_to_normalize or the target_col column normalized, and</span>
</span><span id="EndaNormalizedEstimator.normalize-114"><a href="#EndaNormalizedEstimator.normalize-114"><span class="linenos">114</span></a><span class="sd">            without the normalization_col</span>
</span><span id="EndaNormalizedEstimator.normalize-115"><a href="#EndaNormalizedEstimator.normalize-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.normalize-116"><a href="#EndaNormalizedEstimator.normalize-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_normalization_col</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator.normalize-117"><a href="#EndaNormalizedEstimator.normalize-117"><span class="linenos">117</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator.normalize-118"><a href="#EndaNormalizedEstimator.normalize-118"><span class="linenos">118</span></a>
</span><span id="EndaNormalizedEstimator.normalize-119"><a href="#EndaNormalizedEstimator.normalize-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.normalize-120"><a href="#EndaNormalizedEstimator.normalize-120"><span class="linenos">120</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.normalize-121"><a href="#EndaNormalizedEstimator.normalize-121"><span class="linenos">121</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_normalize</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.normalize-122"><a href="#EndaNormalizedEstimator.normalize-122"><span class="linenos">122</span></a>                    <span class="n">df_norm</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_norm</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span>
</span><span id="EndaNormalizedEstimator.normalize-123"><a href="#EndaNormalizedEstimator.normalize-123"><span class="linenos">123</span></a>
</span><span id="EndaNormalizedEstimator.normalize-124"><a href="#EndaNormalizedEstimator.normalize-124"><span class="linenos">124</span></a>        <span class="c1"># always normalize the target if it is in the df (present in train mode, not in predict mode)</span>
</span><span id="EndaNormalizedEstimator.normalize-125"><a href="#EndaNormalizedEstimator.normalize-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.normalize-126"><a href="#EndaNormalizedEstimator.normalize-126"><span class="linenos">126</span></a>            <span class="n">df_norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EndaNormalizedEstimator.normalize-127"><a href="#EndaNormalizedEstimator.normalize-127"><span class="linenos">127</span></a>                <span class="n">df_norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span>
</span><span id="EndaNormalizedEstimator.normalize-128"><a href="#EndaNormalizedEstimator.normalize-128"><span class="linenos">128</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator.normalize-129"><a href="#EndaNormalizedEstimator.normalize-129"><span class="linenos">129</span></a>
</span><span id="EndaNormalizedEstimator.normalize-130"><a href="#EndaNormalizedEstimator.normalize-130"><span class="linenos">130</span></a>        <span class="n">df_norm</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator.normalize-131"><a href="#EndaNormalizedEstimator.normalize-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="n">df_norm</span>
</span></pre></div>


            <div class="docstring"><p>Checks that the normalization column has only strictly positive values, then normalizes the columns of the
DataFrame that are in the columns_to_normalize attribute by dividing them by the normalization column. Also
normalizes the target_col if it is in the DataFrame columns. Then, drops normalization_col</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The DataFrame to normalize</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The DataFrame with columns part of columns_to_normalize or the target_col column normalized, and
      without the normalization_col</p>
</blockquote>
</div>


                            </div>
                            <div id="EndaNormalizedEstimator.train" class="classattr">
                                        <input id="EndaNormalizedEstimator.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">drop_where_normalization_under_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaNormalizedEstimator.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaNormalizedEstimator.train-133"><a href="#EndaNormalizedEstimator.train-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.train-134"><a href="#EndaNormalizedEstimator.train-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.train-135"><a href="#EndaNormalizedEstimator.train-135"><span class="linenos">135</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.train-136"><a href="#EndaNormalizedEstimator.train-136"><span class="linenos">136</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.train-137"><a href="#EndaNormalizedEstimator.train-137"><span class="linenos">137</span></a>        <span class="n">drop_where_normalization_under_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="EndaNormalizedEstimator.train-138"><a href="#EndaNormalizedEstimator.train-138"><span class="linenos">138</span></a>    <span class="p">):</span>
</span><span id="EndaNormalizedEstimator.train-139"><a href="#EndaNormalizedEstimator.train-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.train-140"><a href="#EndaNormalizedEstimator.train-140"><span class="linenos">140</span></a><span class="sd">        Normalizes the DataFrame and trains the inner estimator</span>
</span><span id="EndaNormalizedEstimator.train-141"><a href="#EndaNormalizedEstimator.train-141"><span class="linenos">141</span></a><span class="sd">        :param df: The training DataFrame</span>
</span><span id="EndaNormalizedEstimator.train-142"><a href="#EndaNormalizedEstimator.train-142"><span class="linenos">142</span></a><span class="sd">        :param target_col: The variable to predict</span>
</span><span id="EndaNormalizedEstimator.train-143"><a href="#EndaNormalizedEstimator.train-143"><span class="linenos">143</span></a><span class="sd">        :param drop_where_normalization_under_zero: Whether to drop rows where normalization_col is not strictly</span>
</span><span id="EndaNormalizedEstimator.train-144"><a href="#EndaNormalizedEstimator.train-144"><span class="linenos">144</span></a><span class="sd">            positive. Note that the normalize function will raise an error if there is still negative values in</span>
</span><span id="EndaNormalizedEstimator.train-145"><a href="#EndaNormalizedEstimator.train-145"><span class="linenos">145</span></a><span class="sd">            normalization_col</span>
</span><span id="EndaNormalizedEstimator.train-146"><a href="#EndaNormalizedEstimator.train-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.train-147"><a href="#EndaNormalizedEstimator.train-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">!=</span> <span class="n">target_col</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.train-148"><a href="#EndaNormalizedEstimator.train-148"><span class="linenos">148</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.train-149"><a href="#EndaNormalizedEstimator.train-149"><span class="linenos">149</span></a>                <span class="sa">f</span><span class="s2">&quot;target should be None or </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2">, but given: </span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaNormalizedEstimator.train-150"><a href="#EndaNormalizedEstimator.train-150"><span class="linenos">150</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator.train-151"><a href="#EndaNormalizedEstimator.train-151"><span class="linenos">151</span></a>
</span><span id="EndaNormalizedEstimator.train-152"><a href="#EndaNormalizedEstimator.train-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">drop_where_normalization_under_zero</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.train-153"><a href="#EndaNormalizedEstimator.train-153"><span class="linenos">153</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="EndaNormalizedEstimator.train-154"><a href="#EndaNormalizedEstimator.train-154"><span class="linenos">154</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator.train-155"><a href="#EndaNormalizedEstimator.train-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Normalizes the DataFrame and trains the inner estimator</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The training DataFrame</li>
<li><strong>target_col</strong>:  The variable to predict</li>
<li><strong>drop_where_normalization_under_zero</strong>:  Whether to drop rows where normalization_col is not strictly
positive. Note that the normalize function will raise an error if there is still negative values in
normalization_col</li>
</ul>
</div>


                            </div>
                            <div id="EndaNormalizedEstimator.predict" class="classattr">
                                        <input id="EndaNormalizedEstimator.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="EndaNormalizedEstimator.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaNormalizedEstimator.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaNormalizedEstimator.predict-157"><a href="#EndaNormalizedEstimator.predict-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.predict-158"><a href="#EndaNormalizedEstimator.predict-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.predict-159"><a href="#EndaNormalizedEstimator.predict-159"><span class="linenos">159</span></a><span class="sd">        Normalizes the input DataFrame, then uses the inner estimator to make a prediction on target_col. Then,</span>
</span><span id="EndaNormalizedEstimator.predict-160"><a href="#EndaNormalizedEstimator.predict-160"><span class="linenos">160</span></a><span class="sd">        multiplies the result by the normalization_col to get the final prediction</span>
</span><span id="EndaNormalizedEstimator.predict-161"><a href="#EndaNormalizedEstimator.predict-161"><span class="linenos">161</span></a><span class="sd">        :param df: The forecast input DataFrame</span>
</span><span id="EndaNormalizedEstimator.predict-162"><a href="#EndaNormalizedEstimator.predict-162"><span class="linenos">162</span></a><span class="sd">        :param target_col: The variable to predict</span>
</span><span id="EndaNormalizedEstimator.predict-163"><a href="#EndaNormalizedEstimator.predict-163"><span class="linenos">163</span></a><span class="sd">        :return: The final prediction of the estimator</span>
</span><span id="EndaNormalizedEstimator.predict-164"><a href="#EndaNormalizedEstimator.predict-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaNormalizedEstimator.predict-165"><a href="#EndaNormalizedEstimator.predict-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">!=</span> <span class="n">target_col</span><span class="p">:</span>
</span><span id="EndaNormalizedEstimator.predict-166"><a href="#EndaNormalizedEstimator.predict-166"><span class="linenos">166</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.predict-167"><a href="#EndaNormalizedEstimator.predict-167"><span class="linenos">167</span></a>                <span class="sa">f</span><span class="s2">&quot;target should be None or &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39;, but given: &#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="EndaNormalizedEstimator.predict-168"><a href="#EndaNormalizedEstimator.predict-168"><span class="linenos">168</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator.predict-169"><a href="#EndaNormalizedEstimator.predict-169"><span class="linenos">169</span></a>
</span><span id="EndaNormalizedEstimator.predict-170"><a href="#EndaNormalizedEstimator.predict-170"><span class="linenos">170</span></a>        <span class="n">df_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.predict-171"><a href="#EndaNormalizedEstimator.predict-171"><span class="linenos">171</span></a>            <span class="n">df</span>
</span><span id="EndaNormalizedEstimator.predict-172"><a href="#EndaNormalizedEstimator.predict-172"><span class="linenos">172</span></a>        <span class="p">)</span>  <span class="c1"># error out if any value of normalization_col is &lt;= 0</span>
</span><span id="EndaNormalizedEstimator.predict-173"><a href="#EndaNormalizedEstimator.predict-173"><span class="linenos">173</span></a>        <span class="n">predict_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator.predict-174"><a href="#EndaNormalizedEstimator.predict-174"><span class="linenos">174</span></a>
</span><span id="EndaNormalizedEstimator.predict-175"><a href="#EndaNormalizedEstimator.predict-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">predict_norm</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaNormalizedEstimator.predict-176"><a href="#EndaNormalizedEstimator.predict-176"><span class="linenos">176</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaNormalizedEstimator.predict-177"><a href="#EndaNormalizedEstimator.predict-177"><span class="linenos">177</span></a>                <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="EndaNormalizedEstimator.predict-178"><a href="#EndaNormalizedEstimator.predict-178"><span class="linenos">178</span></a>                <span class="s2">&quot;Check that for self.inner_estimator, the method &#39;predict&#39; conserves index.&quot;</span>
</span><span id="EndaNormalizedEstimator.predict-179"><a href="#EndaNormalizedEstimator.predict-179"><span class="linenos">179</span></a>            <span class="p">)</span>
</span><span id="EndaNormalizedEstimator.predict-180"><a href="#EndaNormalizedEstimator.predict-180"><span class="linenos">180</span></a>
</span><span id="EndaNormalizedEstimator.predict-181"><a href="#EndaNormalizedEstimator.predict-181"><span class="linenos">181</span></a>        <span class="n">predict</span> <span class="o">=</span> <span class="n">predict_norm</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">normalisation_col</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="EndaNormalizedEstimator.predict-182"><a href="#EndaNormalizedEstimator.predict-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="n">predict</span>
</span></pre></div>


            <div class="docstring"><p>Normalizes the input DataFrame, then uses the inner estimator to make a prediction on target_col. Then,
multiplies the result by the normalization_col to get the final prediction</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The forecast input DataFrame</li>
<li><strong>target_col</strong>:  The variable to predict</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The final prediction of the estimator</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="EndaStackingEstimator">
                            <input id="EndaStackingEstimator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EndaStackingEstimator</span><wbr>(<span class="base"><a href="#EndaEstimator">EndaEstimator</a></span>):

                <label class="view-source-button" for="EndaStackingEstimator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaStackingEstimator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaStackingEstimator-185"><a href="#EndaStackingEstimator-185"><span class="linenos">185</span></a><span class="k">class</span> <span class="nc">EndaStackingEstimator</span><span class="p">(</span><span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="EndaStackingEstimator-186"><a href="#EndaStackingEstimator-186"><span class="linenos">186</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-187"><a href="#EndaStackingEstimator-187"><span class="linenos">187</span></a><span class="sd">    This class serves the same purpose as the Scikit-Learn &quot;Stacking Regressor&quot;. However since we work on</span>
</span><span id="EndaStackingEstimator-188"><a href="#EndaStackingEstimator-188"><span class="linenos">188</span></a><span class="sd">    time-series, we need fine control on which data is passed to train the base_estimators before training</span>
</span><span id="EndaStackingEstimator-189"><a href="#EndaStackingEstimator-189"><span class="linenos">189</span></a><span class="sd">    the final_estimator (to keep it all chronologically consistent).</span>
</span><span id="EndaStackingEstimator-190"><a href="#EndaStackingEstimator-190"><span class="linenos">190</span></a>
</span><span id="EndaStackingEstimator-191"><a href="#EndaStackingEstimator-191"><span class="linenos">191</span></a><span class="sd">    Training is made this way :</span>
</span><span id="EndaStackingEstimator-192"><a href="#EndaStackingEstimator-192"><span class="linenos">192</span></a><span class="sd">        temporarily train base_estimators on train_set[:x]</span>
</span><span id="EndaStackingEstimator-193"><a href="#EndaStackingEstimator-193"><span class="linenos">193</span></a><span class="sd">        use base_estimators to predict on train_set[x:] -&gt; base_predictions</span>
</span><span id="EndaStackingEstimator-194"><a href="#EndaStackingEstimator-194"><span class="linenos">194</span></a><span class="sd">        train final_estimator on the base_predictions</span>
</span><span id="EndaStackingEstimator-195"><a href="#EndaStackingEstimator-195"><span class="linenos">195</span></a><span class="sd">        re-train base_estimators on the full train-set</span>
</span><span id="EndaStackingEstimator-196"><a href="#EndaStackingEstimator-196"><span class="linenos">196</span></a><span class="sd">    We have to train base_estimators twice, because if we trained them on the full set and then predict on</span>
</span><span id="EndaStackingEstimator-197"><a href="#EndaStackingEstimator-197"><span class="linenos">197</span></a><span class="sd">    train_set[x:] for training final_estimator, we would be making a prediction on part of the data that was used to</span>
</span><span id="EndaStackingEstimator-198"><a href="#EndaStackingEstimator-198"><span class="linenos">198</span></a><span class="sd">    train them, which would be a huge risk of over-fitting</span>
</span><span id="EndaStackingEstimator-199"><a href="#EndaStackingEstimator-199"><span class="linenos">199</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-200"><a href="#EndaStackingEstimator-200"><span class="linenos">200</span></a>
</span><span id="EndaStackingEstimator-201"><a href="#EndaStackingEstimator-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-202"><a href="#EndaStackingEstimator-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaStackingEstimator-203"><a href="#EndaStackingEstimator-203"><span class="linenos">203</span></a>        <span class="n">base_estimators</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EndaEstimator</span><span class="p">],</span>
</span><span id="EndaStackingEstimator-204"><a href="#EndaStackingEstimator-204"><span class="linenos">204</span></a>        <span class="n">final_estimator</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="EndaStackingEstimator-205"><a href="#EndaStackingEstimator-205"><span class="linenos">205</span></a>        <span class="n">base_stack_split_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.20</span><span class="p">,</span>
</span><span id="EndaStackingEstimator-206"><a href="#EndaStackingEstimator-206"><span class="linenos">206</span></a>    <span class="p">):</span>
</span><span id="EndaStackingEstimator-207"><a href="#EndaStackingEstimator-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-208"><a href="#EndaStackingEstimator-208"><span class="linenos">208</span></a><span class="sd">        Initialize the stacking estimator</span>
</span><span id="EndaStackingEstimator-209"><a href="#EndaStackingEstimator-209"><span class="linenos">209</span></a><span class="sd">        :param base_estimators: a dict of {estimator_id -&gt; estimator}, each estimator (there must be at least 2) must</span>
</span><span id="EndaStackingEstimator-210"><a href="#EndaStackingEstimator-210"><span class="linenos">210</span></a><span class="sd">            be an EndaEstimator.</span>
</span><span id="EndaStackingEstimator-211"><a href="#EndaStackingEstimator-211"><span class="linenos">211</span></a><span class="sd">        :param final_estimator: the estimator used for stacking, must also implement be an EndaEstimator.</span>
</span><span id="EndaStackingEstimator-212"><a href="#EndaStackingEstimator-212"><span class="linenos">212</span></a><span class="sd">        :param base_stack_split_pct: the % of data used to train the base_estimators before training final_estimator</span>
</span><span id="EndaStackingEstimator-213"><a href="#EndaStackingEstimator-213"><span class="linenos">213</span></a><span class="sd">            (this can be overwritten in the train function).</span>
</span><span id="EndaStackingEstimator-214"><a href="#EndaStackingEstimator-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-215"><a href="#EndaStackingEstimator-215"><span class="linenos">215</span></a>
</span><span id="EndaStackingEstimator-216"><a href="#EndaStackingEstimator-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_estimators</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EndaStackingEstimator-217"><a href="#EndaStackingEstimator-217"><span class="linenos">217</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-218"><a href="#EndaStackingEstimator-218"><span class="linenos">218</span></a>                <span class="sa">f</span><span class="s2">&quot;At least 2 base_estimators are required, but given: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">base_estimators</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaStackingEstimator-219"><a href="#EndaStackingEstimator-219"><span class="linenos">219</span></a>            <span class="p">)</span>
</span><span id="EndaStackingEstimator-220"><a href="#EndaStackingEstimator-220"><span class="linenos">220</span></a>
</span><span id="EndaStackingEstimator-221"><a href="#EndaStackingEstimator-221"><span class="linenos">221</span></a>        <span class="c1"># We store estimators in an ordered dict to make sure we always iterate over them in the same order</span>
</span><span id="EndaStackingEstimator-222"><a href="#EndaStackingEstimator-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span><span id="EndaStackingEstimator-223"><a href="#EndaStackingEstimator-223"><span class="linenos">223</span></a>        <span class="k">for</span> <span class="n">estimator_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="EndaStackingEstimator-224"><a href="#EndaStackingEstimator-224"><span class="linenos">224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="p">[</span><span class="n">estimator_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_estimators</span><span class="p">[</span><span class="n">estimator_id</span><span class="p">]</span>
</span><span id="EndaStackingEstimator-225"><a href="#EndaStackingEstimator-225"><span class="linenos">225</span></a>
</span><span id="EndaStackingEstimator-226"><a href="#EndaStackingEstimator-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span> <span class="o">=</span> <span class="n">final_estimator</span>
</span><span id="EndaStackingEstimator-227"><a href="#EndaStackingEstimator-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_stack_split_pct</span> <span class="o">=</span> <span class="n">base_stack_split_pct</span>
</span><span id="EndaStackingEstimator-228"><a href="#EndaStackingEstimator-228"><span class="linenos">228</span></a>
</span><span id="EndaStackingEstimator-229"><a href="#EndaStackingEstimator-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-230"><a href="#EndaStackingEstimator-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaStackingEstimator-231"><a href="#EndaStackingEstimator-231"><span class="linenos">231</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="EndaStackingEstimator-232"><a href="#EndaStackingEstimator-232"><span class="linenos">232</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="EndaStackingEstimator-233"><a href="#EndaStackingEstimator-233"><span class="linenos">233</span></a>        <span class="n">base_stack_split_pct</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EndaStackingEstimator-234"><a href="#EndaStackingEstimator-234"><span class="linenos">234</span></a>    <span class="p">):</span>
</span><span id="EndaStackingEstimator-235"><a href="#EndaStackingEstimator-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-236"><a href="#EndaStackingEstimator-236"><span class="linenos">236</span></a><span class="sd">        Train base and final estimators.</span>
</span><span id="EndaStackingEstimator-237"><a href="#EndaStackingEstimator-237"><span class="linenos">237</span></a><span class="sd">        :param df: The training dataset</span>
</span><span id="EndaStackingEstimator-238"><a href="#EndaStackingEstimator-238"><span class="linenos">238</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaStackingEstimator-239"><a href="#EndaStackingEstimator-239"><span class="linenos">239</span></a><span class="sd">        :param base_stack_split_pct: If specified, will overwrite the EndaStackingEstimator attribute.</span>
</span><span id="EndaStackingEstimator-240"><a href="#EndaStackingEstimator-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-241"><a href="#EndaStackingEstimator-241"><span class="linenos">241</span></a>        <span class="n">split_pct</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EndaStackingEstimator-242"><a href="#EndaStackingEstimator-242"><span class="linenos">242</span></a>            <span class="n">base_stack_split_pct</span> <span class="k">if</span> <span class="n">base_stack_split_pct</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_stack_split_pct</span>
</span><span id="EndaStackingEstimator-243"><a href="#EndaStackingEstimator-243"><span class="linenos">243</span></a>        <span class="p">)</span>
</span><span id="EndaStackingEstimator-244"><a href="#EndaStackingEstimator-244"><span class="linenos">244</span></a>
</span><span id="EndaStackingEstimator-245"><a href="#EndaStackingEstimator-245"><span class="linenos">245</span></a>        <span class="c1"># training final_estimator will temporarily train single estimators on part of the data,</span>
</span><span id="EndaStackingEstimator-246"><a href="#EndaStackingEstimator-246"><span class="linenos">246</span></a>        <span class="c1"># so it must be done before training the actual single estimators</span>
</span><span id="EndaStackingEstimator-247"><a href="#EndaStackingEstimator-247"><span class="linenos">247</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_final_estimator</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">split_pct</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-248"><a href="#EndaStackingEstimator-248"><span class="linenos">248</span></a>
</span><span id="EndaStackingEstimator-249"><a href="#EndaStackingEstimator-249"><span class="linenos">249</span></a>        <span class="c1"># re-train base estimators with the full dataset</span>
</span><span id="EndaStackingEstimator-250"><a href="#EndaStackingEstimator-250"><span class="linenos">250</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_base_estimators</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-251"><a href="#EndaStackingEstimator-251"><span class="linenos">251</span></a>
</span><span id="EndaStackingEstimator-252"><a href="#EndaStackingEstimator-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">train_final_estimator</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-253"><a href="#EndaStackingEstimator-253"><span class="linenos">253</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">split_pct</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="EndaStackingEstimator-254"><a href="#EndaStackingEstimator-254"><span class="linenos">254</span></a>    <span class="p">):</span>
</span><span id="EndaStackingEstimator-255"><a href="#EndaStackingEstimator-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-256"><a href="#EndaStackingEstimator-256"><span class="linenos">256</span></a><span class="sd">        Trains the final estimator used for stacking.</span>
</span><span id="EndaStackingEstimator-257"><a href="#EndaStackingEstimator-257"><span class="linenos">257</span></a><span class="sd">        (Temporarily) train the single estimators with a subset of the data,</span>
</span><span id="EndaStackingEstimator-258"><a href="#EndaStackingEstimator-258"><span class="linenos">258</span></a><span class="sd">        then apply them on the rest of the data. Use this to train the stacking estimator.</span>
</span><span id="EndaStackingEstimator-259"><a href="#EndaStackingEstimator-259"><span class="linenos">259</span></a><span class="sd">        :param df: The DataFrame with training data</span>
</span><span id="EndaStackingEstimator-260"><a href="#EndaStackingEstimator-260"><span class="linenos">260</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaStackingEstimator-261"><a href="#EndaStackingEstimator-261"><span class="linenos">261</span></a><span class="sd">        :param split_pct: The percentage of training data to use to train the base estimators. The rest of the data</span>
</span><span id="EndaStackingEstimator-262"><a href="#EndaStackingEstimator-262"><span class="linenos">262</span></a><span class="sd">            will be used to train the final estimator based on the predictions of the base estimators</span>
</span><span id="EndaStackingEstimator-263"><a href="#EndaStackingEstimator-263"><span class="linenos">263</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-264"><a href="#EndaStackingEstimator-264"><span class="linenos">264</span></a>
</span><span id="EndaStackingEstimator-265"><a href="#EndaStackingEstimator-265"><span class="linenos">265</span></a>        <span class="c1"># split the training frame : ,</span>
</span><span id="EndaStackingEstimator-266"><a href="#EndaStackingEstimator-266"><span class="linenos">266</span></a>        <span class="n">split_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">split_pct</span><span class="p">))</span>
</span><span id="EndaStackingEstimator-267"><a href="#EndaStackingEstimator-267"><span class="linenos">267</span></a>        <span class="n">split_idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">split_int</span><span class="p">]</span>
</span><span id="EndaStackingEstimator-268"><a href="#EndaStackingEstimator-268"><span class="linenos">268</span></a>
</span><span id="EndaStackingEstimator-269"><a href="#EndaStackingEstimator-269"><span class="linenos">269</span></a>        <span class="n">df_base_estimators</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="EndaStackingEstimator-270"><a href="#EndaStackingEstimator-270"><span class="linenos">270</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">split_idx</span>
</span><span id="EndaStackingEstimator-271"><a href="#EndaStackingEstimator-271"><span class="linenos">271</span></a>        <span class="p">]</span>  <span class="c1"># one part to train the base estimators</span>
</span><span id="EndaStackingEstimator-272"><a href="#EndaStackingEstimator-272"><span class="linenos">272</span></a>        <span class="n">df_stacking</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="EndaStackingEstimator-273"><a href="#EndaStackingEstimator-273"><span class="linenos">273</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">split_idx</span>
</span><span id="EndaStackingEstimator-274"><a href="#EndaStackingEstimator-274"><span class="linenos">274</span></a>        <span class="p">]</span>  <span class="c1"># the other to train the stacking estimator</span>
</span><span id="EndaStackingEstimator-275"><a href="#EndaStackingEstimator-275"><span class="linenos">275</span></a>
</span><span id="EndaStackingEstimator-276"><a href="#EndaStackingEstimator-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="n">df_base_estimators</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">df_stacking</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EndaStackingEstimator-277"><a href="#EndaStackingEstimator-277"><span class="linenos">277</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-278"><a href="#EndaStackingEstimator-278"><span class="linenos">278</span></a>                <span class="s2">&quot;The split gave an empty train set for the base estimators or the final estimator. &quot;</span>
</span><span id="EndaStackingEstimator-279"><a href="#EndaStackingEstimator-279"><span class="linenos">279</span></a>                <span class="sa">f</span><span class="s2">&quot;Change parameter &#39;split_pct&#39; (given </span><span class="si">{</span><span class="n">split_pct</span><span class="si">}</span><span class="s2">) or provide a larger training set.&quot;</span>
</span><span id="EndaStackingEstimator-280"><a href="#EndaStackingEstimator-280"><span class="linenos">280</span></a>            <span class="p">)</span>
</span><span id="EndaStackingEstimator-281"><a href="#EndaStackingEstimator-281"><span class="linenos">281</span></a>
</span><span id="EndaStackingEstimator-282"><a href="#EndaStackingEstimator-282"><span class="linenos">282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_base_estimators</span><span class="p">(</span><span class="n">df_base_estimators</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-283"><a href="#EndaStackingEstimator-283"><span class="linenos">283</span></a>
</span><span id="EndaStackingEstimator-284"><a href="#EndaStackingEstimator-284"><span class="linenos">284</span></a>        <span class="c1"># make predictions with these temporary base_estimators, without the target column</span>
</span><span id="EndaStackingEstimator-285"><a href="#EndaStackingEstimator-285"><span class="linenos">285</span></a>        <span class="n">base_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_base_estimators</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-286"><a href="#EndaStackingEstimator-286"><span class="linenos">286</span></a>            <span class="n">df_stacking</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_col</span><span class="p">]),</span> <span class="n">target_col</span>
</span><span id="EndaStackingEstimator-287"><a href="#EndaStackingEstimator-287"><span class="linenos">287</span></a>        <span class="p">)</span>
</span><span id="EndaStackingEstimator-288"><a href="#EndaStackingEstimator-288"><span class="linenos">288</span></a>
</span><span id="EndaStackingEstimator-289"><a href="#EndaStackingEstimator-289"><span class="linenos">289</span></a>        <span class="c1"># add the target back, to train the final estimator</span>
</span><span id="EndaStackingEstimator-290"><a href="#EndaStackingEstimator-290"><span class="linenos">290</span></a>        <span class="n">base_predictions</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_stacking</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="EndaStackingEstimator-291"><a href="#EndaStackingEstimator-291"><span class="linenos">291</span></a>
</span><span id="EndaStackingEstimator-292"><a href="#EndaStackingEstimator-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">base_predictions</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-293"><a href="#EndaStackingEstimator-293"><span class="linenos">293</span></a>
</span><span id="EndaStackingEstimator-294"><a href="#EndaStackingEstimator-294"><span class="linenos">294</span></a>    <span class="k">def</span> <span class="nf">predict_base_estimators</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-295"><a href="#EndaStackingEstimator-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="EndaStackingEstimator-296"><a href="#EndaStackingEstimator-296"><span class="linenos">296</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaStackingEstimator-297"><a href="#EndaStackingEstimator-297"><span class="linenos">297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-298"><a href="#EndaStackingEstimator-298"><span class="linenos">298</span></a><span class="sd">        Make a prediction using base estimators</span>
</span><span id="EndaStackingEstimator-299"><a href="#EndaStackingEstimator-299"><span class="linenos">299</span></a><span class="sd">        :param df: The input DataFrame for prediction</span>
</span><span id="EndaStackingEstimator-300"><a href="#EndaStackingEstimator-300"><span class="linenos">300</span></a><span class="sd">        :param target_col: The name of the column to predict</span>
</span><span id="EndaStackingEstimator-301"><a href="#EndaStackingEstimator-301"><span class="linenos">301</span></a><span class="sd">        :return: a Dataframe with the prediction of each base estimator in each column (on several rows).</span>
</span><span id="EndaStackingEstimator-302"><a href="#EndaStackingEstimator-302"><span class="linenos">302</span></a><span class="sd">            Each column&#39;s name is the estimator_id given on initialisation.</span>
</span><span id="EndaStackingEstimator-303"><a href="#EndaStackingEstimator-303"><span class="linenos">303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-304"><a href="#EndaStackingEstimator-304"><span class="linenos">304</span></a>
</span><span id="EndaStackingEstimator-305"><a href="#EndaStackingEstimator-305"><span class="linenos">305</span></a>        <span class="n">estimator_dfs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EndaStackingEstimator-306"><a href="#EndaStackingEstimator-306"><span class="linenos">306</span></a>        <span class="k">for</span> <span class="n">estimator_id</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="EndaStackingEstimator-307"><a href="#EndaStackingEstimator-307"><span class="linenos">307</span></a>            <span class="n">estimator_predict</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-308"><a href="#EndaStackingEstimator-308"><span class="linenos">308</span></a>
</span><span id="EndaStackingEstimator-309"><a href="#EndaStackingEstimator-309"><span class="linenos">309</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">estimator_predict</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaStackingEstimator-310"><a href="#EndaStackingEstimator-310"><span class="linenos">310</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-311"><a href="#EndaStackingEstimator-311"><span class="linenos">311</span></a>                    <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="EndaStackingEstimator-312"><a href="#EndaStackingEstimator-312"><span class="linenos">312</span></a>                    <span class="sa">f</span><span class="s2">&quot;Check that for estimator with id &#39;</span><span class="si">{</span><span class="n">estimator_id</span><span class="si">}</span><span class="s2">&#39;, the method &#39;predict&#39; conserves index.&quot;</span>
</span><span id="EndaStackingEstimator-313"><a href="#EndaStackingEstimator-313"><span class="linenos">313</span></a>                <span class="p">)</span>
</span><span id="EndaStackingEstimator-314"><a href="#EndaStackingEstimator-314"><span class="linenos">314</span></a>
</span><span id="EndaStackingEstimator-315"><a href="#EndaStackingEstimator-315"><span class="linenos">315</span></a>            <span class="n">estimator_predict</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">target_col</span><span class="p">:</span> <span class="n">estimator_id</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-316"><a href="#EndaStackingEstimator-316"><span class="linenos">316</span></a>            <span class="n">estimator_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator_predict</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-317"><a href="#EndaStackingEstimator-317"><span class="linenos">317</span></a>
</span><span id="EndaStackingEstimator-318"><a href="#EndaStackingEstimator-318"><span class="linenos">318</span></a>        <span class="n">predict_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">estimator_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-319"><a href="#EndaStackingEstimator-319"><span class="linenos">319</span></a>
</span><span id="EndaStackingEstimator-320"><a href="#EndaStackingEstimator-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="n">predict_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="EndaStackingEstimator-321"><a href="#EndaStackingEstimator-321"><span class="linenos">321</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-322"><a href="#EndaStackingEstimator-322"><span class="linenos">322</span></a>                <span class="sa">f</span><span class="s2">&quot;Given </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> values to predict, but predicted </span><span class="si">{</span><span class="n">predict_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaStackingEstimator-323"><a href="#EndaStackingEstimator-323"><span class="linenos">323</span></a>            <span class="p">)</span>
</span><span id="EndaStackingEstimator-324"><a href="#EndaStackingEstimator-324"><span class="linenos">324</span></a>
</span><span id="EndaStackingEstimator-325"><a href="#EndaStackingEstimator-325"><span class="linenos">325</span></a>        <span class="k">return</span> <span class="n">predict_df</span>
</span><span id="EndaStackingEstimator-326"><a href="#EndaStackingEstimator-326"><span class="linenos">326</span></a>
</span><span id="EndaStackingEstimator-327"><a href="#EndaStackingEstimator-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">train_base_estimators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EndaStackingEstimator-328"><a href="#EndaStackingEstimator-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-329"><a href="#EndaStackingEstimator-329"><span class="linenos">329</span></a><span class="sd">        Train the base estimators</span>
</span><span id="EndaStackingEstimator-330"><a href="#EndaStackingEstimator-330"><span class="linenos">330</span></a><span class="sd">        :param df: The training data</span>
</span><span id="EndaStackingEstimator-331"><a href="#EndaStackingEstimator-331"><span class="linenos">331</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaStackingEstimator-332"><a href="#EndaStackingEstimator-332"><span class="linenos">332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-333"><a href="#EndaStackingEstimator-333"><span class="linenos">333</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="EndaStackingEstimator-334"><a href="#EndaStackingEstimator-334"><span class="linenos">334</span></a>            <span class="n">estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-335"><a href="#EndaStackingEstimator-335"><span class="linenos">335</span></a>
</span><span id="EndaStackingEstimator-336"><a href="#EndaStackingEstimator-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaStackingEstimator-337"><a href="#EndaStackingEstimator-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-338"><a href="#EndaStackingEstimator-338"><span class="linenos">338</span></a><span class="sd">        Make predictions with base estimators, then uses them to make a prediction with the final estimator</span>
</span><span id="EndaStackingEstimator-339"><a href="#EndaStackingEstimator-339"><span class="linenos">339</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="EndaStackingEstimator-340"><a href="#EndaStackingEstimator-340"><span class="linenos">340</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaStackingEstimator-341"><a href="#EndaStackingEstimator-341"><span class="linenos">341</span></a><span class="sd">        :return: A DataFrame with the predicted column</span>
</span><span id="EndaStackingEstimator-342"><a href="#EndaStackingEstimator-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator-343"><a href="#EndaStackingEstimator-343"><span class="linenos">343</span></a>        <span class="n">base_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_base_estimators</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-344"><a href="#EndaStackingEstimator-344"><span class="linenos">344</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">base_predictions</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator-345"><a href="#EndaStackingEstimator-345"><span class="linenos">345</span></a>
</span><span id="EndaStackingEstimator-346"><a href="#EndaStackingEstimator-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaStackingEstimator-347"><a href="#EndaStackingEstimator-347"><span class="linenos">347</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator-348"><a href="#EndaStackingEstimator-348"><span class="linenos">348</span></a>                <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="EndaStackingEstimator-349"><a href="#EndaStackingEstimator-349"><span class="linenos">349</span></a>                <span class="s2">&quot;Check that self.final_estimator.predict conserves index.&quot;</span>
</span><span id="EndaStackingEstimator-350"><a href="#EndaStackingEstimator-350"><span class="linenos">350</span></a>            <span class="p">)</span>
</span><span id="EndaStackingEstimator-351"><a href="#EndaStackingEstimator-351"><span class="linenos">351</span></a>
</span><span id="EndaStackingEstimator-352"><a href="#EndaStackingEstimator-352"><span class="linenos">352</span></a>        <span class="k">return</span> <span class="n">prediction</span>
</span></pre></div>


            <div class="docstring"><p>This class serves the same purpose as the Scikit-Learn "Stacking Regressor". However since we work on
time-series, we need fine control on which data is passed to train the base_estimators before training
the final_estimator (to keep it all chronologically consistent).</p>

<p>Training is made this way :
    temporarily train base_estimators on train_set[:x]
    use base_estimators to predict on train_set[x:] -> base_predictions
    train final_estimator on the base_predictions
    re-train base_estimators on the full train-set
We have to train base_estimators twice, because if we trained them on the full set and then predict on
train_set[x:] for training final_estimator, we would be making a prediction on part of the data that was used to
train them, which would be a huge risk of over-fitting</p>
</div>


                            <div id="EndaStackingEstimator.__init__" class="classattr">
                                        <input id="EndaStackingEstimator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EndaStackingEstimator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">base_estimators</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#EndaEstimator">EndaEstimator</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">final_estimator</span><span class="p">:</span> <span class="n"><a href="#EndaEstimator">EndaEstimator</a></span>,</span><span class="param">	<span class="n">base_stack_split_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span></span>)</span>

                <label class="view-source-button" for="EndaStackingEstimator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaStackingEstimator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaStackingEstimator.__init__-201"><a href="#EndaStackingEstimator.__init__-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.__init__-202"><a href="#EndaStackingEstimator.__init__-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaStackingEstimator.__init__-203"><a href="#EndaStackingEstimator.__init__-203"><span class="linenos">203</span></a>        <span class="n">base_estimators</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EndaEstimator</span><span class="p">],</span>
</span><span id="EndaStackingEstimator.__init__-204"><a href="#EndaStackingEstimator.__init__-204"><span class="linenos">204</span></a>        <span class="n">final_estimator</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="EndaStackingEstimator.__init__-205"><a href="#EndaStackingEstimator.__init__-205"><span class="linenos">205</span></a>        <span class="n">base_stack_split_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.20</span><span class="p">,</span>
</span><span id="EndaStackingEstimator.__init__-206"><a href="#EndaStackingEstimator.__init__-206"><span class="linenos">206</span></a>    <span class="p">):</span>
</span><span id="EndaStackingEstimator.__init__-207"><a href="#EndaStackingEstimator.__init__-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.__init__-208"><a href="#EndaStackingEstimator.__init__-208"><span class="linenos">208</span></a><span class="sd">        Initialize the stacking estimator</span>
</span><span id="EndaStackingEstimator.__init__-209"><a href="#EndaStackingEstimator.__init__-209"><span class="linenos">209</span></a><span class="sd">        :param base_estimators: a dict of {estimator_id -&gt; estimator}, each estimator (there must be at least 2) must</span>
</span><span id="EndaStackingEstimator.__init__-210"><a href="#EndaStackingEstimator.__init__-210"><span class="linenos">210</span></a><span class="sd">            be an EndaEstimator.</span>
</span><span id="EndaStackingEstimator.__init__-211"><a href="#EndaStackingEstimator.__init__-211"><span class="linenos">211</span></a><span class="sd">        :param final_estimator: the estimator used for stacking, must also implement be an EndaEstimator.</span>
</span><span id="EndaStackingEstimator.__init__-212"><a href="#EndaStackingEstimator.__init__-212"><span class="linenos">212</span></a><span class="sd">        :param base_stack_split_pct: the % of data used to train the base_estimators before training final_estimator</span>
</span><span id="EndaStackingEstimator.__init__-213"><a href="#EndaStackingEstimator.__init__-213"><span class="linenos">213</span></a><span class="sd">            (this can be overwritten in the train function).</span>
</span><span id="EndaStackingEstimator.__init__-214"><a href="#EndaStackingEstimator.__init__-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.__init__-215"><a href="#EndaStackingEstimator.__init__-215"><span class="linenos">215</span></a>
</span><span id="EndaStackingEstimator.__init__-216"><a href="#EndaStackingEstimator.__init__-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_estimators</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EndaStackingEstimator.__init__-217"><a href="#EndaStackingEstimator.__init__-217"><span class="linenos">217</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.__init__-218"><a href="#EndaStackingEstimator.__init__-218"><span class="linenos">218</span></a>                <span class="sa">f</span><span class="s2">&quot;At least 2 base_estimators are required, but given: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">base_estimators</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaStackingEstimator.__init__-219"><a href="#EndaStackingEstimator.__init__-219"><span class="linenos">219</span></a>            <span class="p">)</span>
</span><span id="EndaStackingEstimator.__init__-220"><a href="#EndaStackingEstimator.__init__-220"><span class="linenos">220</span></a>
</span><span id="EndaStackingEstimator.__init__-221"><a href="#EndaStackingEstimator.__init__-221"><span class="linenos">221</span></a>        <span class="c1"># We store estimators in an ordered dict to make sure we always iterate over them in the same order</span>
</span><span id="EndaStackingEstimator.__init__-222"><a href="#EndaStackingEstimator.__init__-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span><span id="EndaStackingEstimator.__init__-223"><a href="#EndaStackingEstimator.__init__-223"><span class="linenos">223</span></a>        <span class="k">for</span> <span class="n">estimator_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="EndaStackingEstimator.__init__-224"><a href="#EndaStackingEstimator.__init__-224"><span class="linenos">224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="p">[</span><span class="n">estimator_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_estimators</span><span class="p">[</span><span class="n">estimator_id</span><span class="p">]</span>
</span><span id="EndaStackingEstimator.__init__-225"><a href="#EndaStackingEstimator.__init__-225"><span class="linenos">225</span></a>
</span><span id="EndaStackingEstimator.__init__-226"><a href="#EndaStackingEstimator.__init__-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span> <span class="o">=</span> <span class="n">final_estimator</span>
</span><span id="EndaStackingEstimator.__init__-227"><a href="#EndaStackingEstimator.__init__-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_stack_split_pct</span> <span class="o">=</span> <span class="n">base_stack_split_pct</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the stacking estimator</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>base_estimators</strong>:  a dict of {estimator_id -> estimator}, each estimator (there must be at least 2) must
be an EndaEstimator.</li>
<li><strong>final_estimator</strong>:  the estimator used for stacking, must also implement be an EndaEstimator.</li>
<li><strong>base_stack_split_pct</strong>:  the % of data used to train the base_estimators before training final_estimator
(this can be overwritten in the train function).</li>
</ul>
</div>


                            </div>
                            <div id="EndaStackingEstimator.base_estimators" class="classattr">
                                <div class="attr variable">
            <span class="name">base_estimators</span>

        
    </div>
    <a class="headerlink" href="#EndaStackingEstimator.base_estimators"></a>
    
    

                            </div>
                            <div id="EndaStackingEstimator.final_estimator" class="classattr">
                                <div class="attr variable">
            <span class="name">final_estimator</span>

        
    </div>
    <a class="headerlink" href="#EndaStackingEstimator.final_estimator"></a>
    
    

                            </div>
                            <div id="EndaStackingEstimator.base_stack_split_pct" class="classattr">
                                <div class="attr variable">
            <span class="name">base_stack_split_pct</span>

        
    </div>
    <a class="headerlink" href="#EndaStackingEstimator.base_stack_split_pct"></a>
    
    

                            </div>
                            <div id="EndaStackingEstimator.train" class="classattr">
                                        <input id="EndaStackingEstimator.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	base_stack_split_pct: [&lt;class &#x27;float&#x27;&gt;, None] = None</span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaStackingEstimator.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaStackingEstimator.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaStackingEstimator.train-229"><a href="#EndaStackingEstimator.train-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.train-230"><a href="#EndaStackingEstimator.train-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaStackingEstimator.train-231"><a href="#EndaStackingEstimator.train-231"><span class="linenos">231</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="EndaStackingEstimator.train-232"><a href="#EndaStackingEstimator.train-232"><span class="linenos">232</span></a>        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="EndaStackingEstimator.train-233"><a href="#EndaStackingEstimator.train-233"><span class="linenos">233</span></a>        <span class="n">base_stack_split_pct</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EndaStackingEstimator.train-234"><a href="#EndaStackingEstimator.train-234"><span class="linenos">234</span></a>    <span class="p">):</span>
</span><span id="EndaStackingEstimator.train-235"><a href="#EndaStackingEstimator.train-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.train-236"><a href="#EndaStackingEstimator.train-236"><span class="linenos">236</span></a><span class="sd">        Train base and final estimators.</span>
</span><span id="EndaStackingEstimator.train-237"><a href="#EndaStackingEstimator.train-237"><span class="linenos">237</span></a><span class="sd">        :param df: The training dataset</span>
</span><span id="EndaStackingEstimator.train-238"><a href="#EndaStackingEstimator.train-238"><span class="linenos">238</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaStackingEstimator.train-239"><a href="#EndaStackingEstimator.train-239"><span class="linenos">239</span></a><span class="sd">        :param base_stack_split_pct: If specified, will overwrite the EndaStackingEstimator attribute.</span>
</span><span id="EndaStackingEstimator.train-240"><a href="#EndaStackingEstimator.train-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.train-241"><a href="#EndaStackingEstimator.train-241"><span class="linenos">241</span></a>        <span class="n">split_pct</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="EndaStackingEstimator.train-242"><a href="#EndaStackingEstimator.train-242"><span class="linenos">242</span></a>            <span class="n">base_stack_split_pct</span> <span class="k">if</span> <span class="n">base_stack_split_pct</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_stack_split_pct</span>
</span><span id="EndaStackingEstimator.train-243"><a href="#EndaStackingEstimator.train-243"><span class="linenos">243</span></a>        <span class="p">)</span>
</span><span id="EndaStackingEstimator.train-244"><a href="#EndaStackingEstimator.train-244"><span class="linenos">244</span></a>
</span><span id="EndaStackingEstimator.train-245"><a href="#EndaStackingEstimator.train-245"><span class="linenos">245</span></a>        <span class="c1"># training final_estimator will temporarily train single estimators on part of the data,</span>
</span><span id="EndaStackingEstimator.train-246"><a href="#EndaStackingEstimator.train-246"><span class="linenos">246</span></a>        <span class="c1"># so it must be done before training the actual single estimators</span>
</span><span id="EndaStackingEstimator.train-247"><a href="#EndaStackingEstimator.train-247"><span class="linenos">247</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_final_estimator</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">split_pct</span><span class="p">)</span>
</span><span id="EndaStackingEstimator.train-248"><a href="#EndaStackingEstimator.train-248"><span class="linenos">248</span></a>
</span><span id="EndaStackingEstimator.train-249"><a href="#EndaStackingEstimator.train-249"><span class="linenos">249</span></a>        <span class="c1"># re-train base estimators with the full dataset</span>
</span><span id="EndaStackingEstimator.train-250"><a href="#EndaStackingEstimator.train-250"><span class="linenos">250</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_base_estimators</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Train base and final estimators.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The training dataset</li>
<li><strong>target_col</strong>:  The column to predict</li>
<li><strong>base_stack_split_pct</strong>:  If specified, will overwrite the EndaStackingEstimator attribute.</li>
</ul>
</div>


                            </div>
                            <div id="EndaStackingEstimator.train_final_estimator" class="classattr">
                                        <input id="EndaStackingEstimator.train_final_estimator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train_final_estimator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">split_pct</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaStackingEstimator.train_final_estimator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaStackingEstimator.train_final_estimator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaStackingEstimator.train_final_estimator-252"><a href="#EndaStackingEstimator.train_final_estimator-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">train_final_estimator</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.train_final_estimator-253"><a href="#EndaStackingEstimator.train_final_estimator-253"><span class="linenos">253</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">split_pct</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="EndaStackingEstimator.train_final_estimator-254"><a href="#EndaStackingEstimator.train_final_estimator-254"><span class="linenos">254</span></a>    <span class="p">):</span>
</span><span id="EndaStackingEstimator.train_final_estimator-255"><a href="#EndaStackingEstimator.train_final_estimator-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.train_final_estimator-256"><a href="#EndaStackingEstimator.train_final_estimator-256"><span class="linenos">256</span></a><span class="sd">        Trains the final estimator used for stacking.</span>
</span><span id="EndaStackingEstimator.train_final_estimator-257"><a href="#EndaStackingEstimator.train_final_estimator-257"><span class="linenos">257</span></a><span class="sd">        (Temporarily) train the single estimators with a subset of the data,</span>
</span><span id="EndaStackingEstimator.train_final_estimator-258"><a href="#EndaStackingEstimator.train_final_estimator-258"><span class="linenos">258</span></a><span class="sd">        then apply them on the rest of the data. Use this to train the stacking estimator.</span>
</span><span id="EndaStackingEstimator.train_final_estimator-259"><a href="#EndaStackingEstimator.train_final_estimator-259"><span class="linenos">259</span></a><span class="sd">        :param df: The DataFrame with training data</span>
</span><span id="EndaStackingEstimator.train_final_estimator-260"><a href="#EndaStackingEstimator.train_final_estimator-260"><span class="linenos">260</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaStackingEstimator.train_final_estimator-261"><a href="#EndaStackingEstimator.train_final_estimator-261"><span class="linenos">261</span></a><span class="sd">        :param split_pct: The percentage of training data to use to train the base estimators. The rest of the data</span>
</span><span id="EndaStackingEstimator.train_final_estimator-262"><a href="#EndaStackingEstimator.train_final_estimator-262"><span class="linenos">262</span></a><span class="sd">            will be used to train the final estimator based on the predictions of the base estimators</span>
</span><span id="EndaStackingEstimator.train_final_estimator-263"><a href="#EndaStackingEstimator.train_final_estimator-263"><span class="linenos">263</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.train_final_estimator-264"><a href="#EndaStackingEstimator.train_final_estimator-264"><span class="linenos">264</span></a>
</span><span id="EndaStackingEstimator.train_final_estimator-265"><a href="#EndaStackingEstimator.train_final_estimator-265"><span class="linenos">265</span></a>        <span class="c1"># split the training frame : ,</span>
</span><span id="EndaStackingEstimator.train_final_estimator-266"><a href="#EndaStackingEstimator.train_final_estimator-266"><span class="linenos">266</span></a>        <span class="n">split_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">split_pct</span><span class="p">))</span>
</span><span id="EndaStackingEstimator.train_final_estimator-267"><a href="#EndaStackingEstimator.train_final_estimator-267"><span class="linenos">267</span></a>        <span class="n">split_idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">split_int</span><span class="p">]</span>
</span><span id="EndaStackingEstimator.train_final_estimator-268"><a href="#EndaStackingEstimator.train_final_estimator-268"><span class="linenos">268</span></a>
</span><span id="EndaStackingEstimator.train_final_estimator-269"><a href="#EndaStackingEstimator.train_final_estimator-269"><span class="linenos">269</span></a>        <span class="n">df_base_estimators</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="EndaStackingEstimator.train_final_estimator-270"><a href="#EndaStackingEstimator.train_final_estimator-270"><span class="linenos">270</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">split_idx</span>
</span><span id="EndaStackingEstimator.train_final_estimator-271"><a href="#EndaStackingEstimator.train_final_estimator-271"><span class="linenos">271</span></a>        <span class="p">]</span>  <span class="c1"># one part to train the base estimators</span>
</span><span id="EndaStackingEstimator.train_final_estimator-272"><a href="#EndaStackingEstimator.train_final_estimator-272"><span class="linenos">272</span></a>        <span class="n">df_stacking</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="EndaStackingEstimator.train_final_estimator-273"><a href="#EndaStackingEstimator.train_final_estimator-273"><span class="linenos">273</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">split_idx</span>
</span><span id="EndaStackingEstimator.train_final_estimator-274"><a href="#EndaStackingEstimator.train_final_estimator-274"><span class="linenos">274</span></a>        <span class="p">]</span>  <span class="c1"># the other to train the stacking estimator</span>
</span><span id="EndaStackingEstimator.train_final_estimator-275"><a href="#EndaStackingEstimator.train_final_estimator-275"><span class="linenos">275</span></a>
</span><span id="EndaStackingEstimator.train_final_estimator-276"><a href="#EndaStackingEstimator.train_final_estimator-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="n">df_base_estimators</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">df_stacking</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EndaStackingEstimator.train_final_estimator-277"><a href="#EndaStackingEstimator.train_final_estimator-277"><span class="linenos">277</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.train_final_estimator-278"><a href="#EndaStackingEstimator.train_final_estimator-278"><span class="linenos">278</span></a>                <span class="s2">&quot;The split gave an empty train set for the base estimators or the final estimator. &quot;</span>
</span><span id="EndaStackingEstimator.train_final_estimator-279"><a href="#EndaStackingEstimator.train_final_estimator-279"><span class="linenos">279</span></a>                <span class="sa">f</span><span class="s2">&quot;Change parameter &#39;split_pct&#39; (given </span><span class="si">{</span><span class="n">split_pct</span><span class="si">}</span><span class="s2">) or provide a larger training set.&quot;</span>
</span><span id="EndaStackingEstimator.train_final_estimator-280"><a href="#EndaStackingEstimator.train_final_estimator-280"><span class="linenos">280</span></a>            <span class="p">)</span>
</span><span id="EndaStackingEstimator.train_final_estimator-281"><a href="#EndaStackingEstimator.train_final_estimator-281"><span class="linenos">281</span></a>
</span><span id="EndaStackingEstimator.train_final_estimator-282"><a href="#EndaStackingEstimator.train_final_estimator-282"><span class="linenos">282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_base_estimators</span><span class="p">(</span><span class="n">df_base_estimators</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator.train_final_estimator-283"><a href="#EndaStackingEstimator.train_final_estimator-283"><span class="linenos">283</span></a>
</span><span id="EndaStackingEstimator.train_final_estimator-284"><a href="#EndaStackingEstimator.train_final_estimator-284"><span class="linenos">284</span></a>        <span class="c1"># make predictions with these temporary base_estimators, without the target column</span>
</span><span id="EndaStackingEstimator.train_final_estimator-285"><a href="#EndaStackingEstimator.train_final_estimator-285"><span class="linenos">285</span></a>        <span class="n">base_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_base_estimators</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.train_final_estimator-286"><a href="#EndaStackingEstimator.train_final_estimator-286"><span class="linenos">286</span></a>            <span class="n">df_stacking</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_col</span><span class="p">]),</span> <span class="n">target_col</span>
</span><span id="EndaStackingEstimator.train_final_estimator-287"><a href="#EndaStackingEstimator.train_final_estimator-287"><span class="linenos">287</span></a>        <span class="p">)</span>
</span><span id="EndaStackingEstimator.train_final_estimator-288"><a href="#EndaStackingEstimator.train_final_estimator-288"><span class="linenos">288</span></a>
</span><span id="EndaStackingEstimator.train_final_estimator-289"><a href="#EndaStackingEstimator.train_final_estimator-289"><span class="linenos">289</span></a>        <span class="c1"># add the target back, to train the final estimator</span>
</span><span id="EndaStackingEstimator.train_final_estimator-290"><a href="#EndaStackingEstimator.train_final_estimator-290"><span class="linenos">290</span></a>        <span class="n">base_predictions</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_stacking</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="EndaStackingEstimator.train_final_estimator-291"><a href="#EndaStackingEstimator.train_final_estimator-291"><span class="linenos">291</span></a>
</span><span id="EndaStackingEstimator.train_final_estimator-292"><a href="#EndaStackingEstimator.train_final_estimator-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">base_predictions</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Trains the final estimator used for stacking.
(Temporarily) train the single estimators with a subset of the data,
then apply them on the rest of the data. Use this to train the stacking estimator.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The DataFrame with training data</li>
<li><strong>target_col</strong>:  The column to predict</li>
<li><strong>split_pct</strong>:  The percentage of training data to use to train the base estimators. The rest of the data
will be used to train the final estimator based on the predictions of the base estimators</li>
</ul>
</div>


                            </div>
                            <div id="EndaStackingEstimator.predict_base_estimators" class="classattr">
                                        <input id="EndaStackingEstimator.predict_base_estimators-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict_base_estimators</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="EndaStackingEstimator.predict_base_estimators-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaStackingEstimator.predict_base_estimators"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaStackingEstimator.predict_base_estimators-294"><a href="#EndaStackingEstimator.predict_base_estimators-294"><span class="linenos">294</span></a>    <span class="k">def</span> <span class="nf">predict_base_estimators</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-295"><a href="#EndaStackingEstimator.predict_base_estimators-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-296"><a href="#EndaStackingEstimator.predict_base_estimators-296"><span class="linenos">296</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-297"><a href="#EndaStackingEstimator.predict_base_estimators-297"><span class="linenos">297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-298"><a href="#EndaStackingEstimator.predict_base_estimators-298"><span class="linenos">298</span></a><span class="sd">        Make a prediction using base estimators</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-299"><a href="#EndaStackingEstimator.predict_base_estimators-299"><span class="linenos">299</span></a><span class="sd">        :param df: The input DataFrame for prediction</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-300"><a href="#EndaStackingEstimator.predict_base_estimators-300"><span class="linenos">300</span></a><span class="sd">        :param target_col: The name of the column to predict</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-301"><a href="#EndaStackingEstimator.predict_base_estimators-301"><span class="linenos">301</span></a><span class="sd">        :return: a Dataframe with the prediction of each base estimator in each column (on several rows).</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-302"><a href="#EndaStackingEstimator.predict_base_estimators-302"><span class="linenos">302</span></a><span class="sd">            Each column&#39;s name is the estimator_id given on initialisation.</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-303"><a href="#EndaStackingEstimator.predict_base_estimators-303"><span class="linenos">303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-304"><a href="#EndaStackingEstimator.predict_base_estimators-304"><span class="linenos">304</span></a>
</span><span id="EndaStackingEstimator.predict_base_estimators-305"><a href="#EndaStackingEstimator.predict_base_estimators-305"><span class="linenos">305</span></a>        <span class="n">estimator_dfs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-306"><a href="#EndaStackingEstimator.predict_base_estimators-306"><span class="linenos">306</span></a>        <span class="k">for</span> <span class="n">estimator_id</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-307"><a href="#EndaStackingEstimator.predict_base_estimators-307"><span class="linenos">307</span></a>            <span class="n">estimator_predict</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-308"><a href="#EndaStackingEstimator.predict_base_estimators-308"><span class="linenos">308</span></a>
</span><span id="EndaStackingEstimator.predict_base_estimators-309"><a href="#EndaStackingEstimator.predict_base_estimators-309"><span class="linenos">309</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">estimator_predict</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-310"><a href="#EndaStackingEstimator.predict_base_estimators-310"><span class="linenos">310</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-311"><a href="#EndaStackingEstimator.predict_base_estimators-311"><span class="linenos">311</span></a>                    <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-312"><a href="#EndaStackingEstimator.predict_base_estimators-312"><span class="linenos">312</span></a>                    <span class="sa">f</span><span class="s2">&quot;Check that for estimator with id &#39;</span><span class="si">{</span><span class="n">estimator_id</span><span class="si">}</span><span class="s2">&#39;, the method &#39;predict&#39; conserves index.&quot;</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-313"><a href="#EndaStackingEstimator.predict_base_estimators-313"><span class="linenos">313</span></a>                <span class="p">)</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-314"><a href="#EndaStackingEstimator.predict_base_estimators-314"><span class="linenos">314</span></a>
</span><span id="EndaStackingEstimator.predict_base_estimators-315"><a href="#EndaStackingEstimator.predict_base_estimators-315"><span class="linenos">315</span></a>            <span class="n">estimator_predict</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">target_col</span><span class="p">:</span> <span class="n">estimator_id</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-316"><a href="#EndaStackingEstimator.predict_base_estimators-316"><span class="linenos">316</span></a>            <span class="n">estimator_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator_predict</span><span class="p">)</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-317"><a href="#EndaStackingEstimator.predict_base_estimators-317"><span class="linenos">317</span></a>
</span><span id="EndaStackingEstimator.predict_base_estimators-318"><a href="#EndaStackingEstimator.predict_base_estimators-318"><span class="linenos">318</span></a>        <span class="n">predict_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">estimator_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">)</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-319"><a href="#EndaStackingEstimator.predict_base_estimators-319"><span class="linenos">319</span></a>
</span><span id="EndaStackingEstimator.predict_base_estimators-320"><a href="#EndaStackingEstimator.predict_base_estimators-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="n">predict_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-321"><a href="#EndaStackingEstimator.predict_base_estimators-321"><span class="linenos">321</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-322"><a href="#EndaStackingEstimator.predict_base_estimators-322"><span class="linenos">322</span></a>                <span class="sa">f</span><span class="s2">&quot;Given </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> values to predict, but predicted </span><span class="si">{</span><span class="n">predict_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-323"><a href="#EndaStackingEstimator.predict_base_estimators-323"><span class="linenos">323</span></a>            <span class="p">)</span>
</span><span id="EndaStackingEstimator.predict_base_estimators-324"><a href="#EndaStackingEstimator.predict_base_estimators-324"><span class="linenos">324</span></a>
</span><span id="EndaStackingEstimator.predict_base_estimators-325"><a href="#EndaStackingEstimator.predict_base_estimators-325"><span class="linenos">325</span></a>        <span class="k">return</span> <span class="n">predict_df</span>
</span></pre></div>


            <div class="docstring"><p>Make a prediction using base estimators</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The input DataFrame for prediction</li>
<li><strong>target_col</strong>:  The name of the column to predict</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a Dataframe with the prediction of each base estimator in each column (on several rows).
      Each column's name is the estimator_id given on initialisation.</p>
</blockquote>
</div>


                            </div>
                            <div id="EndaStackingEstimator.train_base_estimators" class="classattr">
                                        <input id="EndaStackingEstimator.train_base_estimators-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train_base_estimators</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>, </span><span class="param"><span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaStackingEstimator.train_base_estimators-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaStackingEstimator.train_base_estimators"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaStackingEstimator.train_base_estimators-327"><a href="#EndaStackingEstimator.train_base_estimators-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">train_base_estimators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EndaStackingEstimator.train_base_estimators-328"><a href="#EndaStackingEstimator.train_base_estimators-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.train_base_estimators-329"><a href="#EndaStackingEstimator.train_base_estimators-329"><span class="linenos">329</span></a><span class="sd">        Train the base estimators</span>
</span><span id="EndaStackingEstimator.train_base_estimators-330"><a href="#EndaStackingEstimator.train_base_estimators-330"><span class="linenos">330</span></a><span class="sd">        :param df: The training data</span>
</span><span id="EndaStackingEstimator.train_base_estimators-331"><a href="#EndaStackingEstimator.train_base_estimators-331"><span class="linenos">331</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaStackingEstimator.train_base_estimators-332"><a href="#EndaStackingEstimator.train_base_estimators-332"><span class="linenos">332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.train_base_estimators-333"><a href="#EndaStackingEstimator.train_base_estimators-333"><span class="linenos">333</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="EndaStackingEstimator.train_base_estimators-334"><a href="#EndaStackingEstimator.train_base_estimators-334"><span class="linenos">334</span></a>            <span class="n">estimator</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Train the base estimators</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The training data</li>
<li><strong>target_col</strong>:  The column to predict</li>
</ul>
</div>


                            </div>
                            <div id="EndaStackingEstimator.predict" class="classattr">
                                        <input id="EndaStackingEstimator.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="EndaStackingEstimator.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaStackingEstimator.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaStackingEstimator.predict-336"><a href="#EndaStackingEstimator.predict-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaStackingEstimator.predict-337"><a href="#EndaStackingEstimator.predict-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.predict-338"><a href="#EndaStackingEstimator.predict-338"><span class="linenos">338</span></a><span class="sd">        Make predictions with base estimators, then uses them to make a prediction with the final estimator</span>
</span><span id="EndaStackingEstimator.predict-339"><a href="#EndaStackingEstimator.predict-339"><span class="linenos">339</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="EndaStackingEstimator.predict-340"><a href="#EndaStackingEstimator.predict-340"><span class="linenos">340</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaStackingEstimator.predict-341"><a href="#EndaStackingEstimator.predict-341"><span class="linenos">341</span></a><span class="sd">        :return: A DataFrame with the predicted column</span>
</span><span id="EndaStackingEstimator.predict-342"><a href="#EndaStackingEstimator.predict-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaStackingEstimator.predict-343"><a href="#EndaStackingEstimator.predict-343"><span class="linenos">343</span></a>        <span class="n">base_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_base_estimators</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator.predict-344"><a href="#EndaStackingEstimator.predict-344"><span class="linenos">344</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">base_predictions</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaStackingEstimator.predict-345"><a href="#EndaStackingEstimator.predict-345"><span class="linenos">345</span></a>
</span><span id="EndaStackingEstimator.predict-346"><a href="#EndaStackingEstimator.predict-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaStackingEstimator.predict-347"><a href="#EndaStackingEstimator.predict-347"><span class="linenos">347</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaStackingEstimator.predict-348"><a href="#EndaStackingEstimator.predict-348"><span class="linenos">348</span></a>                <span class="s2">&quot;prediction must have the same index as given df. &quot;</span>
</span><span id="EndaStackingEstimator.predict-349"><a href="#EndaStackingEstimator.predict-349"><span class="linenos">349</span></a>                <span class="s2">&quot;Check that self.final_estimator.predict conserves index.&quot;</span>
</span><span id="EndaStackingEstimator.predict-350"><a href="#EndaStackingEstimator.predict-350"><span class="linenos">350</span></a>            <span class="p">)</span>
</span><span id="EndaStackingEstimator.predict-351"><a href="#EndaStackingEstimator.predict-351"><span class="linenos">351</span></a>
</span><span id="EndaStackingEstimator.predict-352"><a href="#EndaStackingEstimator.predict-352"><span class="linenos">352</span></a>        <span class="k">return</span> <span class="n">prediction</span>
</span></pre></div>


            <div class="docstring"><p>Make predictions with base estimators, then uses them to make a prediction with the final estimator</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The input data for prediction</li>
<li><strong>target_col</strong>:  The column to predict</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A DataFrame with the predicted column</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="EndaEstimatorWithFallback">
                            <input id="EndaEstimatorWithFallback-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EndaEstimatorWithFallback</span><wbr>(<span class="base"><a href="#EndaEstimator">EndaEstimator</a></span>):

                <label class="view-source-button" for="EndaEstimatorWithFallback-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorWithFallback-355"><a href="#EndaEstimatorWithFallback-355"><span class="linenos">355</span></a><span class="k">class</span> <span class="nc">EndaEstimatorWithFallback</span><span class="p">(</span><span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="EndaEstimatorWithFallback-356"><a href="#EndaEstimatorWithFallback-356"><span class="linenos">356</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-357"><a href="#EndaEstimatorWithFallback-357"><span class="linenos">357</span></a><span class="sd">    This estimator allows to make a prediction even when some important input is missing.</span>
</span><span id="EndaEstimatorWithFallback-358"><a href="#EndaEstimatorWithFallback-358"><span class="linenos">358</span></a>
</span><span id="EndaEstimatorWithFallback-359"><a href="#EndaEstimatorWithFallback-359"><span class="linenos">359</span></a><span class="sd">    In order to deal with missing values, it is common practice to replace None/NA with some meaningful value like</span>
</span><span id="EndaEstimatorWithFallback-360"><a href="#EndaEstimatorWithFallback-360"><span class="linenos">360</span></a><span class="sd">    the mean or the median of the values found in the train set for this feature.</span>
</span><span id="EndaEstimatorWithFallback-361"><a href="#EndaEstimatorWithFallback-361"><span class="linenos">361</span></a><span class="sd">    However, this is problematic when the missing variable has a significant impact on the prediction.</span>
</span><span id="EndaEstimatorWithFallback-362"><a href="#EndaEstimatorWithFallback-362"><span class="linenos">362</span></a>
</span><span id="EndaEstimatorWithFallback-363"><a href="#EndaEstimatorWithFallback-363"><span class="linenos">363</span></a><span class="sd">    Instead, this estimator trains 2 underlying estimators:</span>
</span><span id="EndaEstimatorWithFallback-364"><a href="#EndaEstimatorWithFallback-364"><span class="linenos">364</span></a><span class="sd">    an &#39;estimator_with&#39; and an &#39;estimator_without&#39; the column that can be missing.</span>
</span><span id="EndaEstimatorWithFallback-365"><a href="#EndaEstimatorWithFallback-365"><span class="linenos">365</span></a><span class="sd">    When predicting, it will use the &#39;estimator_with&#39; for inputs with the column present</span>
</span><span id="EndaEstimatorWithFallback-366"><a href="#EndaEstimatorWithFallback-366"><span class="linenos">366</span></a><span class="sd">    and the &#39;estimator_without&#39; for the others.</span>
</span><span id="EndaEstimatorWithFallback-367"><a href="#EndaEstimatorWithFallback-367"><span class="linenos">367</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-368"><a href="#EndaEstimatorWithFallback-368"><span class="linenos">368</span></a>
</span><span id="EndaEstimatorWithFallback-369"><a href="#EndaEstimatorWithFallback-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback-370"><a href="#EndaEstimatorWithFallback-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaEstimatorWithFallback-371"><a href="#EndaEstimatorWithFallback-371"><span class="linenos">371</span></a>        <span class="n">resilient_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="EndaEstimatorWithFallback-372"><a href="#EndaEstimatorWithFallback-372"><span class="linenos">372</span></a>        <span class="n">estimator_with</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="EndaEstimatorWithFallback-373"><a href="#EndaEstimatorWithFallback-373"><span class="linenos">373</span></a>        <span class="n">estimator_without</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="EndaEstimatorWithFallback-374"><a href="#EndaEstimatorWithFallback-374"><span class="linenos">374</span></a>    <span class="p">):</span>
</span><span id="EndaEstimatorWithFallback-375"><a href="#EndaEstimatorWithFallback-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-376"><a href="#EndaEstimatorWithFallback-376"><span class="linenos">376</span></a><span class="sd">        Initialize the estimator</span>
</span><span id="EndaEstimatorWithFallback-377"><a href="#EndaEstimatorWithFallback-377"><span class="linenos">377</span></a><span class="sd">        :param resilient_column: The column that can be missing, which will be taken into account by estimator_with but</span>
</span><span id="EndaEstimatorWithFallback-378"><a href="#EndaEstimatorWithFallback-378"><span class="linenos">378</span></a><span class="sd">            not by estimator_without</span>
</span><span id="EndaEstimatorWithFallback-379"><a href="#EndaEstimatorWithFallback-379"><span class="linenos">379</span></a><span class="sd">        :param estimator_with: An EndaEstimator that will train/predict using resilient_column</span>
</span><span id="EndaEstimatorWithFallback-380"><a href="#EndaEstimatorWithFallback-380"><span class="linenos">380</span></a><span class="sd">        :param estimator_without: An EndaEstimator that will train/predict without using resilient_column</span>
</span><span id="EndaEstimatorWithFallback-381"><a href="#EndaEstimatorWithFallback-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-382"><a href="#EndaEstimatorWithFallback-382"><span class="linenos">382</span></a>
</span><span id="EndaEstimatorWithFallback-383"><a href="#EndaEstimatorWithFallback-383"><span class="linenos">383</span></a>        <span class="k">if</span> <span class="n">estimator_with</span> <span class="ow">is</span> <span class="n">estimator_without</span><span class="p">:</span>  <span class="c1"># check identity</span>
</span><span id="EndaEstimatorWithFallback-384"><a href="#EndaEstimatorWithFallback-384"><span class="linenos">384</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback-385"><a href="#EndaEstimatorWithFallback-385"><span class="linenos">385</span></a>                <span class="s2">&quot;estimator_with and estimator_without must be different objects. &quot;</span>
</span><span id="EndaEstimatorWithFallback-386"><a href="#EndaEstimatorWithFallback-386"><span class="linenos">386</span></a>                <span class="s2">&quot;If you want the same base estimator, you can use copying tools &quot;</span>
</span><span id="EndaEstimatorWithFallback-387"><a href="#EndaEstimatorWithFallback-387"><span class="linenos">387</span></a>                <span class="s2">&quot; (like copy.deepcopy()) to duplicate the raw estimator.&quot;</span>
</span><span id="EndaEstimatorWithFallback-388"><a href="#EndaEstimatorWithFallback-388"><span class="linenos">388</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-389"><a href="#EndaEstimatorWithFallback-389"><span class="linenos">389</span></a>
</span><span id="EndaEstimatorWithFallback-390"><a href="#EndaEstimatorWithFallback-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span> <span class="o">=</span> <span class="n">resilient_column</span>
</span><span id="EndaEstimatorWithFallback-391"><a href="#EndaEstimatorWithFallback-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span> <span class="o">=</span> <span class="n">estimator_with</span>
</span><span id="EndaEstimatorWithFallback-392"><a href="#EndaEstimatorWithFallback-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span> <span class="o">=</span> <span class="n">estimator_without</span>
</span><span id="EndaEstimatorWithFallback-393"><a href="#EndaEstimatorWithFallback-393"><span class="linenos">393</span></a>
</span><span id="EndaEstimatorWithFallback-394"><a href="#EndaEstimatorWithFallback-394"><span class="linenos">394</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EndaEstimatorWithFallback-395"><a href="#EndaEstimatorWithFallback-395"><span class="linenos">395</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-396"><a href="#EndaEstimatorWithFallback-396"><span class="linenos">396</span></a><span class="sd">        Trains the two estimators : estimator_with and estimator_without the resilient_column</span>
</span><span id="EndaEstimatorWithFallback-397"><a href="#EndaEstimatorWithFallback-397"><span class="linenos">397</span></a><span class="sd">        :param df: The input data for training</span>
</span><span id="EndaEstimatorWithFallback-398"><a href="#EndaEstimatorWithFallback-398"><span class="linenos">398</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaEstimatorWithFallback-399"><a href="#EndaEstimatorWithFallback-399"><span class="linenos">399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-400"><a href="#EndaEstimatorWithFallback-400"><span class="linenos">400</span></a>
</span><span id="EndaEstimatorWithFallback-401"><a href="#EndaEstimatorWithFallback-401"><span class="linenos">401</span></a>        <span class="c1"># only train the &quot;estimator_with&quot; where resilient_column is present (not NA)</span>
</span><span id="EndaEstimatorWithFallback-402"><a href="#EndaEstimatorWithFallback-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]),</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-403"><a href="#EndaEstimatorWithFallback-403"><span class="linenos">403</span></a>        <span class="c1"># train the &quot;estimator_without&quot; without resilient_column</span>
</span><span id="EndaEstimatorWithFallback-404"><a href="#EndaEstimatorWithFallback-404"><span class="linenos">404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback-405"><a href="#EndaEstimatorWithFallback-405"><span class="linenos">405</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]),</span> <span class="n">target_col</span>
</span><span id="EndaEstimatorWithFallback-406"><a href="#EndaEstimatorWithFallback-406"><span class="linenos">406</span></a>        <span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-407"><a href="#EndaEstimatorWithFallback-407"><span class="linenos">407</span></a>
</span><span id="EndaEstimatorWithFallback-408"><a href="#EndaEstimatorWithFallback-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">predict_both</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback-409"><a href="#EndaEstimatorWithFallback-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="EndaEstimatorWithFallback-410"><a href="#EndaEstimatorWithFallback-410"><span class="linenos">410</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="EndaEstimatorWithFallback-411"><a href="#EndaEstimatorWithFallback-411"><span class="linenos">411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-412"><a href="#EndaEstimatorWithFallback-412"><span class="linenos">412</span></a><span class="sd">        Makes predictions with both estimators: estimator_with and estimator_without the resilient_column</span>
</span><span id="EndaEstimatorWithFallback-413"><a href="#EndaEstimatorWithFallback-413"><span class="linenos">413</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="EndaEstimatorWithFallback-414"><a href="#EndaEstimatorWithFallback-414"><span class="linenos">414</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaEstimatorWithFallback-415"><a href="#EndaEstimatorWithFallback-415"><span class="linenos">415</span></a><span class="sd">        :return: A tuple with two DataFrames, the first one being the prediction with the resilient_column and the</span>
</span><span id="EndaEstimatorWithFallback-416"><a href="#EndaEstimatorWithFallback-416"><span class="linenos">416</span></a><span class="sd">            second one without</span>
</span><span id="EndaEstimatorWithFallback-417"><a href="#EndaEstimatorWithFallback-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-418"><a href="#EndaEstimatorWithFallback-418"><span class="linenos">418</span></a>        <span class="n">df_with</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="EndaEstimatorWithFallback-419"><a href="#EndaEstimatorWithFallback-419"><span class="linenos">419</span></a>            <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
</span><span id="EndaEstimatorWithFallback-420"><a href="#EndaEstimatorWithFallback-420"><span class="linenos">420</span></a>        <span class="p">]</span>  <span class="c1"># only keeps rows where resilient_column is not NaN</span>
</span><span id="EndaEstimatorWithFallback-421"><a href="#EndaEstimatorWithFallback-421"><span class="linenos">421</span></a>        <span class="n">prediction_with</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_with</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-422"><a href="#EndaEstimatorWithFallback-422"><span class="linenos">422</span></a>        <span class="k">if</span> <span class="n">prediction_with</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="EndaEstimatorWithFallback-423"><a href="#EndaEstimatorWithFallback-423"><span class="linenos">423</span></a>            <span class="c1"># make estimator_with predict NaN where resilient_column is Nan :</span>
</span><span id="EndaEstimatorWithFallback-424"><a href="#EndaEstimatorWithFallback-424"><span class="linenos">424</span></a>            <span class="n">prediction_with</span> <span class="o">=</span> <span class="n">prediction_with</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback-425"><a href="#EndaEstimatorWithFallback-425"><span class="linenos">425</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">index</span>
</span><span id="EndaEstimatorWithFallback-426"><a href="#EndaEstimatorWithFallback-426"><span class="linenos">426</span></a>            <span class="p">)</span>  <span class="c1"># adds rows with NaN values</span>
</span><span id="EndaEstimatorWithFallback-427"><a href="#EndaEstimatorWithFallback-427"><span class="linenos">427</span></a>
</span><span id="EndaEstimatorWithFallback-428"><a href="#EndaEstimatorWithFallback-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction_with</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaEstimatorWithFallback-429"><a href="#EndaEstimatorWithFallback-429"><span class="linenos">429</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback-430"><a href="#EndaEstimatorWithFallback-430"><span class="linenos">430</span></a>                <span class="s2">&quot;prediction_with must have the same index as given df. &quot;</span>
</span><span id="EndaEstimatorWithFallback-431"><a href="#EndaEstimatorWithFallback-431"><span class="linenos">431</span></a>                <span class="s2">&quot;Check that self.estimator_with.predict conserves index.&quot;</span>
</span><span id="EndaEstimatorWithFallback-432"><a href="#EndaEstimatorWithFallback-432"><span class="linenos">432</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-433"><a href="#EndaEstimatorWithFallback-433"><span class="linenos">433</span></a>
</span><span id="EndaEstimatorWithFallback-434"><a href="#EndaEstimatorWithFallback-434"><span class="linenos">434</span></a>        <span class="n">df_without</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">])</span>
</span><span id="EndaEstimatorWithFallback-435"><a href="#EndaEstimatorWithFallback-435"><span class="linenos">435</span></a>        <span class="n">prediction_without</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_without</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-436"><a href="#EndaEstimatorWithFallback-436"><span class="linenos">436</span></a>
</span><span id="EndaEstimatorWithFallback-437"><a href="#EndaEstimatorWithFallback-437"><span class="linenos">437</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction_without</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaEstimatorWithFallback-438"><a href="#EndaEstimatorWithFallback-438"><span class="linenos">438</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback-439"><a href="#EndaEstimatorWithFallback-439"><span class="linenos">439</span></a>                <span class="s2">&quot;prediction_without must have the same index as given df. &quot;</span>
</span><span id="EndaEstimatorWithFallback-440"><a href="#EndaEstimatorWithFallback-440"><span class="linenos">440</span></a>                <span class="s2">&quot;Check that self.estimator_without.predict conserves index.&quot;</span>
</span><span id="EndaEstimatorWithFallback-441"><a href="#EndaEstimatorWithFallback-441"><span class="linenos">441</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-442"><a href="#EndaEstimatorWithFallback-442"><span class="linenos">442</span></a>
</span><span id="EndaEstimatorWithFallback-443"><a href="#EndaEstimatorWithFallback-443"><span class="linenos">443</span></a>        <span class="k">return</span> <span class="n">prediction_with</span><span class="p">,</span> <span class="n">prediction_without</span>
</span><span id="EndaEstimatorWithFallback-444"><a href="#EndaEstimatorWithFallback-444"><span class="linenos">444</span></a>
</span><span id="EndaEstimatorWithFallback-445"><a href="#EndaEstimatorWithFallback-445"><span class="linenos">445</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaEstimatorWithFallback-446"><a href="#EndaEstimatorWithFallback-446"><span class="linenos">446</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-447"><a href="#EndaEstimatorWithFallback-447"><span class="linenos">447</span></a><span class="sd">        Makes a prediction with both estimators, takes prediction by estimator_with by default and fallbacks to</span>
</span><span id="EndaEstimatorWithFallback-448"><a href="#EndaEstimatorWithFallback-448"><span class="linenos">448</span></a><span class="sd">        estimator_without when it is not available</span>
</span><span id="EndaEstimatorWithFallback-449"><a href="#EndaEstimatorWithFallback-449"><span class="linenos">449</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="EndaEstimatorWithFallback-450"><a href="#EndaEstimatorWithFallback-450"><span class="linenos">450</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaEstimatorWithFallback-451"><a href="#EndaEstimatorWithFallback-451"><span class="linenos">451</span></a><span class="sd">        :return: The final prediction combining both estimators</span>
</span><span id="EndaEstimatorWithFallback-452"><a href="#EndaEstimatorWithFallback-452"><span class="linenos">452</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-453"><a href="#EndaEstimatorWithFallback-453"><span class="linenos">453</span></a>        <span class="n">predict_with</span><span class="p">,</span> <span class="n">predict_without</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_both</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-454"><a href="#EndaEstimatorWithFallback-454"><span class="linenos">454</span></a>
</span><span id="EndaEstimatorWithFallback-455"><a href="#EndaEstimatorWithFallback-455"><span class="linenos">455</span></a>        <span class="c1"># keep prediction with column_name when available, else take the prediction of the estimator without it</span>
</span><span id="EndaEstimatorWithFallback-456"><a href="#EndaEstimatorWithFallback-456"><span class="linenos">456</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">predict_with</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback-457"><a href="#EndaEstimatorWithFallback-457"><span class="linenos">457</span></a>            <span class="n">predict_without</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="EndaEstimatorWithFallback-458"><a href="#EndaEstimatorWithFallback-458"><span class="linenos">458</span></a>        <span class="p">)</span>  <span class="c1"># pandas series</span>
</span><span id="EndaEstimatorWithFallback-459"><a href="#EndaEstimatorWithFallback-459"><span class="linenos">459</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-460"><a href="#EndaEstimatorWithFallback-460"><span class="linenos">460</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="EndaEstimatorWithFallback-461"><a href="#EndaEstimatorWithFallback-461"><span class="linenos">461</span></a>
</span><span id="EndaEstimatorWithFallback-462"><a href="#EndaEstimatorWithFallback-462"><span class="linenos">462</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EndaEstimatorWithFallback-463"><a href="#EndaEstimatorWithFallback-463"><span class="linenos">463</span></a>    <span class="k">def</span> <span class="nf">_get_model_name_and_params</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
</span><span id="EndaEstimatorWithFallback-464"><a href="#EndaEstimatorWithFallback-464"><span class="linenos">464</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="EndaEstimatorWithFallback-465"><a href="#EndaEstimatorWithFallback-465"><span class="linenos">465</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</span><span id="EndaEstimatorWithFallback-466"><a href="#EndaEstimatorWithFallback-466"><span class="linenos">466</span></a>        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">params</span>
</span><span id="EndaEstimatorWithFallback-467"><a href="#EndaEstimatorWithFallback-467"><span class="linenos">467</span></a>
</span><span id="EndaEstimatorWithFallback-468"><a href="#EndaEstimatorWithFallback-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">get_model_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EndaEstimatorWithFallback-469"><a href="#EndaEstimatorWithFallback-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-470"><a href="#EndaEstimatorWithFallback-470"><span class="linenos">470</span></a><span class="sd">        Get model parameters of estimator_with and estimator_without</span>
</span><span id="EndaEstimatorWithFallback-471"><a href="#EndaEstimatorWithFallback-471"><span class="linenos">471</span></a><span class="sd">        :return: A dictionary with one entry per model and associated parameters</span>
</span><span id="EndaEstimatorWithFallback-472"><a href="#EndaEstimatorWithFallback-472"><span class="linenos">472</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback-473"><a href="#EndaEstimatorWithFallback-473"><span class="linenos">473</span></a>
</span><span id="EndaEstimatorWithFallback-474"><a href="#EndaEstimatorWithFallback-474"><span class="linenos">474</span></a>        <span class="c1"># TODO : ne fonctionne que pour des estimateurs stacks ?</span>
</span><span id="EndaEstimatorWithFallback-475"><a href="#EndaEstimatorWithFallback-475"><span class="linenos">475</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EndaEstimatorWithFallback-476"><a href="#EndaEstimatorWithFallback-476"><span class="linenos">476</span></a>            <span class="s2">&quot;estimator_with&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;final_estimators&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="EndaEstimatorWithFallback-477"><a href="#EndaEstimatorWithFallback-477"><span class="linenos">477</span></a>            <span class="s2">&quot;estimator_without&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;final_estimators&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="EndaEstimatorWithFallback-478"><a href="#EndaEstimatorWithFallback-478"><span class="linenos">478</span></a>        <span class="p">}</span>
</span><span id="EndaEstimatorWithFallback-479"><a href="#EndaEstimatorWithFallback-479"><span class="linenos">479</span></a>
</span><span id="EndaEstimatorWithFallback-480"><a href="#EndaEstimatorWithFallback-480"><span class="linenos">480</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="EndaEstimatorWithFallback-481"><a href="#EndaEstimatorWithFallback-481"><span class="linenos">481</span></a>            <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-482"><a href="#EndaEstimatorWithFallback-482"><span class="linenos">482</span></a>            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_with&quot;</span><span class="p">][</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="EndaEstimatorWithFallback-483"><a href="#EndaEstimatorWithFallback-483"><span class="linenos">483</span></a>
</span><span id="EndaEstimatorWithFallback-484"><a href="#EndaEstimatorWithFallback-484"><span class="linenos">484</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="EndaEstimatorWithFallback-485"><a href="#EndaEstimatorWithFallback-485"><span class="linenos">485</span></a>            <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-486"><a href="#EndaEstimatorWithFallback-486"><span class="linenos">486</span></a>            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_without&quot;</span><span class="p">][</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="EndaEstimatorWithFallback-487"><a href="#EndaEstimatorWithFallback-487"><span class="linenos">487</span></a>
</span><span id="EndaEstimatorWithFallback-488"><a href="#EndaEstimatorWithFallback-488"><span class="linenos">488</span></a>        <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">final_estimator</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-489"><a href="#EndaEstimatorWithFallback-489"><span class="linenos">489</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_with&quot;</span><span class="p">][</span><span class="s2">&quot;final_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="EndaEstimatorWithFallback-490"><a href="#EndaEstimatorWithFallback-490"><span class="linenos">490</span></a>
</span><span id="EndaEstimatorWithFallback-491"><a href="#EndaEstimatorWithFallback-491"><span class="linenos">491</span></a>        <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">final_estimator</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback-492"><a href="#EndaEstimatorWithFallback-492"><span class="linenos">492</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_without&quot;</span><span class="p">][</span><span class="s2">&quot;final_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="EndaEstimatorWithFallback-493"><a href="#EndaEstimatorWithFallback-493"><span class="linenos">493</span></a>
</span><span id="EndaEstimatorWithFallback-494"><a href="#EndaEstimatorWithFallback-494"><span class="linenos">494</span></a>        <span class="k">return</span> <span class="n">d</span>
</span></pre></div>


            <div class="docstring"><p>This estimator allows to make a prediction even when some important input is missing.</p>

<p>In order to deal with missing values, it is common practice to replace None/NA with some meaningful value like
the mean or the median of the values found in the train set for this feature.
However, this is problematic when the missing variable has a significant impact on the prediction.</p>

<p>Instead, this estimator trains 2 underlying estimators:
an 'estimator_with' and an 'estimator_without' the column that can be missing.
When predicting, it will use the 'estimator_with' for inputs with the column present
and the 'estimator_without' for the others.</p>
</div>


                            <div id="EndaEstimatorWithFallback.__init__" class="classattr">
                                        <input id="EndaEstimatorWithFallback.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EndaEstimatorWithFallback</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">resilient_column</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">estimator_with</span><span class="p">:</span> <span class="n"><a href="#EndaEstimator">EndaEstimator</a></span>,</span><span class="param">	<span class="n">estimator_without</span><span class="p">:</span> <span class="n"><a href="#EndaEstimator">EndaEstimator</a></span></span>)</span>

                <label class="view-source-button" for="EndaEstimatorWithFallback.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorWithFallback.__init__-369"><a href="#EndaEstimatorWithFallback.__init__-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback.__init__-370"><a href="#EndaEstimatorWithFallback.__init__-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EndaEstimatorWithFallback.__init__-371"><a href="#EndaEstimatorWithFallback.__init__-371"><span class="linenos">371</span></a>        <span class="n">resilient_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="EndaEstimatorWithFallback.__init__-372"><a href="#EndaEstimatorWithFallback.__init__-372"><span class="linenos">372</span></a>        <span class="n">estimator_with</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="EndaEstimatorWithFallback.__init__-373"><a href="#EndaEstimatorWithFallback.__init__-373"><span class="linenos">373</span></a>        <span class="n">estimator_without</span><span class="p">:</span> <span class="n">EndaEstimator</span><span class="p">,</span>
</span><span id="EndaEstimatorWithFallback.__init__-374"><a href="#EndaEstimatorWithFallback.__init__-374"><span class="linenos">374</span></a>    <span class="p">):</span>
</span><span id="EndaEstimatorWithFallback.__init__-375"><a href="#EndaEstimatorWithFallback.__init__-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.__init__-376"><a href="#EndaEstimatorWithFallback.__init__-376"><span class="linenos">376</span></a><span class="sd">        Initialize the estimator</span>
</span><span id="EndaEstimatorWithFallback.__init__-377"><a href="#EndaEstimatorWithFallback.__init__-377"><span class="linenos">377</span></a><span class="sd">        :param resilient_column: The column that can be missing, which will be taken into account by estimator_with but</span>
</span><span id="EndaEstimatorWithFallback.__init__-378"><a href="#EndaEstimatorWithFallback.__init__-378"><span class="linenos">378</span></a><span class="sd">            not by estimator_without</span>
</span><span id="EndaEstimatorWithFallback.__init__-379"><a href="#EndaEstimatorWithFallback.__init__-379"><span class="linenos">379</span></a><span class="sd">        :param estimator_with: An EndaEstimator that will train/predict using resilient_column</span>
</span><span id="EndaEstimatorWithFallback.__init__-380"><a href="#EndaEstimatorWithFallback.__init__-380"><span class="linenos">380</span></a><span class="sd">        :param estimator_without: An EndaEstimator that will train/predict without using resilient_column</span>
</span><span id="EndaEstimatorWithFallback.__init__-381"><a href="#EndaEstimatorWithFallback.__init__-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.__init__-382"><a href="#EndaEstimatorWithFallback.__init__-382"><span class="linenos">382</span></a>
</span><span id="EndaEstimatorWithFallback.__init__-383"><a href="#EndaEstimatorWithFallback.__init__-383"><span class="linenos">383</span></a>        <span class="k">if</span> <span class="n">estimator_with</span> <span class="ow">is</span> <span class="n">estimator_without</span><span class="p">:</span>  <span class="c1"># check identity</span>
</span><span id="EndaEstimatorWithFallback.__init__-384"><a href="#EndaEstimatorWithFallback.__init__-384"><span class="linenos">384</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback.__init__-385"><a href="#EndaEstimatorWithFallback.__init__-385"><span class="linenos">385</span></a>                <span class="s2">&quot;estimator_with and estimator_without must be different objects. &quot;</span>
</span><span id="EndaEstimatorWithFallback.__init__-386"><a href="#EndaEstimatorWithFallback.__init__-386"><span class="linenos">386</span></a>                <span class="s2">&quot;If you want the same base estimator, you can use copying tools &quot;</span>
</span><span id="EndaEstimatorWithFallback.__init__-387"><a href="#EndaEstimatorWithFallback.__init__-387"><span class="linenos">387</span></a>                <span class="s2">&quot; (like copy.deepcopy()) to duplicate the raw estimator.&quot;</span>
</span><span id="EndaEstimatorWithFallback.__init__-388"><a href="#EndaEstimatorWithFallback.__init__-388"><span class="linenos">388</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.__init__-389"><a href="#EndaEstimatorWithFallback.__init__-389"><span class="linenos">389</span></a>
</span><span id="EndaEstimatorWithFallback.__init__-390"><a href="#EndaEstimatorWithFallback.__init__-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span> <span class="o">=</span> <span class="n">resilient_column</span>
</span><span id="EndaEstimatorWithFallback.__init__-391"><a href="#EndaEstimatorWithFallback.__init__-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span> <span class="o">=</span> <span class="n">estimator_with</span>
</span><span id="EndaEstimatorWithFallback.__init__-392"><a href="#EndaEstimatorWithFallback.__init__-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span> <span class="o">=</span> <span class="n">estimator_without</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the estimator</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>resilient_column</strong>:  The column that can be missing, which will be taken into account by estimator_with but
not by estimator_without</li>
<li><strong>estimator_with</strong>:  An EndaEstimator that will train/predict using resilient_column</li>
<li><strong>estimator_without</strong>:  An EndaEstimator that will train/predict without using resilient_column</li>
</ul>
</div>


                            </div>
                            <div id="EndaEstimatorWithFallback.resilient_column" class="classattr">
                                <div class="attr variable">
            <span class="name">resilient_column</span>

        
    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback.resilient_column"></a>
    
    

                            </div>
                            <div id="EndaEstimatorWithFallback.estimator_with" class="classattr">
                                <div class="attr variable">
            <span class="name">estimator_with</span>

        
    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback.estimator_with"></a>
    
    

                            </div>
                            <div id="EndaEstimatorWithFallback.estimator_without" class="classattr">
                                <div class="attr variable">
            <span class="name">estimator_without</span>

        
    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback.estimator_without"></a>
    
    

                            </div>
                            <div id="EndaEstimatorWithFallback.train" class="classattr">
                                        <input id="EndaEstimatorWithFallback.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>, </span><span class="param"><span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaEstimatorWithFallback.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorWithFallback.train-394"><a href="#EndaEstimatorWithFallback.train-394"><span class="linenos">394</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EndaEstimatorWithFallback.train-395"><a href="#EndaEstimatorWithFallback.train-395"><span class="linenos">395</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.train-396"><a href="#EndaEstimatorWithFallback.train-396"><span class="linenos">396</span></a><span class="sd">        Trains the two estimators : estimator_with and estimator_without the resilient_column</span>
</span><span id="EndaEstimatorWithFallback.train-397"><a href="#EndaEstimatorWithFallback.train-397"><span class="linenos">397</span></a><span class="sd">        :param df: The input data for training</span>
</span><span id="EndaEstimatorWithFallback.train-398"><a href="#EndaEstimatorWithFallback.train-398"><span class="linenos">398</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaEstimatorWithFallback.train-399"><a href="#EndaEstimatorWithFallback.train-399"><span class="linenos">399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.train-400"><a href="#EndaEstimatorWithFallback.train-400"><span class="linenos">400</span></a>
</span><span id="EndaEstimatorWithFallback.train-401"><a href="#EndaEstimatorWithFallback.train-401"><span class="linenos">401</span></a>        <span class="c1"># only train the &quot;estimator_with&quot; where resilient_column is present (not NA)</span>
</span><span id="EndaEstimatorWithFallback.train-402"><a href="#EndaEstimatorWithFallback.train-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]),</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.train-403"><a href="#EndaEstimatorWithFallback.train-403"><span class="linenos">403</span></a>        <span class="c1"># train the &quot;estimator_without&quot; without resilient_column</span>
</span><span id="EndaEstimatorWithFallback.train-404"><a href="#EndaEstimatorWithFallback.train-404"><span class="linenos">404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback.train-405"><a href="#EndaEstimatorWithFallback.train-405"><span class="linenos">405</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]),</span> <span class="n">target_col</span>
</span><span id="EndaEstimatorWithFallback.train-406"><a href="#EndaEstimatorWithFallback.train-406"><span class="linenos">406</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Trains the two estimators : estimator_with and estimator_without the resilient_column</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The input data for training</li>
<li><strong>target_col</strong>:  The column to predict</li>
</ul>
</div>


                            </div>
                            <div id="EndaEstimatorWithFallback.predict_both" class="classattr">
                                        <input id="EndaEstimatorWithFallback.predict_both-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict_both</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> (&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;, &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;):</span></span>

                <label class="view-source-button" for="EndaEstimatorWithFallback.predict_both-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback.predict_both"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorWithFallback.predict_both-408"><a href="#EndaEstimatorWithFallback.predict_both-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">predict_both</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback.predict_both-409"><a href="#EndaEstimatorWithFallback.predict_both-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="EndaEstimatorWithFallback.predict_both-410"><a href="#EndaEstimatorWithFallback.predict_both-410"><span class="linenos">410</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="EndaEstimatorWithFallback.predict_both-411"><a href="#EndaEstimatorWithFallback.predict_both-411"><span class="linenos">411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.predict_both-412"><a href="#EndaEstimatorWithFallback.predict_both-412"><span class="linenos">412</span></a><span class="sd">        Makes predictions with both estimators: estimator_with and estimator_without the resilient_column</span>
</span><span id="EndaEstimatorWithFallback.predict_both-413"><a href="#EndaEstimatorWithFallback.predict_both-413"><span class="linenos">413</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="EndaEstimatorWithFallback.predict_both-414"><a href="#EndaEstimatorWithFallback.predict_both-414"><span class="linenos">414</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaEstimatorWithFallback.predict_both-415"><a href="#EndaEstimatorWithFallback.predict_both-415"><span class="linenos">415</span></a><span class="sd">        :return: A tuple with two DataFrames, the first one being the prediction with the resilient_column and the</span>
</span><span id="EndaEstimatorWithFallback.predict_both-416"><a href="#EndaEstimatorWithFallback.predict_both-416"><span class="linenos">416</span></a><span class="sd">            second one without</span>
</span><span id="EndaEstimatorWithFallback.predict_both-417"><a href="#EndaEstimatorWithFallback.predict_both-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.predict_both-418"><a href="#EndaEstimatorWithFallback.predict_both-418"><span class="linenos">418</span></a>        <span class="n">df_with</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
</span><span id="EndaEstimatorWithFallback.predict_both-419"><a href="#EndaEstimatorWithFallback.predict_both-419"><span class="linenos">419</span></a>            <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
</span><span id="EndaEstimatorWithFallback.predict_both-420"><a href="#EndaEstimatorWithFallback.predict_both-420"><span class="linenos">420</span></a>        <span class="p">]</span>  <span class="c1"># only keeps rows where resilient_column is not NaN</span>
</span><span id="EndaEstimatorWithFallback.predict_both-421"><a href="#EndaEstimatorWithFallback.predict_both-421"><span class="linenos">421</span></a>        <span class="n">prediction_with</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_with</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.predict_both-422"><a href="#EndaEstimatorWithFallback.predict_both-422"><span class="linenos">422</span></a>        <span class="k">if</span> <span class="n">prediction_with</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="EndaEstimatorWithFallback.predict_both-423"><a href="#EndaEstimatorWithFallback.predict_both-423"><span class="linenos">423</span></a>            <span class="c1"># make estimator_with predict NaN where resilient_column is Nan :</span>
</span><span id="EndaEstimatorWithFallback.predict_both-424"><a href="#EndaEstimatorWithFallback.predict_both-424"><span class="linenos">424</span></a>            <span class="n">prediction_with</span> <span class="o">=</span> <span class="n">prediction_with</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback.predict_both-425"><a href="#EndaEstimatorWithFallback.predict_both-425"><span class="linenos">425</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">index</span>
</span><span id="EndaEstimatorWithFallback.predict_both-426"><a href="#EndaEstimatorWithFallback.predict_both-426"><span class="linenos">426</span></a>            <span class="p">)</span>  <span class="c1"># adds rows with NaN values</span>
</span><span id="EndaEstimatorWithFallback.predict_both-427"><a href="#EndaEstimatorWithFallback.predict_both-427"><span class="linenos">427</span></a>
</span><span id="EndaEstimatorWithFallback.predict_both-428"><a href="#EndaEstimatorWithFallback.predict_both-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction_with</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaEstimatorWithFallback.predict_both-429"><a href="#EndaEstimatorWithFallback.predict_both-429"><span class="linenos">429</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback.predict_both-430"><a href="#EndaEstimatorWithFallback.predict_both-430"><span class="linenos">430</span></a>                <span class="s2">&quot;prediction_with must have the same index as given df. &quot;</span>
</span><span id="EndaEstimatorWithFallback.predict_both-431"><a href="#EndaEstimatorWithFallback.predict_both-431"><span class="linenos">431</span></a>                <span class="s2">&quot;Check that self.estimator_with.predict conserves index.&quot;</span>
</span><span id="EndaEstimatorWithFallback.predict_both-432"><a href="#EndaEstimatorWithFallback.predict_both-432"><span class="linenos">432</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.predict_both-433"><a href="#EndaEstimatorWithFallback.predict_both-433"><span class="linenos">433</span></a>
</span><span id="EndaEstimatorWithFallback.predict_both-434"><a href="#EndaEstimatorWithFallback.predict_both-434"><span class="linenos">434</span></a>        <span class="n">df_without</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resilient_column</span><span class="p">])</span>
</span><span id="EndaEstimatorWithFallback.predict_both-435"><a href="#EndaEstimatorWithFallback.predict_both-435"><span class="linenos">435</span></a>        <span class="n">prediction_without</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_without</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.predict_both-436"><a href="#EndaEstimatorWithFallback.predict_both-436"><span class="linenos">436</span></a>
</span><span id="EndaEstimatorWithFallback.predict_both-437"><a href="#EndaEstimatorWithFallback.predict_both-437"><span class="linenos">437</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">prediction_without</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="EndaEstimatorWithFallback.predict_both-438"><a href="#EndaEstimatorWithFallback.predict_both-438"><span class="linenos">438</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback.predict_both-439"><a href="#EndaEstimatorWithFallback.predict_both-439"><span class="linenos">439</span></a>                <span class="s2">&quot;prediction_without must have the same index as given df. &quot;</span>
</span><span id="EndaEstimatorWithFallback.predict_both-440"><a href="#EndaEstimatorWithFallback.predict_both-440"><span class="linenos">440</span></a>                <span class="s2">&quot;Check that self.estimator_without.predict conserves index.&quot;</span>
</span><span id="EndaEstimatorWithFallback.predict_both-441"><a href="#EndaEstimatorWithFallback.predict_both-441"><span class="linenos">441</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.predict_both-442"><a href="#EndaEstimatorWithFallback.predict_both-442"><span class="linenos">442</span></a>
</span><span id="EndaEstimatorWithFallback.predict_both-443"><a href="#EndaEstimatorWithFallback.predict_both-443"><span class="linenos">443</span></a>        <span class="k">return</span> <span class="n">prediction_with</span><span class="p">,</span> <span class="n">prediction_without</span>
</span></pre></div>


            <div class="docstring"><p>Makes predictions with both estimators: estimator_with and estimator_without the resilient_column</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The input data for prediction</li>
<li><strong>target_col</strong>:  The column to predict</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A tuple with two DataFrames, the first one being the prediction with the resilient_column and the
      second one without</p>
</blockquote>
</div>


                            </div>
                            <div id="EndaEstimatorWithFallback.predict" class="classattr">
                                        <input id="EndaEstimatorWithFallback.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="EndaEstimatorWithFallback.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorWithFallback.predict-445"><a href="#EndaEstimatorWithFallback.predict-445"><span class="linenos">445</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaEstimatorWithFallback.predict-446"><a href="#EndaEstimatorWithFallback.predict-446"><span class="linenos">446</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.predict-447"><a href="#EndaEstimatorWithFallback.predict-447"><span class="linenos">447</span></a><span class="sd">        Makes a prediction with both estimators, takes prediction by estimator_with by default and fallbacks to</span>
</span><span id="EndaEstimatorWithFallback.predict-448"><a href="#EndaEstimatorWithFallback.predict-448"><span class="linenos">448</span></a><span class="sd">        estimator_without when it is not available</span>
</span><span id="EndaEstimatorWithFallback.predict-449"><a href="#EndaEstimatorWithFallback.predict-449"><span class="linenos">449</span></a><span class="sd">        :param df: The input data for prediction</span>
</span><span id="EndaEstimatorWithFallback.predict-450"><a href="#EndaEstimatorWithFallback.predict-450"><span class="linenos">450</span></a><span class="sd">        :param target_col: The column to predict</span>
</span><span id="EndaEstimatorWithFallback.predict-451"><a href="#EndaEstimatorWithFallback.predict-451"><span class="linenos">451</span></a><span class="sd">        :return: The final prediction combining both estimators</span>
</span><span id="EndaEstimatorWithFallback.predict-452"><a href="#EndaEstimatorWithFallback.predict-452"><span class="linenos">452</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.predict-453"><a href="#EndaEstimatorWithFallback.predict-453"><span class="linenos">453</span></a>        <span class="n">predict_with</span><span class="p">,</span> <span class="n">predict_without</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_both</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.predict-454"><a href="#EndaEstimatorWithFallback.predict-454"><span class="linenos">454</span></a>
</span><span id="EndaEstimatorWithFallback.predict-455"><a href="#EndaEstimatorWithFallback.predict-455"><span class="linenos">455</span></a>        <span class="c1"># keep prediction with column_name when available, else take the prediction of the estimator without it</span>
</span><span id="EndaEstimatorWithFallback.predict-456"><a href="#EndaEstimatorWithFallback.predict-456"><span class="linenos">456</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">predict_with</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
</span><span id="EndaEstimatorWithFallback.predict-457"><a href="#EndaEstimatorWithFallback.predict-457"><span class="linenos">457</span></a>            <span class="n">predict_without</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="EndaEstimatorWithFallback.predict-458"><a href="#EndaEstimatorWithFallback.predict-458"><span class="linenos">458</span></a>        <span class="p">)</span>  <span class="c1"># pandas series</span>
</span><span id="EndaEstimatorWithFallback.predict-459"><a href="#EndaEstimatorWithFallback.predict-459"><span class="linenos">459</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.predict-460"><a href="#EndaEstimatorWithFallback.predict-460"><span class="linenos">460</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Makes a prediction with both estimators, takes prediction by estimator_with by default and fallbacks to
estimator_without when it is not available</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The input data for prediction</li>
<li><strong>target_col</strong>:  The column to predict</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The final prediction combining both estimators</p>
</blockquote>
</div>


                            </div>
                            <div id="EndaEstimatorWithFallback.get_model_params" class="classattr">
                                        <input id="EndaEstimatorWithFallback.get_model_params-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_model_params</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaEstimatorWithFallback.get_model_params-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorWithFallback.get_model_params"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorWithFallback.get_model_params-468"><a href="#EndaEstimatorWithFallback.get_model_params-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">get_model_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-469"><a href="#EndaEstimatorWithFallback.get_model_params-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-470"><a href="#EndaEstimatorWithFallback.get_model_params-470"><span class="linenos">470</span></a><span class="sd">        Get model parameters of estimator_with and estimator_without</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-471"><a href="#EndaEstimatorWithFallback.get_model_params-471"><span class="linenos">471</span></a><span class="sd">        :return: A dictionary with one entry per model and associated parameters</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-472"><a href="#EndaEstimatorWithFallback.get_model_params-472"><span class="linenos">472</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-473"><a href="#EndaEstimatorWithFallback.get_model_params-473"><span class="linenos">473</span></a>
</span><span id="EndaEstimatorWithFallback.get_model_params-474"><a href="#EndaEstimatorWithFallback.get_model_params-474"><span class="linenos">474</span></a>        <span class="c1"># TODO : ne fonctionne que pour des estimateurs stacks ?</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-475"><a href="#EndaEstimatorWithFallback.get_model_params-475"><span class="linenos">475</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-476"><a href="#EndaEstimatorWithFallback.get_model_params-476"><span class="linenos">476</span></a>            <span class="s2">&quot;estimator_with&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;final_estimators&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-477"><a href="#EndaEstimatorWithFallback.get_model_params-477"><span class="linenos">477</span></a>            <span class="s2">&quot;estimator_without&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;final_estimators&quot;</span><span class="p">:</span> <span class="p">{}},</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-478"><a href="#EndaEstimatorWithFallback.get_model_params-478"><span class="linenos">478</span></a>        <span class="p">}</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-479"><a href="#EndaEstimatorWithFallback.get_model_params-479"><span class="linenos">479</span></a>
</span><span id="EndaEstimatorWithFallback.get_model_params-480"><a href="#EndaEstimatorWithFallback.get_model_params-480"><span class="linenos">480</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-481"><a href="#EndaEstimatorWithFallback.get_model_params-481"><span class="linenos">481</span></a>            <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-482"><a href="#EndaEstimatorWithFallback.get_model_params-482"><span class="linenos">482</span></a>            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_with&quot;</span><span class="p">][</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-483"><a href="#EndaEstimatorWithFallback.get_model_params-483"><span class="linenos">483</span></a>
</span><span id="EndaEstimatorWithFallback.get_model_params-484"><a href="#EndaEstimatorWithFallback.get_model_params-484"><span class="linenos">484</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">base_estimators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-485"><a href="#EndaEstimatorWithFallback.get_model_params-485"><span class="linenos">485</span></a>            <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-486"><a href="#EndaEstimatorWithFallback.get_model_params-486"><span class="linenos">486</span></a>            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_without&quot;</span><span class="p">][</span><span class="s2">&quot;base_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-487"><a href="#EndaEstimatorWithFallback.get_model_params-487"><span class="linenos">487</span></a>
</span><span id="EndaEstimatorWithFallback.get_model_params-488"><a href="#EndaEstimatorWithFallback.get_model_params-488"><span class="linenos">488</span></a>        <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_with</span><span class="o">.</span><span class="n">final_estimator</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-489"><a href="#EndaEstimatorWithFallback.get_model_params-489"><span class="linenos">489</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_with&quot;</span><span class="p">][</span><span class="s2">&quot;final_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-490"><a href="#EndaEstimatorWithFallback.get_model_params-490"><span class="linenos">490</span></a>
</span><span id="EndaEstimatorWithFallback.get_model_params-491"><a href="#EndaEstimatorWithFallback.get_model_params-491"><span class="linenos">491</span></a>        <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_name_and_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_without</span><span class="o">.</span><span class="n">final_estimator</span><span class="p">)</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-492"><a href="#EndaEstimatorWithFallback.get_model_params-492"><span class="linenos">492</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;estimator_without&quot;</span><span class="p">][</span><span class="s2">&quot;final_estimators&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="EndaEstimatorWithFallback.get_model_params-493"><a href="#EndaEstimatorWithFallback.get_model_params-493"><span class="linenos">493</span></a>
</span><span id="EndaEstimatorWithFallback.get_model_params-494"><a href="#EndaEstimatorWithFallback.get_model_params-494"><span class="linenos">494</span></a>        <span class="k">return</span> <span class="n">d</span>
</span></pre></div>


            <div class="docstring"><p>Get model parameters of estimator_with and estimator_without</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A dictionary with one entry per model and associated parameters</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="EndaEstimatorRecopy">
                            <input id="EndaEstimatorRecopy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EndaEstimatorRecopy</span><wbr>(<span class="base"><a href="#EndaEstimator">EndaEstimator</a></span>):

                <label class="view-source-button" for="EndaEstimatorRecopy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorRecopy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorRecopy-497"><a href="#EndaEstimatorRecopy-497"><span class="linenos">497</span></a><span class="k">class</span> <span class="nc">EndaEstimatorRecopy</span><span class="p">(</span><span class="n">EndaEstimator</span><span class="p">):</span>
</span><span id="EndaEstimatorRecopy-498"><a href="#EndaEstimatorRecopy-498"><span class="linenos">498</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy-499"><a href="#EndaEstimatorRecopy-499"><span class="linenos">499</span></a><span class="sd">    This estimator is used to recopy the information</span>
</span><span id="EndaEstimatorRecopy-500"><a href="#EndaEstimatorRecopy-500"><span class="linenos">500</span></a><span class="sd">    It is notably used to predict the production of river power plants, for which no</span>
</span><span id="EndaEstimatorRecopy-501"><a href="#EndaEstimatorRecopy-501"><span class="linenos">501</span></a><span class="sd">    artificial intelligence is relevant.</span>
</span><span id="EndaEstimatorRecopy-502"><a href="#EndaEstimatorRecopy-502"><span class="linenos">502</span></a><span class="sd">    It simply recopies the most recent data on a daily basis.</span>
</span><span id="EndaEstimatorRecopy-503"><a href="#EndaEstimatorRecopy-503"><span class="linenos">503</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy-504"><a href="#EndaEstimatorRecopy-504"><span class="linenos">504</span></a>
</span><span id="EndaEstimatorRecopy-505"><a href="#EndaEstimatorRecopy-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="EndaEstimatorRecopy-506"><a href="#EndaEstimatorRecopy-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy-507"><a href="#EndaEstimatorRecopy-507"><span class="linenos">507</span></a><span class="sd">        Set up the attribute data that will store the dataframe</span>
</span><span id="EndaEstimatorRecopy-508"><a href="#EndaEstimatorRecopy-508"><span class="linenos">508</span></a><span class="sd">        :param period: The period on which past data should be averaged to be used as future value.</span>
</span><span id="EndaEstimatorRecopy-509"><a href="#EndaEstimatorRecopy-509"><span class="linenos">509</span></a><span class="sd">                       It must be convertible to a pd.Timedelta object, eg &#39;1D&#39;, &#39;2H&#39;, etc...</span>
</span><span id="EndaEstimatorRecopy-510"><a href="#EndaEstimatorRecopy-510"><span class="linenos">510</span></a><span class="sd">                       If nothing is provided, the last past value is used in the future</span>
</span><span id="EndaEstimatorRecopy-511"><a href="#EndaEstimatorRecopy-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy-512"><a href="#EndaEstimatorRecopy-512"><span class="linenos">512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="k">if</span> <span class="n">period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="EndaEstimatorRecopy-513"><a href="#EndaEstimatorRecopy-513"><span class="linenos">513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EndaEstimatorRecopy-514"><a href="#EndaEstimatorRecopy-514"><span class="linenos">514</span></a>
</span><span id="EndaEstimatorRecopy-515"><a href="#EndaEstimatorRecopy-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EndaEstimatorRecopy-516"><a href="#EndaEstimatorRecopy-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy-517"><a href="#EndaEstimatorRecopy-517"><span class="linenos">517</span></a><span class="sd">        This function keeps the more recent data of the input dataframe,</span>
</span><span id="EndaEstimatorRecopy-518"><a href="#EndaEstimatorRecopy-518"><span class="linenos">518</span></a><span class="sd">        and stores it in the attribute training_data. If a period has been</span>
</span><span id="EndaEstimatorRecopy-519"><a href="#EndaEstimatorRecopy-519"><span class="linenos">519</span></a><span class="sd">        given to the estimator constructor, it is used to define a period on</span>
</span><span id="EndaEstimatorRecopy-520"><a href="#EndaEstimatorRecopy-520"><span class="linenos">520</span></a><span class="sd">        which to average the data.</span>
</span><span id="EndaEstimatorRecopy-521"><a href="#EndaEstimatorRecopy-521"><span class="linenos">521</span></a>
</span><span id="EndaEstimatorRecopy-522"><a href="#EndaEstimatorRecopy-522"><span class="linenos">522</span></a><span class="sd">        :param df: The input dataframe, with a single DatetimeIndex</span>
</span><span id="EndaEstimatorRecopy-523"><a href="#EndaEstimatorRecopy-523"><span class="linenos">523</span></a><span class="sd">        :param target_col: the target column</span>
</span><span id="EndaEstimatorRecopy-524"><a href="#EndaEstimatorRecopy-524"><span class="linenos">524</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy-525"><a href="#EndaEstimatorRecopy-525"><span class="linenos">525</span></a>
</span><span id="EndaEstimatorRecopy-526"><a href="#EndaEstimatorRecopy-526"><span class="linenos">526</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="EndaEstimatorRecopy-527"><a href="#EndaEstimatorRecopy-527"><span class="linenos">527</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Index should be of type DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="EndaEstimatorRecopy-528"><a href="#EndaEstimatorRecopy-528"><span class="linenos">528</span></a>
</span><span id="EndaEstimatorRecopy-529"><a href="#EndaEstimatorRecopy-529"><span class="linenos">529</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy-530"><a href="#EndaEstimatorRecopy-530"><span class="linenos">530</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorRecopy-531"><a href="#EndaEstimatorRecopy-531"><span class="linenos">531</span></a>                <span class="sa">f</span><span class="s2">&quot;Target column </span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> not found in the training dataframe&quot;</span>
</span><span id="EndaEstimatorRecopy-532"><a href="#EndaEstimatorRecopy-532"><span class="linenos">532</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorRecopy-533"><a href="#EndaEstimatorRecopy-533"><span class="linenos">533</span></a>
</span><span id="EndaEstimatorRecopy-534"><a href="#EndaEstimatorRecopy-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy-535"><a href="#EndaEstimatorRecopy-535"><span class="linenos">535</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
</span><span id="EndaEstimatorRecopy-536"><a href="#EndaEstimatorRecopy-536"><span class="linenos">536</span></a>                <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">target_col</span><span class="p">])</span>
</span><span id="EndaEstimatorRecopy-537"><a href="#EndaEstimatorRecopy-537"><span class="linenos">537</span></a>            <span class="p">]</span>
</span><span id="EndaEstimatorRecopy-538"><a href="#EndaEstimatorRecopy-538"><span class="linenos">538</span></a>
</span><span id="EndaEstimatorRecopy-539"><a href="#EndaEstimatorRecopy-539"><span class="linenos">539</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy-540"><a href="#EndaEstimatorRecopy-540"><span class="linenos">540</span></a>            <span class="c1"># the training dataframe must have a well-defined frequency</span>
</span><span id="EndaEstimatorRecopy-541"><a href="#EndaEstimatorRecopy-541"><span class="linenos">541</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
</span><span id="EndaEstimatorRecopy-542"><a href="#EndaEstimatorRecopy-542"><span class="linenos">542</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span>
</span><span id="EndaEstimatorRecopy-543"><a href="#EndaEstimatorRecopy-543"><span class="linenos">543</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">target_col</span><span class="p">]),</span>
</span><span id="EndaEstimatorRecopy-544"><a href="#EndaEstimatorRecopy-544"><span class="linenos">544</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="EndaEstimatorRecopy-545"><a href="#EndaEstimatorRecopy-545"><span class="linenos">545</span></a>
</span><span id="EndaEstimatorRecopy-546"><a href="#EndaEstimatorRecopy-546"><span class="linenos">546</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy-547"><a href="#EndaEstimatorRecopy-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy-548"><a href="#EndaEstimatorRecopy-548"><span class="linenos">548</span></a><span class="sd">        Make a prediction just copying the retained information.</span>
</span><span id="EndaEstimatorRecopy-549"><a href="#EndaEstimatorRecopy-549"><span class="linenos">549</span></a><span class="sd">        :param df: The input forecast dataframe, with a single DatetimeIndex</span>
</span><span id="EndaEstimatorRecopy-550"><a href="#EndaEstimatorRecopy-550"><span class="linenos">550</span></a><span class="sd">        :param target_col: the target column</span>
</span><span id="EndaEstimatorRecopy-551"><a href="#EndaEstimatorRecopy-551"><span class="linenos">551</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy-552"><a href="#EndaEstimatorRecopy-552"><span class="linenos">552</span></a>
</span><span id="EndaEstimatorRecopy-553"><a href="#EndaEstimatorRecopy-553"><span class="linenos">553</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy-554"><a href="#EndaEstimatorRecopy-554"><span class="linenos">554</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorRecopy-555"><a href="#EndaEstimatorRecopy-555"><span class="linenos">555</span></a>                <span class="s2">&quot;There is no training dataset defined. Must call &#39;train&#39; before &#39;predict&#39;&quot;</span>
</span><span id="EndaEstimatorRecopy-556"><a href="#EndaEstimatorRecopy-556"><span class="linenos">556</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorRecopy-557"><a href="#EndaEstimatorRecopy-557"><span class="linenos">557</span></a>
</span><span id="EndaEstimatorRecopy-558"><a href="#EndaEstimatorRecopy-558"><span class="linenos">558</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_data</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
</span><span id="EndaEstimatorRecopy-559"><a href="#EndaEstimatorRecopy-559"><span class="linenos">559</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorRecopy-560"><a href="#EndaEstimatorRecopy-560"><span class="linenos">560</span></a>                <span class="s2">&quot;Forecast dataset index should be of same type of input dataset&quot;</span>
</span><span id="EndaEstimatorRecopy-561"><a href="#EndaEstimatorRecopy-561"><span class="linenos">561</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorRecopy-562"><a href="#EndaEstimatorRecopy-562"><span class="linenos">562</span></a>
</span><span id="EndaEstimatorRecopy-563"><a href="#EndaEstimatorRecopy-563"><span class="linenos">563</span></a>        <span class="n">df_predict</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EndaEstimatorRecopy-564"><a href="#EndaEstimatorRecopy-564"><span class="linenos">564</span></a>
</span><span id="EndaEstimatorRecopy-565"><a href="#EndaEstimatorRecopy-565"><span class="linenos">565</span></a>        <span class="n">df_predict</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="EndaEstimatorRecopy-566"><a href="#EndaEstimatorRecopy-566"><span class="linenos">566</span></a>
</span><span id="EndaEstimatorRecopy-567"><a href="#EndaEstimatorRecopy-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">df_predict</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">target_col</span><span class="p">]]</span>
</span></pre></div>


            <div class="docstring"><p>This estimator is used to recopy the information
It is notably used to predict the production of river power plants, for which no
artificial intelligence is relevant.
It simply recopies the most recent data on a daily basis.</p>
</div>


                            <div id="EndaEstimatorRecopy.__init__" class="classattr">
                                        <input id="EndaEstimatorRecopy.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EndaEstimatorRecopy</span><span class="signature pdoc-code multiline">(<span class="param">	period: [&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;pandas._libs.tslibs.timedeltas.Timedelta&#x27;&gt;] = None</span>)</span>

                <label class="view-source-button" for="EndaEstimatorRecopy.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorRecopy.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorRecopy.__init__-505"><a href="#EndaEstimatorRecopy.__init__-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="EndaEstimatorRecopy.__init__-506"><a href="#EndaEstimatorRecopy.__init__-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy.__init__-507"><a href="#EndaEstimatorRecopy.__init__-507"><span class="linenos">507</span></a><span class="sd">        Set up the attribute data that will store the dataframe</span>
</span><span id="EndaEstimatorRecopy.__init__-508"><a href="#EndaEstimatorRecopy.__init__-508"><span class="linenos">508</span></a><span class="sd">        :param period: The period on which past data should be averaged to be used as future value.</span>
</span><span id="EndaEstimatorRecopy.__init__-509"><a href="#EndaEstimatorRecopy.__init__-509"><span class="linenos">509</span></a><span class="sd">                       It must be convertible to a pd.Timedelta object, eg &#39;1D&#39;, &#39;2H&#39;, etc...</span>
</span><span id="EndaEstimatorRecopy.__init__-510"><a href="#EndaEstimatorRecopy.__init__-510"><span class="linenos">510</span></a><span class="sd">                       If nothing is provided, the last past value is used in the future</span>
</span><span id="EndaEstimatorRecopy.__init__-511"><a href="#EndaEstimatorRecopy.__init__-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy.__init__-512"><a href="#EndaEstimatorRecopy.__init__-512"><span class="linenos">512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="k">if</span> <span class="n">period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="EndaEstimatorRecopy.__init__-513"><a href="#EndaEstimatorRecopy.__init__-513"><span class="linenos">513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Set up the attribute data that will store the dataframe</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>period</strong>:  The period on which past data should be averaged to be used as future value.
It must be convertible to a pd.Timedelta object, eg '1D', '2H', etc...
If nothing is provided, the last past value is used in the future</li>
</ul>
</div>


                            </div>
                            <div id="EndaEstimatorRecopy.period" class="classattr">
                                <div class="attr variable">
            <span class="name">period</span>

        
    </div>
    <a class="headerlink" href="#EndaEstimatorRecopy.period"></a>
    
    

                            </div>
                            <div id="EndaEstimatorRecopy.training_data" class="classattr">
                                <div class="attr variable">
            <span class="name">training_data</span>

        
    </div>
    <a class="headerlink" href="#EndaEstimatorRecopy.training_data"></a>
    
    

                            </div>
                            <div id="EndaEstimatorRecopy.train" class="classattr">
                                        <input id="EndaEstimatorRecopy.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>, </span><span class="param"><span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EndaEstimatorRecopy.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorRecopy.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorRecopy.train-515"><a href="#EndaEstimatorRecopy.train-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EndaEstimatorRecopy.train-516"><a href="#EndaEstimatorRecopy.train-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy.train-517"><a href="#EndaEstimatorRecopy.train-517"><span class="linenos">517</span></a><span class="sd">        This function keeps the more recent data of the input dataframe,</span>
</span><span id="EndaEstimatorRecopy.train-518"><a href="#EndaEstimatorRecopy.train-518"><span class="linenos">518</span></a><span class="sd">        and stores it in the attribute training_data. If a period has been</span>
</span><span id="EndaEstimatorRecopy.train-519"><a href="#EndaEstimatorRecopy.train-519"><span class="linenos">519</span></a><span class="sd">        given to the estimator constructor, it is used to define a period on</span>
</span><span id="EndaEstimatorRecopy.train-520"><a href="#EndaEstimatorRecopy.train-520"><span class="linenos">520</span></a><span class="sd">        which to average the data.</span>
</span><span id="EndaEstimatorRecopy.train-521"><a href="#EndaEstimatorRecopy.train-521"><span class="linenos">521</span></a>
</span><span id="EndaEstimatorRecopy.train-522"><a href="#EndaEstimatorRecopy.train-522"><span class="linenos">522</span></a><span class="sd">        :param df: The input dataframe, with a single DatetimeIndex</span>
</span><span id="EndaEstimatorRecopy.train-523"><a href="#EndaEstimatorRecopy.train-523"><span class="linenos">523</span></a><span class="sd">        :param target_col: the target column</span>
</span><span id="EndaEstimatorRecopy.train-524"><a href="#EndaEstimatorRecopy.train-524"><span class="linenos">524</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy.train-525"><a href="#EndaEstimatorRecopy.train-525"><span class="linenos">525</span></a>
</span><span id="EndaEstimatorRecopy.train-526"><a href="#EndaEstimatorRecopy.train-526"><span class="linenos">526</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
</span><span id="EndaEstimatorRecopy.train-527"><a href="#EndaEstimatorRecopy.train-527"><span class="linenos">527</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Index should be of type DatetimeIndex&quot;</span><span class="p">)</span>
</span><span id="EndaEstimatorRecopy.train-528"><a href="#EndaEstimatorRecopy.train-528"><span class="linenos">528</span></a>
</span><span id="EndaEstimatorRecopy.train-529"><a href="#EndaEstimatorRecopy.train-529"><span class="linenos">529</span></a>        <span class="k">if</span> <span class="n">target_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy.train-530"><a href="#EndaEstimatorRecopy.train-530"><span class="linenos">530</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorRecopy.train-531"><a href="#EndaEstimatorRecopy.train-531"><span class="linenos">531</span></a>                <span class="sa">f</span><span class="s2">&quot;Target column </span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> not found in the training dataframe&quot;</span>
</span><span id="EndaEstimatorRecopy.train-532"><a href="#EndaEstimatorRecopy.train-532"><span class="linenos">532</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorRecopy.train-533"><a href="#EndaEstimatorRecopy.train-533"><span class="linenos">533</span></a>
</span><span id="EndaEstimatorRecopy.train-534"><a href="#EndaEstimatorRecopy.train-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy.train-535"><a href="#EndaEstimatorRecopy.train-535"><span class="linenos">535</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
</span><span id="EndaEstimatorRecopy.train-536"><a href="#EndaEstimatorRecopy.train-536"><span class="linenos">536</span></a>                <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">target_col</span><span class="p">])</span>
</span><span id="EndaEstimatorRecopy.train-537"><a href="#EndaEstimatorRecopy.train-537"><span class="linenos">537</span></a>            <span class="p">]</span>
</span><span id="EndaEstimatorRecopy.train-538"><a href="#EndaEstimatorRecopy.train-538"><span class="linenos">538</span></a>
</span><span id="EndaEstimatorRecopy.train-539"><a href="#EndaEstimatorRecopy.train-539"><span class="linenos">539</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy.train-540"><a href="#EndaEstimatorRecopy.train-540"><span class="linenos">540</span></a>            <span class="c1"># the training dataframe must have a well-defined frequency</span>
</span><span id="EndaEstimatorRecopy.train-541"><a href="#EndaEstimatorRecopy.train-541"><span class="linenos">541</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
</span><span id="EndaEstimatorRecopy.train-542"><a href="#EndaEstimatorRecopy.train-542"><span class="linenos">542</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span>
</span><span id="EndaEstimatorRecopy.train-543"><a href="#EndaEstimatorRecopy.train-543"><span class="linenos">543</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">target_col</span><span class="p">]),</span>
</span><span id="EndaEstimatorRecopy.train-544"><a href="#EndaEstimatorRecopy.train-544"><span class="linenos">544</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>This function keeps the more recent data of the input dataframe,
and stores it in the attribute training_data. If a period has been
given to the estimator constructor, it is used to define a period on
which to average the data.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The input dataframe, with a single DatetimeIndex</li>
<li><strong>target_col</strong>:  the target column</li>
</ul>
</div>


                            </div>
                            <div id="EndaEstimatorRecopy.predict" class="classattr">
                                        <input id="EndaEstimatorRecopy.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="EndaEstimatorRecopy.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EndaEstimatorRecopy.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EndaEstimatorRecopy.predict-546"><a href="#EndaEstimatorRecopy.predict-546"><span class="linenos">546</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy.predict-547"><a href="#EndaEstimatorRecopy.predict-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy.predict-548"><a href="#EndaEstimatorRecopy.predict-548"><span class="linenos">548</span></a><span class="sd">        Make a prediction just copying the retained information.</span>
</span><span id="EndaEstimatorRecopy.predict-549"><a href="#EndaEstimatorRecopy.predict-549"><span class="linenos">549</span></a><span class="sd">        :param df: The input forecast dataframe, with a single DatetimeIndex</span>
</span><span id="EndaEstimatorRecopy.predict-550"><a href="#EndaEstimatorRecopy.predict-550"><span class="linenos">550</span></a><span class="sd">        :param target_col: the target column</span>
</span><span id="EndaEstimatorRecopy.predict-551"><a href="#EndaEstimatorRecopy.predict-551"><span class="linenos">551</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EndaEstimatorRecopy.predict-552"><a href="#EndaEstimatorRecopy.predict-552"><span class="linenos">552</span></a>
</span><span id="EndaEstimatorRecopy.predict-553"><a href="#EndaEstimatorRecopy.predict-553"><span class="linenos">553</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EndaEstimatorRecopy.predict-554"><a href="#EndaEstimatorRecopy.predict-554"><span class="linenos">554</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorRecopy.predict-555"><a href="#EndaEstimatorRecopy.predict-555"><span class="linenos">555</span></a>                <span class="s2">&quot;There is no training dataset defined. Must call &#39;train&#39; before &#39;predict&#39;&quot;</span>
</span><span id="EndaEstimatorRecopy.predict-556"><a href="#EndaEstimatorRecopy.predict-556"><span class="linenos">556</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorRecopy.predict-557"><a href="#EndaEstimatorRecopy.predict-557"><span class="linenos">557</span></a>
</span><span id="EndaEstimatorRecopy.predict-558"><a href="#EndaEstimatorRecopy.predict-558"><span class="linenos">558</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_data</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
</span><span id="EndaEstimatorRecopy.predict-559"><a href="#EndaEstimatorRecopy.predict-559"><span class="linenos">559</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="EndaEstimatorRecopy.predict-560"><a href="#EndaEstimatorRecopy.predict-560"><span class="linenos">560</span></a>                <span class="s2">&quot;Forecast dataset index should be of same type of input dataset&quot;</span>
</span><span id="EndaEstimatorRecopy.predict-561"><a href="#EndaEstimatorRecopy.predict-561"><span class="linenos">561</span></a>            <span class="p">)</span>
</span><span id="EndaEstimatorRecopy.predict-562"><a href="#EndaEstimatorRecopy.predict-562"><span class="linenos">562</span></a>
</span><span id="EndaEstimatorRecopy.predict-563"><a href="#EndaEstimatorRecopy.predict-563"><span class="linenos">563</span></a>        <span class="n">df_predict</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EndaEstimatorRecopy.predict-564"><a href="#EndaEstimatorRecopy.predict-564"><span class="linenos">564</span></a>
</span><span id="EndaEstimatorRecopy.predict-565"><a href="#EndaEstimatorRecopy.predict-565"><span class="linenos">565</span></a>        <span class="n">df_predict</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</span><span id="EndaEstimatorRecopy.predict-566"><a href="#EndaEstimatorRecopy.predict-566"><span class="linenos">566</span></a>
</span><span id="EndaEstimatorRecopy.predict-567"><a href="#EndaEstimatorRecopy.predict-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">df_predict</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">target_col</span><span class="p">]]</span>
</span></pre></div>


            <div class="docstring"><p>Make a prediction just copying the retained information.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong>:  The input forecast dataframe, with a single DatetimeIndex</li>
<li><strong>target_col</strong>:  the target column</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>